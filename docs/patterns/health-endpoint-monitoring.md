---
title: Modello di monitoraggio endpoint di integrità
titleSuffix: Cloud Design Patterns
description: Implementare controlli funzionali all'interno di un'applicazione a cui gli strumenti esterni possono accedere tramite endpoint esposti a intervalli regolari.
keywords: schema progettuale
author: dragon119
ms.date: 06/23/2017
ms.custom: seodec18
ms.openlocfilehash: 85a1355ff47e6fce80d9b2ed114024651eb994db
ms.sourcegitcommit: 1f4cdb08fe73b1956e164ad692f792f9f635b409
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2019
ms.locfileid: "54114250"
---
# <a name="health-endpoint-monitoring-pattern"></a><span data-ttu-id="72fd9-104">Modello di monitoraggio endpoint di integrità</span><span class="sxs-lookup"><span data-stu-id="72fd9-104">Health Endpoint Monitoring pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="72fd9-105">Implementare controlli funzionali all'interno di un'applicazione a cui gli strumenti esterni possono accedere tramite endpoint esposti a intervalli regolari.</span><span class="sxs-lookup"><span data-stu-id="72fd9-105">Implement functional checks in an application that external tools can access through exposed endpoints at regular intervals.</span></span> <span data-ttu-id="72fd9-106">Ciò consente di verificare che le applicazioni e i servizi funzionino correttamente.</span><span class="sxs-lookup"><span data-stu-id="72fd9-106">This can help to verify that applications and services are performing correctly.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="72fd9-107">Contesto e problema</span><span class="sxs-lookup"><span data-stu-id="72fd9-107">Context and problem</span></span>

<span data-ttu-id="72fd9-108">È buona norma, e spesso un requisito di business, monitorare le applicazioni Web e i servizi di back-end per verificare che siano disponibili e funzionino correttamente.</span><span class="sxs-lookup"><span data-stu-id="72fd9-108">It's a good practice, and often a business requirement, to monitor web applications and back-end services, to ensure they're available and performing correctly.</span></span> <span data-ttu-id="72fd9-109">È comunque più difficile monitorare i servizi in esecuzione nel cloud anziché i servizi locali.</span><span class="sxs-lookup"><span data-stu-id="72fd9-109">However, it's more difficult to monitor services running in the cloud than it is to monitor on-premises services.</span></span> <span data-ttu-id="72fd9-110">Ad esempio, non si esercita controllo completo sull'ambiente di hosting e i servizi in genere dipendono da altri servizi offerti dai fornitori di piattaforme e altri.</span><span class="sxs-lookup"><span data-stu-id="72fd9-110">For example, you don't have full control of the hosting environment, and the services typically depend on other services provided by platform vendors and others.</span></span>

<span data-ttu-id="72fd9-111">Molti fattori influiscono sulle applicazioni ospitate nel cloud, ad esempio latenza di rete, prestazioni e disponibilità dei sistemi di elaborazione e archiviazione sottostanti, nonché la larghezza di banda di rete tra questi.</span><span class="sxs-lookup"><span data-stu-id="72fd9-111">There are many factors that affect cloud-hosted applications such as network latency, the performance and availability of the underlying compute and storage systems, and the network bandwidth between them.</span></span> <span data-ttu-id="72fd9-112">Il servizio può non riuscire in modo completo o parziale per via di uno di questi fattori.</span><span class="sxs-lookup"><span data-stu-id="72fd9-112">The service can fail entirely or partially due to any of these factors.</span></span> <span data-ttu-id="72fd9-113">È pertanto necessario verificare a intervalli regolari che il servizio funzioni correttamente per garantire il livello di disponibilità richiesto, che potrebbe far parte del contratto di servizio (SLA).</span><span class="sxs-lookup"><span data-stu-id="72fd9-113">Therefore, you must verify at regular intervals that the service is performing correctly to ensure the required level of availability, which might be part of your service level agreement (SLA).</span></span>

## <a name="solution"></a><span data-ttu-id="72fd9-114">Soluzione</span><span class="sxs-lookup"><span data-stu-id="72fd9-114">Solution</span></span>

<span data-ttu-id="72fd9-115">Implementare il monitoraggio dell'integrità inviando richieste a un endpoint nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-115">Implement health monitoring by sending requests to an endpoint on the application.</span></span> <span data-ttu-id="72fd9-116">L'applicazione deve eseguire i controlli necessari e restituire un'indicazione del relativo stato.</span><span class="sxs-lookup"><span data-stu-id="72fd9-116">The application should perform the necessary checks, and return an indication of its status.</span></span>

<span data-ttu-id="72fd9-117">Un controllo di monitoraggio dell'integrità combina in genere due fattori:</span><span class="sxs-lookup"><span data-stu-id="72fd9-117">A health monitoring check typically combines two factors:</span></span>

- <span data-ttu-id="72fd9-118">I controlli (se presenti) eseguiti dall'applicazione o dal servizio in risposta alla richiesta all'endpoint di verifica dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-118">The checks (if any) performed by the application or service in response to the request to the health verification endpoint.</span></span>
- <span data-ttu-id="72fd9-119">L'analisi dei risultati eseguita dallo strumento o dal framework che esegue il controllo di verifica dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-119">Analysis of the results by the tool or framework that performs the health verification check.</span></span>

<span data-ttu-id="72fd9-120">Il codice di risposta indica lo stato dell'applicazione e, facoltativamente, eventuali componenti o servizi usati.</span><span class="sxs-lookup"><span data-stu-id="72fd9-120">The response code indicates the status of the application and, optionally, any components or services it uses.</span></span> <span data-ttu-id="72fd9-121">Il controllo di latenza o del tempo di risposta viene eseguito dallo strumento o dal framework di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="72fd9-121">The latency or response time check is performed by the monitoring tool or framework.</span></span> <span data-ttu-id="72fd9-122">La figura offre una panoramica del modello.</span><span class="sxs-lookup"><span data-stu-id="72fd9-122">The figure provides an overview of the pattern.</span></span>

![Panoramica del modello](./_images/health-endpoint-monitoring-pattern.png)

<span data-ttu-id="72fd9-124">Altri controlli che possono essere eseguiti dal codice di monitoraggio dell'integrità nell'applicazione includono:</span><span class="sxs-lookup"><span data-stu-id="72fd9-124">Other checks that might be carried out by the health monitoring code in the application include:</span></span>

- <span data-ttu-id="72fd9-125">Controllo della disponibilità e del tempo di risposta dell'archiviazione cloud o di un database.</span><span class="sxs-lookup"><span data-stu-id="72fd9-125">Checking cloud storage or a database for availability and response time.</span></span>
- <span data-ttu-id="72fd9-126">Controllo di risorse o servizi nell'applicazione o altrove, ma usati dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-126">Checking other resources or services located in the application, or located elsewhere but used by the application.</span></span>

<span data-ttu-id="72fd9-127">Sono disponibili servizi e strumenti che monitorano le applicazioni Web inviando una richiesta a un set configurabile di endpoint e valutando i risultati a fronte di un set di regole configurabili.</span><span class="sxs-lookup"><span data-stu-id="72fd9-127">Services and tools are available that monitor web applications by submitting a request to a configurable set of endpoints, and evaluating the results against a set of configurable rules.</span></span> <span data-ttu-id="72fd9-128">È relativamente semplice creare un endpoint di servizio il cui unico scopo consista nell'eseguire alcuni test funzionali nel sistema.</span><span class="sxs-lookup"><span data-stu-id="72fd9-128">It's relatively easy to create a service endpoint whose sole purpose is to perform some functional tests on the system.</span></span>

<span data-ttu-id="72fd9-129">Controlli tipici che possono essere eseguiti dagli strumenti di monitoraggio includono:</span><span class="sxs-lookup"><span data-stu-id="72fd9-129">Typical checks that can be performed by the monitoring tools include:</span></span>

- <span data-ttu-id="72fd9-130">Convalida del codice di risposta.</span><span class="sxs-lookup"><span data-stu-id="72fd9-130">Validating the response code.</span></span> <span data-ttu-id="72fd9-131">Ad esempio, una risposta HTTP di 200 (OK) indica che l'applicazione ha risposto senza errori.</span><span class="sxs-lookup"><span data-stu-id="72fd9-131">For example, an HTTP response of 200 (OK) indicates that the application responded without error.</span></span> <span data-ttu-id="72fd9-132">Il sistema di monitoraggio potrebbe anche controllare altri codici di risposta per offrire risultati più completi.</span><span class="sxs-lookup"><span data-stu-id="72fd9-132">The monitoring system might also check for other response codes to give more comprehensive results.</span></span>
- <span data-ttu-id="72fd9-133">Controllo del contenuto della risposta per rilevare errori, anche quando viene restituito un codice di stato 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="72fd9-133">Checking the content of the response to detect errors, even when a 200 (OK) status code is returned.</span></span> <span data-ttu-id="72fd9-134">In questo modo è possibile rilevare errori che riguardano solo una sezione della pagina Web o della risposta del servizio restituita.</span><span class="sxs-lookup"><span data-stu-id="72fd9-134">This can detect errors that affect only a section of the returned web page or service response.</span></span> <span data-ttu-id="72fd9-135">Ad esempio, il controllo del titolo di una pagina o la ricerca di una frase specifica che indichi che è stata restituita la pagina corretta.</span><span class="sxs-lookup"><span data-stu-id="72fd9-135">For example, checking the title of a page or looking for a specific phrase that indicates the correct page was returned.</span></span>
- <span data-ttu-id="72fd9-136">Misurazione del tempo di risposta, che indica una combinazione di latenza di rete e del tempo impiegato dall'applicazione per eseguire la richiesta.</span><span class="sxs-lookup"><span data-stu-id="72fd9-136">Measuring the response time, which indicates a combination of the network latency and the time that the application took to execute the request.</span></span> <span data-ttu-id="72fd9-137">Un valore di incremento può indicare un problema emergente con l'applicazione o la rete.</span><span class="sxs-lookup"><span data-stu-id="72fd9-137">An increasing value can indicate an emerging problem with the application or network.</span></span>
- <span data-ttu-id="72fd9-138">Controllo delle risorse o dei servizi che si trovano all'esterno dell'applicazione, ad esempio una rete per la distribuzione di contenuti usata dall'applicazione per distribuire contenuti da cache globali.</span><span class="sxs-lookup"><span data-stu-id="72fd9-138">Checking resources or services located outside the application, such as a content delivery network used by the application to deliver content from global caches.</span></span>
- <span data-ttu-id="72fd9-139">Controllo della scadenza dei certificati SSL.</span><span class="sxs-lookup"><span data-stu-id="72fd9-139">Checking for expiration of SSL certificates.</span></span>
- <span data-ttu-id="72fd9-140">Misurazione del tempo di risposta di una ricerca DNS dell'URL dell'applicazione per misurare la latenza e gli errori DNS.</span><span class="sxs-lookup"><span data-stu-id="72fd9-140">Measuring the response time of a DNS lookup for the URL of the application to measure DNS latency and DNS failures.</span></span>
- <span data-ttu-id="72fd9-141">Convalida dell'URL restituito dalla ricerca DNS per verificare le voci corrette.</span><span class="sxs-lookup"><span data-stu-id="72fd9-141">Validating the URL returned by the DNS lookup to ensure correct entries.</span></span> <span data-ttu-id="72fd9-142">In questo modo è possibile evitare il reindirizzamento dannoso delle richieste mediante un attacco sul server DNS.</span><span class="sxs-lookup"><span data-stu-id="72fd9-142">This can help to avoid malicious request redirection through a successful attack on the DNS server.</span></span>

<span data-ttu-id="72fd9-143">È anche utile, laddove possibile, eseguire questi controlli da posizioni ospitate o locali diverse per misurare e confrontare i tempi di risposta.</span><span class="sxs-lookup"><span data-stu-id="72fd9-143">It's also useful, where possible, to run these checks from different on-premises or hosted locations to measure and compare response times.</span></span> <span data-ttu-id="72fd9-144">In teoria è consigliabile monitorare le applicazioni da posizioni vicine ai clienti per ottenere una vista accurata delle prestazioni da ogni posizione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-144">Ideally you should monitor applications from locations that are close to customers to get an accurate view of the performance from each location.</span></span> <span data-ttu-id="72fd9-145">Oltre a offrire un meccanismo di controllo più efficiente, i risultati sono utili per decidere la posizione di distribuzione per l'applicazione e scegliere se distribuirla in più data center.</span><span class="sxs-lookup"><span data-stu-id="72fd9-145">In addition to providing a more robust checking mechanism, the results can help you decide on the deployment location for the application&mdash;and whether to deploy it in more than one datacenter.</span></span>

<span data-ttu-id="72fd9-146">È consigliabile eseguire test anche per tutte le istanze del servizio usate dai clienti per verificare che l'applicazione funzioni correttamente per tutti i clienti.</span><span class="sxs-lookup"><span data-stu-id="72fd9-146">Tests should also be run against all the service instances that customers use to ensure the application is working correctly for all customers.</span></span> <span data-ttu-id="72fd9-147">Ad esempio, se le risorse di archiviazione dei clienti sono suddivise in più account di archiviazione, il processo di monitoraggio dovrebbe controllarli tutti.</span><span class="sxs-lookup"><span data-stu-id="72fd9-147">For example, if customer storage is spread across more than one storage account, the monitoring process should check all of these.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="72fd9-148">Considerazioni e problemi</span><span class="sxs-lookup"><span data-stu-id="72fd9-148">Issues and considerations</span></span>

<span data-ttu-id="72fd9-149">Prima di decidere come implementare questo modello, considerare quanto segue:</span><span class="sxs-lookup"><span data-stu-id="72fd9-149">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="72fd9-150">Come convalidare la risposta.</span><span class="sxs-lookup"><span data-stu-id="72fd9-150">How to validate the response.</span></span> <span data-ttu-id="72fd9-151">Ad esempio, un singolo codice di stato 200 (OK) è sufficiente per verificare che l'applicazione funzioni correttamente?</span><span class="sxs-lookup"><span data-stu-id="72fd9-151">For example, is just a single 200 (OK) status code sufficient to verify the application is working correctly?</span></span> <span data-ttu-id="72fd9-152">Sebbene questa situazione offra la misura ideale della disponibilità dell'applicazione e rappresenti l'implementazione minima di questo modello, fornisce poche informazioni sulle operazioni, sulle tendenze e sui possibili problemi imminenti nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-152">While this provides the most basic measure of application availability, and is the minimum implementation of this pattern, it provides little information about the operations, trends, and possible upcoming issues in the application.</span></span>

   > <span data-ttu-id="72fd9-153">Verificare che l'applicazione restituisca un codice di stato 200 (OK) solo se la risorsa di destinazione viene trovata ed elaborata.</span><span class="sxs-lookup"><span data-stu-id="72fd9-153">Make sure that the application correctly returns a 200 (OK) only when the target resource is found and processed.</span></span> <span data-ttu-id="72fd9-154">In alcuni scenari, ad esempio quando si usa una pagina master per ospitare la pagina Web di destinazione, il server invia di nuovo un codice di stato 200 (OK) anziché un codice 404 (non trovato), anche se la pagina dei contenuti di destinazione non è stata trovata.</span><span class="sxs-lookup"><span data-stu-id="72fd9-154">In some scenarios, such as when using a master page to host the target web page, the server sends back a 200 (OK) status code instead of a 404 (Not Found) code, even when the target content page was not found.</span></span>

<span data-ttu-id="72fd9-155">Il numero di endpoint da esporre per un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-155">The number of endpoints to expose for an application.</span></span> <span data-ttu-id="72fd9-156">Un approccio consiste nell'esporre almeno un endpoint per i servizi di base usato dall'applicazione e un altro per i servizi di priorità inferiore, consentendo di assegnare vari livelli di importanza a ogni risultato di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="72fd9-156">One approach is to expose at least one endpoint for the core services that the application uses and another for lower priority services, allowing different levels of importance to be assigned to each monitoring result.</span></span> <span data-ttu-id="72fd9-157">Valutare anche di esporre più endpoint, ad esempio uno per ogni servizio di base, per garantire maggiore granularità di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="72fd9-157">Also consider exposing more endpoints, such as one for each core service, for additional monitoring granularity.</span></span> <span data-ttu-id="72fd9-158">Un controllo di verifica dell'integrità potrebbe ad esempio controllare il database, la risorsa di archiviazione e un servizio di geocodifica esterno usato da un'applicazione, ognuno richiedente un livello diverso di tempi di attività e risposta.</span><span class="sxs-lookup"><span data-stu-id="72fd9-158">For example, a health verification check might check the database, storage, and an external geocoding service that an application uses, with each requiring a different level of uptime and response time.</span></span> <span data-ttu-id="72fd9-159">L'applicazione potrebbe comunque essere ancora integra se il servizio di geocodifica o un'altra attività in background non è disponibile per alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="72fd9-159">The application could still be healthy if the geocoding service, or some other background task, is unavailable for a few minutes.</span></span>

<span data-ttu-id="72fd9-160">Se per il monitoraggio si intende usare lo stesso endpoint per l'accesso generale, ma a un percorso specifico progettato per i controlli di verifica dell'integrità, ad esempio /HealthCheck/{GUID}/ nell'endpoint di accesso generale.</span><span class="sxs-lookup"><span data-stu-id="72fd9-160">Whether to use the same endpoint for monitoring as is used for general access, but to a specific path designed for health verification checks, for example, /HealthCheck/{GUID}/ on the general access endpoint.</span></span> <span data-ttu-id="72fd9-161">In questo modo alcuni test funzionali nell'applicazione possono essere eseguiti dagli strumenti di monitoraggio, ad esempio l'aggiunta di una nuova registrazione utente, l'accesso e l'inserimento di un ordine di test, verificando al contempo che l'endpoint di accesso generale sia disponibile.</span><span class="sxs-lookup"><span data-stu-id="72fd9-161">This allows some functional tests in the application to be run by the monitoring tools, such as adding a new user registration, signing in, and placing a test order, while also verifying that the general access endpoint is available.</span></span>

<span data-ttu-id="72fd9-162">Il tipo di informazioni da raccogliere nel servizio in risposta a richieste di monitoraggio e il modo in cui restituirle.</span><span class="sxs-lookup"><span data-stu-id="72fd9-162">The type of information to collect in the service in response to monitoring requests, and how to return this information.</span></span> <span data-ttu-id="72fd9-163">La maggior parte degli strumenti e dei framework esistenti verificano solo il codice di stato HTTP restituito dall'endpoint.</span><span class="sxs-lookup"><span data-stu-id="72fd9-163">Most existing tools and frameworks look only at the HTTP status code that the endpoint returns.</span></span> <span data-ttu-id="72fd9-164">Per restituire e convalidare informazioni aggiuntive, potrebbe essere necessario creare un servizio o un'utilità di monitoraggio personalizzata.</span><span class="sxs-lookup"><span data-stu-id="72fd9-164">To return and validate additional information, you might have to create a custom monitoring utility or service.</span></span>

<span data-ttu-id="72fd9-165">Quantità di informazioni da raccogliere.</span><span class="sxs-lookup"><span data-stu-id="72fd9-165">How much information to collect.</span></span> <span data-ttu-id="72fd9-166">L'esecuzione di eccessive elaborazioni durante il controllo può sottoporre a overload l'applicazione e influire su altri utenti.</span><span class="sxs-lookup"><span data-stu-id="72fd9-166">Performing excessive processing during the check can overload the application and impact other users.</span></span> <span data-ttu-id="72fd9-167">Il tempo impiegato potrebbe superare il timeout del sistema di monitoraggio, contrassegnando l'applicazione come non disponibile.</span><span class="sxs-lookup"><span data-stu-id="72fd9-167">The time it takes might exceed the timeout of the monitoring system so it marks the application as unavailable.</span></span> <span data-ttu-id="72fd9-168">La maggior parte delle applicazioni include la strumentazione, ad esempio gestori di errori e contatori delle prestazioni che registrano prestazioni e informazioni dettagliate sugli errori. Potrebbe essere sufficiente, anziché restituire altre informazioni da un controllo di verifica dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-168">Most applications include instrumentation such as error handlers and performance counters that log performance and detailed error information, this might be sufficient instead of returning additional information from a health verification check.</span></span>

<span data-ttu-id="72fd9-169">Memorizzazione nella cache dello stato dell'endpoint.</span><span class="sxs-lookup"><span data-stu-id="72fd9-169">Caching the endpoint status.</span></span> <span data-ttu-id="72fd9-170">Potrebbe essere dispendioso eseguire troppo spesso il controllo dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-170">It could be expensive to run the health check too frequently.</span></span> <span data-ttu-id="72fd9-171">Se lo stato di integrità viene ad esempio segnalato con un dashboard, non è consigliabile che ogni richiesta del dashboard attivi un controllo dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-171">If the health status is reported through a dashboard, for example, you don't want every request from the dashboard to trigger a health check.</span></span> <span data-ttu-id="72fd9-172">In alternativa, controllare periodicamente l'integrità del sistema e memorizzare lo stato nella cache.</span><span class="sxs-lookup"><span data-stu-id="72fd9-172">Instead, periodically check the system health and cache the status.</span></span> <span data-ttu-id="72fd9-173">Esporre un endpoint che restituisca lo stato memorizzato nella cache.</span><span class="sxs-lookup"><span data-stu-id="72fd9-173">Expose an endpoint that returns the cached status.</span></span>

<span data-ttu-id="72fd9-174">Come configurare la sicurezza per gli endpoint di monitoraggio per la protezione da accesso pubblico, che potrebbe esporre l'applicazione ad attacchi dannosi, rischiare di esporre informazioni sensibili o attirare attacchi Denial of Service (DoS).</span><span class="sxs-lookup"><span data-stu-id="72fd9-174">How to configure security for the monitoring endpoints to protect them from public access, which might expose the application to malicious attacks, risk the exposure of sensitive information, or attract denial of service (DoS) attacks.</span></span> <span data-ttu-id="72fd9-175">Questo deve in genere verificarsi nella configurazione dell'applicazione in modo che possa essere facilmente aggiornata senza riavviare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-175">Typically this should be done in the application configuration so that it can be updated easily without restarting the application.</span></span> <span data-ttu-id="72fd9-176">Considerare l'uso di una o più tecniche riportate di seguito:</span><span class="sxs-lookup"><span data-stu-id="72fd9-176">Consider using one or more of the following techniques:</span></span>

- <span data-ttu-id="72fd9-177">Proteggere l'endpoint richiedendo l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-177">Secure the endpoint by requiring authentication.</span></span> <span data-ttu-id="72fd9-178">A tale scopo, usare una chiave di sicurezza dell'autenticazione nell'intestazione della richiesta o passare le credenziali con la richiesta, a condizione che lo strumento o il servizio di monitoraggio supporti l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-178">You can do this by using an authentication security key in the request header or by passing credentials with the request, provided that the monitoring service or tool supports authentication.</span></span>

  - <span data-ttu-id="72fd9-179">Usare un endpoint oscuro o nascosto.</span><span class="sxs-lookup"><span data-stu-id="72fd9-179">Use an obscure or hidden endpoint.</span></span> <span data-ttu-id="72fd9-180">Ad esempio, esporre l'endpoint in un indirizzo IP diverso da quello usato dall'URL dell'applicazione predefinito, configurare l'endpoint su una porta HTTP non standard e/o usare un percorso complesso per la pagina di test.</span><span class="sxs-lookup"><span data-stu-id="72fd9-180">For example, expose the endpoint on a different IP address to that used by the default application URL, configure the endpoint on a nonstandard HTTP port, and/or use a complex path to the test page.</span></span> <span data-ttu-id="72fd9-181">È in genere possibile specificare indirizzi e porte di endpoint aggiuntivi nella configurazione dell'applicazione e aggiungere voci per questi endpoint al server DNS, se necessario, per evitare di dover specificare direttamente l'indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="72fd9-181">You can usually specify additional endpoint addresses and ports in the application configuration, and add entries for these endpoints to the DNS server if required to avoid having to specify the IP address directly.</span></span>

  - <span data-ttu-id="72fd9-182">Esporre un metodo su un endpoint che accetta un parametro, ad esempio un valore di chiave o di modalità di operazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-182">Expose a method on an endpoint that accepts a parameter such as a key value or an operation mode value.</span></span> <span data-ttu-id="72fd9-183">A seconda del valore specificato per questo parametro, quando si riceve una richiesta il codice può eseguire un test o un set di test specifico oppure restituire un errore 404 (non trovato) se il valore del parametro non viene riconosciuto.</span><span class="sxs-lookup"><span data-stu-id="72fd9-183">Depending on the value supplied for this parameter, when a request is received the code can perform a specific test or set of tests, or return a 404 (Not Found) error if the parameter value isn't recognized.</span></span> <span data-ttu-id="72fd9-184">Nella configurazione dell'applicazione è possibile impostare i valori dei parametri riconosciuti.</span><span class="sxs-lookup"><span data-stu-id="72fd9-184">The recognized parameter values could be set in the application configuration.</span></span>

     >  <span data-ttu-id="72fd9-185">Gli attacchi DoS hanno in genere un impatto inferiore su un endpoint separato che esegue test funzionali di base senza compromettere il funzionamento dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-185">DoS attacks are likely to have less impact on a separate endpoint that performs basic functional tests without compromising the operation of the application.</span></span> <span data-ttu-id="72fd9-186">Evitare se possibile di usare un test che possa esporre informazioni riservate.</span><span class="sxs-lookup"><span data-stu-id="72fd9-186">Ideally, avoid using a test that might expose sensitive information.</span></span> <span data-ttu-id="72fd9-187">Se è necessario restituire informazioni che potrebbero essere utili a un utente malintenzionato, valutare un modo per proteggere l'endpoint e i dati da un accesso non autorizzato.</span><span class="sxs-lookup"><span data-stu-id="72fd9-187">If you must return information that might be useful to an attacker, consider how you'll protect the endpoint and the data from unauthorized access.</span></span> <span data-ttu-id="72fd9-188">In questo caso, affidarsi all'oscuramento non è sufficiente.</span><span class="sxs-lookup"><span data-stu-id="72fd9-188">In this case just relying on obscurity isn't enough.</span></span> <span data-ttu-id="72fd9-189">È opportuno valutare anche l'uso di una connessione HTTPS e la crittografia dei dati sensibili, sebbene aumenti il carico sul server.</span><span class="sxs-lookup"><span data-stu-id="72fd9-189">You should also consider using an HTTPS connection and encrypting any sensitive data, although this will increase the load on the server.</span></span>

- <span data-ttu-id="72fd9-190">Come accedere a un endpoint protetto mediante autenticazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-190">How to access an endpoint that's secured using authentication.</span></span> <span data-ttu-id="72fd9-191">Non tutti gli strumenti e i framework possono essere configurati per includere credenziali con la richiesta di verifica dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-191">Not all tools and frameworks can be configured to include credentials with the health verification request.</span></span> <span data-ttu-id="72fd9-192">Ad esempio, le funzionalità di verifica dell'integrità predefinite di Microsoft Azure non forniscono credenziali di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-192">For example, Microsoft Azure built-in health verification features can't provide authentication credentials.</span></span> <span data-ttu-id="72fd9-193">Sono disponibili alcune alternative di terze parti: [Pingdom](https://www.pingdom.com/), [Panopta](https://www.panopta.com/), [NewRelic](https://newrelic.com/) e [Statuscake](https://www.statuscake.com/).</span><span class="sxs-lookup"><span data-stu-id="72fd9-193">Some third-party alternatives are [Pingdom](https://www.pingdom.com/), [Panopta](https://www.panopta.com/), [NewRelic](https://newrelic.com/), and [Statuscake](https://www.statuscake.com/).</span></span>

- <span data-ttu-id="72fd9-194">Come garantire la corretta esecuzione dell'agente di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="72fd9-194">How to ensure that the monitoring agent is performing correctly.</span></span> <span data-ttu-id="72fd9-195">Un approccio consiste nell'esporre un endpoint che restituisce semplicemente un valore dalla configurazione dell'applicazione o un valore casuale che può essere usato per testare l'agente.</span><span class="sxs-lookup"><span data-stu-id="72fd9-195">One approach is to expose an endpoint that simply returns a value from the application configuration or a random value that can be used to test the agent.</span></span>

   >  <span data-ttu-id="72fd9-196">Verificare anche che il sistema di monitoraggio esegua controlli su se stesso, ad esempio una verifica automatica e un test integrato, per evitare che restituisca falsi positivi.</span><span class="sxs-lookup"><span data-stu-id="72fd9-196">Also ensure that the monitoring system performs checks on itself, such as a self-test and built-in test, to avoid it issuing false positive results.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="72fd9-197">Quando usare questo modello</span><span class="sxs-lookup"><span data-stu-id="72fd9-197">When to use this pattern</span></span>

<span data-ttu-id="72fd9-198">Questo modello è utile per:</span><span class="sxs-lookup"><span data-stu-id="72fd9-198">This pattern is useful for:</span></span>

- <span data-ttu-id="72fd9-199">Monitorare applicazioni e siti Web per verificare la disponibilità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-199">Monitoring websites and web applications to verify availability.</span></span>
- <span data-ttu-id="72fd9-200">Monitorare applicazioni e siti Web per confermare il corretto funzionamento.</span><span class="sxs-lookup"><span data-stu-id="72fd9-200">Monitoring websites and web applications to check for correct operation.</span></span>
- <span data-ttu-id="72fd9-201">Monitorare servizi di livello intermedio o condivisi per rilevare e isolare un errore che può interrompere altre applicazioni.</span><span class="sxs-lookup"><span data-stu-id="72fd9-201">Monitoring middle-tier or shared services to detect and isolate a failure that could disrupt other applications.</span></span>
- <span data-ttu-id="72fd9-202">Integrare la strumentazione esistente nell'applicazione, ad esempio con contatori delle prestazioni e gestori degli errori.</span><span class="sxs-lookup"><span data-stu-id="72fd9-202">Complementing existing instrumentation in the application, such as performance counters and error handlers.</span></span> <span data-ttu-id="72fd9-203">Il controllo di verifica dell'integrità non sostituisce il requisito di registrazione e controllo nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-203">Health verification checking doesn't replace the requirement for logging and auditing in the application.</span></span> <span data-ttu-id="72fd9-204">La strumentazione offre informazioni utili per un framework esistente che monitora contatori e log degli errori per rilevare altri problemi.</span><span class="sxs-lookup"><span data-stu-id="72fd9-204">Instrumentation can provide valuable information for an existing framework that monitors counters and error logs to detect failures or other issues.</span></span> <span data-ttu-id="72fd9-205">Non fornisce comunque informazioni se l'applicazione non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="72fd9-205">However, it can't provide information if the application is unavailable.</span></span>

## <a name="example"></a><span data-ttu-id="72fd9-206">Esempio</span><span class="sxs-lookup"><span data-stu-id="72fd9-206">Example</span></span>

<span data-ttu-id="72fd9-207">Gli esempi di codice seguenti, ricavati dalla classe `HealthCheckController` (un esempio che illustra questo modello è disponibile in [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring)), espongono un endpoint per l'esecuzione di un'ampia gamma di controlli di integrità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-207">The following code examples, taken from the `HealthCheckController` class (a sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring)), demonstrates exposing an endpoint for performing a range of health checks.</span></span>

<span data-ttu-id="72fd9-208">Il metodo `CoreServices`, illustrato di seguito in C#, esegue una serie di controlli sui servizi usati nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-208">The `CoreServices` method, shown below in C#, performs a series of checks on services used in the application.</span></span> <span data-ttu-id="72fd9-209">Se tutti i test vengono eseguiti senza errori, il metodo restituisce un codice di stato 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="72fd9-209">If all of the tests run without error, the method returns a 200 (OK) status code.</span></span> <span data-ttu-id="72fd9-210">Se un test genera un'eccezione, il metodo restituisce un codice di stato 500 (errore interno).</span><span class="sxs-lookup"><span data-stu-id="72fd9-210">If any of the tests raises an exception, the method returns a 500 (Internal Error) status code.</span></span> <span data-ttu-id="72fd9-211">Il metodo potrebbe anche restituire informazioni aggiuntive in caso di errore, se il framework o lo strumento di monitoraggio è in grado di usarle.</span><span class="sxs-lookup"><span data-stu-id="72fd9-211">The method could optionally return additional information when an error occurs, if the monitoring tool or framework is able to make use of it.</span></span>

```csharp
public ActionResult CoreServices()
{
  try
  {
    // Run a simple check to ensure the database is available.
    DataStore.Instance.CoreHealthCheck();

    // Run a simple check on our external service.
    MyExternalService.Instance.CoreHealthCheck();
  }
  catch (Exception ex)
  {
    Trace.TraceError("Exception in basic health check: {0}", ex.Message);

    // This can optionally return different status codes based on the exception.
    // Optionally it could return more details about the exception.
    // The additional information could be used by administrators who access the
    // endpoint with a browser, or using a ping utility that can display the
    // additional information.
    return new HttpStatusCodeResult((int)HttpStatusCode.InternalServerError);
  }
  return new HttpStatusCodeResult((int)HttpStatusCode.OK);
}
```

<span data-ttu-id="72fd9-212">Il metodo `ObscurePath` mostra come leggere un percorso dalla configurazione dell'applicazione e usarlo come endpoint per i test.</span><span class="sxs-lookup"><span data-stu-id="72fd9-212">The `ObscurePath` method shows how you can read a path from the application configuration and use it as the endpoint for tests.</span></span> <span data-ttu-id="72fd9-213">Questo esempio, in C#, illustra anche come accettare un ID come parametro e usarlo per verificare la presenza di richieste valide.</span><span class="sxs-lookup"><span data-stu-id="72fd9-213">This example, in C#, also shows how you can accept an ID as a parameter and use it to check for valid requests.</span></span>

```csharp
public ActionResult ObscurePath(string id)
{
  // The id could be used as a simple way to obscure or hide the endpoint.
  // The id to match could be retrieved from configuration and, if matched,
  // perform a specific set of tests and return the result. If not matched it
  // could return a 404 (Not Found) status.

  // The obscure path can be set through configuration to hide the endpoint.
  var hiddenPathKey = CloudConfigurationManager.GetSetting("Test.ObscurePath");

  // If the value passed does not match that in configuration, return 404 (Not Found).
  if (!string.Equals(id, hiddenPathKey))
  {
    return new HttpStatusCodeResult((int)HttpStatusCode.NotFound);
  }

  // Else continue and run the tests...
  // Return results from the core services test.
  return this.CoreServices();
}
```

<span data-ttu-id="72fd9-214">Il metodo `TestResponseFromConfig` mostra come esporre un endpoint che esegue un controllo per un valore di impostazione della configurazione specificato.</span><span class="sxs-lookup"><span data-stu-id="72fd9-214">The `TestResponseFromConfig` method shows how you can expose an endpoint that performs a check for a specified configuration setting value.</span></span>

```csharp
public ActionResult TestResponseFromConfig()
{
  // Health check that returns a response code set in configuration for testing.
  var returnStatusCodeSetting = CloudConfigurationManager.GetSetting(
                                                          "Test.ReturnStatusCode");

  int returnStatusCode;

  if (!int.TryParse(returnStatusCodeSetting, out returnStatusCode))
  {
    returnStatusCode = (int)HttpStatusCode.OK;
  }

  return new HttpStatusCodeResult(returnStatusCode);
}
```

## <a name="monitoring-endpoints-in-azure-hosted-applications"></a><span data-ttu-id="72fd9-215">Monitoraggio di endpoint nelle applicazioni ospitate di Azure</span><span class="sxs-lookup"><span data-stu-id="72fd9-215">Monitoring endpoints in Azure hosted applications</span></span>

<span data-ttu-id="72fd9-216">Di seguito sono riportate alcune opzioni per il monitoraggio degli endpoint nelle applicazioni di Azure:</span><span class="sxs-lookup"><span data-stu-id="72fd9-216">Some options for monitoring endpoints in Azure applications are:</span></span>

- <span data-ttu-id="72fd9-217">Usare le funzionalità di monitoraggio integrate di Azure.</span><span class="sxs-lookup"><span data-stu-id="72fd9-217">Use the built-in monitoring features of Azure.</span></span>

- <span data-ttu-id="72fd9-218">Usare un framework o un servizio di terze parti come Microsoft System Center Operations Manager.</span><span class="sxs-lookup"><span data-stu-id="72fd9-218">Use a third-party service or a framework such as Microsoft System Center Operations Manager.</span></span>

- <span data-ttu-id="72fd9-219">Creare un'utilità o un servizio personalizzato eseguibile su un server proprietario oppure ospitato.</span><span class="sxs-lookup"><span data-stu-id="72fd9-219">Create a custom utility or a service that runs on your own or on a hosted server.</span></span>

   >  <span data-ttu-id="72fd9-220">Anche se Azure fornisce un set ragionevolmente completo di opzioni di monitoraggio, è possibile usare altri strumenti e servizi per fornire informazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="72fd9-220">Even though Azure provides a reasonably comprehensive set of monitoring options, you can use additional services and tools to provide extra information.</span></span> <span data-ttu-id="72fd9-221">I servizi di gestione di Azure offrono un meccanismo di monitoraggio integrato per le regole di avviso.</span><span class="sxs-lookup"><span data-stu-id="72fd9-221">Azure Management Services provides a built-in monitoring mechanism for alert rules.</span></span> <span data-ttu-id="72fd9-222">La sezione degli avvisi della pagina relativa ai servizi di gestione nel portale di Azure consente di configurare fino a dieci regole di avviso per ogni sottoscrizione per i servizi.</span><span class="sxs-lookup"><span data-stu-id="72fd9-222">The alerts section of the management services page in the Azure portal allows you to configure up to ten alert rules per subscription for your services.</span></span> <span data-ttu-id="72fd9-223">Queste regole specificano una condizione e un valore di soglia per un servizio, ad esempio il carico della CPU o il numero di richieste o errori al secondo, e il servizio può inviare automaticamente notifiche tramite posta elettronica agli indirizzi definiti in ogni regola.</span><span class="sxs-lookup"><span data-stu-id="72fd9-223">These rules specify a condition and a threshold value for a service such as CPU load, or the number of requests or errors per second, and the service can automatically send email notifications to addresses you define in each rule.</span></span>

<span data-ttu-id="72fd9-224">Le condizioni che è possibile monitorare variano a seconda del meccanismo di hosting scelto per l'applicazione (ad esempio Siti Web, Servizi cloud, Macchine virtuali o Servizi mobili), ma tutti consentono di creare una regola di avviso che usa un endpoint Web specificato nelle impostazioni per il servizio.</span><span class="sxs-lookup"><span data-stu-id="72fd9-224">The conditions you can monitor vary depending on the hosting mechanism you choose for your application (such as Web Sites, Cloud Services, Virtual Machines, or Mobile Services), but all of these include the ability to create an alert rule that uses a web endpoint you specify in the settings for your service.</span></span> <span data-ttu-id="72fd9-225">L'endpoint risponde in modo tempestivo, in modo che il sistema di avvisi possa rilevare il corretto funzionamento dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="72fd9-225">This endpoint should respond in a timely way so that the alert system can detect that the application is operating correctly.</span></span>

> <span data-ttu-id="72fd9-226">Sono disponibili altre informazioni sulla [creazione di notifiche di avviso][portal-alerts].</span><span class="sxs-lookup"><span data-stu-id="72fd9-226">Read more information about [creating alert notifications][portal-alerts].</span></span>

<span data-ttu-id="72fd9-227">Se si ospita l'applicazione nei ruoli Web e di lavoro di Servizi cloud di Azure o in Macchine virtuali, è possibile usufruire di un servizio integrato in Azure, denominato Gestione traffico.</span><span class="sxs-lookup"><span data-stu-id="72fd9-227">If you host your application in Azure Cloud Services web and worker roles or Virtual Machines, you can take advantage of one of the built-in services in Azure called Traffic Manager.</span></span> <span data-ttu-id="72fd9-228">Gestione traffico è un servizio di routing e bilanciamento del carico che consente di distribuire le richieste a istanze specifiche dell'applicazione ospitata in Servizi cloud in base a un'ampia gamma di regole e impostazioni.</span><span class="sxs-lookup"><span data-stu-id="72fd9-228">Traffic Manager is a routing and load-balancing service that can distribute requests to specific instances of your Cloud Services hosted application based on a range of rules and settings.</span></span>

<span data-ttu-id="72fd9-229">Oltre al routing delle richieste, Gestione traffico esegue il ping di un URL, una porta e un percorso relativo specificati a intervalli regolari per determinare quali istanze dell'applicazione definita nelle regole sono attive e rispondono alle richieste.</span><span class="sxs-lookup"><span data-stu-id="72fd9-229">In addition to routing requests, Traffic Manager pings a URL, port, and relative path that you specify on a regular basis to determine which instances of the application defined in its rules are active and are responding to requests.</span></span> <span data-ttu-id="72fd9-230">Se rileva un codice di stato 200 (OK), contrassegna l'applicazione come disponibile.</span><span class="sxs-lookup"><span data-stu-id="72fd9-230">If it detects a status code 200 (OK), it marks the application as available.</span></span> <span data-ttu-id="72fd9-231">Con qualsiasi altro codice di stato, Gestione traffico contrassegna l'applicazione come offline.</span><span class="sxs-lookup"><span data-stu-id="72fd9-231">Any other status code causes Traffic Manager to mark the application as offline.</span></span> <span data-ttu-id="72fd9-232">È possibile visualizzare lo stato nella console di Gestione traffico e configurare la regola per reindirizzare le richieste ad altre istanze dell'applicazione che rispondono.</span><span class="sxs-lookup"><span data-stu-id="72fd9-232">You can view the status in the Traffic Manager console, and configure the rule to reroute requests to other instances of the application that are responding.</span></span>

<span data-ttu-id="72fd9-233">Gestione traffico attenderà tuttavia solo dieci secondi per ricevere una risposta dall'URL di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="72fd9-233">However, Traffic Manager will only wait ten seconds to receive a response from the monitoring URL.</span></span> <span data-ttu-id="72fd9-234">È pertanto necessario verificare che il codice di verifica dell'integrità sia in esecuzione, consentendo la latenza di rete necessaria per il round trip da Gestione traffico all'applicazione e viceversa.</span><span class="sxs-lookup"><span data-stu-id="72fd9-234">Therefore, you should ensure that your health verification code executes in this time, allowing for network latency for the round trip from Traffic Manager to your application and back again.</span></span>

> <span data-ttu-id="72fd9-235">Sono disponibili altre informazioni sull'uso di [Gestione traffico per monitorare le applicazioni](/azure/traffic-manager/).</span><span class="sxs-lookup"><span data-stu-id="72fd9-235">Read more information about using [Traffic Manager to monitor your applications](/azure/traffic-manager/).</span></span> <span data-ttu-id="72fd9-236">Gestione traffico è anche descritto in[Multiple Datacenter Deployment Guidance](https://msdn.microsoft.com/library/dn589779.aspx) (Guida alla distribuzione in più data center).</span><span class="sxs-lookup"><span data-stu-id="72fd9-236">Traffic Manager is also discussed in [Multiple Datacenter Deployment Guidance](https://msdn.microsoft.com/library/dn589779.aspx).</span></span>

## <a name="related-guidance"></a><span data-ttu-id="72fd9-237">Informazioni correlate</span><span class="sxs-lookup"><span data-stu-id="72fd9-237">Related guidance</span></span>

<span data-ttu-id="72fd9-238">Quando si implementa questo modello, possono essere utili le linee guida seguenti:</span><span class="sxs-lookup"><span data-stu-id="72fd9-238">The following guidance can be useful when implementing this pattern:</span></span>

- <span data-ttu-id="72fd9-239">[Indicazioni sulla strumentazione e la telemetria](https://msdn.microsoft.com/library/dn589775.aspx).</span><span class="sxs-lookup"><span data-stu-id="72fd9-239">[Instrumentation and Telemetry Guidance](https://msdn.microsoft.com/library/dn589775.aspx).</span></span> <span data-ttu-id="72fd9-240">Il controllo dell'integrità di servizi e componenti viene in genere eseguita mediante probing, ma è anche utile avere a disposizione le informazioni per monitorare le prestazioni dell'applicazione e rilevare gli eventi che si verificano durante il runtime.</span><span class="sxs-lookup"><span data-stu-id="72fd9-240">Checking the health of services and components is typically done by probing, but it's also useful to have information in place to monitor application performance and detect events that occur at runtime.</span></span> <span data-ttu-id="72fd9-241">Questi dati possono essere trasmessi di nuovo agli strumenti di monitoraggio come informazioni aggiuntive per il monitoraggio dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="72fd9-241">This data can be transmitted back to monitoring tools as additional information for health monitoring.</span></span> <span data-ttu-id="72fd9-242">Indicazioni sulla strumentazione e la telemetria esplora le informazioni di diagnostica raccolte dalla strumentazione di applicazioni.</span><span class="sxs-lookup"><span data-stu-id="72fd9-242">Instrumentation and Telemetry Guidance explores gathering remote diagnostics information that's collected by instrumentation in applications.</span></span>
- <span data-ttu-id="72fd9-243">[Ricezione di avvisi di allerta][portal-alerts].</span><span class="sxs-lookup"><span data-stu-id="72fd9-243">[Receiving alert notifications][portal-alerts].</span></span>
- <span data-ttu-id="72fd9-244">Questo modello include un'[applicazione di esempio](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring) scaricabile.</span><span class="sxs-lookup"><span data-stu-id="72fd9-244">This pattern includes a downloadable [sample application](https://github.com/mspnp/cloud-design-patterns/tree/master/health-endpoint-monitoring).</span></span>

[portal-alerts]: /azure/azure-monitor/platform/alerts-metric
