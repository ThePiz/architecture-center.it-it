---
title: Passepartout
description: Usare un token o una chiave che fornisca ai client l'accesso diretto limitato a una specifica risorsa o a un servizio.
keywords: schema progettuale
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- data-management
- security
ms.openlocfilehash: 791132eabf926cc285567454c60f894efa286433
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 11/14/2017
---
# <a name="valet-key-pattern"></a><span data-ttu-id="1a44c-104">Modello di passepartout</span><span class="sxs-lookup"><span data-stu-id="1a44c-104">Valet Key pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="1a44c-105">Usare un token che fornisca ai client l'accesso diretto limitato a una specifica risorsa per eseguire l'offload del trasferimento dei dati dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1a44c-105">Use a token that provides clients with restricted direct access to a specific resource, in order to offload data transfer from the application.</span></span> <span data-ttu-id="1a44c-106">Questa condizione risulta particolarmente utile nelle applicazioni che usano code o sistemi di archiviazione ospitati nel cloud e permette di ridurre i costi e ottimizzare scalabilità e prestazioni.</span><span class="sxs-lookup"><span data-stu-id="1a44c-106">This is particularly useful in applications that use cloud-hosted storage systems or queues, and can minimize cost and maximize scalability and performance.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="1a44c-107">Contesto e problema</span><span class="sxs-lookup"><span data-stu-id="1a44c-107">Context and problem</span></span>

<span data-ttu-id="1a44c-108">Programmi client e Web browser devono spesso leggere e scrivere file o flussi di dati da e verso l'archiviazione di un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1a44c-108">Client programs and web browsers often need to read and write files or data streams to and from an application’s storage.</span></span> <span data-ttu-id="1a44c-109">L'applicazione gestisce in genere lo spostamento dei dati recuperandoli dall'archiviazione e trasmettendoli al client oppure leggendo il flusso caricato dal client e memorizzandolo nell'archivio dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-109">Typically, the application will handle the movement of the data &mdash; either by fetching it from storage and streaming it to the client, or by reading the uploaded stream from the client and storing it in the data store.</span></span> <span data-ttu-id="1a44c-110">Questo approccio assorbe tuttavia risorse utili, ad esempio risorse di calcolo, memoria e larghezza di banda.</span><span class="sxs-lookup"><span data-stu-id="1a44c-110">However, this approach absorbs valuable resources such as compute, memory, and bandwidth.</span></span>

<span data-ttu-id="1a44c-111">Gli archivi dati sono in grado di gestire direttamente l'upload e il download dei dati, senza che l'applicazione debba eseguire un'elaborazione per spostare questi dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-111">Data stores have the ability to handle upload and download of data directly, without requiring that the application perform any processing to move this data.</span></span> <span data-ttu-id="1a44c-112">In questi casi, tuttavia, il cliente potrebbe dover accedere alle credenziali di sicurezza per l'archivio.</span><span class="sxs-lookup"><span data-stu-id="1a44c-112">But, this typically requires the client to have access to the security credentials for the store.</span></span> <span data-ttu-id="1a44c-113">Può trattarsi di una tecnica utile per ridurre al minimo i costi di trasferimento dei dati e l'esigenza di scalare orizzontalmente l'applicazione, nonché per ottimizzare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="1a44c-113">This can be a useful technique to minimize data transfer costs and the requirement to scale out the application, and to maximize performance.</span></span> <span data-ttu-id="1a44c-114">L'applicazione, tuttavia, non è più in grado di gestire la sicurezza dei dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-114">It means, though, that the application is no longer able to manage the security of the data.</span></span> <span data-ttu-id="1a44c-115">Dopo che il client avrà stabilito una connessione all'archivio dati per l'accesso diretto, l'applicazione non potrà fungere da gatekeeper.</span><span class="sxs-lookup"><span data-stu-id="1a44c-115">After the client has a connection to the data store for direct access, the application can't act as the gatekeeper.</span></span> <span data-ttu-id="1a44c-116">Non è più in controllo del processo e non può impedire upload o download successivi dall'archivio dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-116">It's no longer in control of the process and can't prevent subsequent uploads or downloads from the data store.</span></span>

<span data-ttu-id="1a44c-117">Ciò non costituisce un approccio realistico nei sistemi distribuiti che gestiscono client non attendibili.</span><span class="sxs-lookup"><span data-stu-id="1a44c-117">This isn't a realistic approach in distributed systems that need to serve untrusted clients.</span></span> <span data-ttu-id="1a44c-118">Al contrario, le applicazioni devono essere in grado di controllare in modo sicuro l'accesso ai dati in modo granulare, ma comunque ridurre il carico sul server configurando questa connessione e poi consentendo al client di comunicare direttamente con l'archivio dati per eseguire le operazioni di lettura o scrittura necessarie.</span><span class="sxs-lookup"><span data-stu-id="1a44c-118">Instead, applications must be able to securely control access to data in a granular way, but still reduce the load on the server by setting up this connection and then allowing the client to communicate directly with the data store to perform the required read or write operations.</span></span>

## <a name="solution"></a><span data-ttu-id="1a44c-119">Soluzione</span><span class="sxs-lookup"><span data-stu-id="1a44c-119">Solution</span></span>

<span data-ttu-id="1a44c-120">È necessario risolvere il problema di controllo dell'accesso a un archivio dati in cui l'archivio non possa gestire l'autenticazione e l'autorizzazione dei client.</span><span class="sxs-lookup"><span data-stu-id="1a44c-120">You need to resolve the problem of controlling access to a data store where the store can't manage authentication and authorization of clients.</span></span> <span data-ttu-id="1a44c-121">Una soluzione tipica consiste nel limitare l'accesso alla connessione pubblica dell'archivio dati e fornire al client una chiave o un token convalidabile dall'archivio dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-121">One typical solution is to restrict access to the data store’s public connection and provide the client with a key or token that the data store can validate.</span></span>

<span data-ttu-id="1a44c-122">Questa chiave o token è in genere definita passepartout.</span><span class="sxs-lookup"><span data-stu-id="1a44c-122">This key or token is usually referred to as a valet key.</span></span> <span data-ttu-id="1a44c-123">Offre l'accesso temporaneo a risorse specifiche e consente solo operazioni predefinite, ad esempio operazioni di lettura e scrittura nell'archiviazione o nelle code, o upload e download in un Web browser.</span><span class="sxs-lookup"><span data-stu-id="1a44c-123">It provides time-limited access to specific resources and allows only predefined operations such as reading and writing to storage or queues, or uploading and downloading in a web browser.</span></span> <span data-ttu-id="1a44c-124">Le applicazioni possono creare ed emettere passepartout per dispositivi client e Web browser in modo rapido e semplice, consentendo ai client di eseguire le operazioni necessarie senza che l'applicazione debba gestire direttamente il trasferimento dei dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-124">Applications can create and issue valet keys to client devices and web browsers quickly and easily, allowing clients to perform the required operations without requiring the application to directly handle the data transfer.</span></span> <span data-ttu-id="1a44c-125">In questo modo si eliminano il sovraccarico di elaborazione e l'impatto su prestazioni e scalabilità dall'applicazione e dal server.</span><span class="sxs-lookup"><span data-stu-id="1a44c-125">This removes the processing overhead, and the impact on performance and scalability, from the application and the server.</span></span>

<span data-ttu-id="1a44c-126">Il client usa questo token per accedere a una risorsa specifica nell'archivio dati solo per un periodo di tempo e con restrizioni specifiche sulle autorizzazioni di accesso, come illustrato nella figura.</span><span class="sxs-lookup"><span data-stu-id="1a44c-126">The client uses this token to access a specific resource in the data store for only a specific period, and with specific restrictions on access permissions, as shown in the figure.</span></span> <span data-ttu-id="1a44c-127">Dopo il periodo specificato, la chiave non sarà più valida e non consentirà l'accesso alla risorsa.</span><span class="sxs-lookup"><span data-stu-id="1a44c-127">After the specified period, the key becomes invalid and won't allow access to the resource.</span></span>

![Figura 1 - Panoramica del modello](./_images/valet-key-pattern.png)

<span data-ttu-id="1a44c-129">È anche possibile configurare una chiave con altre dipendenze, ad esempio l'ambito dei dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-129">It's also possible to configure a key that has other dependencies, such as the scope of the data.</span></span> <span data-ttu-id="1a44c-130">Ad esempio, a seconda delle funzionalità dell'archivio dati, la chiave può specificare un'intera tabella in un archivio dati o solo le righe specifiche di una tabella.</span><span class="sxs-lookup"><span data-stu-id="1a44c-130">For example, depending on the data store capabilities, the key can specify a complete table in a data store, or only specific rows in a table.</span></span> <span data-ttu-id="1a44c-131">Nei sistemi di archiviazione cloud la chiave può specificare un contenitore o solo un elemento specifico al suo interno.</span><span class="sxs-lookup"><span data-stu-id="1a44c-131">In cloud storage systems the key can specify a container, or just a specific item within a container.</span></span>

<span data-ttu-id="1a44c-132">La chiave può anche essere invalidata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1a44c-132">The key can also be invalidated by the application.</span></span> <span data-ttu-id="1a44c-133">Si tratta di un approccio utile se il client segnala al server che l'operazione di trasferimento dei dati è stata completata.</span><span class="sxs-lookup"><span data-stu-id="1a44c-133">This is a useful approach if the client notifies the server that the data transfer operation is complete.</span></span> <span data-ttu-id="1a44c-134">Il server può poi invalidare la chiave per impedire altre operazioni.</span><span class="sxs-lookup"><span data-stu-id="1a44c-134">The server can then invalidate that key to prevent further.</span></span>

<span data-ttu-id="1a44c-135">Questo modello permette di semplificare la gestione dell'accesso alle risorse, perché non è necessario creare e autenticare un utente, concedere autorizzazioni e rimuovere di nuovo l'utente.</span><span class="sxs-lookup"><span data-stu-id="1a44c-135">Using this pattern can simplify managing access to resources because there's no requirement to create and authenticate a user, grant permissions, and then remove the user again.</span></span> <span data-ttu-id="1a44c-136">Semplifica anche la possibilità di limitare la posizione, l'autorizzazione e il periodo di validità. generando semplicemente una chiave in fase di runtime.</span><span class="sxs-lookup"><span data-stu-id="1a44c-136">It also makes it easy to limit the location, the permission, and the validity period&mdash;all by simply generating a key at runtime.</span></span> <span data-ttu-id="1a44c-137">I fattori importanti consistono nel limitare il periodo di validità, e in particolare la posizione della risorsa, quanto più possibile per garantire che il destinatario possa usarla solo per lo scopo previsto.</span><span class="sxs-lookup"><span data-stu-id="1a44c-137">The important factors are to limit the validity period, and especially the location of the resource, as tightly as possible so that the recipient can only use it for the intended purpose.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="1a44c-138">Considerazioni e problemi</span><span class="sxs-lookup"><span data-stu-id="1a44c-138">Issues and considerations</span></span>

<span data-ttu-id="1a44c-139">Prima di decidere come implementare questo modello, considerare quanto segue:</span><span class="sxs-lookup"><span data-stu-id="1a44c-139">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="1a44c-140">**Gestire lo stato e il periodo di validità della chiave**.</span><span class="sxs-lookup"><span data-stu-id="1a44c-140">**Manage the validity status and period of the key**.</span></span> <span data-ttu-id="1a44c-141">Se persa o compromessa, la chiave sblocca l'elemento di destinazione e lo rende disponibile per uso dannoso durante il periodo di validità.</span><span class="sxs-lookup"><span data-stu-id="1a44c-141">If leaked or compromised, the key effectively unlocks the target item and makes it available for malicious use during the validity period.</span></span> <span data-ttu-id="1a44c-142">Una chiave può essere in genere revocata o disabilitata, a seconda della modalità di emissione.</span><span class="sxs-lookup"><span data-stu-id="1a44c-142">A key can usually be revoked or disabled, depending on how it was issued.</span></span> <span data-ttu-id="1a44c-143">I criteri lato server possono essere modificati oppure la chiave del server con cui è stato firmato può essere invalidata.</span><span class="sxs-lookup"><span data-stu-id="1a44c-143">Server-side policies can be changed or, the server key it was signed with can be invalidated.</span></span> <span data-ttu-id="1a44c-144">Specificare un periodo di validità breve per ridurre al minimo il rischio di consentire operazioni non autorizzate nell'archivio dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-144">Specify a short validity period to minimize the risk of allowing unauthorized operations to take place against the data store.</span></span> <span data-ttu-id="1a44c-145">Se tuttavia il periodo di validità è troppo breve, il client potrebbe non essere in grado di completare l'operazione prima della scadenza della chiave.</span><span class="sxs-lookup"><span data-stu-id="1a44c-145">However, if the validity period is too short, the client might not be able to complete the operation before the key expires.</span></span> <span data-ttu-id="1a44c-146">Consentire agli utenti autorizzati di rinnovare la chiave prima della scadenza del periodo di validità se sono necessari più accessi alla risorsa protetta.</span><span class="sxs-lookup"><span data-stu-id="1a44c-146">Allow authorized users to renew the key before the validity period expires if multiple accesses to the protected resource are required.</span></span>

<span data-ttu-id="1a44c-147">**Controllare il livello di accesso fornito dalla chiave**.</span><span class="sxs-lookup"><span data-stu-id="1a44c-147">**Control the level of access the key will provide**.</span></span> <span data-ttu-id="1a44c-148">La chiave deve in genere consentire all'utente di eseguire solo le azioni necessarie per completare l'operazione, ad esempio l'accesso di sola lettura se il client non è in grado di caricare dati nell'archivio dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-148">Typically, the key should allow the user to only perform the actions necessary to complete the operation, such as read-only access if the client shouldn't be able to upload data to the data store.</span></span> <span data-ttu-id="1a44c-149">Per l'upload dei file viene in genere specificata una chiave che fornisce l'autorizzazione di sola scrittura, nonché il percorso e il periodo di validità.</span><span class="sxs-lookup"><span data-stu-id="1a44c-149">For file uploads, it's common to specify a key that provides write-only permission, as well as the location and the validity period.</span></span> <span data-ttu-id="1a44c-150">È fondamentale specificare in modo accurato la risorsa o il set di risorse a cui si applica la chiave.</span><span class="sxs-lookup"><span data-stu-id="1a44c-150">It's critical to accurately specify the resource or the set of resources to which the key applies.</span></span>

<span data-ttu-id="1a44c-151">**Considerare il modo in cui controllare il comportamento degli utenti**.</span><span class="sxs-lookup"><span data-stu-id="1a44c-151">**Consider how to control users’ behavior**.</span></span> <span data-ttu-id="1a44c-152">L'implementazione di questo modello implica una perdita parziale di controllo sulle risorse a cui gli utenti sono autorizzati ad accedere.</span><span class="sxs-lookup"><span data-stu-id="1a44c-152">Implementing this pattern means some loss of control over the resources users are granted access to.</span></span> <span data-ttu-id="1a44c-153">Il livello di controllo che può essere esercitato è limitato dalle funzionalità dei criteri e delle autorizzazioni disponibili per il servizio o l'archivio dati di destinazione.</span><span class="sxs-lookup"><span data-stu-id="1a44c-153">The level of control that can be exerted is limited by the capabilities of the policies and permissions available for the service or the target data store.</span></span> <span data-ttu-id="1a44c-154">Ad esempio, in genere non è possibile creare una chiave che limita le dimensioni dei dati da scrivere nell'archiviazione o il numero di volte in cui è possibile usare la chiave per accedere a un file.</span><span class="sxs-lookup"><span data-stu-id="1a44c-154">For example, it's usually not possible to create a key that limits the size of the data to be written to storage, or the number of times the key can be used to access a file.</span></span> <span data-ttu-id="1a44c-155">Questo problema può determinare elevati costi imprevisti per il trasferimento dei dati, anche se in uso da parte del client previsto, e può essere dovuto a un errore nel codice che determina upload e download ripetuti.</span><span class="sxs-lookup"><span data-stu-id="1a44c-155">This can result in huge unexpected costs for data transfer, even when used by the intended client, and might be caused by an error in the code that causes repeated upload or download.</span></span> <span data-ttu-id="1a44c-156">Per limitare il numero di volte in cui può essere caricato un file, laddove possibile, forzare il client a inviare una notifica all'applicazione quando un'operazione è stata completata.</span><span class="sxs-lookup"><span data-stu-id="1a44c-156">To limit the number of times a file can be uploaded, where possible, force the client to notify the application when one operation has completed.</span></span> <span data-ttu-id="1a44c-157">Alcuni archivi dati generano ad esempio eventi che il codice dell'applicazione può usare per monitorare le operazioni e controllare il comportamento degli utenti.</span><span class="sxs-lookup"><span data-stu-id="1a44c-157">For example, some data stores raise events the application code can use to monitor operations and control user behavior.</span></span> <span data-ttu-id="1a44c-158">È comunque difficile imporre quote per singoli utenti in uno scenario multi-tenant in cui la stessa chiave viene usata da tutti gli utenti di un tenant.</span><span class="sxs-lookup"><span data-stu-id="1a44c-158">However, it's hard to enforce quotas for individual users in a multi-tenant scenario where the same key is used by all the users from one tenant.</span></span>

<span data-ttu-id="1a44c-159">**Convalidare e facoltativamente purificare tutti i dati caricati**.</span><span class="sxs-lookup"><span data-stu-id="1a44c-159">**Validate, and optionally sanitize, all uploaded data**.</span></span> <span data-ttu-id="1a44c-160">Un utente malintenzionato che riesce ad accedere alla chiave potrebbe caricare dati progettati per compromettere il sistema.</span><span class="sxs-lookup"><span data-stu-id="1a44c-160">A malicious user that gains access to the key could upload data designed to compromise the system.</span></span> <span data-ttu-id="1a44c-161">In alternativa, gli utenti autorizzati potrebbero caricare dati non validi che, se elaborati, potrebbero generare un errore o un errore di sistema.</span><span class="sxs-lookup"><span data-stu-id="1a44c-161">Alternatively, authorized users might upload data that's invalid and, when processed, could result in an error or system failure.</span></span> <span data-ttu-id="1a44c-162">Per evitare questo problema, verificare che tutti i dati caricati siano convalidati e non contengano contenuto dannoso prima dell'uso.</span><span class="sxs-lookup"><span data-stu-id="1a44c-162">To protect against this, ensure that all uploaded data is validated and checked for malicious content before use.</span></span>

<span data-ttu-id="1a44c-163">**Controllare tutte le operazioni**.</span><span class="sxs-lookup"><span data-stu-id="1a44c-163">**Audit all operations**.</span></span> <span data-ttu-id="1a44c-164">Molti meccanismi basati su chiavi possono registrare alcune operazioni, ad esempio gli upload, i download e gli errori.</span><span class="sxs-lookup"><span data-stu-id="1a44c-164">Many key-based mechanisms can log operations such as uploads, downloads, and failures.</span></span> <span data-ttu-id="1a44c-165">Questi log possono essere in genere incorporati in un processo di controllo e usati anche per la fatturazione se gli addebiti dell'utente variano in base alle dimensioni dei file o al volume di dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-165">These logs can usually be incorporated into an audit process, and also used for billing if the user is charged based on file size or data volume.</span></span> <span data-ttu-id="1a44c-166">Usare i log per rilevare errori di autenticazione che potrebbero essere causati da problemi con il provider della chiave o la rimozione accidentale di criteri di accesso archiviati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-166">Use the logs to detect authentication failures that might be caused by issues with the key provider, or accidental removal of a stored access policy.</span></span>

<span data-ttu-id="1a44c-167">**Distribuire in modo sicuro la chiave**.</span><span class="sxs-lookup"><span data-stu-id="1a44c-167">**Deliver the key securely**.</span></span> <span data-ttu-id="1a44c-168">Può essere incorporata in un URL attivato dall'utente in una pagina Web o può essere usato in un'operazione di reindirizzamento del server per consentire il download automatico.</span><span class="sxs-lookup"><span data-stu-id="1a44c-168">It can be embedded in a URL that the user activates in a web page, or it can be used in a server redirection operation so that the download occurs automatically.</span></span> <span data-ttu-id="1a44c-169">Usare sempre HTTPS per distribuire la chiave su un canale sicuro.</span><span class="sxs-lookup"><span data-stu-id="1a44c-169">Always use HTTPS to deliver the key over a secure channel.</span></span>

<span data-ttu-id="1a44c-170">**Proteggere i dati sensibili in transito**.</span><span class="sxs-lookup"><span data-stu-id="1a44c-170">**Protect sensitive data in transit**.</span></span> <span data-ttu-id="1a44c-171">I dati sensibili vengono in genere recapitati dall'applicazione con crittografia SSL o TLS. Questa operazione deve essere applicata per i client che accedono direttamente all'archivio dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-171">Sensitive data delivered through the application will usually take place using SSL or TLS, and this should be enforced for clients accessing the data store directly.</span></span>

<span data-ttu-id="1a44c-172">Di seguito sono riportati altri problemi da considerare quando si implementa questo modello:</span><span class="sxs-lookup"><span data-stu-id="1a44c-172">Other issues to be aware of when implementing this pattern are:</span></span>

- <span data-ttu-id="1a44c-173">Se il client non segnala al server il completamento dell'operazione, o non è in grado di farlo, e l'unico limite è il periodo di scadenza della chiave, l'applicazione non sarà in grado di eseguire le operazioni di controllo, ad esempio il conteggio del numero di upload o download o la capacità di impedire più upload o download.</span><span class="sxs-lookup"><span data-stu-id="1a44c-173">If the client doesn't, or can't, notify the server of completion of the operation, and the only limit is the expiration period of the key, the application won't be able to perform auditing operations such as counting the number of uploads or downloads, or preventing multiple uploads or downloads.</span></span>

- <span data-ttu-id="1a44c-174">La flessibilità dei criteri delle chiavi che è possibile generare potrebbe essere limitata.</span><span class="sxs-lookup"><span data-stu-id="1a44c-174">The flexibility of key policies that can be generated might be limited.</span></span> <span data-ttu-id="1a44c-175">Alcuni meccanismi consentono ad esempio solo l'uso di un periodo di scadenza a tempo.</span><span class="sxs-lookup"><span data-stu-id="1a44c-175">For example, some mechanisms only allow the use of a timed expiration period.</span></span> <span data-ttu-id="1a44c-176">Altri non sono in grado di specificare un livello sufficiente di granularità per le autorizzazioni di lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="1a44c-176">Others aren't able to specify a sufficient granularity of read/write permissions.</span></span>

- <span data-ttu-id="1a44c-177">Se viene specificata l'ora di inizio per la chiave o il periodo di validità del token, assicurarsi che sia leggermente anteriore all'ora corrente, poiché gli orologi dei client potrebbero non essere perfettamente sincronizzati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-177">If the start time for the key or token validity period is specified, ensure that it's a little earlier than the current server time to allow for client clocks that might be slightly out of synchronization.</span></span> <span data-ttu-id="1a44c-178">Il valore predefinito, se non specificato, è in genere l'ora del server corrente.</span><span class="sxs-lookup"><span data-stu-id="1a44c-178">The default, if not specified, is usually the current server time.</span></span>

- <span data-ttu-id="1a44c-179">L'URL che contiene la chiave verrà registrato nei file di log del server.</span><span class="sxs-lookup"><span data-stu-id="1a44c-179">The URL containing the key will be recorded in server log files.</span></span> <span data-ttu-id="1a44c-180">Sebbene in genere la chiave scada prima di usare i file di log per l'analisi, assicurarsi comunque di limitare l'accesso a questi file.</span><span class="sxs-lookup"><span data-stu-id="1a44c-180">While the key will typically have expired before the log files are used for analysis, ensure that you limit access to them.</span></span> <span data-ttu-id="1a44c-181">Se i dati di log vengono trasmessi a un sistema di monitoraggio o archiviati in un'altra posizione, è consigliabile implementare un ritardo per impedire la perdita delle chiavi dopo la scadenza del periodo di validità.</span><span class="sxs-lookup"><span data-stu-id="1a44c-181">If log data is transmitted to a monitoring system or stored in another location, consider implementing a delay to prevent leakage of keys until after their validity period has expired.</span></span>

- <span data-ttu-id="1a44c-182">Se il codice del client viene eseguito in un Web browser, il browser potrebbe dover supportare la condivisione di risorse tra origini (CORS) per consentire al codice in esecuzione nel Web browser di accedere ai dati in un dominio diverso da quello che ha gestito la pagina.</span><span class="sxs-lookup"><span data-stu-id="1a44c-182">If the client code runs in a web browser, the browser might need to support cross-origin resource sharing (CORS) to enable code that executes within the web browser to access data in a different domain from the one that served the page.</span></span> <span data-ttu-id="1a44c-183">Alcuni browser precedenti e alcuni archivi dati non supportano la funzionalità CORS e il codice in esecuzione in questi browser potrebbe essere in grado di usare un passepartout per garantire l'accesso ai dati in un dominio diverso, ad esempio un account di archiviazione cloud.</span><span class="sxs-lookup"><span data-stu-id="1a44c-183">Some older browsers and some data stores don't support CORS, and code that runs in these browsers might be able to use a valet key to provide access to data in a different domain, such as a cloud storage account.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="1a44c-184">Quando usare questo modello</span><span class="sxs-lookup"><span data-stu-id="1a44c-184">When to use this pattern</span></span>

<span data-ttu-id="1a44c-185">Questo modello è utile nelle situazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="1a44c-185">This pattern is useful for the following situations:</span></span>

- <span data-ttu-id="1a44c-186">Per ridurre al minimo il caricamento delle risorse e ottimizzare prestazioni e scalabilità.</span><span class="sxs-lookup"><span data-stu-id="1a44c-186">To minimize resource loading and maximize performance and scalability.</span></span> <span data-ttu-id="1a44c-187">L'uso di un passepartout non prevede il blocco della risorsa, non è necessario eseguire una chiamata al server remoto, non sussistono limiti al numero di passepartout che è possibile emettere ed evita che si verifichi un singolo punto di guasto risultante dall'esecuzione del trasferimento dei dati tramite il codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1a44c-187">Using a valet key doesn't require the resource to be locked, no remote server call is required, there's no limit on the number of valet keys that can be issued, and it avoids a single point of failure resulting from performing the data transfer through the application code.</span></span> <span data-ttu-id="1a44c-188">La creazione di un passepartout consiste in genere in una semplice operazione crittografica di firma di una stringa con una chiave.</span><span class="sxs-lookup"><span data-stu-id="1a44c-188">Creating a valet key is typically a simple cryptographic operation of signing a string with a key.</span></span>

- <span data-ttu-id="1a44c-189">Per ridurre al minimo i costi operativi.</span><span class="sxs-lookup"><span data-stu-id="1a44c-189">To minimize operational cost.</span></span> <span data-ttu-id="1a44c-190">L'accesso diretto ad archivi e risorse consente di risparmiare tempo e denaro, comporta un numero inferiore di round trip di rete e potrebbe determinare una riduzione nel numero delle risorse di calcolo necessarie.</span><span class="sxs-lookup"><span data-stu-id="1a44c-190">Enabling direct access to stores and queues is resource and cost efficient, can result in fewer network round trips, and might allow for a reduction in the number of compute resources required.</span></span>

- <span data-ttu-id="1a44c-191">Quando i client periodicamente caricano o scaricano dati, in particolare in presenza di volumi elevati o se ogni operazione riguarda file di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="1a44c-191">When clients regularly upload or download data, particularly where there's a large volume or when each operation involves large files.</span></span>

- <span data-ttu-id="1a44c-192">Quando l'applicazione ha un numero limitato di risorse di calcolo disponibili, a causa di limitazioni di hosting o per motivi economici.</span><span class="sxs-lookup"><span data-stu-id="1a44c-192">When the application has limited compute resources available, either due to hosting limitations or cost considerations.</span></span> <span data-ttu-id="1a44c-193">In questo scenario, il modello risulta particolarmente utile in presenza di vari upload o download simultanei, poiché evita all'applicazione di gestire il trasferimento dei dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-193">In this scenario, the pattern is even more helpful if there are many concurrent data uploads or downloads because it relieves the application from handling the data transfer.</span></span>

- <span data-ttu-id="1a44c-194">Quando i dati vengono archiviati in un archivio dati remoto o un altro data center.</span><span class="sxs-lookup"><span data-stu-id="1a44c-194">When the data is stored in a remote data store or a different datacenter.</span></span> <span data-ttu-id="1a44c-195">Se l'applicazione deve agire da gatekeeper, potrebbe essere previsto un addebito per la larghezza di banda aggiuntiva destinata al trasferimento dei dati tra i data center oppure nelle reti pubbliche o private tra il client e l'applicazione e poi tra l'applicazione e l'archivio dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-195">If the application was required to act as a gatekeeper, there might be a charge for the additional bandwidth of transferring the data between datacenters, or across public or private networks between the client and the application, and then between the application and the data store.</span></span>

<span data-ttu-id="1a44c-196">Questo modello può non essere utile nelle situazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="1a44c-196">This pattern might not be useful in the following situations:</span></span>

- <span data-ttu-id="1a44c-197">Se l'applicazione deve eseguire alcune attività sui dati prima di che vengano archiviati o inviati al client.</span><span class="sxs-lookup"><span data-stu-id="1a44c-197">If the application must perform some task on the data before it's stored or before it's sent to the client.</span></span> <span data-ttu-id="1a44c-198">Se ad esempio l'applicazione deve eseguire la convalida, registrare l'esito positivo dell'accesso o eseguire una trasformazione sui dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-198">For example, if the application needs to perform validation, log access success, or execute a transformation on the data.</span></span> <span data-ttu-id="1a44c-199">Alcuni archivi dati e client sono tuttavia in grado di negoziare ed eseguire trasformazioni semplici, ad esempio compressione e decompressione (un Web browser in genere può gestire formati GZip).</span><span class="sxs-lookup"><span data-stu-id="1a44c-199">However, some data stores and clients are able to negotiate and carry out simple transformations such as compression and decompression (for example, a web browser can usually handle GZip formats).</span></span>

- <span data-ttu-id="1a44c-200">Se la progettazione di un'applicazione esistente rende difficile incorporare il modello.</span><span class="sxs-lookup"><span data-stu-id="1a44c-200">If the design of an existing application makes it difficult to incorporate the pattern.</span></span> <span data-ttu-id="1a44c-201">L'uso di questo modello comporta in genere un approccio diverso dal punto di vista dell'architettura per il recapito e la ricezione di dati.</span><span class="sxs-lookup"><span data-stu-id="1a44c-201">Using this pattern typically requires a different architectural approach for delivering and receiving data.</span></span>

- <span data-ttu-id="1a44c-202">Se è necessario gestire audit trail o controllare il numero di tentativi di esecuzione di un'operazione di trasferimento di dati e il meccanismo di passepartout in uso non supporta le notifiche che il server può usare per gestire queste operazioni.</span><span class="sxs-lookup"><span data-stu-id="1a44c-202">If it's necessary to maintain audit trails or control the number of times a data transfer operation is executed, and the valet key mechanism in use doesn't support notifications that the server can use to manage these operations.</span></span>

- <span data-ttu-id="1a44c-203">Se è necessario limitare le dimensioni dei dati, soprattutto durante le operazioni di upload.</span><span class="sxs-lookup"><span data-stu-id="1a44c-203">If it's necessary to limit the size of the data, especially during upload operations.</span></span> <span data-ttu-id="1a44c-204">L'unica soluzione per questo scenario prevede che l'applicazione controlli le dimensioni dei dati al termine dell'operazione oppure le dimensioni degli upload dopo un periodo specifico o a intervalli regolari.</span><span class="sxs-lookup"><span data-stu-id="1a44c-204">The only solution to this is for the application to check the data size after the operation is complete, or check the size of uploads after a specified period or on a scheduled basis.</span></span>

## <a name="example"></a><span data-ttu-id="1a44c-205">Esempio</span><span class="sxs-lookup"><span data-stu-id="1a44c-205">Example</span></span>

<span data-ttu-id="1a44c-206">Azure supporta firme di accesso condiviso in Archiviazione di Azure per il controllo dell'accesso granulare ai dati in BLOB, tabelle e code e per le code e gli argomenti del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="1a44c-206">Azure supports shared access signatures on Azure Storage for granular access control to data in blobs, tables, and queues, and for Service Bus queues and topics.</span></span> <span data-ttu-id="1a44c-207">È possibile configurare un token di firma di accesso condiviso per concedere specifici diritti di accesso, ad esempio lettura, scrittura, aggiornamento ed eliminazione, a una specifica tabella, un intervallo di chiavi in una tabella, una coda, un BLOB o un contenitore BLOB.</span><span class="sxs-lookup"><span data-stu-id="1a44c-207">A shared access signature token can be configured to provide specific access rights such as read, write, update, and delete to a specific table; a key range within a table; a queue; a blob; or a blob container.</span></span> <span data-ttu-id="1a44c-208">La validità può essere un periodo di tempo specificato, ma è possibile anche impostare nessun limite.</span><span class="sxs-lookup"><span data-stu-id="1a44c-208">The validity can be a specified time period or with no time limit.</span></span>

<span data-ttu-id="1a44c-209">Le firme di accesso condiviso di Azure supportano anche criteri di accesso archiviati nel server che possono essere associati a una risorsa specifica, ad esempio una tabella o un BLOB.</span><span class="sxs-lookup"><span data-stu-id="1a44c-209">Azure shared access signatures also support server-stored access policies that can be associated with a specific resource such as a table or blob.</span></span> <span data-ttu-id="1a44c-210">Questa funzionalità offre un livello maggiore di controllo e flessibilità rispetto ai token di firma di accesso condiviso generati dall'applicazione e deve essere usata laddove possibile.</span><span class="sxs-lookup"><span data-stu-id="1a44c-210">This feature provides additional control and flexibility compared to application-generated shared access signature tokens, and should be used whenever possible.</span></span> <span data-ttu-id="1a44c-211">Le impostazioni definite in un criterio archiviato nel server possono essere modificate e vengono riflesse nel token senza richiederne l'emissione di uno nuovo, mentre le impostazioni definite nel token non possono essere modificate senza emettere un nuovo token.</span><span class="sxs-lookup"><span data-stu-id="1a44c-211">Settings defined in a server-stored policy can be changed and are reflected in the token without requiring a new token to be issued, but settings defined in the token can't be changed without issuing a new token.</span></span> <span data-ttu-id="1a44c-212">Questo approccio consente anche di revocare un token di firma di accesso condiviso valido prima della scadenza.</span><span class="sxs-lookup"><span data-stu-id="1a44c-212">This approach also makes it possible to revoke a valid shared access signature token before it's expired.</span></span>

> <span data-ttu-id="1a44c-213">Per altre informazioni, vedere [Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) (Introduzione alla tabella SAS (firma di accesso condiviso), alla coda SAS e all'aggiornamento nel BLOB SAS) e [Uso delle firme di accesso condiviso](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/) su MSDN.</span><span class="sxs-lookup"><span data-stu-id="1a44c-213">For more information see [Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) and [Using Shared Access Signatures](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/) on MSDN.</span></span>

<span data-ttu-id="1a44c-214">Il codice seguente mostra come creare un token di firma di accesso condiviso valido per cinque minuti.</span><span class="sxs-lookup"><span data-stu-id="1a44c-214">The following code shows how to create a shared access signature token that's valid for five minutes.</span></span> <span data-ttu-id="1a44c-215">Il metodo `GetSharedAccessReferenceForUpload` restituisce un token di firma di accesso condiviso che può essere usato per caricare un file in Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="1a44c-215">The `GetSharedAccessReferenceForUpload` method returns a shared access signatures token that can be used to upload a file to Azure Blob Storage.</span></span>

```csharp
public class ValuesController : ApiController
{
  private readonly CloudStorageAccount account;
  private readonly string blobContainer;
  ...
  /// <summary>
  /// Return a limited access key that allows the caller to upload a file
  /// to this specific destination for a defined period of time.
  /// </summary>
  private StorageEntitySas GetSharedAccessReferenceForUpload(string blobName)
  {
    var blobClient = this.account.CreateCloudBlobClient();
    var container = blobClient.GetContainerReference(this.blobContainer);

    var blob = container.GetBlockBlobReference(blobName);

    var policy = new SharedAccessBlobPolicy
    {
      Permissions = SharedAccessBlobPermissions.Write,

      // Specify a start time five minutes earlier to allow for client clock skew.
      SharedAccessStartTime = DateTime.UtcNow.AddMinutes(-5),

      // Specify a validity period of five minutes starting from now.
      SharedAccessExpiryTime = DateTime.UtcNow.AddMinutes(5)
    };

    // Create the signature.
    var sas = blob.GetSharedAccessSignature(policy);

    return new StorageEntitySas
    {
      BlobUri = blob.Uri,
      Credentials = sas,
      Name = blobName
    };
  }

  public struct StorageEntitySas
  {
    public string Credentials;
    public Uri BlobUri;
    public string Name;
  }
}
```

> <span data-ttu-id="1a44c-216">L'esempio completo è disponibile nella soluzione ValetKey disponibile per il download da [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span><span class="sxs-lookup"><span data-stu-id="1a44c-216">The complete sample is available in the ValetKey solution available for download from [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span></span> <span data-ttu-id="1a44c-217">Il progetto ValetKey.Web in questa soluzione contiene un'applicazione Web che include la classe `ValuesController` illustrata in precedenza.</span><span class="sxs-lookup"><span data-stu-id="1a44c-217">The ValetKey.Web project in this solution contains a web application that includes the `ValuesController` class shown above.</span></span> <span data-ttu-id="1a44c-218">Un'applicazione client di esempio che usa questa applicazione Web per recuperare una chiave di firma di accesso condiviso e caricare un file di archiviazione BLOB è disponibile nel progetto ValetKey.Client.</span><span class="sxs-lookup"><span data-stu-id="1a44c-218">A sample client application that uses this web application to retrieve a shared access signatures key and upload a file to blob storage is available in the ValetKey.Client project.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1a44c-219">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="1a44c-219">Next steps</span></span>

<span data-ttu-id="1a44c-220">Per l'implementazione di questo modello possono risultare utili i modelli e le informazioni aggiuntive seguenti:</span><span class="sxs-lookup"><span data-stu-id="1a44c-220">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>
- <span data-ttu-id="1a44c-221">Un esempio che illustra questo modello è disponibile su [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span><span class="sxs-lookup"><span data-stu-id="1a44c-221">A sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span></span>
- <span data-ttu-id="1a44c-222">[Modello Gatekeeper](gatekeeper.md).</span><span class="sxs-lookup"><span data-stu-id="1a44c-222">[Gatekeeper pattern](gatekeeper.md).</span></span> <span data-ttu-id="1a44c-223">Questo modello può essere usato insieme al modello Passepartout per proteggere le applicazioni e i servizi usando un'istanza host dedicata che funga da broker tra i client e l'applicazione o il servizio.</span><span class="sxs-lookup"><span data-stu-id="1a44c-223">This pattern can be used in conjunction with the Valet Key pattern to protect applications and services by using a dedicated host instance that acts as a broker between clients and the application or service.</span></span> <span data-ttu-id="1a44c-224">Il gatekeeper convalida e purifica le richieste e passa richieste e dati tra il client e l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="1a44c-224">The gatekeeper validates and sanitizes requests, and passes requests and data between the client and the application.</span></span> <span data-ttu-id="1a44c-225">Può conferire un livello aggiuntivo di sicurezza e ridurre la superficie di attacco del sistema.</span><span class="sxs-lookup"><span data-stu-id="1a44c-225">Can provide an additional layer of security, and reduce the attack surface of the system.</span></span>
- <span data-ttu-id="1a44c-226">[Modello di hosting del contenuto statico](static-content-hosting.md).</span><span class="sxs-lookup"><span data-stu-id="1a44c-226">[Static Content Hosting pattern](static-content-hosting.md).</span></span> <span data-ttu-id="1a44c-227">Descrive come distribuire risorse statiche in un servizio di archiviazione basato su cloud in grado di recapitare queste risorse direttamente al client per ridurre l'esigenza di dispendiose istanze di calcolo.</span><span class="sxs-lookup"><span data-stu-id="1a44c-227">Describes how to deploy static resources to a cloud-based storage service that can deliver these resources directly to the client to reduce the requirement for expensive compute instances.</span></span> <span data-ttu-id="1a44c-228">Laddove le risorse non siano destinate a essere rese disponibili pubblicamente, il modello di passepartout può essere usato per proteggerle.</span><span class="sxs-lookup"><span data-stu-id="1a44c-228">Where the resources aren't intended to be publicly available, the Valet Key pattern can be used to secure them.</span></span>
- <span data-ttu-id="1a44c-229">[Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) (Introduzione alla tabella SAS (firma di accesso condiviso), alla coda SAS e all'aggiornamento nel BLOB SAS)</span><span class="sxs-lookup"><span data-stu-id="1a44c-229">[Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/)</span></span>
- [<span data-ttu-id="1a44c-230">Uso delle firme di accesso condiviso</span><span class="sxs-lookup"><span data-stu-id="1a44c-230">Using Shared Access Signatures</span></span>](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/)
- [<span data-ttu-id="1a44c-231">Autenticazione della firma di accesso condiviso con il bus di servizio</span><span class="sxs-lookup"><span data-stu-id="1a44c-231">Shared Access Signature Authentication with Service Bus</span></span>](https://azure.microsoft.com/documentation/articles/service-bus-shared-access-signature-authentication/)
