---
title: Supervisione agente di pianificazione
description: Coordinare un set di azioni in un set distribuito di servizi e di altre risorse remote.
keywords: schema progettuale
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- messaging
- resiliency
ms.openlocfilehash: 7914708413d68689e2326df28ced00e5fc3a5dd8
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 09/28/2018
ms.locfileid: "47428670"
---
# <a name="scheduler-agent-supervisor-pattern"></a><span data-ttu-id="c244b-104">Modello di supervisione agente di pianificazione</span><span class="sxs-lookup"><span data-stu-id="c244b-104">Scheduler Agent Supervisor pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="c244b-105">Coordinare un set di azioni distribuite come singola operazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-105">Coordinate a set of distributed actions as a single operation.</span></span> <span data-ttu-id="c244b-106">Se una qualsiasi operazione ha esito negativo, provare a gestire gli errori in modo trasparente oppure annullare l'attività eseguita in modo da consentire che l'operazione abbia interamente esito positivo o negativo.</span><span class="sxs-lookup"><span data-stu-id="c244b-106">If any of the actions fail, try to handle the failures transparently, or else undo the work that was performed, so the entire operation succeeds or fails as a whole.</span></span> <span data-ttu-id="c244b-107">In questo modo si può aggiungere resilienza a un sistema distribuito, consentendo di recuperare e ripetere le azioni non riuscite a causa di eccezioni temporanee, errori di processi e di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="c244b-107">This can add resiliency to a distributed system, by enabling it to recover and retry actions that fail due to transient exceptions, long-lasting faults, and process failures.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="c244b-108">Contesto e problema</span><span class="sxs-lookup"><span data-stu-id="c244b-108">Context and problem</span></span>

<span data-ttu-id="c244b-109">Un'applicazione esegue attività che comprendono diversi passaggi, alcuni dei quali potrebbero richiamare servizi remoti o accedere a risorse remote.</span><span class="sxs-lookup"><span data-stu-id="c244b-109">An application performs tasks that include a number of steps, some of which might invoke remote services or access remote resources.</span></span> <span data-ttu-id="c244b-110">I singoli passaggi potrebbero essere indipendenti tra loro, ma sono coordinati dalla logica dell'applicazione che implementa l'attività.</span><span class="sxs-lookup"><span data-stu-id="c244b-110">The individual steps might be independent of each other, but they are orchestrated by the application logic that implements the task.</span></span>

<span data-ttu-id="c244b-111">Quando possibile, l'applicazione deve garantire che l'attività venga eseguita fino al completamento e risolvere eventuali problemi che potrebbero verificarsi durante l'accesso a risorse o servizi remoti.</span><span class="sxs-lookup"><span data-stu-id="c244b-111">Whenever possible, the application should ensure that the task runs to completion and resolve any failures that might occur when accessing remote services or resources.</span></span> <span data-ttu-id="c244b-112">Possono verificarsi errori per diversi motivi.</span><span class="sxs-lookup"><span data-stu-id="c244b-112">Failures can occur for many reasons.</span></span> <span data-ttu-id="c244b-113">Ad esempio, la rete potrebbe essere inattiva, le comunicazioni potrebbero essere interrotte, un servizio remoto potrebbe non rispondere o essere in uno stato instabile oppure una risorsa remota potrebbe essere temporaneamente inaccessibile, forse a causa di vincoli.</span><span class="sxs-lookup"><span data-stu-id="c244b-113">For example, the network might be down, communications could be interrupted, a remote service might be unresponsive or in an unstable state, or a remote resource might be temporarily inaccessible, perhaps due to resource constraints.</span></span> <span data-ttu-id="c244b-114">In molti casi gli errori sono temporanei e possono essere gestiti tramite il [modello di ripetizione dei tentativi][retry-pattern].</span><span class="sxs-lookup"><span data-stu-id="c244b-114">In many cases the failures will be transient and can be handled by using the [Retry pattern][retry-pattern].</span></span>

<span data-ttu-id="c244b-115">Se l'applicazione rileva un errore più permanente da cui non è possibile eseguire facilmente il recupero, deve essere in grado di ripristinare il sistema a uno stato coerente e garantire l'integrità dell'intera operazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-115">If the application detects a more permanent fault it can't easily recover from, it must be able to restore the system to a consistent state and ensure integrity of the entire operation.</span></span>

## <a name="solution"></a><span data-ttu-id="c244b-116">Soluzione</span><span class="sxs-lookup"><span data-stu-id="c244b-116">Solution</span></span>

<span data-ttu-id="c244b-117">Il modello di supervisione agente di pianificazione definisce gli attori seguenti.</span><span class="sxs-lookup"><span data-stu-id="c244b-117">The Scheduler Agent Supervisor pattern defines the following actors.</span></span> <span data-ttu-id="c244b-118">Questi attori orchestrano i passaggi da eseguire nell'ambito dell'attività complessiva.</span><span class="sxs-lookup"><span data-stu-id="c244b-118">These actors orchestrate the steps to be performed as part of the overall task.</span></span>

- <span data-ttu-id="c244b-119">L'**utilità di pianificazione** predispone i passaggi che costituiscono l'attività da eseguire e ne orchestra il funzionamento.</span><span class="sxs-lookup"><span data-stu-id="c244b-119">The **Scheduler** arranges for the steps that make up the task to be executed and orchestrates their operation.</span></span> <span data-ttu-id="c244b-120">Questi passaggi possono essere combinati in una pipeline o un flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c244b-120">These steps can be combined into a pipeline or workflow.</span></span> <span data-ttu-id="c244b-121">L'utilità di pianificazione è responsabile dell'esecuzione dei passaggi descritti in questo flusso di lavoro nell'ordine corretto.</span><span class="sxs-lookup"><span data-stu-id="c244b-121">The Scheduler is responsible for ensuring that the steps in this workflow are performed in the right order.</span></span> <span data-ttu-id="c244b-122">All'esecuzione di ogni passaggio l'utilità di pianificazione registra lo stato del flusso di lavoro, indicando ad esempio che il passaggio non è stato ancora avviato, è in esecuzione o è stato completato.</span><span class="sxs-lookup"><span data-stu-id="c244b-122">As each step is performed, the Scheduler records the state of the workflow, such as "step not yet started," "step running," or "step completed."</span></span> <span data-ttu-id="c244b-123">Le informazioni sullo stato devono includere anche un limite superiore di tempo consentito per il completamento del passaggio, detto appunto ora di completamento.</span><span class="sxs-lookup"><span data-stu-id="c244b-123">The state information should also include an upper limit of the time allowed for the step to finish, called the complete-by time.</span></span> <span data-ttu-id="c244b-124">Se un passaggio richiede l'accesso a una risorsa o un servizio remoto, l'utilità di pianificazione richiama l'agente appropriato, passando i dettagli del lavoro da eseguire.</span><span class="sxs-lookup"><span data-stu-id="c244b-124">If a step requires access to a remote service or resource, the Scheduler invokes the appropriate Agent, passing it the details of the work to be performed.</span></span> <span data-ttu-id="c244b-125">L'utilità di pianificazione comunica in genere con un agente usando la messaggistica asincrona di richiesta-risposta.</span><span class="sxs-lookup"><span data-stu-id="c244b-125">The Scheduler typically communicates with an Agent using asynchronous request/response messaging.</span></span> <span data-ttu-id="c244b-126">Questa azione può essere implementata usando le code, sebbene sia possibile usare anche altre tecnologie di messaggistica distribuite.</span><span class="sxs-lookup"><span data-stu-id="c244b-126">This can be implemented using queues, although other distributed messaging technologies could be used instead.</span></span>

    > <span data-ttu-id="c244b-127">L'utilità di pianificazione esegue una funzione analoga al gestore processi nel [modello del gestore processi](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html).</span><span class="sxs-lookup"><span data-stu-id="c244b-127">The Scheduler performs a similar function to the Process Manager in the [Process Manager pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html).</span></span> <span data-ttu-id="c244b-128">Il flusso di lavoro effettivo è in genere definito e implementato da un motore del flusso di lavoro controllato dall'utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-128">The actual workflow is typically defined and implemented by a workflow engine that's controlled by the Scheduler.</span></span> <span data-ttu-id="c244b-129">Questo approccio decuplica la logica di business nel flusso di lavoro dall'utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-129">This approach decouples the business logic in the workflow from the Scheduler.</span></span>

- <span data-ttu-id="c244b-130">L'**agente** contiene logica che incapsula una chiamata a un servizio remoto o l'accesso a una risorsa remota a cui si fa riferimento in un passaggio di un'attività.</span><span class="sxs-lookup"><span data-stu-id="c244b-130">The **Agent** contains logic that encapsulates a call to a remote service, or access to a remote resource referenced by a step in a task.</span></span> <span data-ttu-id="c244b-131">Ogni agente in genere esegue il wrapping delle chiamate in un singolo servizio o una risorsa, implementando la logica di gestione degli errori e ripetizione dei tentativi appropriata (soggetta a un vincolo di timeout, descritto più avanti).</span><span class="sxs-lookup"><span data-stu-id="c244b-131">Each Agent typically wraps calls to a single service or resource, implementing the appropriate error handling and retry logic (subject to a timeout constraint, described later).</span></span> <span data-ttu-id="c244b-132">Se i passaggi nel flusso di lavoro eseguiti dall'utilità di pianificazione usano vari servizi e risorse in diversi passaggi, ognuno di questi può fare riferimento a un agente differente (dettaglio di implementazione del modello).</span><span class="sxs-lookup"><span data-stu-id="c244b-132">If the steps in the workflow being run by the Scheduler use several services and resources across different steps, each step might reference a different Agent (this is an implementation detail of the pattern).</span></span>

- <span data-ttu-id="c244b-133">Il **supervisore** monitora lo stato dei passaggi nell'attività eseguita dall'utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-133">The **Supervisor** monitors the status of the steps in the task being performed by the Scheduler.</span></span> <span data-ttu-id="c244b-134">Viene eseguito periodicamente (la frequenza sarà specifica del sistema) ed esamina lo stato dei passaggi gestiti dall'utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-134">It runs periodically (the frequency will be system specific), and examines the status of steps maintained by the Scheduler.</span></span> <span data-ttu-id="c244b-135">Se ne rileva alcuni con timeout o errori, ne predispone il recupero da parte dell'agente appropriato oppure esegue l'azione correttiva idonea (che potrebbe includere la modifica dello stato di un passaggio).</span><span class="sxs-lookup"><span data-stu-id="c244b-135">If it detects any that have timed out or failed, it arranges for the appropriate Agent to recover the step or execute the appropriate remedial action (this might involve modifying the status of a step).</span></span> <span data-ttu-id="c244b-136">Si noti che le azioni di recupero o correttive vengono implementate dall'utilità di pianificazione e dagli agenti.</span><span class="sxs-lookup"><span data-stu-id="c244b-136">Note that the recovery or remedial actions are implemented by the Scheduler and Agents.</span></span> <span data-ttu-id="c244b-137">Il supervisore deve semplicemente richiedere l'esecuzione di queste azioni.</span><span class="sxs-lookup"><span data-stu-id="c244b-137">The Supervisor should simply request that these actions be performed.</span></span>

<span data-ttu-id="c244b-138">L'utilità di pianificazione, l'agente e il supervisore sono componenti logici e la loro implementazione fisica dipende dalla tecnologia usata.</span><span class="sxs-lookup"><span data-stu-id="c244b-138">The Scheduler, Agent, and Supervisor are logical components and their physical implementation depends on the technology being used.</span></span> <span data-ttu-id="c244b-139">Ad esempio, potrebbero essere implementati vari agenti logici nell'ambito di un unico servizio Web.</span><span class="sxs-lookup"><span data-stu-id="c244b-139">For example, several logical agents might be implemented as part of a single web service.</span></span>

<span data-ttu-id="c244b-140">L'utilità di pianificazione gestisce le informazioni sullo stato dell'attività e sullo stato di ogni passaggio in un archivio dati permanente, detto l'archivio stati.</span><span class="sxs-lookup"><span data-stu-id="c244b-140">The Scheduler maintains information about the progress of the task and the state of each step in a durable data store, called the state store.</span></span> <span data-ttu-id="c244b-141">Il supervisore può usare queste informazioni per determinare se un passaggio non è riuscito.</span><span class="sxs-lookup"><span data-stu-id="c244b-141">The Supervisor can use this information to help determine whether a step has failed.</span></span> <span data-ttu-id="c244b-142">La figura illustra la relazione tra l'utilità di pianificazione, gli agenti, il supervisore e l'archivio stati.</span><span class="sxs-lookup"><span data-stu-id="c244b-142">The figure illustrates the relationship between the Scheduler, the Agents, the Supervisor, and the state store.</span></span>

![Figura 1 - Attori nel modello di supervisione agente di pianificazione](./_images/scheduler-agent-supervisor-pattern.png)


> <span data-ttu-id="c244b-144">Questo diagramma mostra una versione semplificata del modello.</span><span class="sxs-lookup"><span data-stu-id="c244b-144">This diagram shows a simplified version of the pattern.</span></span> <span data-ttu-id="c244b-145">In un'implementazione reale varie istanze dell'utilità di pianificazione potrebbero essere in esecuzione contemporaneamente, ognuna con un subset di attività.</span><span class="sxs-lookup"><span data-stu-id="c244b-145">In a real implementation, there might be many instances of the Scheduler running concurrently, each a subset of tasks.</span></span> <span data-ttu-id="c244b-146">In modo analogo, il sistema può eseguire più istanze di ogni agente o anche più supervisori.</span><span class="sxs-lookup"><span data-stu-id="c244b-146">Similarly, the system could run multiple instances of each Agent, or even multiple Supervisors.</span></span> <span data-ttu-id="c244b-147">In questo caso i supervisori devono coordinare attentamente il lavoro tra loro per verificare che non si trovino a recuperare gli stessi passaggi e attività non riusciti.</span><span class="sxs-lookup"><span data-stu-id="c244b-147">In this case, Supervisors must coordinate their work with each other carefully to ensure that they don’t compete to recover the same failed steps and tasks.</span></span> <span data-ttu-id="c244b-148">Il [modello di designazione leader](leader-election.md) offre una possibile soluzione a questo problema.</span><span class="sxs-lookup"><span data-stu-id="c244b-148">The [Leader Election pattern](leader-election.md) provides one possible solution to this problem.</span></span>

<span data-ttu-id="c244b-149">Quando l'applicazione è pronta per l'esecuzione di un'attività, invia una richiesta all'utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-149">When the application is ready to run a task, it submits a request to the Scheduler.</span></span> <span data-ttu-id="c244b-150">L'utilità di pianificazione registra le informazioni sullo stato iniziale dell'attività e dei relativi passaggi (ad esempio, indicando che il passaggio non è ancora stata avviato) nell'archivio stati e poi inizia a eseguire le operazioni definite dal flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c244b-150">The Scheduler records initial state information about the task and its steps (for example, step not yet started) in the state store and then starts performing the operations defined by the workflow.</span></span> <span data-ttu-id="c244b-151">All'avvio di ogni passaggio, l'utilità di pianificazione aggiorna le informazioni sullo stato del passaggio nell'archivio stati (ad esempio, come passaggio in esecuzione).</span><span class="sxs-lookup"><span data-stu-id="c244b-151">As the Scheduler starts each step, it updates the information about the state of that step in the state store (for example, step running).</span></span>

<span data-ttu-id="c244b-152">Se un passaggio fa riferimento a una risorsa o un servizio remoto, l'utilità di pianificazione invia un messaggio all'agente appropriato.</span><span class="sxs-lookup"><span data-stu-id="c244b-152">If a step references a remote service or resource, the Scheduler sends a message to the appropriate Agent.</span></span> <span data-ttu-id="c244b-153">Il messaggio contiene le informazioni necessarie all'agente per passare al servizio o accedere alla risorsa, oltre all'ora di completamento per l'operazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-153">The message contains the information that the Agent needs to pass to the service or access the resource, in addition to the complete-by time for the operation.</span></span> <span data-ttu-id="c244b-154">Se l'agente completata l'operazione, restituisce una risposta all'utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-154">If the Agent completes its operation successfully, it returns a response to the Scheduler.</span></span> <span data-ttu-id="c244b-155">A questo punto l'utilità di pianificazione può aggiornare le informazioni sullo stato nell'archivio stati (ad esempio, come passaggio completato) ed esegue il passaggio successivo.</span><span class="sxs-lookup"><span data-stu-id="c244b-155">The Scheduler can then update the state information in the state store (for example, step completed) and perform the next step.</span></span> <span data-ttu-id="c244b-156">Questo processo continua fino al completamento dell'intera attività.</span><span class="sxs-lookup"><span data-stu-id="c244b-156">This process continues until the entire task is complete.</span></span>

<span data-ttu-id="c244b-157">Un agente può implementare qualsiasi logica di ripetizione dei tentativi necessaria a eseguire il lavoro.</span><span class="sxs-lookup"><span data-stu-id="c244b-157">An Agent can implement any retry logic that's necessary to perform its work.</span></span> <span data-ttu-id="c244b-158">Tuttavia, se l'agente non completa il lavoro entro il periodo di completamento, l'utilità di pianificazione presupporrà che l'operazione non sia riuscita.</span><span class="sxs-lookup"><span data-stu-id="c244b-158">However, if the Agent doesn't complete its work before the complete-by period expires, the Scheduler will assume that the operation has failed.</span></span> <span data-ttu-id="c244b-159">In questo caso l'agente dovrebbe interrompere il lavoro e non restituire alcuna risposta all'utilità di pianificazione (nemmeno un messaggio di errore) o tentare alcun tipo di ripristino.</span><span class="sxs-lookup"><span data-stu-id="c244b-159">In this case, the Agent should stop its work and not try to return anything to the Scheduler (not even an error message), or try any form of recovery.</span></span> <span data-ttu-id="c244b-160">Il motivo di questa limitazione è che, in caso di timeout o errori in un passaggio, un'altra istanza dell'agente può essere pianificata per eseguire il passaggio non riuscito (questo processo è descritto più avanti).</span><span class="sxs-lookup"><span data-stu-id="c244b-160">The reason for this restriction is that, after a step has timed out or failed, another instance of the Agent might be scheduled to run the failing step (this process is described later).</span></span>

<span data-ttu-id="c244b-161">Se l'agente ha esito negativo, l'utilità di pianificazione non riceverà una risposta.</span><span class="sxs-lookup"><span data-stu-id="c244b-161">If the Agent fails, the Scheduler won't receive a response.</span></span> <span data-ttu-id="c244b-162">Il modello non effettua distinzione tra un passaggio con timeout e uno effettivamente non riuscito.</span><span class="sxs-lookup"><span data-stu-id="c244b-162">The pattern doesn't make a distinction between a step that has timed out and one that has genuinely failed.</span></span>

<span data-ttu-id="c244b-163">In caso di timeout o errore in un passaggio, l'archivio stati conterrà un record che indica che il passaggio è in esecuzione, ma l'ora di completamento sarà stato superato.</span><span class="sxs-lookup"><span data-stu-id="c244b-163">If a step times out or fails, the state store will contain a record that indicates that the step is running, but the complete-by time will have passed.</span></span> <span data-ttu-id="c244b-164">Il supervisore cerca passaggi come questo e tenta di recuperarli.</span><span class="sxs-lookup"><span data-stu-id="c244b-164">The Supervisor looks for steps like this and tries to recover them.</span></span> <span data-ttu-id="c244b-165">Una possibile strategia prevede che il supervisore aggiorni il valore dell'ora di completamento per estendere la durata disponibile per completare il passaggio e invii un messaggio all'utilità di pianificazione identificando il passaggio con timeout. A questo punto l'utilità di pianificazione potrà provare a ripetere il passaggio.</span><span class="sxs-lookup"><span data-stu-id="c244b-165">One possible strategy is for the Supervisor to update the complete-by value to extend the time available to complete the step, and then send a message to the Scheduler identifying the step that has timed out. The Scheduler can then try to repeat this step.</span></span> <span data-ttu-id="c244b-166">Tuttavia, per questa soluzione le attività devono essere idempotenti.</span><span class="sxs-lookup"><span data-stu-id="c244b-166">However, this design requires the tasks to be idempotent.</span></span>

<span data-ttu-id="c244b-167">Il supervisore potrebbe dover impedire che lo stesso passaggio venga ripetuto se continuano a verificarsi errori o timeout. A tale scopo, il supervisore può gestire un numero di tentativi per ogni passaggio, insieme alle informazioni sullo stato, nell'archivio stati.</span><span class="sxs-lookup"><span data-stu-id="c244b-167">The Supervisor might need to prevent the same step from being retried if it continually fails or times out. To do this, the Supervisor could maintain a retry count for each step, along with the state information, in the state store.</span></span> <span data-ttu-id="c244b-168">Se questo numero supera una soglia predefinita, il supervisore può adottare una strategia di attesa per un periodo più esteso prima di indicare all'utilità di pianificazione di provare a ripetere il passaggio, nell'eventualità che l'errore venga risolto durante questo periodo.</span><span class="sxs-lookup"><span data-stu-id="c244b-168">If this count exceeds a predefined threshold the Supervisor can adopt a strategy of waiting for an extended period before notifying the Scheduler that it should retry the step, in the expectation that the fault will be resolved during this period.</span></span> <span data-ttu-id="c244b-169">In alternativa, il supervisore può inviare un messaggio all'utilità di pianificazione per richiedere di annullare l'intera attività implementando un [modello di transazioni di compensazione](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="c244b-169">Alternatively, the Supervisor can send a message to the Scheduler to request the entire task be undone by implementing a [Compensating Transaction pattern](compensating-transaction.md).</span></span> <span data-ttu-id="c244b-170">Questo approccio varia a seconda che l'utilità di pianificazione e gli agenti forniscano o meno le informazioni necessarie per implementare le operazioni di compensazione per ogni passaggio completato correttamente.</span><span class="sxs-lookup"><span data-stu-id="c244b-170">This approach will depend on the Scheduler and Agents providing the information necessary to implement the compensating operations for each step that completed successfully.</span></span>

> <span data-ttu-id="c244b-171">Non è compito del supervisore monitorare l'utilità di pianificazione e gli agenti e riavviarli in caso di errori.</span><span class="sxs-lookup"><span data-stu-id="c244b-171">It isn't the purpose of the Supervisor to monitor the Scheduler and Agents, and restart them if they fail.</span></span> <span data-ttu-id="c244b-172">Questo aspetto del sistema deve essere gestito dall'infrastruttura in cui sono in esecuzione questi componenti.</span><span class="sxs-lookup"><span data-stu-id="c244b-172">This aspect of the system should be handled by the infrastructure these components are running in.</span></span> <span data-ttu-id="c244b-173">In modo analogo, il supervisore non è tenuto a conoscere le effettive operazioni di business svolte dalle attività in esecuzione nell'utilità di pianificazione (tra cui la procedura di compensazione in caso di errori in queste attività).</span><span class="sxs-lookup"><span data-stu-id="c244b-173">Similarly, the Supervisor shouldn't have knowledge of the actual business operations that the tasks being performed by the Scheduler are running (including how to compensate should these tasks fail).</span></span> <span data-ttu-id="c244b-174">È compito della logica di flusso di lavoro implementata dall'utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-174">This is the purpose of the workflow logic implemented by the Scheduler.</span></span> <span data-ttu-id="c244b-175">L'unica responsabilità del supervisore consiste nel determinare se un passaggio non è riuscito e disporne la ripetizione oppure l'annullamento dell'intera attività che include il passaggio con errori.</span><span class="sxs-lookup"><span data-stu-id="c244b-175">The sole responsibility of the Supervisor is to determine whether a step has failed and arrange either for it to be repeated or for the entire task containing the failed step to be undone.</span></span>

<span data-ttu-id="c244b-176">Se l'utilità di pianificazione viene riavviata dopo un errore o il flusso di lavoro eseguito dall'utilità di pianificazione si arresta in modo imprevisto, l'utilità di pianificazione dovrà essere in grado di determinare lo stato di qualsiasi attività in elaborazione al suo interno al momento dell'errore ed essere pronta a riprenderla dal punto dell'interruzione.</span><span class="sxs-lookup"><span data-stu-id="c244b-176">If the Scheduler is restarted after a failure, or the workflow being performed by the Scheduler terminates unexpectedly, the Scheduler should be able to determine the status of any inflight task that it was handling when it failed, and be prepared to resume this task from that point.</span></span> <span data-ttu-id="c244b-177">I dettagli di implementazione di questo processo sono probabilmente specifici del sistema.</span><span class="sxs-lookup"><span data-stu-id="c244b-177">The implementation details of this process are likely to be system specific.</span></span> <span data-ttu-id="c244b-178">Se l'attività non può essere recuperata, potrebbe essere necessario annullare il lavoro già eseguito dall'attività stessa.</span><span class="sxs-lookup"><span data-stu-id="c244b-178">If the task can't be recovered, it might be necessary to undo the work already performed by the task.</span></span> <span data-ttu-id="c244b-179">Potrebbe essere anche necessario implementare una [transazione di compensazione](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="c244b-179">This might also require implementing a [compensating transaction](compensating-transaction.md).</span></span>

<span data-ttu-id="c244b-180">Il vantaggio principale di questo modello è che il sistema è resiliente in caso di errori temporanei o irreversibili imprevisti.</span><span class="sxs-lookup"><span data-stu-id="c244b-180">The key advantage of this pattern is that the system is resilient in the event of unexpected temporary or unrecoverable failures.</span></span> <span data-ttu-id="c244b-181">Il sistema può essere progettato per la riparazione automatica.</span><span class="sxs-lookup"><span data-stu-id="c244b-181">The system can be constructed to be self healing.</span></span> <span data-ttu-id="c244b-182">Ad esempio, se si verifica un errore nell'agente o nell'utilità di pianificazione, è possibile avviare un nuovo agente e il supervisore può predisporre la ripresa di un'attività.</span><span class="sxs-lookup"><span data-stu-id="c244b-182">For example, if an Agent or the Scheduler fails, a new one can be started and the Supervisor can arrange for a task to be resumed.</span></span> <span data-ttu-id="c244b-183">Se si verificano errori nel supervisore, un'altra istanza può essere avviata e riprendere dal punto in cui si è verificato l'errore.</span><span class="sxs-lookup"><span data-stu-id="c244b-183">If the Supervisor fails, another instance can be started and can take over from where the failure occurred.</span></span> <span data-ttu-id="c244b-184">Se il supervisore è pianificato per l'esecuzione periodica, una nuova istanza può essere avviata automaticamente dopo un intervallo predefinito.</span><span class="sxs-lookup"><span data-stu-id="c244b-184">If the Supervisor is scheduled to run periodically, a new instance can be automatically started after a predefined interval.</span></span> <span data-ttu-id="c244b-185">È possibile replicare l'archivio stati per raggiungere anche un maggiore grado di resilienza.</span><span class="sxs-lookup"><span data-stu-id="c244b-185">The state store can be replicated to reach an even greater degree of resiliency.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="c244b-186">Considerazioni e problemi</span><span class="sxs-lookup"><span data-stu-id="c244b-186">Issues and considerations</span></span>

<span data-ttu-id="c244b-187">Prima di decidere come implementare questo schema, è opportuno considerare quanto segue:</span><span class="sxs-lookup"><span data-stu-id="c244b-187">You should consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="c244b-188">Questo modello può essere difficile da implementare e richiede test approfonditi di ogni possibile modalità di errore del sistema.</span><span class="sxs-lookup"><span data-stu-id="c244b-188">This pattern can be difficult to implement and requires thorough testing of each possible failure mode of the system.</span></span>

- <span data-ttu-id="c244b-189">La logica di recupero/ripetizione dei tentativi implementata dall'utilità di pianificazione è complessa e varia a seconda delle informazioni sullo stato incluse nell'archivio stati.</span><span class="sxs-lookup"><span data-stu-id="c244b-189">The recovery/retry logic implemented by the Scheduler is complex and dependent on state information held in the state store.</span></span> <span data-ttu-id="c244b-190">Potrebbe anche essere necessario registrare le informazioni richieste per implementare una transazione di compensazione in un archivio dati permanente.</span><span class="sxs-lookup"><span data-stu-id="c244b-190">It might also be necessary to record the information required to implement a compensating transaction in a durable data store.</span></span>

- <span data-ttu-id="c244b-191">La frequenza di esecuzione del supervisore è importante.</span><span class="sxs-lookup"><span data-stu-id="c244b-191">How often the Supervisor runs will be important.</span></span> <span data-ttu-id="c244b-192">Deve essere eseguito con una frequenza tale da impedire che eventuali passaggi con errori blocchino un'applicazione per un lungo periodo di tempo, ma non così spesso da creare un sovraccarico.</span><span class="sxs-lookup"><span data-stu-id="c244b-192">It should run often enough to prevent any failed steps from blocking an application for an extended period, but it shouldn't run so often that it becomes an overhead.</span></span>

- <span data-ttu-id="c244b-193">I passaggi svolti da un agente possono essere eseguiti più volte.</span><span class="sxs-lookup"><span data-stu-id="c244b-193">The steps performed by an Agent could be run more than once.</span></span> <span data-ttu-id="c244b-194">La logica che implementa questi passaggi deve essere idempotente.</span><span class="sxs-lookup"><span data-stu-id="c244b-194">The logic that implements these steps should be idempotent.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="c244b-195">Quando usare questo modello</span><span class="sxs-lookup"><span data-stu-id="c244b-195">When to use this pattern</span></span>

<span data-ttu-id="c244b-196">Usare questo modello quando un processo che viene eseguito in un ambiente distribuito, ad esempio nel cloud, deve essere resiliente a errori di comunicazione e/o operativi.</span><span class="sxs-lookup"><span data-stu-id="c244b-196">Use this pattern when a process that runs in a distributed environment, such as the cloud, must be resilient to communications failure and/or operational failure.</span></span>

<span data-ttu-id="c244b-197">Questo modello potrebbe non essere indicato per le attività che non richiamano servizi remoti o accedono a risorse remote.</span><span class="sxs-lookup"><span data-stu-id="c244b-197">This pattern might not be suitable for tasks that don't invoke remote services or access remote resources.</span></span>

## <a name="example"></a><span data-ttu-id="c244b-198">Esempio</span><span class="sxs-lookup"><span data-stu-id="c244b-198">Example</span></span>

<span data-ttu-id="c244b-199">Un'applicazione Web che implementa un sistema di e-commerce è stata distribuita in Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="c244b-199">A web application that implements an ecommerce system has been deployed on Microsoft Azure.</span></span> <span data-ttu-id="c244b-200">Gli utenti possono eseguire questa applicazione per visualizzare i prodotti disponibili ed eseguire ordini.</span><span class="sxs-lookup"><span data-stu-id="c244b-200">Users can run this application to browse the available products and to place orders.</span></span> <span data-ttu-id="c244b-201">L'interfaccia utente viene eseguita come ruolo Web e gli elementi di elaborazione degli ordini dell'applicazione vengono implementati come set di ruoli di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c244b-201">The user interface runs as a web role, and the order processing elements of the application are implemented as a set of worker roles.</span></span> <span data-ttu-id="c244b-202">Parte della logica di elaborazione degli ordini implica l'accesso a un servizio remoto. Questo aspetto del sistema potrebbe essere soggetto a errori temporanei e/o di durata più estesa.</span><span class="sxs-lookup"><span data-stu-id="c244b-202">Part of the order processing logic involves accessing a remote service, and this aspect of the system could be prone to transient or more long-lasting faults.</span></span> <span data-ttu-id="c244b-203">Per questo motivo, i progettisti hanno usato il modello di supervisione agente di pianificazione per implementare gli elementi di elaborazione degli ordini del sistema.</span><span class="sxs-lookup"><span data-stu-id="c244b-203">For this reason, the designers used the Scheduler Agent Supervisor pattern to implement the order processing elements of the system.</span></span>

<span data-ttu-id="c244b-204">Quando un cliente esegue un ordine, l'applicazione crea un messaggio che descrive l'ordine e lo invia a una coda.</span><span class="sxs-lookup"><span data-stu-id="c244b-204">When a customer places an order, the application constructs a message that describes the order and posts this message to a queue.</span></span> <span data-ttu-id="c244b-205">Un processo di invio separato, in esecuzione in un ruolo di lavoro, recupera il messaggio, inserisce i dettagli dell'ordine nel database degli ordini e crea un record per il processo dell'ordine nell'archivio stati.</span><span class="sxs-lookup"><span data-stu-id="c244b-205">A separate submission process, running in a worker role, retrieves the message, inserts the order details into the orders database, and creates a record for the order process in the state store.</span></span> <span data-ttu-id="c244b-206">Si noti che gli inserimenti nel database degli ordini e nell'archivio stati vengono eseguiti all'interno della stessa operazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-206">Note that the inserts into the orders database and the state store are performed as part of the same operation.</span></span> <span data-ttu-id="c244b-207">Il processo di invio è progettato per garantire che entrambi gli inserimenti vengano completati contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="c244b-207">The submission process is designed to ensure that both inserts complete together.</span></span>

<span data-ttu-id="c244b-208">Le informazioni sullo stato create durante il processo di invio dell'ordine includono:</span><span class="sxs-lookup"><span data-stu-id="c244b-208">The state information that the submission process creates for the order includes:</span></span>

- <span data-ttu-id="c244b-209">**OrderID**.</span><span class="sxs-lookup"><span data-stu-id="c244b-209">**OrderID**.</span></span> <span data-ttu-id="c244b-210">ID dell'ordine nel database degli ordini.</span><span class="sxs-lookup"><span data-stu-id="c244b-210">The ID of the order in the orders database.</span></span>

- <span data-ttu-id="c244b-211">**LockedBy**.</span><span class="sxs-lookup"><span data-stu-id="c244b-211">**LockedBy**.</span></span> <span data-ttu-id="c244b-212">ID di istanza del ruolo di lavoro che gestisce l'ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-212">The instance ID of the worker role handling the order.</span></span> <span data-ttu-id="c244b-213">Potrebbero essere presenti più istanze correnti del ruolo di lavoro in esecuzione nell'utilità di pianificazione, ma ogni ordine deve essere gestito da una sola istanza.</span><span class="sxs-lookup"><span data-stu-id="c244b-213">There might be multiple current instances of the worker role running the Scheduler, but each order should only be handled by a single instance.</span></span>

- <span data-ttu-id="c244b-214">**CompleteBy**.</span><span class="sxs-lookup"><span data-stu-id="c244b-214">**CompleteBy**.</span></span> <span data-ttu-id="c244b-215">Ora di completamento dell'elaborazione dell'ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-215">The time the order should be processed by.</span></span>

- <span data-ttu-id="c244b-216">**ProcessState**.</span><span class="sxs-lookup"><span data-stu-id="c244b-216">**ProcessState**.</span></span> <span data-ttu-id="c244b-217">Stato corrente dell'attività che gestisce l'ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-217">The current state of the task handling the order.</span></span> <span data-ttu-id="c244b-218">Gli stati possibili sono elencati di seguito:</span><span class="sxs-lookup"><span data-stu-id="c244b-218">The possible states are:</span></span>

    - <span data-ttu-id="c244b-219">**Pending**.</span><span class="sxs-lookup"><span data-stu-id="c244b-219">**Pending**.</span></span> <span data-ttu-id="c244b-220">L'ordine è stato creato, ma l'elaborazione non è ancora stata avviata.</span><span class="sxs-lookup"><span data-stu-id="c244b-220">The order has been created but processing hasn't yet been started.</span></span>
    - <span data-ttu-id="c244b-221">**Processing**.</span><span class="sxs-lookup"><span data-stu-id="c244b-221">**Processing**.</span></span> <span data-ttu-id="c244b-222">L'ordine è in fase di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-222">The order is currently being processed.</span></span>
    - <span data-ttu-id="c244b-223">**Processed**.</span><span class="sxs-lookup"><span data-stu-id="c244b-223">**Processed**.</span></span> <span data-ttu-id="c244b-224">L'ordine è stato elaborato correttamente.</span><span class="sxs-lookup"><span data-stu-id="c244b-224">The order has been processed successfully.</span></span>
    - <span data-ttu-id="c244b-225">**Error**.</span><span class="sxs-lookup"><span data-stu-id="c244b-225">**Error**.</span></span> <span data-ttu-id="c244b-226">L'elaborazione degli ordini non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="c244b-226">The order processing has failed.</span></span>

- <span data-ttu-id="c244b-227">**FailureCount**.</span><span class="sxs-lookup"><span data-stu-id="c244b-227">**FailureCount**.</span></span> <span data-ttu-id="c244b-228">Numero di tentativi di elaborazione dell'ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-228">The number of times that processing has been tried for the order.</span></span>

<span data-ttu-id="c244b-229">In queste informazioni sullo stato il campo `OrderID` viene copiato dall'ID del nuovo ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-229">In this state information, the `OrderID` field is copied from the order ID of the new order.</span></span> <span data-ttu-id="c244b-230">I campi `LockedBy` e `CompleteBy` sono impostati su `null`, il campo `ProcessState` su `Pending`e il campo `FailureCount` su 0.</span><span class="sxs-lookup"><span data-stu-id="c244b-230">The `LockedBy` and `CompleteBy` fields are set to `null`, the `ProcessState` field is set to `Pending`, and the `FailureCount` field is set to 0.</span></span>

> <span data-ttu-id="c244b-231">In questo esempio, la logica di gestione degli ordini è relativamente semplice e include un solo passaggio che richiama un servizio remoto.</span><span class="sxs-lookup"><span data-stu-id="c244b-231">In this example, the order handling logic is relatively simple and only has a single step that invokes a remote service.</span></span> <span data-ttu-id="c244b-232">In uno scenario più complesso a più passaggi, il processo di invio comporterebbe diversi passaggi e verrebbero creati vari record nell'archivio stati, ognuno con la descrizione dello stato di un singolo passaggio.</span><span class="sxs-lookup"><span data-stu-id="c244b-232">In a more complex multistep scenario, the submission process would likely involve several steps, and so several records would be created in the state store—each one describing the state of an individual step.</span></span>

<span data-ttu-id="c244b-233">Anche l'utilità di pianificazione viene eseguita nell'ambito di un ruolo di lavoro e implementa la logica di business che gestisce l'ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-233">The Scheduler also runs as part of a worker role and implements the business logic that handles the order.</span></span> <span data-ttu-id="c244b-234">Un'istanza dell'utilità di pianificazione che esegue il polling di nuovi ordini esamina l'archivio stati alla ricerca dei record in cui il campo `LockedBy` è Null e il campo `ProcessState` è Pending.</span><span class="sxs-lookup"><span data-stu-id="c244b-234">An instance of the Scheduler polling for new orders examines the state store for records where the `LockedBy` field is null and the `ProcessState` field is pending.</span></span> <span data-ttu-id="c244b-235">Quando l'utilità di pianificazione individua un nuovo ordine, popola immediatamente il campo `LockedBy` con lo specifico ID di istanza, imposta il campo `CompleteBy` su un'ora appropriata e imposta il campo `ProcessState` per l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-235">When the Scheduler finds a new order, it immediately populates the `LockedBy` field with its own instance ID, sets the `CompleteBy` field to an appropriate time, and sets the `ProcessState` field to processing.</span></span> <span data-ttu-id="c244b-236">Il codice è progettato per essere esclusivo e atomico, per garantire che due istanze simultanee dell'utilità di pianificazione non tentino di gestire contemporaneamente lo stesso ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-236">The code is designed to be exclusive and atomic to ensure that two concurrent instances of the Scheduler can't try to handle the same order simultaneously.</span></span>

<span data-ttu-id="c244b-237">L'utilità di pianificazione esegue poi il flusso di lavoro di business per elaborare l'ordine in modo asincrono, passando il valore nel campo `OrderID` dall'archivio stati.</span><span class="sxs-lookup"><span data-stu-id="c244b-237">The Scheduler then runs the business workflow to process the order asynchronously, passing it the value in the `OrderID` field from the state store.</span></span> <span data-ttu-id="c244b-238">Il flusso di lavoro che gestisce l'ordine recupera i dettagli dell'ordine dal database degli ordini ed esegue il suo lavoro.</span><span class="sxs-lookup"><span data-stu-id="c244b-238">The workflow handling the order retrieves the details of the order from the orders database and performs its work.</span></span> <span data-ttu-id="c244b-239">Quando un passaggio nel flusso di lavoro di elaborazione degli ordini deve richiamare il servizio remoto, usa un agente.</span><span class="sxs-lookup"><span data-stu-id="c244b-239">When a step in the order processing workflow needs to invoke the remote service, it uses an Agent.</span></span> <span data-ttu-id="c244b-240">Il passaggio del flusso di lavoro comunica con l'agente usando una coppia di code di messaggi del bus di servizio di Azure che funge da canale di richiesta/risposta.</span><span class="sxs-lookup"><span data-stu-id="c244b-240">The workflow step communicates with the Agent using a pair of Azure Service Bus message queues acting as a request/response channel.</span></span> <span data-ttu-id="c244b-241">La figura illustra una panoramica della soluzione.</span><span class="sxs-lookup"><span data-stu-id="c244b-241">The figure shows a high level view of the solution.</span></span>

![Figura 2 - Uso del modello di supervisione agente di pianificazione per gestire gli ordini in una soluzione di Azure](./_images/scheduler-agent-supervisor-solution.png)

<span data-ttu-id="c244b-243">Il messaggio inviato da un passaggio del flusso di lavoro all'agente descrive l'ordine e include l'ora di completamento.</span><span class="sxs-lookup"><span data-stu-id="c244b-243">The message sent to the Agent from a workflow step describes the order and includes the complete-by time.</span></span> <span data-ttu-id="c244b-244">Se l'agente riceve una risposta dal servizio remoto prima che sopraggiunga l'ora di completamento, invia un messaggio di risposta nella coda del bus di servizio in cui è in ascolto il flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c244b-244">If the Agent receives a response from the remote service before the complete-by time expires, it posts a reply message on the Service Bus queue on which the workflow is listening.</span></span> <span data-ttu-id="c244b-245">Quando il passaggio del flusso di lavoro riceve il messaggio di risposta valido, completa l'elaborazione e l'utilità di pianificazione imposta il campo ProcessState dello stato dell'ordine su Processed.</span><span class="sxs-lookup"><span data-stu-id="c244b-245">When the workflow step receives the valid reply message, it completes its processing and the Scheduler sets the \`ProcessState field of the order state to processed.</span></span> <span data-ttu-id="c244b-246">A questo punto, l'elaborazione dell'ordine è stata completata.</span><span class="sxs-lookup"><span data-stu-id="c244b-246">At this point, the order processing has completed successfully.</span></span>

<span data-ttu-id="c244b-247">Se l'ora di completamento giunge prima che l'agente riceva una risposta dal servizio remoto, l'agente interrompe l'elaborazione e termina la gestione dell'ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-247">If the complete-by time expires before the Agent receives a response from the remote service, the Agent simply halts its processing and terminates handling the order.</span></span> <span data-ttu-id="c244b-248">In modo analogo, se il flusso di lavoro che gestisce l'ordine supera l'ora di completamento, termina anch'esso.</span><span class="sxs-lookup"><span data-stu-id="c244b-248">Similarly, if the workflow handling the order exceeds the complete-by time, it also terminates.</span></span> <span data-ttu-id="c244b-249">In entrambi i casi, lo stato dell'ordine nell'archivio stati resta impostato su Processing, ma l'ora di completamento indica che l'ora di elaborazione dell'ordine è stata superata e il processo viene considerato come non riuscito.</span><span class="sxs-lookup"><span data-stu-id="c244b-249">In both cases, the state of the order in the state store remains set to processing, but the complete-by time indicates that the time for processing the order has passed and the process is deemed to have failed.</span></span> <span data-ttu-id="c244b-250">Se l'agente che accede al servizio remoto o il flusso di lavoro che gestisce l'ordine (o entrambi) viene terminato in modo imprevisto, le informazioni nell'archivio stati rimarranno nuovamente impostate su Processing e il valore di completamento risulterà scaduto.</span><span class="sxs-lookup"><span data-stu-id="c244b-250">Note that if the Agent that's accessing the remote service, or the workflow that's handling the order (or both) terminate unexpectedly, the information in the state store will again remain set to processing and eventually will have an expired complete-by value.</span></span>

<span data-ttu-id="c244b-251">Se l'agente rileva un errore irreversibile permanente mentre prova a contattare il servizio remoto, può inviare una risposta di errore al flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c244b-251">If the Agent detects an unrecoverable, nontransient fault while it's trying to contact the remote service, it can send an error response back to the workflow.</span></span> <span data-ttu-id="c244b-252">L'utilità di pianificazione può impostare lo stato dell'ordine su Error e generare un evento che avvisa un operatore.</span><span class="sxs-lookup"><span data-stu-id="c244b-252">The Scheduler can set the status of the order to error and raise an event that alerts an operator.</span></span> <span data-ttu-id="c244b-253">A questo punto l'operatore può provare a risolvere manualmente il motivo dell'errore e inviare di nuovo il passaggio di elaborazione non riuscito.</span><span class="sxs-lookup"><span data-stu-id="c244b-253">The operator can then try to resolve the reason for the failure manually and resubmit the failed processing step.</span></span>

<span data-ttu-id="c244b-254">Il supervisore esamina periodicamente l'archivio stati alla ricerca di ordini con valore di completamento scaduto.</span><span class="sxs-lookup"><span data-stu-id="c244b-254">The Supervisor periodically examines the state store looking for orders with an expired complete-by value.</span></span> <span data-ttu-id="c244b-255">Se il supervisore trova un record, incrementa il campo `FailureCount`.</span><span class="sxs-lookup"><span data-stu-id="c244b-255">If the Supervisor finds a record, it increments the `FailureCount` field.</span></span> <span data-ttu-id="c244b-256">Se il valore del numero di errori è inferiore a un valore di soglia specificato, il supervisore reimposta il campo `LockedBy` su Null, aggiorna il campo `CompleteBy` con una nuova ora di scadenza e imposta il campo `ProcessState` su Pending.</span><span class="sxs-lookup"><span data-stu-id="c244b-256">If the failure count value is below a specified threshold value, the Supervisor resets the `LockedBy` field to null, updates the `CompleteBy` field with a new expiration time, and sets the `ProcessState` field to pending.</span></span> <span data-ttu-id="c244b-257">Un'istanza dell'utilità di pianificazione può prelevare questo ordine ed eseguire l'elaborazione come in precedenza.</span><span class="sxs-lookup"><span data-stu-id="c244b-257">An instance of the Scheduler can pick up this order and perform its processing as before.</span></span> <span data-ttu-id="c244b-258">Se il valore del numero di errori supera una soglia specificata, il motivo dell'errore viene considerato permanente.</span><span class="sxs-lookup"><span data-stu-id="c244b-258">If the failure count value exceeds a specified threshold, the reason for the failure is assumed to be nontransient.</span></span> <span data-ttu-id="c244b-259">L'utilità di pianificazione imposta lo stato dell'ordine su Error e genera un evento che avvisa un operatore.</span><span class="sxs-lookup"><span data-stu-id="c244b-259">The Supervisor sets the status of the order to error and raises an event that alerts an operator.</span></span>

> <span data-ttu-id="c244b-260">In questo esempio, il supervisore viene implementato in un ruolo di lavoro separato.</span><span class="sxs-lookup"><span data-stu-id="c244b-260">In this example, the Supervisor is implemented in a separate worker role.</span></span> <span data-ttu-id="c244b-261">È possibile usare un'ampia gamma di strategie per predisporre l'esecuzione dell'attività del supervisore, ad esempio l'uso del servizio Utilità di pianificazione di Azure (da non confondersi con il componente utilità di pianificazione in questo modello).</span><span class="sxs-lookup"><span data-stu-id="c244b-261">You can use a variety of strategies to arrange for the Supervisor task to be run, including using the Azure Scheduler service (not to be confused with the Scheduler component in this pattern).</span></span> <span data-ttu-id="c244b-262">Per altre informazioni sul servizio Utilità di pianificazione di Azure, visitare la pagina [Utilità di pianificazione](https://azure.microsoft.com/services/scheduler/).</span><span class="sxs-lookup"><span data-stu-id="c244b-262">For more information about the Azure Scheduler service, visit the [Scheduler](https://azure.microsoft.com/services/scheduler/) page.</span></span>

<span data-ttu-id="c244b-263">Sebbene non sia mostrato in questo esempio, l'utilità di pianificazione potrebbe dover mantenere informata l'applicazione che ha inviato l'ordine sull'avanzamento e sullo stato dell'ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-263">Although it isn't shown in this example, the Scheduler might need to keep the application that submitted the order informed about the progress and status of the order.</span></span> <span data-ttu-id="c244b-264">L'applicazione e l'utilità di pianificazione sono isolate l'una dall'altra per eliminare eventuali interdipendenze.</span><span class="sxs-lookup"><span data-stu-id="c244b-264">The application and the Scheduler are isolated from each other to eliminate any dependencies between them.</span></span> <span data-ttu-id="c244b-265">L'applicazione ignora quale istanza dell'utilità di pianificazione gestisca l'ordine e l'utilità di pianificazione non conosce la specifica istanza dell'applicazione che ha inviato l'ordine.</span><span class="sxs-lookup"><span data-stu-id="c244b-265">The application has no knowledge of which instance of the Scheduler is handling the order, and the Scheduler is unaware of which specific application instance posted the order.</span></span>

<span data-ttu-id="c244b-266">Per consentire la segnalazione dello stato dell'ordine, l'applicazione può usare la coda di risposta privata.</span><span class="sxs-lookup"><span data-stu-id="c244b-266">To allow the order status to be reported, the application could use its own private response queue.</span></span> <span data-ttu-id="c244b-267">I dettagli di questa coda di risposta verranno inseriti nella richiesta inviata al processo di invio, che includerà queste informazioni nell'archivio stati.</span><span class="sxs-lookup"><span data-stu-id="c244b-267">The details of this response queue would be included as part of the request sent to the submission process, which would include this information in the state store.</span></span> <span data-ttu-id="c244b-268">L'utilità di pianificazione pubblicherà poi i messaggi a questa coda indicando lo stato dell'ordine (richiesta ricevuta, ordine completato, ordine non è riuscito e così via).</span><span class="sxs-lookup"><span data-stu-id="c244b-268">The Scheduler would then post messages to this queue indicating the status of the order (request received, order completed, order failed, and so on).</span></span> <span data-ttu-id="c244b-269">Deve includere l'ID dell'ordine in questi messaggi, in modo che possano essere correlati alla richiesta originale dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c244b-269">It should include the order ID in these messages so they can be correlated with the original request by the application.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="c244b-270">Modelli correlati e informazioni aggiuntive</span><span class="sxs-lookup"><span data-stu-id="c244b-270">Related patterns and guidance</span></span>

<span data-ttu-id="c244b-271">Per l'implementazione di questo modello possono risultare utili i modelli e le informazioni aggiuntive seguenti:</span><span class="sxs-lookup"><span data-stu-id="c244b-271">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>
- <span data-ttu-id="c244b-272">[Modello di ripetizione dei tentativi][retry-pattern].</span><span class="sxs-lookup"><span data-stu-id="c244b-272">[Retry pattern][retry-pattern].</span></span> <span data-ttu-id="c244b-273">Un agente può usare questo modello per ripetere in modo trasparente un'operazione che accede a un servizio remoto o una risorsa precedentemente non riuscita.</span><span class="sxs-lookup"><span data-stu-id="c244b-273">An Agent can use this pattern to transparently retry an operation that accesses a remote service or resource that has previously failed.</span></span> <span data-ttu-id="c244b-274">Usarlo quando si prevede che la causa dell'errore sia temporanea e possa essere corretta.</span><span class="sxs-lookup"><span data-stu-id="c244b-274">Use when the expectation is that the cause of the failure is transient and can be corrected.</span></span>
- <span data-ttu-id="c244b-275">[Modello di interruttore](circuit-breaker.md).</span><span class="sxs-lookup"><span data-stu-id="c244b-275">[Circuit Breaker pattern](circuit-breaker.md).</span></span> <span data-ttu-id="c244b-276">Un agente può usare questo modello per gestire gli errori la cui correzione potrebbe richiedere una quantità variabile di tempo in fase di connessione a una risorsa o a un servizio remoto.</span><span class="sxs-lookup"><span data-stu-id="c244b-276">An Agent can use this pattern to handle faults that take a variable amount of time to correct when connecting to a remote service or resource.</span></span>
- <span data-ttu-id="c244b-277">[Modello di transazioni di compensazione](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="c244b-277">[Compensating Transaction pattern](compensating-transaction.md).</span></span> <span data-ttu-id="c244b-278">Se il flusso di lavoro eseguito da un'utilità di pianificazione non può essere completato, potrebbe essere necessario annullare le operazioni eseguite in precedenza.</span><span class="sxs-lookup"><span data-stu-id="c244b-278">If the workflow being performed by a Scheduler can't be completed successfully, it might be necessary to undo any work it's previously performed.</span></span> <span data-ttu-id="c244b-279">Il modello di transizioni di compensazione descrive come ottenere questo risultato per le operazioni che seguono il modello di coerenza finale.</span><span class="sxs-lookup"><span data-stu-id="c244b-279">The Compensating Transaction pattern describes how this can be achieved for operations that follow the eventual consistency model.</span></span> <span data-ttu-id="c244b-280">Questi tipi di operazioni sono in genere implementate da un'utilità di pianificazione che esegue processi di business e flussi di lavoro complessi.</span><span class="sxs-lookup"><span data-stu-id="c244b-280">These types of operations are commonly implemented by a Scheduler that performs complex business processes and workflows.</span></span>
- <span data-ttu-id="c244b-281">[Introduzione alla messaggistica asincrona](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="c244b-281">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="c244b-282">I componenti nel modello di supervisione agente di pianificazione vengono in genere eseguiti decuplicati tra loro e comunicano in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="c244b-282">The components in the Scheduler Agent Supervisor pattern typically run decoupled from each other and communicate asynchronously.</span></span> <span data-ttu-id="c244b-283">Descrive alcuni approcci che possono essere adottati per implementare la comunicazione asincrona in base alle code di messaggi.</span><span class="sxs-lookup"><span data-stu-id="c244b-283">Describes some of the approaches that can be used to implement asynchronous communication based on message queues.</span></span>
- <span data-ttu-id="c244b-284">[Modello di designazione leader](leader-election.md).</span><span class="sxs-lookup"><span data-stu-id="c244b-284">[Leader Election pattern](leader-election.md).</span></span> <span data-ttu-id="c244b-285">Potrebbe essere necessario coordinare le azioni di più istanze di un supervisore per evitare che tentino di recuperare lo stesso processo non riuscito.</span><span class="sxs-lookup"><span data-stu-id="c244b-285">It might be necessary to coordinate the actions of multiple instances of a Supervisor to prevent them from attempting to recover the same failed process.</span></span> <span data-ttu-id="c244b-286">Il modello di designazione leader descrive come ottenere questo risultato.</span><span class="sxs-lookup"><span data-stu-id="c244b-286">The Leader Election pattern describes how to do this.</span></span>
- <span data-ttu-id="c244b-287">[Cloud Architecture: The Scheduler-Agent-Supervisor Pattern](https://blogs.msdn.microsoft.com/clemensv/2010/09/27/cloud-architecture-the-scheduler-agent-supervisor-pattern/) (Architettura cloud: modello di supervisione agente di pianificazione) sul blog di Clemens Vasters</span><span class="sxs-lookup"><span data-stu-id="c244b-287">[Cloud Architecture: The Scheduler-Agent-Supervisor Pattern](https://blogs.msdn.microsoft.com/clemensv/2010/09/27/cloud-architecture-the-scheduler-agent-supervisor-pattern/) on Clemens Vasters' blog</span></span>
- <span data-ttu-id="c244b-288">[Process Manager pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html) (Modello del gestore processi)</span><span class="sxs-lookup"><span data-stu-id="c244b-288">[Process Manager pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html)</span></span>
- <span data-ttu-id="c244b-289">[Reference 6: A Saga on Sagas](https://msdn.microsoft.com/library/jj591569.aspx) (Riferimento 6: una saga su Sagas).</span><span class="sxs-lookup"><span data-stu-id="c244b-289">[Reference 6: A Saga on Sagas](https://msdn.microsoft.com/library/jj591569.aspx).</span></span> <span data-ttu-id="c244b-290">Esempio che illustra in che modo il modello CQRS usa un gestore processi (nell'ambito delle indicazioni sul passaggio a CQRS).</span><span class="sxs-lookup"><span data-stu-id="c244b-290">An example showing how the CQRS pattern uses a process manager (part of the CQRS Journey guidance).</span></span>
- [<span data-ttu-id="c244b-291">Utilità di pianificazione di Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="c244b-291">Microsoft Azure Scheduler</span></span>](https://azure.microsoft.com/services/scheduler/)

[retry-pattern]: ./retry.md
