---
title: Ridurre al minimo il coordinamento
titleSuffix: Azure Application Architecture Guide
description: Ridurre al minimo il coordinamento tra i servizi delle applicazioni per ottenere la scalabilità.
author: MikeWasson
ms.date: 08/30/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seojan19
ms.openlocfilehash: e124e6720b909bafc74a4c074454ec0a3ec30c59
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/23/2019
ms.locfileid: "54488580"
---
# <a name="minimize-coordination"></a><span data-ttu-id="43efe-103">Ridurre al minimo il coordinamento</span><span class="sxs-lookup"><span data-stu-id="43efe-103">Minimize coordination</span></span>

## <a name="minimize-coordination-between-application-services-to-achieve-scalability"></a><span data-ttu-id="43efe-104">Ridurre al minimo il coordinamento tra i servizi per le applicazioni per ottenere la scalabilità</span><span class="sxs-lookup"><span data-stu-id="43efe-104">Minimize coordination between application services to achieve scalability</span></span>

<span data-ttu-id="43efe-105">La maggior parte delle applicazioni cloud è costituita da più servizi per le applicazioni &mdash; front-end Web, da database, da processi di business, da report, analisi e così via.</span><span class="sxs-lookup"><span data-stu-id="43efe-105">Most cloud applications consist of multiple application services &mdash; web front ends, databases, business processes, reporting and analysis, and so on.</span></span> <span data-ttu-id="43efe-106">Per ottenere scalabilità e affidabilità, ciascuno di questi servizi deve eseguire più istanze.</span><span class="sxs-lookup"><span data-stu-id="43efe-106">To achieve scalability and reliability, each of those services should run on multiple instances.</span></span>

<span data-ttu-id="43efe-107">Cosa accade quando due istanze provano a eseguire operazioni simultanee che influiscono su determinati stati condivisi?</span><span class="sxs-lookup"><span data-stu-id="43efe-107">What happens when two instances try to perform concurrent operations that affect some shared state?</span></span> <span data-ttu-id="43efe-108">In alcuni casi, è necessario il coordinamento tra i nodi, ad esempio per mantenere le garanzie ACID.</span><span class="sxs-lookup"><span data-stu-id="43efe-108">In some cases, there must be coordination across nodes, for example to preserve ACID guarantees.</span></span> <span data-ttu-id="43efe-109">In questo diagramma `Node2` è in attesa che `Node1` rilasci un blocco di database:</span><span class="sxs-lookup"><span data-stu-id="43efe-109">In this diagram, `Node2` is waiting for `Node1` to release a database lock:</span></span>

![Diagramma del blocco di database](./images/database-lock.svg)

<span data-ttu-id="43efe-111">Il coordinamento limita i vantaggi di scalabilità orizzontale e crea i colli di bottiglia.</span><span class="sxs-lookup"><span data-stu-id="43efe-111">Coordination limits the benefits of horizontal scale and creates bottlenecks.</span></span> <span data-ttu-id="43efe-112">In questo esempio, scalando orizzontalmente l'applicazione e aggiungendo altre istanze, verrà visualizzata una contesa di blocco maggiore.</span><span class="sxs-lookup"><span data-stu-id="43efe-112">In this example, as you scale out the application and add more instances, you'll see increased lock contention.</span></span> <span data-ttu-id="43efe-113">Nel peggiore dei casi, le istanze front-end impiegano la maggior parte del tempo in attesa sui blocchi.</span><span class="sxs-lookup"><span data-stu-id="43efe-113">In the worst case, the front-end instances will spend most of their time waiting on locks.</span></span>

<span data-ttu-id="43efe-114">La semantica "exactly once" è un'altra causa frequente di coordinamento.</span><span class="sxs-lookup"><span data-stu-id="43efe-114">"Exactly once" semantics are another frequent source of coordination.</span></span> <span data-ttu-id="43efe-115">Per esempio, un ordine deve essere elaborato esattamente una volta.</span><span class="sxs-lookup"><span data-stu-id="43efe-115">For example, an order must be processed exactly once.</span></span> <span data-ttu-id="43efe-116">Due ruoli di lavoro sono in ascolto di nuovi ordini.</span><span class="sxs-lookup"><span data-stu-id="43efe-116">Two workers are listening for new orders.</span></span> <span data-ttu-id="43efe-117">`Worker1` seleziona un ordine per l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="43efe-117">`Worker1` picks up an order for processing.</span></span> <span data-ttu-id="43efe-118">L'applicazione deve garantire che `Worker2` non duplichi il lavoro, ma anche che, in caso di arresto anomalo di `Worker1`, l'ordine non venga eliminato.</span><span class="sxs-lookup"><span data-stu-id="43efe-118">The application must ensure that `Worker2` doesn't duplicate the work, but also if `Worker1` crashes, the order isn't dropped.</span></span>

![Diagramma del coordinamento](./images/coordination.svg)

<span data-ttu-id="43efe-120">È possibile usare un modello, ad esempio [Supervisione agente di pianificazione][sas-pattern] per il coordinamento tra i ruoli di lavoro, ma in questo caso, una soluzione migliore potrebbe essere partizionare il lavoro.</span><span class="sxs-lookup"><span data-stu-id="43efe-120">You can use a pattern such as [Scheduler Agent Supervisor][sas-pattern] to coordinate between the workers, but in this case a better approach might be to partition the work.</span></span> <span data-ttu-id="43efe-121">A ogni ruolo di lavoro viene assegnato un determinato intervallo di ordini (ad esempio, per area di fatturazione).</span><span class="sxs-lookup"><span data-stu-id="43efe-121">Each worker is assigned a certain range of orders (say, by billing region).</span></span> <span data-ttu-id="43efe-122">Se un ruolo di lavoro ha un arresto anomalo, una nuova istanza riprende dal punto in cui la precedente si è interrotta, senza che vi sia conflitto fra le diverse istanze.</span><span class="sxs-lookup"><span data-stu-id="43efe-122">If a worker crashes, a new instance picks up where the previous instance left off, but multiple instances aren't contending.</span></span>

## <a name="recommendations"></a><span data-ttu-id="43efe-123">Consigli</span><span class="sxs-lookup"><span data-stu-id="43efe-123">Recommendations</span></span>

<span data-ttu-id="43efe-124">**Implementare la coerenza finale**.</span><span class="sxs-lookup"><span data-stu-id="43efe-124">**Embrace eventual consistency**.</span></span> <span data-ttu-id="43efe-125">Quando i dati vengono distribuiti, si coordinano per applicare le garanzie di coerenza di alto livello.</span><span class="sxs-lookup"><span data-stu-id="43efe-125">When data is distributed, it takes coordination to enforce strong consistency guarantees.</span></span> <span data-ttu-id="43efe-126">Ad esempio, si supponga che un'operazione aggiorni due database:</span><span class="sxs-lookup"><span data-stu-id="43efe-126">For example, suppose an operation updates two databases.</span></span> <span data-ttu-id="43efe-127">invece di inserirla in un unico ambito di transazione, è preferibile che il sistema possa far fronte alla coerenza finale, magari usando il modello di [transazione di compensazione][compensating-transaction] per eseguire il rollback in modo logico dopo l'errore.</span><span class="sxs-lookup"><span data-stu-id="43efe-127">Instead of putting it into a single transaction scope, it's better if the system can accommodate eventual consistency, perhaps by using the [Compensating Transaction][compensating-transaction] pattern to logically roll back after a failure.</span></span>

<span data-ttu-id="43efe-128">**Usare gli eventi di dominio per sincronizzare lo stato**.</span><span class="sxs-lookup"><span data-stu-id="43efe-128">**Use domain events to synchronize state**.</span></span> <span data-ttu-id="43efe-129">Un [evento di dominio][domain-event] è un evento che registra quando si verifica ciò che ha significance all'interno del dominio.</span><span class="sxs-lookup"><span data-stu-id="43efe-129">A [domain event][domain-event] is an event that records when something happens that has significance within the domain.</span></span> <span data-ttu-id="43efe-130">I servizi interessati possono essere in ascolto dell'evento, invece di usare una transazione globale per coordinare tra più servizi.</span><span class="sxs-lookup"><span data-stu-id="43efe-130">Interested services can listen for the event, rather than using a global transaction to coordinate across multiple services.</span></span> <span data-ttu-id="43efe-131">Se viene usato questo approccio, il sistema deve tollerare la coerenza finale (vedere elemento precedente).</span><span class="sxs-lookup"><span data-stu-id="43efe-131">If this approach is used, the system must tolerate eventual consistency (see previous item).</span></span>

<span data-ttu-id="43efe-132">**Prendere in considerazione i modelli, ad esempio CQRS e origine evento**.</span><span class="sxs-lookup"><span data-stu-id="43efe-132">**Consider patterns such as CQRS and event sourcing**.</span></span> <span data-ttu-id="43efe-133">Questi due modelli possono aiutare a ridurre la contesa tra i carichi di lavoro di lettura e i carichi di lavoro di scrittura.</span><span class="sxs-lookup"><span data-stu-id="43efe-133">These two patterns can help to reduce contention between read workloads and write workloads.</span></span>

- <span data-ttu-id="43efe-134">Il [modello CQRS][cqrs-pattern] separa le operazioni di lettura da quelle di scrittura.</span><span class="sxs-lookup"><span data-stu-id="43efe-134">The [CQRS pattern][cqrs-pattern] separates read operations from write operations.</span></span> <span data-ttu-id="43efe-135">In alcune implementazioni, la lettura dati è fisicamente separata dalla scrittura dati.</span><span class="sxs-lookup"><span data-stu-id="43efe-135">In some implementations, the read data is physically separated from the write data.</span></span>

- <span data-ttu-id="43efe-136">Nel [modello di origine evento][event-sourcing], le modifiche di stato vengono registrate come una serie di eventi da un archivio dati di solo accodamento.</span><span class="sxs-lookup"><span data-stu-id="43efe-136">In the [Event Sourcing pattern][event-sourcing], state changes are recorded as a series of events to an append-only data store.</span></span> <span data-ttu-id="43efe-137">L'accodamento di un evento al flusso è un'operazione atomica, che richiede un blocco minimo.</span><span class="sxs-lookup"><span data-stu-id="43efe-137">Appending an event to the stream is an atomic operation, requiring minimal locking.</span></span>

<span data-ttu-id="43efe-138">Questi due modelli sono complementari tra loro.</span><span class="sxs-lookup"><span data-stu-id="43efe-138">These two patterns complement each other.</span></span> <span data-ttu-id="43efe-139">Se l'archivio di sola scrittura in CQRS usa l'origine evento, l'archivio di sola lettura può restare in ascolto degli stessi eventi per creare uno snapshot leggibile dello stato corrente, ottimizzato per le query.</span><span class="sxs-lookup"><span data-stu-id="43efe-139">If the write-only store in CQRS uses event sourcing, the read-only store can listen for the same events to create a readable snapshot of the current state, optimized for queries.</span></span> <span data-ttu-id="43efe-140">Prima di adottare CQRS o l'origine evento, tenere comunque presente le problematiche di questo approccio.</span><span class="sxs-lookup"><span data-stu-id="43efe-140">Before adopting CQRS or event sourcing, however, be aware of the challenges of this approach.</span></span> <span data-ttu-id="43efe-141">Per altre informazioni, vedere [CQRS architecture style][cqrs-style] (Stile dell'architettura CQRS).</span><span class="sxs-lookup"><span data-stu-id="43efe-141">For more information, see [CQRS architecture style][cqrs-style].</span></span>

<span data-ttu-id="43efe-142">**Dati di partizione**.</span><span class="sxs-lookup"><span data-stu-id="43efe-142">**Partition data**.</span></span>  <span data-ttu-id="43efe-143">Evitare di inserire tutti i dati in uno schema di dati, condiviso tra molti servizi delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="43efe-143">Avoid putting all of your data into one data schema that is shared across many application services.</span></span> <span data-ttu-id="43efe-144">Un'architettura di microservizi applica questo principio, eseguendo ogni servizio responsabile per il proprio archivio dati.</span><span class="sxs-lookup"><span data-stu-id="43efe-144">A microservices architecture enforces this principle by making each service responsible for its own data store.</span></span> <span data-ttu-id="43efe-145">All'interno di un database singolo, il partizionamento dei dati in partizioni può migliorare la concorrenza, poiché una scrittura di servizio in una partizione non influisce su una scrittura di servizio in una partizione diversa.</span><span class="sxs-lookup"><span data-stu-id="43efe-145">Within a single database, partitioning the data into shards can improve concurrency, because a service writing to one shard does not affect a service writing to a different shard.</span></span>

<span data-ttu-id="43efe-146">**Progettare operazioni idempotenti**.</span><span class="sxs-lookup"><span data-stu-id="43efe-146">**Design idempotent operations**.</span></span> <span data-ttu-id="43efe-147">Quando possibile, progettare operazioni che siano idempotenti,</span><span class="sxs-lookup"><span data-stu-id="43efe-147">When possible, design operations to be idempotent.</span></span> <span data-ttu-id="43efe-148">in modo tale che possano essere gestite con una semantica at least once.</span><span class="sxs-lookup"><span data-stu-id="43efe-148">That way, they can be handled using at-least-once semantics.</span></span> <span data-ttu-id="43efe-149">Ad esempio, è possibile inserire gli elementi di lavoro in una coda:</span><span class="sxs-lookup"><span data-stu-id="43efe-149">For example, you can put work items on a queue.</span></span> <span data-ttu-id="43efe-150">se un ruolo di lavoro subisce un arresto anomalo durante un'operazione, un altro ruolo di lavoro, semplicemente, preleva l'elemento di lavoro.</span><span class="sxs-lookup"><span data-stu-id="43efe-150">If a worker crashes in the middle of an operation, another worker simply picks up the work item.</span></span>

<span data-ttu-id="43efe-151">**Usare l'elaborazione parallela asincrona**.</span><span class="sxs-lookup"><span data-stu-id="43efe-151">**Use asynchronous parallel processing**.</span></span> <span data-ttu-id="43efe-152">Se un'operazione richiede più passaggi, eseguiti in modo asincrono (come le chiamate al servizio remoto), è possibile chiamarli in parallelo e successivamente aggregare i risultati.</span><span class="sxs-lookup"><span data-stu-id="43efe-152">If an operation requires multiple steps that are performed asynchronously (such as remote service calls), you might be able to call them in parallel, and then aggregate the results.</span></span> <span data-ttu-id="43efe-153">Questo approccio presuppone che ogni passaggio non dipenda dai risultati del passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="43efe-153">This approach assumes that each step does not depend on the results of the previous step.</span></span>

<span data-ttu-id="43efe-154">**Quando possibile, usare la concorrenza ottimistica**.</span><span class="sxs-lookup"><span data-stu-id="43efe-154">**Use optimistic concurrency when possible**.</span></span> <span data-ttu-id="43efe-155">Il controllo della concorrenza pessimistica usa blocchi di database per evitare conflitti.</span><span class="sxs-lookup"><span data-stu-id="43efe-155">Pessimistic concurrency control uses database locks to prevent conflicts.</span></span> <span data-ttu-id="43efe-156">Questo può causare prestazioni non ottimali e ridurre la disponibilità.</span><span class="sxs-lookup"><span data-stu-id="43efe-156">This can cause poor performance and reduce availability.</span></span> <span data-ttu-id="43efe-157">Con il controllo della concorrenza ottimistica, ogni transazione modifica una copia o uno snapshot dei dati.</span><span class="sxs-lookup"><span data-stu-id="43efe-157">With optimistic concurrency control, each transaction modifies a copy or snapshot of the data.</span></span> <span data-ttu-id="43efe-158">Quando viene eseguito il commit della transazione, il motore di database convalida la transazione e rifiuta tutte le transazioni che hanno influenza sulla coerenza del database.</span><span class="sxs-lookup"><span data-stu-id="43efe-158">When the transaction is committed, the database engine validates the transaction and rejects any transactions that would affect database consistency.</span></span>

<span data-ttu-id="43efe-159">Il database SQL di Azure e SQL Server supportano la concorrenza ottimistica tramite l'[isolamento dello snapshot][sql-snapshot-isolation].</span><span class="sxs-lookup"><span data-stu-id="43efe-159">Azure SQL Database and SQL Server support optimistic concurrency through [snapshot isolation][sql-snapshot-isolation].</span></span> <span data-ttu-id="43efe-160">Alcuni servizi di Archiviazione di Microsoft Azure supportano la concorrenza ottimistica tramite l'uso di valori Etag, tra cui [Azure Cosmos DB][cosmosdb-faq] e l'[archiviazione di Azure][storage-concurrency].</span><span class="sxs-lookup"><span data-stu-id="43efe-160">Some Azure storage services support optimistic concurrency through the use of Etags, including [Azure Cosmos DB][cosmosdb-faq] and [Azure Storage][storage-concurrency].</span></span>

<span data-ttu-id="43efe-161">**Prendere in considerazione MapReduce o altri algoritmi paralleli e distribuiti**.</span><span class="sxs-lookup"><span data-stu-id="43efe-161">**Consider MapReduce or other parallel, distributed algorithms**.</span></span> <span data-ttu-id="43efe-162">A seconda dei dati e del tipo di lavoro da eseguire, si può dividere il lavoro in due attività indipendenti, che possono essere eseguite da più nodi che lavorano in parallelo.</span><span class="sxs-lookup"><span data-stu-id="43efe-162">Depending on the data and type of work to be performed, you may be able to split the work into independent tasks that can be performed by multiple nodes working in parallel.</span></span> <span data-ttu-id="43efe-163">Vedere [Big compute architecture style][big-compute] (Stile dell'architettura Big compute).</span><span class="sxs-lookup"><span data-stu-id="43efe-163">See [Big compute architecture style][big-compute].</span></span>

<span data-ttu-id="43efe-164">**Usare la designazione leader per il coordinamento**.</span><span class="sxs-lookup"><span data-stu-id="43efe-164">**Use leader election for coordination**.</span></span> <span data-ttu-id="43efe-165">Nei casi in cui sia necessario coordinare le operazioni, assicurarsi che il coordinatore non diventi un singolo punto di guasto nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="43efe-165">In cases where you need to coordinate operations, make sure the coordinator does not become a single point of failure in the application.</span></span> <span data-ttu-id="43efe-166">Usando il [modello di designazione leader][leader-election], un'istanza rappresenta il leader in qualsiasi momento e agisce come coordinatore.</span><span class="sxs-lookup"><span data-stu-id="43efe-166">Using the [Leader Election pattern][leader-election], one instance is the leader at any time, and acts as the coordinator.</span></span> <span data-ttu-id="43efe-167">Se il leader ha esito negativo, viene designata una nuova istanza come leader.</span><span class="sxs-lookup"><span data-stu-id="43efe-167">If the leader fails, a new instance is elected to be the leader.</span></span>

<!-- links -->

[big-compute]: ../architecture-styles/big-compute.md
[compensating-transaction]: ../../patterns/compensating-transaction.md
[cqrs-style]: ../architecture-styles/cqrs.md
[cqrs-pattern]: ../../patterns/cqrs.md
[cosmosdb-faq]: /azure/cosmos-db/faq
[domain-event]: https://martinfowler.com/eaaDev/DomainEvent.html
[event-sourcing]: ../../patterns/event-sourcing.md
[leader-election]: ../../patterns/leader-election.md
[sas-pattern]: ../../patterns/scheduler-agent-supervisor.md
[sql-snapshot-isolation]: /sql/t-sql/statements/set-transaction-isolation-level-transact-sql
[storage-concurrency]: https://azure.microsoft.com/blog/managing-concurrency-in-microsoft-azure-storage-2/