---
title: Eseguire una farm di SharePoint Server 2016 a disponibilità elevata in Azure.
description: Procedure consolidate per la configurazione di una farm di SharePoint Server 2016 a disponibilità elevata in Azure.
author: njray
ms.date: 07/14/2018
ms.openlocfilehash: ff690300cb5f4af301bcfac58ac10b9b3c47f96d
ms.sourcegitcommit: 71cbef121c40ef36e2d6e3a088cb85c4260599b9
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 07/14/2018
ms.locfileid: "39060898"
---
# <a name="run-a-high-availability-sharepoint-server-2016-farm-in-azure"></a><span data-ttu-id="0e76f-103">Eseguire una farm di SharePoint Server 2016 a disponibilità elevata in Azure.</span><span class="sxs-lookup"><span data-stu-id="0e76f-103">Run a high availability SharePoint Server 2016 farm in Azure</span></span>

<span data-ttu-id="0e76f-104">Questa architettura di riferimento mostra una serie di procedure comprovate per la configurazione di una farm di SharePoint Server 2016 a disponibilità elevata in Azure, usando la topologia MinRole e i gruppi di disponibilità di SQL Server Always On.</span><span class="sxs-lookup"><span data-stu-id="0e76f-104">This reference architecture shows a set of proven practices for setting up a high availability SharePoint Server 2016 farm on Azure, using MinRole topology and SQL Server Always On availability groups.</span></span> <span data-ttu-id="0e76f-105">La farm di SharePoint viene distribuita in una rete virtuale protetta senza presenza su Internet o endpoint con connessione Internet.</span><span class="sxs-lookup"><span data-stu-id="0e76f-105">The SharePoint farm is deployed in a secured virtual network with no Internet-facing endpoint or presence.</span></span> [<span data-ttu-id="0e76f-106">**Distribuire questa soluzione**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-106">**Deploy this solution**.</span></span>](#deploy-the-solution) 

![](./images/sharepoint-ha.png)

<span data-ttu-id="0e76f-107">*Scaricare un [file Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="0e76f-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="0e76f-108">Architettura</span><span class="sxs-lookup"><span data-stu-id="0e76f-108">Architecture</span></span>

<span data-ttu-id="0e76f-109">Questa architettura si basa su quella illustrata in [Eseguire macchine virtuali Windows per un'applicazione a più livelli][windows-n-tier].</span><span class="sxs-lookup"><span data-stu-id="0e76f-109">This architecture builds on the one shown in [Run Windows VMs for an N-tier application][windows-n-tier].</span></span> <span data-ttu-id="0e76f-110">Distribuisce una farm di SharePoint Server 2016 a disponibilità elevata all'interno di una rete virtuale Azure.</span><span class="sxs-lookup"><span data-stu-id="0e76f-110">It deploys a SharePoint Server 2016 farm with high availability inside an Azure virtual network (VNet).</span></span> <span data-ttu-id="0e76f-111">Questa architettura è adatta a un ambiente di test o di produzione, a un'infrastruttura ibrida SharePoint con Office 365 o come base per uno scenario di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="0e76f-111">This architecture is suitable for a test or production environment, a SharePoint hybrid infrastructure with Office 365, or as the basis for a disaster recovery scenario.</span></span>

<span data-ttu-id="0e76f-112">Questa architettura è costituita dai componenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="0e76f-112">The architecture consists of the following components:</span></span>

- <span data-ttu-id="0e76f-113">**Gruppi di risorse**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-113">**Resource groups**.</span></span> <span data-ttu-id="0e76f-114">Un [gruppo di risorse][resource-group] è un contenitore di risorse correlate di Azure.</span><span class="sxs-lookup"><span data-stu-id="0e76f-114">A [resource group][resource-group] is a container that holds related Azure resources.</span></span> <span data-ttu-id="0e76f-115">Un gruppo di risorse viene usato per i server SharePoint e un altro gruppo di risorse viene usato per i componenti dell'infrastruttura indipendenti dalle macchine virtuali, ad esempio la rete virtuale e i bilanciamenti del carico.</span><span class="sxs-lookup"><span data-stu-id="0e76f-115">One resource group is used for the SharePoint servers, and another resource group is used for infrastructure components that are independent of VMs, such as the virtual network and load balancers.</span></span>

- <span data-ttu-id="0e76f-116">**Rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-116">**Virtual network (VNet)**.</span></span> <span data-ttu-id="0e76f-117">Le macchine virtuali vengono distribuite in una rete virtuale con uno spazio degli indirizzi Intranet univoco.</span><span class="sxs-lookup"><span data-stu-id="0e76f-117">The VMs are deployed in a VNet with a unique intranet address space.</span></span> <span data-ttu-id="0e76f-118">La rete virtuale viene ulteriormente suddivisa in subnet.</span><span class="sxs-lookup"><span data-stu-id="0e76f-118">The VNet is further subdivided into subnets.</span></span> 

- <span data-ttu-id="0e76f-119">**Macchine virtuali (VM)**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-119">**Virtual machines (VMs)**.</span></span> <span data-ttu-id="0e76f-120">Le macchine virtuali vengono distribuite nella rete virtuale e a tutte le macchine virtuali vengono assegnati indirizzi IP statici privati.</span><span class="sxs-lookup"><span data-stu-id="0e76f-120">The VMs are deployed into the VNet, and private static IP addresses are assigned to all of the VMs.</span></span> <span data-ttu-id="0e76f-121">Gli indirizzi IP statici sono consigliati per le macchine virtuali che eseguono SQL Server e SharePoint Server 2016, per evitare problemi relativi alla memorizzazione nella cache degli indirizzi IP e alle modifiche di indirizzi dopo un riavvio.</span><span class="sxs-lookup"><span data-stu-id="0e76f-121">Static IP addresses are recommended for the VMs running SQL Server and SharePoint Server 2016, to avoid issues with IP address caching and changes of addresses after a restart.</span></span>

- <span data-ttu-id="0e76f-122">**Set di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-122">**Availability sets**.</span></span> <span data-ttu-id="0e76f-123">Inserire le macchine virtuali per ogni ruolo SharePoint in [set di disponibilità][availability-set] separati ed eseguire il provisioning di almeno due macchine virtuali (VM) per ogni ruolo.</span><span class="sxs-lookup"><span data-stu-id="0e76f-123">Place the VMs for each SharePoint role into separate [availability sets][availability-set], and provision at least two virtual machines (VMs) for each role.</span></span> <span data-ttu-id="0e76f-124">In questo modo le macchine virtuali sono idonee per un contratto di servizio di livello superiore.</span><span class="sxs-lookup"><span data-stu-id="0e76f-124">This makes the VMs eligible for a higher service level agreement (SLA).</span></span> 

- <span data-ttu-id="0e76f-125">**Servizio di bilanciamento del carico interno**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-125">**Internal load balancer**.</span></span> <span data-ttu-id="0e76f-126">Il [bilanciamento del carico][load-balancer] distribuisce il traffico di richieste di SharePoint dalla rete locale ai server Web front-end della farm di SharePoint.</span><span class="sxs-lookup"><span data-stu-id="0e76f-126">The [load balancer][load-balancer] distributes SharePoint request traffic from the on-premises network to the front-end web servers of the SharePoint farm.</span></span> 

- <span data-ttu-id="0e76f-127">**Gruppi di sicurezza di rete (NSG)**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-127">**Network security groups (NSGs)**.</span></span> <span data-ttu-id="0e76f-128">Per ogni subnet contenente macchine virtuali viene creato un [gruppo di sicurezza di rete][nsg].</span><span class="sxs-lookup"><span data-stu-id="0e76f-128">For each subnet that contains virtual machines, a [network security group][nsg] is created.</span></span> <span data-ttu-id="0e76f-129">Usare i gruppi di sicurezza di rete per limitare il traffico di rete all'interno della rete virtuale al fine di isolare le subnet.</span><span class="sxs-lookup"><span data-stu-id="0e76f-129">Use NSGs to restrict network traffic within the VNet, in order to isolate subnets.</span></span> 

- <span data-ttu-id="0e76f-130">**Gateway**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-130">**Gateway**.</span></span> <span data-ttu-id="0e76f-131">Il gateway fornisce una connessione tra la rete virtuale di Azure e la rete locale.</span><span class="sxs-lookup"><span data-stu-id="0e76f-131">The gateway provides a connection between your on-premises network and the Azure virtual network.</span></span> <span data-ttu-id="0e76f-132">La connessione può usare ExpressRoute o la VPN da sito a sito.</span><span class="sxs-lookup"><span data-stu-id="0e76f-132">Your connection can use ExpressRoute or site-to-site VPN.</span></span> <span data-ttu-id="0e76f-133">Per altre informazioni, vedere [Connect an on-premises network to Azure][hybrid-ra] (Connettere una rete locale ad Azure).</span><span class="sxs-lookup"><span data-stu-id="0e76f-133">For more information, see [Connect an on-premises network to Azure][hybrid-ra].</span></span>

- <span data-ttu-id="0e76f-134">**Controller di dominio di Windows Server Active Directory (AD)**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-134">**Windows Server Active Directory (AD) domain controllers**.</span></span> <span data-ttu-id="0e76f-135">Questa architettura di riferimento distribuisce i controller di dominio AD di Windows Server.</span><span class="sxs-lookup"><span data-stu-id="0e76f-135">This reference architecture deploys Windows Server AD domain controllers.</span></span> <span data-ttu-id="0e76f-136">Questi controller di dominio vengono eseguiti nella rete virtuale di Azure e hanno una relazione di trust con la foresta di Windows Server AD locale.</span><span class="sxs-lookup"><span data-stu-id="0e76f-136">These domain controllers run in the Azure VNet and have a trust relationship with the on-premises Windows Server AD forest.</span></span> <span data-ttu-id="0e76f-137">Le richieste Web dei client per le risorse della farm di SharePoint vengono autenticate nella rete virtuale, anziché inviare questo traffico di autenticazione attraverso la connessione del gateway alla rete locale.</span><span class="sxs-lookup"><span data-stu-id="0e76f-137">Client web requests for SharePoint farm resources are authenticated in the VNet rather than sending that authentication traffic across the gateway connection to the on-premises network.</span></span> <span data-ttu-id="0e76f-138">In DNS, i record Intranet A o CNAME vengono creati in modo che gli utenti della Intranet possano risolvere il nome della farm di SharePoint all'indirizzo IP privato del bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="0e76f-138">In DNS, intranet A or CNAME records are created so that intranet users can resolve the name of the SharePoint farm to the private IP address of the internal load balancer.</span></span>

  <span data-ttu-id="0e76f-139">SharePoint Server 2016 supporta anche l'uso di [Azure Active Directory Domain Services](/azure/active-directory-domain-services/).</span><span class="sxs-lookup"><span data-stu-id="0e76f-139">SharePoint Server 2016 also supports using [Azure Active Directory Domain Services](/azure/active-directory-domain-services/).</span></span> <span data-ttu-id="0e76f-140">Azure AD Domain Services fornisce servizi di dominio gestiti, per non dover distribuire e gestire controller di dominio in Azure.</span><span class="sxs-lookup"><span data-stu-id="0e76f-140">Azure AD Domain Services provides managed domain services, so that you don't need to deploy and manage domain controllers in Azure.</span></span>

- <span data-ttu-id="0e76f-141">**Gruppo di disponibilità Always On di SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-141">**SQL Server Always On Availability Group**.</span></span> <span data-ttu-id="0e76f-142">Per la disponibilità elevata del database SQL Server è consigliabile usare i [gruppi di disponibilità Always On di SQL Server][sql-always-on].</span><span class="sxs-lookup"><span data-stu-id="0e76f-142">For high availability of the SQL Server database, we recommend [SQL Server Always On Availability Groups][sql-always-on].</span></span> <span data-ttu-id="0e76f-143">Per SQL Server vengono usate due macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="0e76f-143">Two virtual machines are used for SQL Server.</span></span> <span data-ttu-id="0e76f-144">Una contiene la replica di database primaria e l'altra contiene la replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="0e76f-144">One contains the primary database replica and the other contains the secondary replica.</span></span> 

- <span data-ttu-id="0e76f-145">**Macchina virtuale con maggioranza dei nodi**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-145">**Majority node VM**.</span></span> <span data-ttu-id="0e76f-146">Questa macchina virtuale consente al cluster di failover di stabilire il quorum.</span><span class="sxs-lookup"><span data-stu-id="0e76f-146">This VM allows the failover cluster to establish quorum.</span></span> <span data-ttu-id="0e76f-147">Per altre informazioni, vedere [Informazioni sulle configurazioni quorum in un cluster di failover][sql-quorum].</span><span class="sxs-lookup"><span data-stu-id="0e76f-147">For more information, see [Understanding Quorum Configurations in a Failover Cluster][sql-quorum].</span></span>

- <span data-ttu-id="0e76f-148">**Server SharePoint**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-148">**SharePoint servers**.</span></span> <span data-ttu-id="0e76f-149">I server SharePoint eseguono i ruoli Web front-end, memorizzazione nella cache, applicazione e ricerca.</span><span class="sxs-lookup"><span data-stu-id="0e76f-149">The SharePoint servers perform the web front-end, caching, application, and search roles.</span></span> 

- <span data-ttu-id="0e76f-150">**Jumpbox**.</span><span class="sxs-lookup"><span data-stu-id="0e76f-150">**Jumpbox**.</span></span> <span data-ttu-id="0e76f-151">detto anche [bastion host][bastion-host].</span><span class="sxs-lookup"><span data-stu-id="0e76f-151">Also called a [bastion host][bastion-host].</span></span> <span data-ttu-id="0e76f-152">È una macchina virtuale sicura in rete che viene usata dagli amministratori per connettersi alle altre macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="0e76f-152">This is a secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="0e76f-153">Il jumpbox ha un gruppo di sicurezza di rete che consente il traffico remoto solo da indirizzi IP pubblici inclusi in un elenco di indirizzi attendibili.</span><span class="sxs-lookup"><span data-stu-id="0e76f-153">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="0e76f-154">L'NSG dovrebbe consentire il traffico RDP (Remote Desktop Protocol).</span><span class="sxs-lookup"><span data-stu-id="0e76f-154">The NSG should permit remote desktop (RDP) traffic.</span></span>

## <a name="recommendations"></a><span data-ttu-id="0e76f-155">Consigli</span><span class="sxs-lookup"><span data-stu-id="0e76f-155">Recommendations</span></span>

<span data-ttu-id="0e76f-156">I requisiti della propria organizzazione potrebbero essere diversi da quelli dell'architettura descritta in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="0e76f-156">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="0e76f-157">Usare queste indicazioni come punto di partenza.</span><span class="sxs-lookup"><span data-stu-id="0e76f-157">Use these recommendations as a starting point.</span></span>

### <a name="resource-group-recommendations"></a><span data-ttu-id="0e76f-158">Indicazioni sui gruppi di risorse</span><span class="sxs-lookup"><span data-stu-id="0e76f-158">Resource group recommendations</span></span>

<span data-ttu-id="0e76f-159">È consigliabile separare i gruppi di risorse in base al ruolo del server e disporre di un gruppo di risorse separato per i componenti di infrastruttura che sono risorse globali.</span><span class="sxs-lookup"><span data-stu-id="0e76f-159">We recommend separating resource groups according to the server role, and having a separate resource group for infrastructure components that are global resources.</span></span> <span data-ttu-id="0e76f-160">In questa architettura le risorse di SharePoint formano un gruppo, mentre le risorse di Microsoft Server SQL e di altre utilità formano un altro gruppo.</span><span class="sxs-lookup"><span data-stu-id="0e76f-160">In this architecture, the SharePoint resources form one group, while the SQL Server and other utility assets form another.</span></span>

### <a name="virtual-network-and-subnet-recommendations"></a><span data-ttu-id="0e76f-161">Indicazioni sulla rete virtuale e le subnet</span><span class="sxs-lookup"><span data-stu-id="0e76f-161">Virtual network and subnet recommendations</span></span>

<span data-ttu-id="0e76f-162">Usare una subnet per ogni ruolo SharePoint, oltre a una subnet per il gateway e una per il jumpbox.</span><span class="sxs-lookup"><span data-stu-id="0e76f-162">Use one subnet for each SharePoint role, plus a subnet for the gateway and one for the jumpbox.</span></span> 

<span data-ttu-id="0e76f-163">La subnet per il gateway deve essere denominata *GatewaySubnet*.</span><span class="sxs-lookup"><span data-stu-id="0e76f-163">The gateway subnet must be named *GatewaySubnet*.</span></span> <span data-ttu-id="0e76f-164">Assegnare lo spazio di indirizzi della subnet per il gateway usando l'ultima parte dello spazio di indirizzi della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="0e76f-164">Assign the gateway subnet address space from the last part of the virtual network address space.</span></span> <span data-ttu-id="0e76f-165">Per altre informazioni, vedere [Connect an on-premises network to Azure using a VPN gateway][hybrid-vpn-ra] (Connettere una rete locale ad Azure usando un gateway VPN).</span><span class="sxs-lookup"><span data-stu-id="0e76f-165">For more information, see [Connect an on-premises network to Azure using a VPN gateway][hybrid-vpn-ra].</span></span>

### <a name="vm-recommendations"></a><span data-ttu-id="0e76f-166">Indicazioni per le VM</span><span class="sxs-lookup"><span data-stu-id="0e76f-166">VM recommendations</span></span>

<span data-ttu-id="0e76f-167">Questa architettura, basata sulle dimensioni della macchina virtuale Standard DSv2, richiede almeno 38 core:</span><span class="sxs-lookup"><span data-stu-id="0e76f-167">Based on Standard DSv2 virtual machine sizes, this architecture requires a minimum of 38 cores:</span></span>

- <span data-ttu-id="0e76f-168">8 server SharePoint su Standard_DS3_v2 (ognuno con 4 core) = 32 core</span><span class="sxs-lookup"><span data-stu-id="0e76f-168">8 SharePoint servers on Standard_DS3_v2 (4 cores each) = 32 cores</span></span>
- <span data-ttu-id="0e76f-169">2 controller di dominio Active Directory su Standard_DS1_v2 (ognuno con 1 core) = 2 core</span><span class="sxs-lookup"><span data-stu-id="0e76f-169">2 Active Directory domain controllers on Standard_DS1_v2 (1 core each) = 2 cores</span></span>
- <span data-ttu-id="0e76f-170">2 VM di SQL Server su Standard_DS1_v2 = 2 core</span><span class="sxs-lookup"><span data-stu-id="0e76f-170">2 SQL Server VMs on Standard_DS1_v2 = 2 cores</span></span>
- <span data-ttu-id="0e76f-171">1 maggioranza di nodi su Standard_DS1_v2 = 1 core</span><span class="sxs-lookup"><span data-stu-id="0e76f-171">1 majority node on Standard_DS1_v2 = 1 core</span></span>
- <span data-ttu-id="0e76f-172">1 server di gestione su Standard_DS1_v2 = 1 core</span><span class="sxs-lookup"><span data-stu-id="0e76f-172">1 management server on Standard_DS1_v2 = 1 core</span></span>

<span data-ttu-id="0e76f-173">Il numero totale di core dipenderà dalle dimensioni della macchina virtuale selezionate.</span><span class="sxs-lookup"><span data-stu-id="0e76f-173">The total number of cores will depend on the VM sizes that you select.</span></span> <span data-ttu-id="0e76f-174">Per altre informazioni, vedere [Indicazioni su SharePoint Server](#sharepoint-server-recommendations) di seguito.</span><span class="sxs-lookup"><span data-stu-id="0e76f-174">For more information, see [SharePoint Server recommendations](#sharepoint-server-recommendations) below.</span></span>

<span data-ttu-id="0e76f-175">Assicurarsi che la sottoscrizione di Azure disponga di una quota di core sufficiente per la distribuzione; in caso contrario la distribuzione avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="0e76f-175">Make sure your Azure subscription has enough VM core quota for the deployment, or the deployment will fail.</span></span> <span data-ttu-id="0e76f-176">Vedere [Sottoscrizione di Azure e limiti, quote e vincoli dei servizi][quotas].</span><span class="sxs-lookup"><span data-stu-id="0e76f-176">See [Azure subscription and service limits, quotas, and constraints][quotas].</span></span> 
 
### <a name="nsg-recommendations"></a><span data-ttu-id="0e76f-177">Indicazioni sui gruppi di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="0e76f-177">NSG recommendations</span></span>

<span data-ttu-id="0e76f-178">È consigliabile disporre di un gruppo di sicurezza di rete per ogni subnet che include macchine virtuali per consentire l'isolamento delle subnet.</span><span class="sxs-lookup"><span data-stu-id="0e76f-178">We recommend having one NSG for each subnet that contains VMs, to enable subnet isolation.</span></span> <span data-ttu-id="0e76f-179">Per configurare l'isolamento delle subnet, aggiungere regole dei gruppi di sicurezza di rete che definiscono il traffico in ingresso o in uscita consentito o negato per ogni subnet.</span><span class="sxs-lookup"><span data-stu-id="0e76f-179">If you want to configure subnet isolation, add NSG rules that define the allowed or denied inbound or outbound traffic for each subnet.</span></span> <span data-ttu-id="0e76f-180">Per altre informazioni, vedere [Filtrare il traffico di rete con gruppi di sicurezza di rete][virtual-networks-nsg].</span><span class="sxs-lookup"><span data-stu-id="0e76f-180">For more information, see [Filter network traffic with network security groups][virtual-networks-nsg].</span></span> 

<span data-ttu-id="0e76f-181">Non assegnare un gruppo di sicurezza di rete alla subnet del gateway per evitare che il gateway smetta di funzionare.</span><span class="sxs-lookup"><span data-stu-id="0e76f-181">Do not assign an NSG to the gateway subnet, or the gateway will stop functioning.</span></span> 

### <a name="storage-recommendations"></a><span data-ttu-id="0e76f-182">Indicazioni sull'archiviazione</span><span class="sxs-lookup"><span data-stu-id="0e76f-182">Storage recommendations</span></span>

<span data-ttu-id="0e76f-183">La configurazione dell'archiviazione delle macchine virtuali nella farm deve corrispondere alle procedure consigliate appropriate usate per le distribuzioni locali.</span><span class="sxs-lookup"><span data-stu-id="0e76f-183">The storage configuration of the VMs in the farm should match the appropriate best practices used for on-premises deployments.</span></span> <span data-ttu-id="0e76f-184">È necessario un disco separato per i log nei server SharePoint.</span><span class="sxs-lookup"><span data-stu-id="0e76f-184">SharePoint servers should have a separate disk for logs.</span></span> <span data-ttu-id="0e76f-185">I server SharePoint con i ruoli di indice di ricerca richiedono ulteriore spazio su disco per l'archiviazione dell'indice di ricerca.</span><span class="sxs-lookup"><span data-stu-id="0e76f-185">SharePoint servers hosting search index roles require additional disk space for the search index to be stored.</span></span> <span data-ttu-id="0e76f-186">Per SQL Server la procedura standard consiste nel separare i dati e i log.</span><span class="sxs-lookup"><span data-stu-id="0e76f-186">For SQL Server, the standard practice is to separate data and logs.</span></span> <span data-ttu-id="0e76f-187">Aggiungere altri dischi per l'archiviazione del backup di database e usare un disco separato per [tempdb][tempdb].</span><span class="sxs-lookup"><span data-stu-id="0e76f-187">Add more disks for database backup storage, and use a separate disk for [tempdb][tempdb].</span></span>

<span data-ttu-id="0e76f-188">Per una migliore affidabilità, è consigliabile usare [Azure Managed Disks][managed-disks].</span><span class="sxs-lookup"><span data-stu-id="0e76f-188">For best reliability, we recommend using [Azure Managed Disks][managed-disks].</span></span> <span data-ttu-id="0e76f-189">I dischi gestiti garantiscono che i dischi per le macchine virtuali all'interno di un set di disponibilità siano isolati per evitare singoli punti di guasto.</span><span class="sxs-lookup"><span data-stu-id="0e76f-189">Managed disks ensure that the disks for VMs within an availability set are isolated to avoid single points of failure.</span></span> 

> [!NOTE]
> <span data-ttu-id="0e76f-190">Attualmente il modello di Resource Manager per questa architettura di riferimento non usa dischi gestiti.</span><span class="sxs-lookup"><span data-stu-id="0e76f-190">Currently the Resource Manager template for this reference architecture does not use managed disks.</span></span> <span data-ttu-id="0e76f-191">È previsto l'aggiornamento del modello per consentire l'utilizzo di dischi gestiti.</span><span class="sxs-lookup"><span data-stu-id="0e76f-191">We are planning to update the template to use managed disks.</span></span>

<span data-ttu-id="0e76f-192">Usare i dischi gestiti Premium per tutte le macchine virtuali di SQL Server e SharePoint.</span><span class="sxs-lookup"><span data-stu-id="0e76f-192">Use Premium managed disks for all SharePoint and SQL Server VMs.</span></span> <span data-ttu-id="0e76f-193">È possibile usare i dischi gestiti Standard per il server con maggioranza dei nodi, i controller di dominio e il server di gestione.</span><span class="sxs-lookup"><span data-stu-id="0e76f-193">You can use Standard managed disks for the majority node server, the domain controllers, and the management server.</span></span> 

### <a name="sharepoint-server-recommendations"></a><span data-ttu-id="0e76f-194">Indicazioni sui server SharePoint</span><span class="sxs-lookup"><span data-stu-id="0e76f-194">SharePoint Server recommendations</span></span>

<span data-ttu-id="0e76f-195">Prima di configurare la farm di SharePoint, accertarsi che sia disponibile un account di servizio di Windows Server Active Directory per ogni servizio.</span><span class="sxs-lookup"><span data-stu-id="0e76f-195">Before configuring the SharePoint farm, make sure you have one Windows Server Active Directory service account per service.</span></span> <span data-ttu-id="0e76f-196">Per questa architettura, sono necessari i seguenti account a livello di dominio per isolare il privilegio per ogni ruolo:</span><span class="sxs-lookup"><span data-stu-id="0e76f-196">For this architecture, you need at a minimum the following domain-level accounts to isolate privilege per role:</span></span>

- <span data-ttu-id="0e76f-197">Account del servizio SQL Server</span><span class="sxs-lookup"><span data-stu-id="0e76f-197">SQL Server Service account</span></span>
- <span data-ttu-id="0e76f-198">Account utente per la configurazione</span><span class="sxs-lookup"><span data-stu-id="0e76f-198">Setup User account</span></span>
- <span data-ttu-id="0e76f-199">Account della server farm</span><span class="sxs-lookup"><span data-stu-id="0e76f-199">Server Farm account</span></span>
- <span data-ttu-id="0e76f-200">Account del servizio di ricerca</span><span class="sxs-lookup"><span data-stu-id="0e76f-200">Search Service account</span></span>
- <span data-ttu-id="0e76f-201">Account di accesso al contenuto</span><span class="sxs-lookup"><span data-stu-id="0e76f-201">Content Access account</span></span>
- <span data-ttu-id="0e76f-202">Account per il pool di app Web</span><span class="sxs-lookup"><span data-stu-id="0e76f-202">Web App Pool accounts</span></span>
- <span data-ttu-id="0e76f-203">Account per il pool di app di servizio</span><span class="sxs-lookup"><span data-stu-id="0e76f-203">Service App Pool accounts</span></span>
- <span data-ttu-id="0e76f-204">Account utente con privilegi avanzati per la cache</span><span class="sxs-lookup"><span data-stu-id="0e76f-204">Cache Super User account</span></span>
- <span data-ttu-id="0e76f-205">Account lettore con privilegi avanzati per la cache</span><span class="sxs-lookup"><span data-stu-id="0e76f-205">Cache Super Reader account</span></span>

<span data-ttu-id="0e76f-206">Per tutti i ruoli tranne l'indicizzatore di ricerca, è consigliabile usare la dimensione di macchina virtuale [Standard_DS3_v2][vm-sizes-general].</span><span class="sxs-lookup"><span data-stu-id="0e76f-206">For all roles except the Search Indexer, we recommended using the [Standard_DS3_v2][vm-sizes-general] VM size.</span></span> <span data-ttu-id="0e76f-207">La dimensione dell'indicizzatore di ricerca deve essere almeno [Standard_DS13_v2] [ vm-sizes-memory].</span><span class="sxs-lookup"><span data-stu-id="0e76f-207">The Search Indexer should be at least the [Standard_DS13_v2][vm-sizes-memory] size.</span></span> 

> [!NOTE]
> <span data-ttu-id="0e76f-208">Il modello di Resource Manager per questa architettura di riferimento usa in questo caso la dimensione DS3 più piccola per il test della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0e76f-208">The Resource Manager template for this reference architecture uses the smaller DS3 size for the Search Indexer, for purposes of testing the deployment.</span></span> <span data-ttu-id="0e76f-209">Per una distribuzione in produzione usare la dimensione DS13 o una superiore.</span><span class="sxs-lookup"><span data-stu-id="0e76f-209">For a production deployment, use the DS13 size or larger.</span></span> 

<span data-ttu-id="0e76f-210">Per i carichi di lavoro in produzione, vedere i [requisiti hardware e software per SharePoint Server 2016][sharepoint-reqs].</span><span class="sxs-lookup"><span data-stu-id="0e76f-210">For production workloads, see [Hardware and software requirements for SharePoint Server 2016][sharepoint-reqs].</span></span> 

<span data-ttu-id="0e76f-211">Per soddisfare il requisito di supporto per la velocità effettiva del disco di almeno 200 MB al secondo, assicurarsi di pianificare l'architettura di ricerca.</span><span class="sxs-lookup"><span data-stu-id="0e76f-211">To meet the support requirement for disk throughput of 200 MB per second minimum, make sure to plan the Search architecture.</span></span> <span data-ttu-id="0e76f-212">Vedere [Pianificare l'architettura di ricerca a livello aziendale in SharePoint Server 2013][sharepoint-search].</span><span class="sxs-lookup"><span data-stu-id="0e76f-212">See [Plan enterprise search architecture in SharePoint Server 2013][sharepoint-search].</span></span> <span data-ttu-id="0e76f-213">Seguire anche le istruzioni in [Best practices for crawling in SharePoint Server 2016][sharepoint-crawling] (Procedure consigliate per la ricerca per indicizzazione in SharePoint Server 2016).</span><span class="sxs-lookup"><span data-stu-id="0e76f-213">Also follow the guidelines in [Best practices for crawling in SharePoint Server 2016][sharepoint-crawling].</span></span>

<span data-ttu-id="0e76f-214">Inoltre è possibile archiviare i dati dei componenti di ricerca in una partizione o in un volume di archiviazione separato con prestazioni elevate.</span><span class="sxs-lookup"><span data-stu-id="0e76f-214">In addition, store the search component data on a separate storage volume or partition with high performance.</span></span> <span data-ttu-id="0e76f-215">Per ridurre il carico e migliorare la velocità effettiva, configurare gli account utente per la cache di oggetti che sono necessari in questa architettura.</span><span class="sxs-lookup"><span data-stu-id="0e76f-215">To reduce load and improve throughput, configure the object cache user accounts, which are required in this architecture.</span></span> <span data-ttu-id="0e76f-216">Dividere i file del sistema operativo Windows Server, i file di programma di SharePoint Server 2016 e i log di diagnostica in tre partizioni o volumi di archiviazione separati con prestazioni normali.</span><span class="sxs-lookup"><span data-stu-id="0e76f-216">Split the Windows Server operating system files, the SharePoint Server 2016 program files, and diagnostics logs across three separate storage volumes or partitions with normal performance.</span></span> 

<span data-ttu-id="0e76f-217">Per altre informazioni su queste indicazioni, vedere [Account amministrativi e di servizio per la distribuzione iniziale in SharePoint Server 2016][sharepoint-accounts].</span><span class="sxs-lookup"><span data-stu-id="0e76f-217">For more information about these recommendations, see [Initial deployment administrative and service accounts in SharePoint Server 2016][sharepoint-accounts].</span></span>

### <a name="hybrid-workloads"></a><span data-ttu-id="0e76f-218">Carichi di lavoro ibridi</span><span class="sxs-lookup"><span data-stu-id="0e76f-218">Hybrid workloads</span></span>

<span data-ttu-id="0e76f-219">Questa architettura di riferimento distribuisce una farm di SharePoint Server 2016 che può essere usata come [ambiente ibrido SharePoint][sharepoint-hybrid]&mdash;, ovvero estendendo SharePoint Server 2016 a Office 365 SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="0e76f-219">This reference architecture deploys a SharePoint Server 2016 farm that can be used as a [SharePoint hybrid environment][sharepoint-hybrid] &mdash; that is, extending SharePoint Server 2016 to Office 365 SharePoint Online.</span></span> <span data-ttu-id="0e76f-220">Se si dispone di Office Online Server, vedere [Office Web Apps and Office Online Server supportability in Azure][office-web-apps] (Supporto di Office Web Apps e Office Online Server in Azure).</span><span class="sxs-lookup"><span data-stu-id="0e76f-220">If you have Office Online Server, see [Office Web Apps and Office Online Server supportability in Azure][office-web-apps].</span></span>

<span data-ttu-id="0e76f-221">Le applicazioni di servizio predefinite in questa distribuzione sono progettate per supportare carichi di lavoro ibridi.</span><span class="sxs-lookup"><span data-stu-id="0e76f-221">The default service applications in this deployment are designed to support hybrid workloads.</span></span> <span data-ttu-id="0e76f-222">Tutti i carichi di lavoro di SharePoint Server 2016 e Office 365 possono essere distribuiti nella farm senza apportare modifiche all'infrastruttura di SharePoint con un'unica eccezione: l'applicazione del servizio di ricerca ibrida su cloud non deve essere distribuita nei server in cui è presente in hosting una topologia di ricerca esistente.</span><span class="sxs-lookup"><span data-stu-id="0e76f-222">All SharePoint Server 2016 and Office 365 hybrid workloads can be deployed to this farm without changes to the SharePoint infrastructure, with one exception: The Cloud Hybrid Search Service Application must not be deployed onto servers hosting an existing search topology.</span></span> <span data-ttu-id="0e76f-223">È quindi necessario aggiungere una o più macchine virtuali basate sui ruoli di ricerca alla farm per supportare questo scenario ibrido.</span><span class="sxs-lookup"><span data-stu-id="0e76f-223">Therefore, one or more search-role-based VMs must be added to the farm to support this hybrid scenario.</span></span>

### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="0e76f-224">Gruppi di disponibilità Always On di SQL Server</span><span class="sxs-lookup"><span data-stu-id="0e76f-224">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="0e76f-225">Questa architettura usa le macchine virtuali SQL Server perché SharePoint Server 2016 non è compatibile con il database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="0e76f-225">This architecture uses SQL Server virtual machines because SharePoint Server 2016 cannot use Azure SQL Database.</span></span> <span data-ttu-id="0e76f-226">Per supportare la disponibilità elevata in SQL Server, è consigliabile usare i gruppi di disponibilità Always On, che specificano un set di database che effettuano insieme il failover, assicurando disponibilità elevata e possibilità di ripristino.</span><span class="sxs-lookup"><span data-stu-id="0e76f-226">To support high availability in SQL Server, we recommend using Always On Availability Groups, which specify a set of databases that fail over together, making them highly-available and recoverable.</span></span> <span data-ttu-id="0e76f-227">In questa architettura di riferimento i database vengono creati durante la distribuzione, ma è necessario abilitare manualmente i gruppi di disponibilità Always On e aggiungere i database di SharePoint a un gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="0e76f-227">In this reference architecture, the databases are created during deployment, but you must manually enable Always On Availability Groups and add the SharePoint databases to an availability group.</span></span> <span data-ttu-id="0e76f-228">Per altre informazioni, vedere [Creare il gruppo di disponibilità e aggiungere i database SharePoint][create-availability-group].</span><span class="sxs-lookup"><span data-stu-id="0e76f-228">For more information, see [Create the availability group and add the SharePoint databases][create-availability-group].</span></span>

<span data-ttu-id="0e76f-229">È consigliabile anche aggiungere un indirizzo IP di listener al cluster, ovvero l'indirizzo IP privato del bilanciamento del carico interno per le macchine virtuali SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0e76f-229">We also recommend adding a listener IP address to the cluster, which is the private IP address of the internal load balancer for the SQL Server virtual machines.</span></span>

<span data-ttu-id="0e76f-230">Per le dimensioni della macchina virtuale consigliate e per altre raccomandazioni sulle prestazioni per SQL Server in esecuzione in Azure, vedere [Procedure consigliate per le prestazioni per SQL Server in Macchine virtuali di Azure][sql-performance].</span><span class="sxs-lookup"><span data-stu-id="0e76f-230">For recommended VM sizes and other performance recommendations for SQL Server running in Azure, see [Performance best practices for SQL Server in Azure Virtual Machines][sql-performance].</span></span> <span data-ttu-id="0e76f-231">Inoltre seguire le indicazioni in [Procedure consigliate per SQL Server in una farm di SharePoint Server 2016][sql-sharepoint-best-practices].</span><span class="sxs-lookup"><span data-stu-id="0e76f-231">Also follow the recommendations in [Best practices for SQL Server in a SharePoint Server 2016 farm][sql-sharepoint-best-practices].</span></span>

<span data-ttu-id="0e76f-232">È consigliabile che il server con maggioranza dei nodi risieda in un computer separato dai partner di replica.</span><span class="sxs-lookup"><span data-stu-id="0e76f-232">We recommend that the majority node server reside on a separate computer from the replication partners.</span></span> <span data-ttu-id="0e76f-233">Il server consente al server partner di replica secondaria in una sessione in modalità a protezione elevata di stabilire se avviare un failover automatico.</span><span class="sxs-lookup"><span data-stu-id="0e76f-233">The server enables the secondary replication partner server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="0e76f-234">A differenza dei due partner, il server con maggioranza dei nodi non serve il database ma supporta il failover automatico.</span><span class="sxs-lookup"><span data-stu-id="0e76f-234">Unlike the two partners, the majority node server doesn't serve the database but rather supports automatic failover.</span></span> 

## <a name="scalability-considerations"></a><span data-ttu-id="0e76f-235">Considerazioni sulla scalabilità</span><span class="sxs-lookup"><span data-stu-id="0e76f-235">Scalability considerations</span></span>

<span data-ttu-id="0e76f-236">Per aumentare i server esistenti, è sufficiente modificare le dimensioni della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="0e76f-236">To scale up the existing servers, simply change the VM size.</span></span> 

<span data-ttu-id="0e76f-237">Con la funzionalità [MinRoles][minroles] in SharePoint Server 2016, è possibile scalare orizzontalmente i server in base al ruolo del server e rimuovere i server da un ruolo.</span><span class="sxs-lookup"><span data-stu-id="0e76f-237">With the [MinRoles][minroles] capability in SharePoint Server 2016, you can scale out servers based on the server's role and also remove servers from a role.</span></span> <span data-ttu-id="0e76f-238">Quando si aggiungono server a un ruolo, è possibile specificare uno dei ruoli singoli o uno dei ruoli combinati.</span><span class="sxs-lookup"><span data-stu-id="0e76f-238">When you add servers to a role, you can specify any of the single roles or one of the combined roles.</span></span> <span data-ttu-id="0e76f-239">Tuttavia, se si aggiungono server al ruolo di ricerca, è necessario anche riconfigurare la topologia di ricerca tramite PowerShell.</span><span class="sxs-lookup"><span data-stu-id="0e76f-239">If you add servers to the Search role, however, you must also reconfigure the search topology using PowerShell.</span></span> <span data-ttu-id="0e76f-240">È anche possibile convertire i ruoli usando MinRoles.</span><span class="sxs-lookup"><span data-stu-id="0e76f-240">You can also convert roles using MinRoles.</span></span> <span data-ttu-id="0e76f-241">Per altre informazioni, vedere [Gestione di una server farm MinRole in SharePoint Server 2016][sharepoint-minrole].</span><span class="sxs-lookup"><span data-stu-id="0e76f-241">For more information, see [Managing a MinRole Server Farm in SharePoint Server 2016][sharepoint-minrole].</span></span>

<span data-ttu-id="0e76f-242">Si noti che SharePoint Server 2016 non supporta l'uso di set di scalabilità di macchine virtuali per la scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="0e76f-242">Note that SharePoint Server 2016 doesn't support using virtual machine scale sets for auto-scaling.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="0e76f-243">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="0e76f-243">Availability considerations</span></span>

<span data-ttu-id="0e76f-244">Questa architettura di riferimento supporta la disponibilità elevata all'interno di un'area di Azure perché ogni ruolo dispone almeno di due macchine virtuali distribuite in un set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="0e76f-244">This reference architecture supports high availability within an Azure region, because each role has at least two VMs deployed in an availability set.</span></span>

<span data-ttu-id="0e76f-245">Per evitare un errore a livello di area, creare una farm separata per il ripristino di emergenza in un'area diversa di Azure.</span><span class="sxs-lookup"><span data-stu-id="0e76f-245">To protect against a regional failure, create a separate disaster recovery farm in a different Azure region.</span></span> <span data-ttu-id="0e76f-246">Gli obiettivi del tempo di ripristino (RTO) e gli obiettivi del punto di ripristino (RPO) determineranno i requisiti della configurazione.</span><span class="sxs-lookup"><span data-stu-id="0e76f-246">Your recovery time objectives (RTOs) and recovery point objectives (RPOs) will determine the setup requirements.</span></span> <span data-ttu-id="0e76f-247">Per informazioni dettagliate, vedere [Choose a disaster recovery strategy for SharePoint 2016][sharepoint-dr] (Scegliere una strategia di ripristino di emergenza per SharePoint 2016).</span><span class="sxs-lookup"><span data-stu-id="0e76f-247">For details, see [Choose a disaster recovery strategy for SharePoint 2016][sharepoint-dr].</span></span> <span data-ttu-id="0e76f-248">L'area secondaria deve essere un'*area abbinata* all'area primaria.</span><span class="sxs-lookup"><span data-stu-id="0e76f-248">The secondary region should be a *paired region* with the primary region.</span></span> <span data-ttu-id="0e76f-249">Nel caso di un'interruzione su vasta scala, viene definita la priorità di ripristino di un'area per ogni coppia.</span><span class="sxs-lookup"><span data-stu-id="0e76f-249">In the event of a broad outage, recovery of one region is prioritized out of every pair.</span></span> <span data-ttu-id="0e76f-250">Per altre informazioni, vedere [Continuità aziendale e ripristino di emergenza nelle aree geografiche abbinate di Azure][paired-regions].</span><span class="sxs-lookup"><span data-stu-id="0e76f-250">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][paired-regions].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="0e76f-251">Considerazioni sulla gestibilità</span><span class="sxs-lookup"><span data-stu-id="0e76f-251">Manageability considerations</span></span>

<span data-ttu-id="0e76f-252">Per usare e gestire i server, le server farm e i siti, seguire le procedure consigliate per le operazioni SharePoint.</span><span class="sxs-lookup"><span data-stu-id="0e76f-252">To operate and maintain servers, server farms, and sites, follow the recommended practices for SharePoint operations.</span></span> <span data-ttu-id="0e76f-253">Per altre informazioni, vedere [Operazioni per SharePoint Server 2016][sharepoint-ops].</span><span class="sxs-lookup"><span data-stu-id="0e76f-253">For more information, see [Operations for SharePoint Server 2016][sharepoint-ops].</span></span>

<span data-ttu-id="0e76f-254">Le attività da prendere in considerazione per la gestione di SQL Server in un ambiente SharePoint possono differire da quelle considerate in genere per un'applicazione di database.</span><span class="sxs-lookup"><span data-stu-id="0e76f-254">The tasks to consider when managing SQL Server in a SharePoint environment may differ from the ones typically considered for a database application.</span></span> <span data-ttu-id="0e76f-255">Una procedura consigliata consiste nel backup settimanale completo di tutti i database SQL con backup incrementali ogni notte.</span><span class="sxs-lookup"><span data-stu-id="0e76f-255">A best practice is to fully back up all SQL databases weekly with incremental nightly backups.</span></span> <span data-ttu-id="0e76f-256">Eseguire un backup dei log delle transazioni ogni 15 minuti.</span><span class="sxs-lookup"><span data-stu-id="0e76f-256">Back up transaction logs every 15 minutes.</span></span> <span data-ttu-id="0e76f-257">Un'altra procedura consiste nell'implementare le attività di manutenzione di SQL Server nei database disabilitando al contempo quelle SharePoint predefinite.</span><span class="sxs-lookup"><span data-stu-id="0e76f-257">Another practice is to implement SQL Server maintenance tasks on the databases while disabling the built-in SharePoint ones.</span></span> <span data-ttu-id="0e76f-258">Per altre informazioni, vedere [Storage and SQL Server capacity planning and configuration][sql-server-capacity-planning] (Pianificazione e configurazione dell'archiviazione e della capacità di SQL Server).</span><span class="sxs-lookup"><span data-stu-id="0e76f-258">For more information, see [Storage and SQL Server capacity planning and configuration][sql-server-capacity-planning].</span></span> 

## <a name="security-considerations"></a><span data-ttu-id="0e76f-259">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="0e76f-259">Security considerations</span></span>

<span data-ttu-id="0e76f-260">Gli account di servizio a livello di dominio usati per eseguire SharePoint Server 2016 richiedono i controller di dominio di Windows Server Active Directory per i processi di autenticazione e di aggiunta al dominio.</span><span class="sxs-lookup"><span data-stu-id="0e76f-260">The domain-level service accounts used to run SharePoint Server 2016 require Windows Server AD domain controllers for domain-join and authentication processes.</span></span> <span data-ttu-id="0e76f-261">A questo scopo non è possibile usare Azure Active Directory Domain Services.</span><span class="sxs-lookup"><span data-stu-id="0e76f-261">Azure Active Directory Domain Services can't be used for this purpose.</span></span> <span data-ttu-id="0e76f-262">Per estendere l'infrastruttura di identità di Windows Server Active Directory già in uso in Intranet, questa architettura usa due controller di dominio di replica di Windows Server Active Directory di una foresta Windows Server Active Directory locale esistente.</span><span class="sxs-lookup"><span data-stu-id="0e76f-262">To extend the Windows Server AD identity infrastructure already in place in the intranet, this architecture uses two Windows Server AD replica domain controllers of an existing on-premises Windows Server AD forest.</span></span>

<span data-ttu-id="0e76f-263">Inoltre è sempre consigliabile pianificare la protezione avanzata della sicurezza.</span><span class="sxs-lookup"><span data-stu-id="0e76f-263">In addition, it's always wise to plan for security hardening.</span></span> <span data-ttu-id="0e76f-264">Altri indicazioni includono:</span><span class="sxs-lookup"><span data-stu-id="0e76f-264">Other recommendations include:</span></span>

- <span data-ttu-id="0e76f-265">Aggiungere regole ai gruppi di sicurezza di rete per isolare i ruoli e le subnet.</span><span class="sxs-lookup"><span data-stu-id="0e76f-265">Add rules to NSGs to isolate subnets and roles.</span></span>
- <span data-ttu-id="0e76f-266">Non assegnare indirizzi IP pubblici alle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="0e76f-266">Don't assign public IP addresses to VMs.</span></span>
- <span data-ttu-id="0e76f-267">Per il rilevamento delle intrusioni e l'analisi dei payload, considerare l'uso di un dispositivo di rete virtuale davanti ai server Web front-end anziché un servizio di bilanciamento del carico interno di Azure.</span><span class="sxs-lookup"><span data-stu-id="0e76f-267">For intrusion detection and analysis of payloads, consider using a network virtual appliance in front of the front-end web servers instead of an internal Azure load balancer.</span></span>
- <span data-ttu-id="0e76f-268">In alternativa, usare i criteri IPsec per la crittografia del traffico di testo non crittografato tra server.</span><span class="sxs-lookup"><span data-stu-id="0e76f-268">As an option, use IPsec policies for encryption of cleartext traffic between servers.</span></span> <span data-ttu-id="0e76f-269">Se si esegue anche l'isolamento delle subnet, è possibile aggiornare le regole dei gruppi di sicurezza di rete per consentire il traffico IPsec.</span><span class="sxs-lookup"><span data-stu-id="0e76f-269">If you are also doing subnet isolation, update your network security group rules to allow IPsec traffic.</span></span>
- <span data-ttu-id="0e76f-270">Installare gli agenti anti-malware per le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="0e76f-270">Install anti-malware agents for the VMs.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="0e76f-271">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="0e76f-271">Deploy the solution</span></span>

<span data-ttu-id="0e76f-272">Una distribuzione di questa architettura di riferimento è disponibile in [GitHub][github].</span><span class="sxs-lookup"><span data-stu-id="0e76f-272">A deployment for this reference architecture is available on [GitHub][github].</span></span> <span data-ttu-id="0e76f-273">Il completamento dell'intera distribuzione può richiedere alcune ore.</span><span class="sxs-lookup"><span data-stu-id="0e76f-273">The entire deployment can take several hours to complete.</span></span>

<span data-ttu-id="0e76f-274">La distribuzione crea i seguenti gruppi di risorse nella sottoscrizione:</span><span class="sxs-lookup"><span data-stu-id="0e76f-274">The deployment creates the following resource groups in your subscription:</span></span>

- <span data-ttu-id="0e76f-275">ra-onprem-sp2016-rg</span><span class="sxs-lookup"><span data-stu-id="0e76f-275">ra-onprem-sp2016-rg</span></span>
- <span data-ttu-id="0e76f-276">ra-sp2016-network-rg</span><span class="sxs-lookup"><span data-stu-id="0e76f-276">ra-sp2016-network-rg</span></span>

<span data-ttu-id="0e76f-277">I file parametro di modello fanno riferimento a questi nomi; pertanto, se questi vengono modificati, aggiornare i file parametro in modo che corrispondano.</span><span class="sxs-lookup"><span data-stu-id="0e76f-277">The template parameter files refer to these names, so if you change them, update the parameter files to match.</span></span> 

<span data-ttu-id="0e76f-278">I file dei parametri comprendono una password hardcoded in diverse posizioni.</span><span class="sxs-lookup"><span data-stu-id="0e76f-278">The parameter files include a hard-coded password in various places.</span></span> <span data-ttu-id="0e76f-279">Modificare questi valori prima di eseguire la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="0e76f-279">Change these values before you deploy.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="0e76f-280">prerequisiti</span><span class="sxs-lookup"><span data-stu-id="0e76f-280">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-the-solution"></a><span data-ttu-id="0e76f-281">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="0e76f-281">Deploy the solution</span></span> 

1. <span data-ttu-id="0e76f-282">Eseguire il comando seguente per distribuire una rete locale simulata.</span><span class="sxs-lookup"><span data-stu-id="0e76f-282">Run the following command to deploy a simulated on-premises network.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p onprem.json --deploy
    ```

2. <span data-ttu-id="0e76f-283">Eseguire il comando seguente per distribuire la rete virtuale di Azure e il gateway VPN.</span><span class="sxs-lookup"><span data-stu-id="0e76f-283">Run the following command to deploy the Azure VNet and the VPN gateway.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p connections.json --deploy
    ```

3. <span data-ttu-id="0e76f-284">Eseguire il comando seguente per distribuire il jumpbox, i controller di dominio di AD e le VM di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0e76f-284">Run the following command to deploy the jumpbox, AD domain controllers, and SQL Server VMs.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure1.json --deploy
    ```

4. <span data-ttu-id="0e76f-285">Eseguire il comando seguente per creare il cluster di failover e il gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="0e76f-285">Run the following command to create the failover cluster and the availability group.</span></span> 

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure2-cluster.json --deploy

5. Run the following command to deploy the remaining VMs.

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure3.json --deploy
    ```

<span data-ttu-id="0e76f-286">A questo punto, assicurarsi che sia possibile stabilire una connessione TCP dal front-end Web al servizio di bilanciamento del carico per il gruppo di disponibilità AlwaysOn di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0e76f-286">At this point, verify that you can make a TCP conection from the web front end to the load balancer for the SQL Server Always On availability group.</span></span> <span data-ttu-id="0e76f-287">A questo scopo, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="0e76f-287">To do so, perform the following steps:</span></span>

1. <span data-ttu-id="0e76f-288">Usare il portale di Azure per trovare la macchina virtuale denominata `ra-sp-jb-vm1` nel gruppo di risorse `ra-sp2016-network-rg`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-288">Use the Azure portal to find the VM named `ra-sp-jb-vm1` in the `ra-sp2016-network-rg` resource group.</span></span> <span data-ttu-id="0e76f-289">Questa è la VM del jumpbox.</span><span class="sxs-lookup"><span data-stu-id="0e76f-289">This is the jumpbox VM.</span></span>

2. <span data-ttu-id="0e76f-290">Fare clic su `Connect` per aprire una sessione di desktop remoto per la macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="0e76f-290">Click `Connect` to open a remote desktop session to the VM.</span></span> <span data-ttu-id="0e76f-291">Usare la password specificata nel file parametro `azure1.json`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-291">Use the password that you specified in the `azure1.json` parameter file.</span></span>

3. <span data-ttu-id="0e76f-292">Dalla sessione di Desktop remoto accedere a 10.0.5.4.</span><span class="sxs-lookup"><span data-stu-id="0e76f-292">From the Remote Desktop session, log into 10.0.5.4.</span></span> <span data-ttu-id="0e76f-293">Si tratta dell'indirizzo IP della macchina virtuale denominata `ra-sp-app-vm1`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-293">This is the IP address of the VM named `ra-sp-app-vm1`.</span></span>

4. <span data-ttu-id="0e76f-294">Aprire una console PowerShell nella VM e usare il cmdlet `Test-NetConnection` per verificare la possibilità di connettersi al servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="0e76f-294">Open a PowerShell console in the VM, and use the `Test-NetConnection` cmdlet to verify that you can connect to the load balancer.</span></span>

    ```powershell
    Test-NetConnection 10.0.3.100 -Port 1433
    ```

<span data-ttu-id="0e76f-295">L'output dovrebbe essere simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="0e76f-295">The output should look similar to the following:</span></span>

```powershell
ComputerName     : 10.0.3.100
RemoteAddress    : 10.0.3.100
RemotePort       : 1433
InterfaceAlias   : Ethernet 3
SourceAddress    : 10.0.0.132
TcpTestSucceeded : True
```

<span data-ttu-id="0e76f-296">In caso di errore, usare il portale di Azure per riavviare la VM denominata `ra-sp-sql-vm2`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-296">If it fails, use the Azure Portal to restart the VM named `ra-sp-sql-vm2`.</span></span> <span data-ttu-id="0e76f-297">Dopo il riavvio della macchina virtuale, eseguire di nuovo il comando `Test-NetConnection`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-297">After the VM restarts, run the `Test-NetConnection` command again.</span></span> <span data-ttu-id="0e76f-298">Potrebbe essere necessario attendere circa un minuto dopo il riavvio della VM prima che venga stabilita la connessione.</span><span class="sxs-lookup"><span data-stu-id="0e76f-298">You may need to wait about a minute after the VM restarts for the connection to succeed.</span></span> 

<span data-ttu-id="0e76f-299">Completare quindi la distribuzione come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="0e76f-299">Now complete the deployment as follows.</span></span>

1. <span data-ttu-id="0e76f-300">Eseguire il comando seguente per distribuire il nodo primario della farm di SharePoint.</span><span class="sxs-lookup"><span data-stu-id="0e76f-300">Run the following command to deploy the SharePoint farm primary node.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure4-sharepoint-server.json --deploy
    ```

2. <span data-ttu-id="0e76f-301">Eseguire il comando seguente per distribuire la cache, le funzionalità di ricerca e il Web di SharePoint.</span><span class="sxs-lookup"><span data-stu-id="0e76f-301">Run the following command to deploy the SharePoint cache, search, and web.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure5-sharepoint-farm.json --deploy
    ```

3. <span data-ttu-id="0e76f-302">Eseguire il comando seguente per creare le regole del gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="0e76f-302">Run the following command to create the NSG rules.</span></span>

    ```bash
    azbb -s <subscription_id> -g ra-onprem-sp2016-rg -l <location> -p azure6-security.json --deploy
    ```

### <a name="validate-the-deployment"></a><span data-ttu-id="0e76f-303">Convalidare la distribuzione</span><span class="sxs-lookup"><span data-stu-id="0e76f-303">Validate the deployment</span></span>

1. <span data-ttu-id="0e76f-304">Nel [portale di Azure][azure-portal] passare al gruppo di risorse `ra-onprem-sp2016-rg`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-304">In the [Azure portal][azure-portal], navigate to the `ra-onprem-sp2016-rg` resource group.</span></span>

2. <span data-ttu-id="0e76f-305">Nell'elenco di risorse selezionare la risorsa di macchina virtuale denominata `ra-onpr-u-vm1`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-305">In the list of resources, select the VM resource named `ra-onpr-u-vm1`.</span></span> 

3. <span data-ttu-id="0e76f-306">Connettersi alla macchina virtuale, come descritto in [Connettersi alla macchina virtuale][connect-to-vm].</span><span class="sxs-lookup"><span data-stu-id="0e76f-306">Connect to the VM, as described in [Connect to virtual machine][connect-to-vm].</span></span> <span data-ttu-id="0e76f-307">Il nome utente è `\onpremuser`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-307">The user name is `\onpremuser`.</span></span>

5.  <span data-ttu-id="0e76f-308">Quando viene stabilita la connessione remota alla macchina virtuale, aprire un browser nella macchina virtuale e passare a `http://portal.contoso.local`.</span><span class="sxs-lookup"><span data-stu-id="0e76f-308">When the remote connection to the VM is established, open a browser in the VM and navigate to `http://portal.contoso.local`.</span></span>

6.  <span data-ttu-id="0e76f-309">Nella casella **Sicurezza di Windows** accedere al portale di SharePoint usando `contoso.local\testuser` per il nome utente.</span><span class="sxs-lookup"><span data-stu-id="0e76f-309">In the **Windows Security** box, log on to the SharePoint portal using `contoso.local\testuser` for the user name.</span></span>

<span data-ttu-id="0e76f-310">Questo accesso crea un tunnel dal dominio Fabrikam.com usato dalla rete locale al dominio contoso.local usato dal portale SharePoint.</span><span class="sxs-lookup"><span data-stu-id="0e76f-310">This logon tunnels from the Fabrikam.com domain used by the on-premises network to the contoso.local domain used by the SharePoint portal.</span></span> <span data-ttu-id="0e76f-311">Quando si apre il sito di SharePoint, verrà visualizzato il sito demo radice.</span><span class="sxs-lookup"><span data-stu-id="0e76f-311">When the SharePoint site opens, you'll see the root demo site.</span></span>

<span data-ttu-id="0e76f-312">**_Collaboratori di questa architettura di riferimento_**&mdash; Joe Davies, Bob Fox, Neil Hodgkinson e Paul Stork</span><span class="sxs-lookup"><span data-stu-id="0e76f-312">**_Contributors to this reference architecture_** &mdash;  Joe Davies, Bob Fox, Neil Hodgkinson, Paul Stork</span></span>

<!-- links -->

[availability-set]: /azure/virtual-machines/windows/manage-availability
[azure-portal]: https://portal.azure.com
[azure-ps]: /powershell/azure/overview
[azure-pricing]: https://azure.microsoft.com/pricing/calculator/
[bastion-host]: https://en.wikipedia.org/wiki/Bastion_host
[create-availability-group]: https://technet.microsoft.com/library/mt793548(v=office.16).aspx
[connect-to-vm]: /azure/virtual-machines/windows/quick-create-portal#connect-to-virtual-machine
[github]: https://github.com/mspnp/reference-architectures
[hybrid-ra]: ../hybrid-networking/index.md
[hybrid-vpn-ra]: ../hybrid-networking/vpn.md
[load-balancer]: /azure/load-balancer/load-balancer-internal-overview
[managed-disks]: /azure/storage/storage-managed-disks-overview
[minroles]: https://technet.microsoft.com/library/mt346114(v=office.16).aspx
[nsg]: /azure/virtual-network/virtual-networks-nsg
[office-web-apps]: https://support.microsoft.com/help/3199955/office-web-apps-and-office-online-server-supportability-in-azure
[paired-regions]: /azure/best-practices-availability-paired-regions
[readme]: https://github.com/mspnp/reference-architectures/tree/master/sharepoint/sharepoint-2016
[resource-group]: /azure/azure-resource-manager/resource-group-overview
[quotas]: /azure/azure-subscription-service-limits
[sharepoint-accounts]: https://technet.microsoft.com/library/ee662513(v=office.16).aspx
[sharepoint-crawling]: https://technet.microsoft.com/library/dn535606(v=office.16).aspx
[sharepoint-dr]: https://technet.microsoft.com/library/ff628971(v=office.16).aspx
[sharepoint-hybrid]: https://aka.ms/sphybrid
[sharepoint-minrole]: https://technet.microsoft.com/library/mt743705(v=office.16).aspx
[sharepoint-ops]: https://technet.microsoft.com/library/cc262289(v=office.16).aspx
[sharepoint-reqs]: https://technet.microsoft.com/library/cc262485(v=office.16).aspx
[sharepoint-search]: https://technet.microsoft.com/library/dn342836.aspx
[sql-always-on]: /sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server
[sql-performance]: /virtual-machines/windows/sql/virtual-machines-windows-sql-performance
[sql-server-capacity-planning]: https://technet.microsoft.com/library/cc298801(v=office.16).aspx
[sql-quorum]: https://technet.microsoft.com/library/cc731739(v=ws.11).aspx
[sql-sharepoint-best-practices]: https://technet.microsoft.com/library/hh292622(v=office.16).aspx
[tempdb]: /sql/relational-databases/databases/tempdb-database
[virtual-networks-nsg]: /azure/virtual-network/virtual-networks-nsg
[visio-download]: https://archcenter.blob.core.windows.net/cdn/Sharepoint-2016.vsdx
[vm-sizes-general]: /azure/virtual-machines/windows/sizes-general
[vm-sizes-memory]: /azure/virtual-machines/windows/sizes-memory
[windows-n-tier]: ../virtual-machines-windows/n-tier.md
