---
title: Architettura di microservizi nel servizio Azure Kubernetes (AKS)
description: Distribuire un'architettura di microservizi nel servizio Azure Kubernetes (AKS)
author: MikeWasson
ms.date: 12/10/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: f3b637d61c929e5523ea5409426f3d7a72096dfa
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/23/2019
ms.locfileid: "54484126"
---
# <a name="microservices-architecture-on-azure-kubernetes-service-aks"></a><span data-ttu-id="cc137-103">Architettura di microservizi nel servizio Azure Kubernetes (AKS)</span><span class="sxs-lookup"><span data-stu-id="cc137-103">Microservices architecture on Azure Kubernetes Service (AKS)</span></span>

<span data-ttu-id="cc137-104">Questa architettura di riferimento mostra un'applicazione di microservizi distribuita al servizio Azure Kubernetes (AKS).</span><span class="sxs-lookup"><span data-stu-id="cc137-104">This reference architectures shows a microservices application deployed to Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="cc137-105">Mostra una configurazione di base del servizio Azure Kubernetes, che può costituire il punto di partenza per la maggior parte delle distribuzioni.</span><span class="sxs-lookup"><span data-stu-id="cc137-105">It shows a basic AKS configuration that can be the starting point for most deployments.</span></span> <span data-ttu-id="cc137-106">Le opzioni più avanzate, incluse le opzioni avanzate di rete, verranno trattate in un'architettura di riferimento separata.</span><span class="sxs-lookup"><span data-stu-id="cc137-106">More advanced options, including advanced networking options, will be covered in a separate reference architecture.</span></span>

<span data-ttu-id="cc137-107">Questo articolo presuppone conoscenze di base di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-107">This article assumes basic knowledge of Kubernetes.</span></span> <span data-ttu-id="cc137-108">L'articolo si concentra principalmente sull'infrastruttura e sulle considerazioni relative a DevOps sull'esecuzione di un'architettura di microservizi nel servizio Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-108">The article focuses mainly on the infrastructure and DevOps considerations of running a microservices architecture on AKS.</span></span> <span data-ttu-id="cc137-109">Per indicazioni su come progettare i microservizi da una prospettiva di progettazione basata su dominio (DDD), vedere [Progettazione, compilazione e gestione di microservizi in Azure](/azure/architecture/microservices).</span><span class="sxs-lookup"><span data-stu-id="cc137-109">For guidance on how to design microservices from a Domain Driven Design (DDD) perspective, see [Designing, building, and operating microservices on Azure](/azure/architecture/microservices).</span></span>

> [!NOTE]
> <span data-ttu-id="cc137-110">Microsoft sta lavorando a un'implementazione di riferimento (RI) a complemento di questo articolo, la cui pubblicazione è prevista a inizio 2019.</span><span class="sxs-lookup"><span data-stu-id="cc137-110">We are working on a reference implementation (RI) to accompany this article, which we expect to publish in early 2019.</span></span> <span data-ttu-id="cc137-111">Questo articolo verrà aggiornato per incorporare le procedure aggiuntive consigliate da tale implementazione di riferimento.</span><span class="sxs-lookup"><span data-stu-id="cc137-111">This article will be updated to incorporate additional best practices from that RI.</span></span>

![Architettura di riferimento del servizio Azure Kubernetes](./_images/aks.png)

## <a name="architecture"></a><span data-ttu-id="cc137-113">Architettura</span><span class="sxs-lookup"><span data-stu-id="cc137-113">Architecture</span></span>

<span data-ttu-id="cc137-114">L'architettura è costituita dai componenti seguenti.</span><span class="sxs-lookup"><span data-stu-id="cc137-114">The architecture consists of the following components.</span></span>

<span data-ttu-id="cc137-115">**Servizio Azure Kubernetes** (AKS).</span><span class="sxs-lookup"><span data-stu-id="cc137-115">**Azure Kubernetes Service** (AKS).</span></span> <span data-ttu-id="cc137-116">Il servizio Azure Kubernetes è un servizio di Azure che distribuisce un cluster Kubernetes gestito.</span><span class="sxs-lookup"><span data-stu-id="cc137-116">AKS is an Azure service that deploys a managed Kubernetes cluster.</span></span> 

<span data-ttu-id="cc137-117">**Cluster Kubernetes**.</span><span class="sxs-lookup"><span data-stu-id="cc137-117">**Kubernetes cluster**.</span></span> <span data-ttu-id="cc137-118">Il servizio Azure Kubernetes è responsabile della distribuzione del cluster e della gestione dei master di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-118">AKS is responsible for deploying the Kubernetes cluster and for managing the Kubernetes masters.</span></span> <span data-ttu-id="cc137-119">Si gestiscono solo i nodi agente.</span><span class="sxs-lookup"><span data-stu-id="cc137-119">You only manage the agent nodes.</span></span>

<span data-ttu-id="cc137-120">**Rete virtuale**.</span><span class="sxs-lookup"><span data-stu-id="cc137-120">**Virtual network**.</span></span> <span data-ttu-id="cc137-121">Per impostazione predefinita, il servizio Azure Kubernetes crea una rete virtuale per distribuirvi all'interno i nodi agente.</span><span class="sxs-lookup"><span data-stu-id="cc137-121">By default, AKS creates a virtual network to deploy the agent nodes into.</span></span> <span data-ttu-id="cc137-122">Per scenari più avanzati, è possibile creare innanzitutto la rete virtuale, la quale consente di controllare aspetti come la configurazione di subnet, la connettività locale e l'indirizzamento IP.</span><span class="sxs-lookup"><span data-stu-id="cc137-122">For more advanced scenarios, you can create the virtual network first, which lets you control things like how the subnets are configured, on-premises connectivity, and IP addressing.</span></span> <span data-ttu-id="cc137-123">Per altre informazioni, vedere [Configurare funzionalità di rete avanzate nel servizio Azure Kubernetes (AKS)](/azure/aks/configure-advanced-networking).</span><span class="sxs-lookup"><span data-stu-id="cc137-123">For more information, see [Configure advanced networking in Azure Kubernetes Service (AKS)](/azure/aks/configure-advanced-networking).</span></span>

<span data-ttu-id="cc137-124">**Dati in ingresso**.</span><span class="sxs-lookup"><span data-stu-id="cc137-124">**Ingress**.</span></span> <span data-ttu-id="cc137-125">Un dato in ingresso espone le route HTTP (S) ai servizi all'interno del cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-125">An ingress exposes HTTP(S) routes to services inside the cluster.</span></span> <span data-ttu-id="cc137-126">Per altre informazioni, vedere la sezione [API gateway](#api-gateway) di seguito.</span><span class="sxs-lookup"><span data-stu-id="cc137-126">For more information, see the section [API Gateway](#api-gateway) below.</span></span>

<span data-ttu-id="cc137-127">**Origine dati esterna**.</span><span class="sxs-lookup"><span data-stu-id="cc137-127">**External data stores**.</span></span> <span data-ttu-id="cc137-128">I microservizi sono in genere senza stati; la scrittura dello stato avviene in archivi di dati esterni, ad esempio database SQL di Azure o Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="cc137-128">Microservices are typically stateless and write state to external data stores, such as Azure SQL Database or Cosmos DB.</span></span>

<span data-ttu-id="cc137-129">**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="cc137-129">**Azure Active Directory**.</span></span> <span data-ttu-id="cc137-130">Il servizio Azure Kubernetes usa un'identità di Azure Active Directory (Azure AD) per creare e gestire altre risorse di Azure, ad esempio i servizi di bilanciamento del carico di Azure.</span><span class="sxs-lookup"><span data-stu-id="cc137-130">AKS uses an Azure Active Directory (Azure AD) identity to create and manage other Azure resources such as Azure load balancers.</span></span> <span data-ttu-id="cc137-131">Azure AD è consigliabile inoltre per l'autenticazione utente nelle applicazioni client.</span><span class="sxs-lookup"><span data-stu-id="cc137-131">Azure AD is also recommended for user authentication in client applications.</span></span>

<span data-ttu-id="cc137-132">**Registro Azure Container**.</span><span class="sxs-lookup"><span data-stu-id="cc137-132">**Azure Container Registry**.</span></span> <span data-ttu-id="cc137-133">Usare Registro Azure Container per archiviare le immagini Docker private, che vengono distribuite nel cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-133">Use Container Registry to store private Docker images, which are deployed to the cluster.</span></span> <span data-ttu-id="cc137-134">Il servizio Azure Kubernetes può eseguire l'autenticazione con Registro Azure Container usando la relativa identità di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cc137-134">AKS can authenticate with Container Registry using its Azure AD identity.</span></span> <span data-ttu-id="cc137-135">Il servizio Azure Kubernetes non richiede Registro Azure Container.</span><span class="sxs-lookup"><span data-stu-id="cc137-135">Note that AKS does not require Azure Container Registry.</span></span> <span data-ttu-id="cc137-136">È possibile usare altri registri di contenitori, ad esempio l'hub Docker.</span><span class="sxs-lookup"><span data-stu-id="cc137-136">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="cc137-137">**Azure Pipelines**.</span><span class="sxs-lookup"><span data-stu-id="cc137-137">**Azure Pipelines**.</span></span> <span data-ttu-id="cc137-138">Pipeline fa parte di Azure DevOps Services ed esegue build automatizzate, test e distribuzioni.</span><span class="sxs-lookup"><span data-stu-id="cc137-138">Pipelines is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="cc137-139">È inoltre possibile usare soluzioni CI/CD di terze parti come Jenkins.</span><span class="sxs-lookup"><span data-stu-id="cc137-139">You can also use third-party CI/CD solutions such as Jenkins.</span></span> 

<span data-ttu-id="cc137-140">**Helm**.</span><span class="sxs-lookup"><span data-stu-id="cc137-140">**Helm**.</span></span> <span data-ttu-id="cc137-141">Helm è, come Gestione pacchetti per Kubernetes &mdash;, un modo per raggruppare gli oggetti Kubernetes in una singola unità che si può pubblicare, distribuire, effettuare il controllo versione e aggiornare.</span><span class="sxs-lookup"><span data-stu-id="cc137-141">Helm is as a package manager for Kubernetes &mdash; a way to bundle Kubernetes objects into a single unit that you can publish, deploy, version, and update.</span></span>

<span data-ttu-id="cc137-142">**Monitoraggio di Azure**.</span><span class="sxs-lookup"><span data-stu-id="cc137-142">**Azure Monitor**.</span></span> <span data-ttu-id="cc137-143">Monitoraggio di Azure raccoglie e archivia log e metriche, incluse le metriche di piattaforma per i servizi di Azure nella soluzione e in telemetria applicazioni.</span><span class="sxs-lookup"><span data-stu-id="cc137-143">Azure Monitor collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="cc137-144">Usare questi dati per monitorare l'applicazione, configurare avvisi e dashboard ed eseguire l'analisi delle cause principali di errore.</span><span class="sxs-lookup"><span data-stu-id="cc137-144">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="cc137-145">Monitoraggio di Azure si integra con il servizio Azure Kubernetes per raccogliere le metriche da controller, nodi e contenitori, nonché dai log contenitore e dai log del nodo master.</span><span class="sxs-lookup"><span data-stu-id="cc137-145">Azure Monitor integrates with AKS to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="cc137-146">Considerazioni sulla progettazione</span><span class="sxs-lookup"><span data-stu-id="cc137-146">Design considerations</span></span>

<span data-ttu-id="cc137-147">Questa architettura di riferimento è incentrata su architetture di microservizi, anche se molte delle procedure consigliate si applicano per altri carichi di lavoro in esecuzione nel servizio Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-147">This reference architecture is focused on microservices architectures, although many of the recommended practices will apply to other workloads running on AKS.</span></span>

### <a name="microservices"></a><span data-ttu-id="cc137-148">Microservizi</span><span class="sxs-lookup"><span data-stu-id="cc137-148">Microservices</span></span>

<span data-ttu-id="cc137-149">L'oggetto Kubernetes Service è un modo semplice per adattare i microservizi in Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-149">The Kubernetes Service object is a natural way to model microservices in Kubernetes.</span></span> <span data-ttu-id="cc137-150">Un microservizio è un'unità di codice a regime di controllo libero, distribuibile in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="cc137-150">A microservice is a loosely coupled, independently deployable unit of code.</span></span> <span data-ttu-id="cc137-151">In genere, i Microservizi comunicano tramite API ben definite e possono essere individuati tramite alcune forme di individuazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="cc137-151">Microservices typically communicate through well-defined APIs, and are discoverable through some form of service discovery.</span></span> <span data-ttu-id="cc137-152">L'oggetto Kubernetes Service fornisce un set di funzionalità che corrispondono a questi requisiti:</span><span class="sxs-lookup"><span data-stu-id="cc137-152">The Kubernetes Service object provides a set of capabilities that match these requirements:</span></span>

- <span data-ttu-id="cc137-153">Indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="cc137-153">IP address.</span></span> <span data-ttu-id="cc137-154">L'oggetto service fornisce un indirizzo IP interno statico per un gruppo di pod (ReplicaSet).</span><span class="sxs-lookup"><span data-stu-id="cc137-154">The Service object provides a static internal IP address for a group of pods (ReplicaSet).</span></span> <span data-ttu-id="cc137-155">Quando i pod vengono creati o spostati, il servizio è sempre raggiungibile in questo indirizzo IP interno.</span><span class="sxs-lookup"><span data-stu-id="cc137-155">As pods are created or moved around, the service is always reachable at this internal IP address.</span></span>

- <span data-ttu-id="cc137-156">Bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="cc137-156">Load balancing.</span></span> <span data-ttu-id="cc137-157">Il traffico inviato all'indirizzo IP del servizio è a carico bilanciato per il numero di pod.</span><span class="sxs-lookup"><span data-stu-id="cc137-157">Traffic sent to the service's IP address is load balanced to the pods.</span></span> 

- <span data-ttu-id="cc137-158">Individuazione dei servizi.</span><span class="sxs-lookup"><span data-stu-id="cc137-158">Service discovery.</span></span> <span data-ttu-id="cc137-159">Il servizio DNS di Kubernetes assegna ai servizi le voci DNS interne.</span><span class="sxs-lookup"><span data-stu-id="cc137-159">Services are assigned internal DNS entries by the Kubernetes DNS service.</span></span> <span data-ttu-id="cc137-160">Ciò significa che il gateway API può chiamare un servizio back-end usando il nome DNS.</span><span class="sxs-lookup"><span data-stu-id="cc137-160">That means the API gateway can call a backend service using the DNS name.</span></span> <span data-ttu-id="cc137-161">Lo stesso meccanismo può essere usato per la comunicazione da servizio a servizio.</span><span class="sxs-lookup"><span data-stu-id="cc137-161">The same mechanism can be used for service-to-service communication.</span></span> <span data-ttu-id="cc137-162">Le voci DNS sono organizzate per spazio dei nomi, pertanto se gli spazi dei nomi corrispondono a contesti delimitati, il nome DNS per un servizio eseguirà naturalmente il mapping al dominio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="cc137-162">The DNS entries are organized by namespace, so if your namespaces correspond to bounded contexts, then the DNS name for a service will map naturally to the application domain.</span></span>

<span data-ttu-id="cc137-163">Il diagramma seguente mostra la relazione concettuale tra servizi e i pod.</span><span class="sxs-lookup"><span data-stu-id="cc137-163">The following diagram show the conceptual relation between services and pods.</span></span> <span data-ttu-id="cc137-164">Il mapping effettivo degli indirizzi IP e delle porte degli endpoint viene effettuata da kube-proxy, il proxy di rete Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-164">The actual mapping to endpoint IP addresses and ports is done by kube-proxy, the Kubernetes network proxy.</span></span>

![Servizi e pod](./_images/aks-services.png)

### <a name="api-gateway"></a><span data-ttu-id="cc137-166">API Gateway</span><span class="sxs-lookup"><span data-stu-id="cc137-166">API Gateway</span></span>

<span data-ttu-id="cc137-167">Un *gateway API* è un gateway che si trova tra i client esterni e i microservizi</span><span class="sxs-lookup"><span data-stu-id="cc137-167">An *API gateway* is a gateway that sits between external clients and the microservices.</span></span> <span data-ttu-id="cc137-168">e funge da proxy inverso, indirizzando le richieste dai client ai microservizi.</span><span class="sxs-lookup"><span data-stu-id="cc137-168">It acts as a reverse proxy, routing requests from clients to microservices.</span></span> <span data-ttu-id="cc137-169">Può anche eseguire varie attività trasversali come l'autenticazione, la terminazione SSL e la limitazione della frequenza.</span><span class="sxs-lookup"><span data-stu-id="cc137-169">It may also perform various cross-cutting tasks such as authentication, SSL termination, and rate limiting.</span></span> 

<span data-ttu-id="cc137-170">Le funzionalità fornite da un gateway possono essere raggruppate nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="cc137-170">Functionality provided by a gateway can be grouped as follows:</span></span>

- <span data-ttu-id="cc137-171">[Routing del gateway](../../patterns/gateway-routing.md): routing delle richieste client ai servizi back-end corretti.</span><span class="sxs-lookup"><span data-stu-id="cc137-171">[Gateway Routing](../../patterns/gateway-routing.md): Routing client requests to the right backend services.</span></span> <span data-ttu-id="cc137-172">Questo offre un singolo endpoint per i client e consente di separare i client dai servizi.</span><span class="sxs-lookup"><span data-stu-id="cc137-172">This provides a single endpoint for clients, and helps to decouple clients from services.</span></span>

- <span data-ttu-id="cc137-173">[Aggregazione tramite il gateway](../../patterns/gateway-aggregation.md): aggregazione di più richieste in una sola, per ridurre la frammentarietà tra il client e il back-end.</span><span class="sxs-lookup"><span data-stu-id="cc137-173">[Gateway Aggregation](../../patterns/gateway-aggregation.md): Aggregation of multiple requests into a single request, to reduce chattiness between the client and the backend.</span></span>

- <span data-ttu-id="cc137-174">[Offload al gateway](../../patterns/gateway-offloading.md).</span><span class="sxs-lookup"><span data-stu-id="cc137-174">[Gateway Offloading](../../patterns/gateway-offloading.md).</span></span> <span data-ttu-id="cc137-175">Un gateway può eseguire l'offload delle funzionalità dai servizi back-end, ad esempio la terminazione SSL, l'autenticazione, inserimento nell'elenco di IP consentiti o limitazione della frequenza dei client (limitazione delle richieste).</span><span class="sxs-lookup"><span data-stu-id="cc137-175">A gateway can offload functionality from the backend services, such as SSL termination, authentication, IP whitelisting, or client rate limiting (throttling).</span></span>

<span data-ttu-id="cc137-176">I gateway API sono uno schema [progettuale generale di microservizi](https://microservices.io/patterns/apigateway.html).</span><span class="sxs-lookup"><span data-stu-id="cc137-176">API gateways are a general [microservices design pattern](https://microservices.io/patterns/apigateway.html).</span></span> <span data-ttu-id="cc137-177">Possono essere implementati usando una serie di tecnologie diverse.</span><span class="sxs-lookup"><span data-stu-id="cc137-177">They can be implemented using a number of different technologies.</span></span> <span data-ttu-id="cc137-178">Probabilmente l'implementazione più comune consiste nel distribuire un router perimetrale o proxy inversi, ad esempio Nginx, HAProxy o Traefik, all'interno del cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-178">Probably the most common implementation is to deploy an edge router or reverse proxy, such as Nginx, HAProxy, or Traefik, inside the cluster.</span></span> 

<span data-ttu-id="cc137-179">Altre opzioni includono:</span><span class="sxs-lookup"><span data-stu-id="cc137-179">Other options include:</span></span>

- <span data-ttu-id="cc137-180">Gateway applicazione Azure e/o Azure gestione API, entrambi servizi gestiti che si trovano all'esterno del cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-180">Azure Application Gateway and/or Azure API-Management, which are both managed services that reside outside of the cluster.</span></span> <span data-ttu-id="cc137-181">Un controller di ingresso del gateway applicazione è attualmente in versione beta.</span><span class="sxs-lookup"><span data-stu-id="cc137-181">An Application Gateway Ingress Controller is currently in beta.</span></span>

- <span data-ttu-id="cc137-182">Proxy di Funzioni di Azure.</span><span class="sxs-lookup"><span data-stu-id="cc137-182">Azure Functions Proxies.</span></span> <span data-ttu-id="cc137-183">I proxy possono modificare richieste e risposte e indirizzare le richieste in base a un indirizzo Web.</span><span class="sxs-lookup"><span data-stu-id="cc137-183">Proxies can modify requests and responses and route requests based on URL.</span></span>

<span data-ttu-id="cc137-184">Il tipo di risorsa **Ingress** di Kubernetes, astrae le impostazioni di configurazione per un server proxy.</span><span class="sxs-lookup"><span data-stu-id="cc137-184">The Kubernetes **Ingress** resource type abstracts the configuration settings for a proxy server.</span></span> <span data-ttu-id="cc137-185">Funziona in combinazione con un controller in ingresso, che fornisce l'implementazione sottostante della risorsa Ingress.</span><span class="sxs-lookup"><span data-stu-id="cc137-185">It works in conjunction with an ingress controller, which provides the underlying implementation of the Ingress.</span></span> <span data-ttu-id="cc137-186">Sono presenti controller in ingresso per Nginx, HAProxy, Traefik e gateway applicazione (anteprima), tra gli altri.</span><span class="sxs-lookup"><span data-stu-id="cc137-186">There are ingress controllers for Nginx, HAProxy, Traefik, and Application Gateway (preview), among others.</span></span>

<span data-ttu-id="cc137-187">Il controller di ingresso gestisce la configurazione del server proxy.</span><span class="sxs-lookup"><span data-stu-id="cc137-187">The ingress controller handles configuring the proxy server.</span></span> <span data-ttu-id="cc137-188">Spesso questi controller richiedono file di configurazione complessi, che possono essere difficili da ottimizzare se non si è esperti, in modo che il controller di ingresso funzioni da astrazione.</span><span class="sxs-lookup"><span data-stu-id="cc137-188">Often these require complex configuration files, which can be hard to tune if you aren't an expert, so the ingress controller is a nice abstraction.</span></span> <span data-ttu-id="cc137-189">Inoltre, il controller di ingresso ha accesso all'API di Kubernetes, affinché possa prendere decisioni intelligenti sul routing e sul bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="cc137-189">In addition, the Ingress Controller has access to the Kubernetes API, so it can make intelligent decisions about routing and load balancing.</span></span> <span data-ttu-id="cc137-190">Ad esempio, il controller di ingress Nginx consente di ignorare il proxy di rete di kube-proxy.</span><span class="sxs-lookup"><span data-stu-id="cc137-190">For example, the Nginx ingress controller bypasses the kube-proxy network proxy.</span></span>

<span data-ttu-id="cc137-191">D'altra parte, se serve completare un controllo sulle impostazioni, è possibile ignorare questa astrazione e configurare manualmente il server proxy.</span><span class="sxs-lookup"><span data-stu-id="cc137-191">On the other hand, if you need complete control over the settings, you may want to bypass this abstraction and configure the proxy server manually.</span></span> 

<span data-ttu-id="cc137-192">Il server proxy inverso è un potenziale collo di bottiglia o singolo punto di guasto nel sistema: distribuire sempre almeno due repliche per garantire disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="cc137-192">A reverse proxy server is a potential bottleneck or single point of failure, so always deploy at least two replicas for high availability.</span></span>

### <a name="data-storage"></a><span data-ttu-id="cc137-193">Archiviazione dei dati</span><span class="sxs-lookup"><span data-stu-id="cc137-193">Data storage</span></span>

<span data-ttu-id="cc137-194">In un'architettura di microservizi i servizi non devono condividere archiviazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="cc137-194">In a microservices architecture, services should not share data storage.</span></span> <span data-ttu-id="cc137-195">Ogni servizio deve possedere i propri dati privati in una risorsa di archiviazione logica separata, per evitare dipendenze nascoste tra servizi.</span><span class="sxs-lookup"><span data-stu-id="cc137-195">Each service should own its own private data in a separate logical storage, to avoid hidden dependencies among services.</span></span> <span data-ttu-id="cc137-196">Il motivo è evitare l'accoppiamento accidentale tra i servizi, come può accadere quando i servizi condividono gli stessi schemi di dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="cc137-196">The reason is to avoid unintentional coupling between services, which can happen when services share the same underlying data schemas.</span></span> <span data-ttu-id="cc137-197">Inoltre, quando servizi gestiscono i propri archivi dati, possono usare l'archivio dati corretto per requisiti specifici.</span><span class="sxs-lookup"><span data-stu-id="cc137-197">Also, when services manage their own data stores, they can use the right data store for their particular requirements.</span></span> <span data-ttu-id="cc137-198">Per altre informazioni, vedere [Progettazione di microservizi: considerazioni sui dati](/azure/architecture/microservices/data-considerations).</span><span class="sxs-lookup"><span data-stu-id="cc137-198">For more information, see [Designing microservices: Data considerations](/azure/architecture/microservices/data-considerations).</span></span>

<span data-ttu-id="cc137-199">Evitare l'archiviazione persistente dei dati nel cluster locale poiché in questo modo si legano i dati al nodo.</span><span class="sxs-lookup"><span data-stu-id="cc137-199">Avoid storing persistent data in local cluster storage, because that ties the data to the node.</span></span> <span data-ttu-id="cc137-200">In alternativa,</span><span class="sxs-lookup"><span data-stu-id="cc137-200">Instead,</span></span> 

- <span data-ttu-id="cc137-201">usare un servizio esterno, ad esempio database SQL di Azure, Cosmos DB, *o*</span><span class="sxs-lookup"><span data-stu-id="cc137-201">Use an external service such as Azure SQL Database or Cosmos DB, *or*</span></span>

- <span data-ttu-id="cc137-202">montare un volume permanente usando dischi o file di Azure.</span><span class="sxs-lookup"><span data-stu-id="cc137-202">Mount a persistent volume using Azure Disks or Azure Files.</span></span> <span data-ttu-id="cc137-203">Se lo stesso volume deve essere condiviso da più pod, usare file di Azure.</span><span class="sxs-lookup"><span data-stu-id="cc137-203">Use Azure Files if the same volume needs to be shared by multiple pods.</span></span>

### <a name="namespaces"></a><span data-ttu-id="cc137-204">Spazi dei nomi</span><span class="sxs-lookup"><span data-stu-id="cc137-204">Namespaces</span></span>

<span data-ttu-id="cc137-205">Usare gli spazi dei nomi per organizzare i servizi all'interno del cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-205">Use namespaces to organize services within the cluster.</span></span> <span data-ttu-id="cc137-206">Ogni oggetto in un cluster Kubernetes appartiene a uno spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="cc137-206">Every object in a Kubernetes cluster belongs to a namespace.</span></span> <span data-ttu-id="cc137-207">Per impostazione predefinita, quando si crea un nuovo oggetto, questi viene inserito all'interno dello`default` spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="cc137-207">By default, when you create a new object, it goes into the `default` namespace.</span></span> <span data-ttu-id="cc137-208">Tuttavia è buona norma creare spazi dei nomi più descrittivi per aiutare a organizzare le risorse nel cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-208">But it's a good practice to create namespaces that are more descriptive to help organize the resources in the cluster.</span></span>

<span data-ttu-id="cc137-209">In primo luogo, gli spazi dei nomi aiutano a evitare conflitti di denominazione.</span><span class="sxs-lookup"><span data-stu-id="cc137-209">First, namespaces help prevent naming collisions.</span></span> <span data-ttu-id="cc137-210">Quando più team distribuiscono i microservizi nello stesso cluster, assieme a circa un centinaio di microservizi, diventa difficile da gestire se passano tutti nello stesso spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="cc137-210">When multiple teams deploy microservices into the same cluster, with possibly hundreds of microservices, it gets hard to manage if they all go into the same namespace.</span></span> <span data-ttu-id="cc137-211">Inoltre, gli spazi dei nomi consentono di:</span><span class="sxs-lookup"><span data-stu-id="cc137-211">In addition, namespaces allow you to:</span></span>

- <span data-ttu-id="cc137-212">Applicare vincoli delle risorse a uno spazio dei nomi, in modo che il set complessivo di pod assegnati allo spazio dei nomi non possa superare la quota delle risorse in spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="cc137-212">Apply resource constraints to a namespace, so that the total set of pods assigned to that namespace cannot exceed the resource quota of the namespace.</span></span>

- <span data-ttu-id="cc137-213">Applicare criteri a livello di spazio dei nomi, inclusi i criteri di Controllo degli accessi in base al ruolo e di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="cc137-213">Apply policies at the namespace level, including RBAC and security policies.</span></span>

<span data-ttu-id="cc137-214">Per un'architettura di microservizi, prendere in considerazione l'organizzazione di microservizi in contesti delimitati e la creazione di spazi dei nomi per ciascun contesto delimitato.</span><span class="sxs-lookup"><span data-stu-id="cc137-214">For a microservices architecture, considering organizing the microservices into bounded contexts, and creating namespaces for each bounded context.</span></span> <span data-ttu-id="cc137-215">Ad esempio, tutti i microservizi correlati al contesto delimitato "Evasione degli ordini" potrebbero essere inseriti nello stesso spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="cc137-215">For example, all microservices related to the "Order Fulfillment" bounded context could go into the same namespace.</span></span> <span data-ttu-id="cc137-216">In alternativa, creare uno spazio dei nomi per ogni team di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="cc137-216">Alternatively, create a namespace for each development team.</span></span>

<span data-ttu-id="cc137-217">Posizionare i servizi di utilità nel proprio spazio dei nomi separato.</span><span class="sxs-lookup"><span data-stu-id="cc137-217">Place utility services into their own separate namespace.</span></span> <span data-ttu-id="cc137-218">Ad esempio, è possibile distribuire Elasticsearch o Prometheus per il monitoraggio del cluster o Tiller per Helm.</span><span class="sxs-lookup"><span data-stu-id="cc137-218">For example, you might deploy Elasticsearch or Prometheus for cluster monitoring, or Tiller for Helm.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="cc137-219">Considerazioni sulla scalabilità</span><span class="sxs-lookup"><span data-stu-id="cc137-219">Scalability considerations</span></span>

<span data-ttu-id="cc137-220">Kubernetes supporta la scalabilità orizzontale a due livelli:</span><span class="sxs-lookup"><span data-stu-id="cc137-220">Kubernetes supports scale-out at two levels:</span></span>

- <span data-ttu-id="cc137-221">Ridimensionare il numero di pod allocati a una distribuzione.</span><span class="sxs-lookup"><span data-stu-id="cc137-221">Scale the number of pods allocated to a deployment.</span></span>
- <span data-ttu-id="cc137-222">Ridimensionare i nodi del cluster, per aumentare le risorse di calcolo totale disponibili per il cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-222">Scale the nodes in the cluster, to increase the total compute resources available to the cluster.</span></span>

<span data-ttu-id="cc137-223">Anche se è possibile scalare orizzontalmente i pod e nodi manualmente, è consigliabile usare la scalabilità automatica, per ridurre al minimo le probabilità che i servizi vengano configurati come risorse esaurite sotto un carico elevato.</span><span class="sxs-lookup"><span data-stu-id="cc137-223">Although you can scale out pods and nodes manually, we recommend using autoscaling, to minimize the chance that services will become resource starved under high load.</span></span> <span data-ttu-id="cc137-224">Una strategia di scalabilità automatica deve prendere in considerazione sia i pod che i nodi.</span><span class="sxs-lookup"><span data-stu-id="cc137-224">An autoscaling strategy must take both pods and nodes into account.</span></span> <span data-ttu-id="cc137-225">Se si scalano orizzontalmente i pod, alla fine si raggiungono i limiti di risorse dei nodi.</span><span class="sxs-lookup"><span data-stu-id="cc137-225">If you just scale out the pods, eventually you will reach the resource limits of the nodes.</span></span> 

### <a name="pod-autoscaling"></a><span data-ttu-id="cc137-226">Scalabilità automatica dei pod</span><span class="sxs-lookup"><span data-stu-id="cc137-226">Pod autoscaling</span></span>

<span data-ttu-id="cc137-227">La scalabilità automatica orizzontale dei pod (HPA) consente di scalare i pod basati su CPU osservata, memoria o metriche personalizzate.</span><span class="sxs-lookup"><span data-stu-id="cc137-227">The Horizontal Pod Autoscaler (HPA) scales pods based on observed CPU, memory, or custom metrics.</span></span> <span data-ttu-id="cc137-228">Per configurare la scalabilità orizzontale dei pod, specificare una metrica di destinazione (ad esempio, il 70% della CPU) e il numero minimo e massimo di repliche.</span><span class="sxs-lookup"><span data-stu-id="cc137-228">To configure horizontal pod scaling, you specify a target metric (for example, 70% of CPU), and the minimum and maximum number of replicas.</span></span> <span data-ttu-id="cc137-229">È consigliabile testare i servizi per derivare i numeri.</span><span class="sxs-lookup"><span data-stu-id="cc137-229">You should load test your services to derive these numbers.</span></span>

<span data-ttu-id="cc137-230">Un effetto collaterale della scalabilità automatica è che i pod possono essere creati o rimossi più spesso, quando si verifica un evento di aumento e riduzione del numero.</span><span class="sxs-lookup"><span data-stu-id="cc137-230">A side-effect of autoscaling is that pods may be created or evicted more frequently, as scale-out and scale-in events happen.</span></span> <span data-ttu-id="cc137-231">Per attenuare gli effetti di questa operazione:</span><span class="sxs-lookup"><span data-stu-id="cc137-231">To mitigate the effects of this:</span></span>

- <span data-ttu-id="cc137-232">Usare probe di idoneità per consentire a Kubernetes di sapere quando un nuovo pod è pronto per accettare il traffico.</span><span class="sxs-lookup"><span data-stu-id="cc137-232">Use readiness probes to let Kubernetes know when a new pod is ready to accept traffic.</span></span>
- <span data-ttu-id="cc137-233">Usare i budget di interruzioni di pod per limitare il numero di pod che possono essere eliminati da un servizio alla volta.</span><span class="sxs-lookup"><span data-stu-id="cc137-233">Use pod disruption budgets to limit how many pods can be evicted from a service at a time.</span></span>

### <a name="cluster-autoscaling"></a><span data-ttu-id="cc137-234">La scalabilità automatica del cluster</span><span class="sxs-lookup"><span data-stu-id="cc137-234">Cluster autoscaling</span></span>

<span data-ttu-id="cc137-235">La scalabilità automatica dei cluster aumenta il numero di nodi.</span><span class="sxs-lookup"><span data-stu-id="cc137-235">The cluster autoscaler scales the number of nodes.</span></span> <span data-ttu-id="cc137-236">Se non è possibile pianificare i pod a causa di vincoli delle risorse, il ridimensionamento automatico del cluster eseguirà il provisioning di più nodi.</span><span class="sxs-lookup"><span data-stu-id="cc137-236">If pods can't be scheduled because of resource constraints, the cluster autoscaler will provision more nodes.</span></span>  <span data-ttu-id="cc137-237">(Nota: l'integrazione tra il servizio Azure Kubernetes e il ridimensionamento automatico del cluster è attualmente in anteprima.)</span><span class="sxs-lookup"><span data-stu-id="cc137-237">(Note: Integration between AKS and the cluster autoscaler is currently in preview.)</span></span>

<span data-ttu-id="cc137-238">Mentre l'HPA esamina le risorse effettivamente consumate o altre metriche dai pod in esecuzione, la scalabilità automatica del cluster effettua il provisioning dei nodi per i pod che non sono stati ancora pianificati.</span><span class="sxs-lookup"><span data-stu-id="cc137-238">Whereas HPA looks at actual resources consumed or other metrics from running pods, the cluster autoscaler is provisioning nodes for pods that aren't scheduled yet.</span></span> <span data-ttu-id="cc137-239">Pertanto, analizza le risorse richieste come indicato nella specifica di pod Kubernetes per una distribuzione.</span><span class="sxs-lookup"><span data-stu-id="cc137-239">Therefore, it looks at the requested resources, as specified in the Kubernetes pod spec for a deployment.</span></span> <span data-ttu-id="cc137-240">Per ottimizzare questi valori, usare il test di carico.</span><span class="sxs-lookup"><span data-stu-id="cc137-240">Use load testing to fine-tune these values.</span></span>

<span data-ttu-id="cc137-241">Non è possibile modificare la dimensione della macchina virtuale dopo aver creato il cluster, pertanto, quando si crea il cluster, sarebbe necessario fare una pianificazione della capacità iniziale per scegliere una dimensione della macchina virtuale appropriata per i nodi agente.</span><span class="sxs-lookup"><span data-stu-id="cc137-241">You can't change the VM size after you create the cluster, so you should do some initial capacity planning to choose an appropriate VM size for the agent nodes when you create the cluster.</span></span> 

## <a name="availability-considerations"></a><span data-ttu-id="cc137-242">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="cc137-242">Availability considerations</span></span>

### <a name="health-probes"></a><span data-ttu-id="cc137-243">Probe di integrità</span><span class="sxs-lookup"><span data-stu-id="cc137-243">Health probes</span></span>

<span data-ttu-id="cc137-244">Kubernetes definisce due tipi di probe di integrità che un pod può esporre:</span><span class="sxs-lookup"><span data-stu-id="cc137-244">Kubernetes defines two types of health probe that a pod can expose:</span></span>

- <span data-ttu-id="cc137-245">Conformità del probe: Indica a Kubernetes se il pod è pronto per accettare le richieste.</span><span class="sxs-lookup"><span data-stu-id="cc137-245">Readiness probe: Tells Kubernetes whether the pod is ready to accept requests.</span></span>

- <span data-ttu-id="cc137-246">Probe di attività: Indica a Kubernetes. se un pod deve essere rimosso e se viene avviata una nuova istanza.</span><span class="sxs-lookup"><span data-stu-id="cc137-246">Liveness probe: Tells Kubernetes whether a pod should be removed and a new instance started.</span></span>

<span data-ttu-id="cc137-247">Quando si pensa a un probe, è utile ricordare il funzionamento di un servizio in Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-247">When thinking about probes, it's useful to recall how a service works in Kubernetes.</span></span> <span data-ttu-id="cc137-248">Un servizio dispone di un selettore di etichetta che corrisponde a un set di pod (zero o più).</span><span class="sxs-lookup"><span data-stu-id="cc137-248">A service has a label selector that matches a set of (zero or more) pods.</span></span> <span data-ttu-id="cc137-249">Kubernetes bilancia il carico di traffico verso i pod che corrispondono al selettore.</span><span class="sxs-lookup"><span data-stu-id="cc137-249">Kubernetes load balances traffic to the pods that match the selector.</span></span> <span data-ttu-id="cc137-250">Ricevono il traffico solo i pod avviati correttamente e integri.</span><span class="sxs-lookup"><span data-stu-id="cc137-250">Only pods that started successfully and are healthy receive traffic.</span></span> <span data-ttu-id="cc137-251">Se si blocca un contenitore, Kubernetes termina il pod e pianifica una sostituzione.</span><span class="sxs-lookup"><span data-stu-id="cc137-251">If a container crashes, Kubernetes kills the pod and schedules a replacement.</span></span>

<span data-ttu-id="cc137-252">Un pod in alcuni casi, potrebbe non essere pronto a ricevere il traffico, anche se è stato avviato correttamente.</span><span class="sxs-lookup"><span data-stu-id="cc137-252">Sometimes, a pod may not be ready to receive traffic, even though the pod started successfully.</span></span> <span data-ttu-id="cc137-253">Ad esempio, ci possono essere attività di inizializzazione, in cui l'applicazione in esecuzione nel contenitore carica dati in memoria o legge dati di configurazione.</span><span class="sxs-lookup"><span data-stu-id="cc137-253">For example, there may be initialization tasks, where the application running in the container loads things into memory or reads configuration data.</span></span> <span data-ttu-id="cc137-254">Per indicare che un pod è integro ma non è pronto a ricevere il traffico, definire un probe di idoneità.</span><span class="sxs-lookup"><span data-stu-id="cc137-254">To indicate that a pod is healthy but not ready to receive traffic, define a readiness probe.</span></span> 

<span data-ttu-id="cc137-255">I probe attività gestiscono situazioni in cui un pod è ancora in esecuzione, ma non è integro e deve essere riciclato.</span><span class="sxs-lookup"><span data-stu-id="cc137-255">Liveness probes handle the case where a pod is still running, but is unhealthy and should be recycled.</span></span> <span data-ttu-id="cc137-256">Ad esempio, si supponga che un contenitore gestisca le richieste HTTP ma si blocchi per qualche motivo.</span><span class="sxs-lookup"><span data-stu-id="cc137-256">For example, suppose that a container is serving HTTP requests but hangs for some reason.</span></span> <span data-ttu-id="cc137-257">Il contenitore non si arresta in modo anomalo, ma smette di gestire qualsiasi richiesta.</span><span class="sxs-lookup"><span data-stu-id="cc137-257">The container doesn't crash, but it has stopped serving any requests.</span></span> <span data-ttu-id="cc137-258">Se si definisce un probe di attività HTTP, il probe smetterà di rispondere e comunicherà a Kubernetes di riavviare il pod.</span><span class="sxs-lookup"><span data-stu-id="cc137-258">If you define an HTTP liveness probe, the probe will stop responding and that informs Kubernetes to restart the pod.</span></span>

<span data-ttu-id="cc137-259">Di seguito sono riportate alcune considerazioni in caso di progettazione di probe:</span><span class="sxs-lookup"><span data-stu-id="cc137-259">Here are some considerations when designing probes:</span></span>

- <span data-ttu-id="cc137-260">Se il codice ha un tempo di avvio di lunga durata, vi è il rischio che un probe di attività possa segnalare l'errore prima che venga completato l'avvio.</span><span class="sxs-lookup"><span data-stu-id="cc137-260">If your code has a long startup time, there is a danger that a liveness probe will report failure before the startup completes.</span></span> <span data-ttu-id="cc137-261">Per evitare questo problema, usare l'impostazione initialDelaySeconds, che ritarda l'avvio del probe.</span><span class="sxs-lookup"><span data-stu-id="cc137-261">To prevent this, use the initialDelaySeconds setting, which delays the probe from starting.</span></span>

- <span data-ttu-id="cc137-262">Un probe di attività non è utile, a meno che il riavvio del pod non sia in grado di ripristinarne lo stato di integrità.</span><span class="sxs-lookup"><span data-stu-id="cc137-262">A liveness probe doesn't help unless restarting the pod is likely to restore it to a healthy state.</span></span> <span data-ttu-id="cc137-263">È possibile usare un probe di attività per ridurre perdite di memoria o deadlock imprevisti, tuttavia non ha senso riavviare un pod che darà nuovamente errore subito dopo.</span><span class="sxs-lookup"><span data-stu-id="cc137-263">You can use a liveness probe to mitigate against memory leaks or unexpected deadlocks, but there's no point in restarting a pod that's going to immediately fail again.</span></span>

- <span data-ttu-id="cc137-264">In alcuni casi i probe di idoneità vengono usati per controllare i servizi dipendenti.</span><span class="sxs-lookup"><span data-stu-id="cc137-264">Sometimes readiness probes are used to check dependent services.</span></span> <span data-ttu-id="cc137-265">Ad esempio, se un pod è dipendente da un database, il probe di attività può controllare la connessione al database stesso.</span><span class="sxs-lookup"><span data-stu-id="cc137-265">For example, if a pod has a dependency on a database, the liveness probe might check the database connection.</span></span> <span data-ttu-id="cc137-266">Tuttavia, questo è un approccio che può creare problemi imprevisti.</span><span class="sxs-lookup"><span data-stu-id="cc137-266">However, this approach can create unexpected problems.</span></span> <span data-ttu-id="cc137-267">Per qualche motivo, un servizio esterno potrebbe essere temporaneamente non disponibile.</span><span class="sxs-lookup"><span data-stu-id="cc137-267">An external service might be temporarily unavailable for some reason.</span></span> <span data-ttu-id="cc137-268">In tal modo il probe di idoneità avrà esito negativo per tutti i pod nel servizio, causandone la rimozione dal bilanciamento del carico e, pertanto, la creazione di errori a catena upstream.</span><span class="sxs-lookup"><span data-stu-id="cc137-268">That will cause the readiness probe to fail for all the pods in your service, causing all of them to be removed from load balancing, and thus creating cascading failures upstream.</span></span> <span data-ttu-id="cc137-269">Un approccio migliore è quello di implementare la gestione dei tentativi all'interno del servizio, in modo che questi possa ripristinarsi correttamente dagli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="cc137-269">A better approach is to implement retry handling within your service, so that your service can recover correctly from transient failures.</span></span>

### <a name="resource-constraints"></a><span data-ttu-id="cc137-270">Vincoli delle risorse</span><span class="sxs-lookup"><span data-stu-id="cc137-270">Resource constraints</span></span>

<span data-ttu-id="cc137-271">I vincoli delle risorse possono influire sulla disponibilità di un servizio.</span><span class="sxs-lookup"><span data-stu-id="cc137-271">Resource contention can affect the availability of a service.</span></span> <span data-ttu-id="cc137-272">Definire i vincoli delle risorse per i contenitori, in modo che un singolo contenitore non possa superare le risorse del cluster (memoria e CPU).</span><span class="sxs-lookup"><span data-stu-id="cc137-272">Define resource constraints for containers, so that a single container cannot overwhelm the cluster resources (memory and CPU).</span></span> <span data-ttu-id="cc137-273">Per le risorse non contenitore, come thread o connessioni di rete, è consigliabile usare il [Modello a scomparti](/azure/architecture/patterns/bulkhead) per isolare le risorse.</span><span class="sxs-lookup"><span data-stu-id="cc137-273">For non-container resources, such as threads or network connections, consider using the [Bulkhead Pattern](/azure/architecture/patterns/bulkhead) to isolate resources.</span></span>

<span data-ttu-id="cc137-274">Usare le quote di risorse per limitare il numero di risorse totali consentite per uno spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="cc137-274">Use resource quotas to limit the total resources allowed for a namespace.</span></span> <span data-ttu-id="cc137-275">In questo modo, il front-end non può privare i servizi di backend per le risorse o viceversa.</span><span class="sxs-lookup"><span data-stu-id="cc137-275">That way, the front end can't starve the backend services for resources or vice-versa.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="cc137-276">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="cc137-276">Security considerations</span></span>

### <a name="role-based-access-control-rbac"></a><span data-ttu-id="cc137-277">Controllo degli accessi in base al ruolo (RBAC)</span><span class="sxs-lookup"><span data-stu-id="cc137-277">Role based access control (RBAC)</span></span>

<span data-ttu-id="cc137-278">Kubernetes e Azure dispongono di meccanismi per il controllo degli accessi in base al ruolo (RBAC):</span><span class="sxs-lookup"><span data-stu-id="cc137-278">Kubernetes and Azure both have mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="cc137-279">Azure RBAC controlla l'accesso alle risorse in Azure, inclusa la possibilità di creare nuove risorse di Azure.</span><span class="sxs-lookup"><span data-stu-id="cc137-279">Azure RBAC controls access to resources in Azure, including the ability to create new Azure resources.</span></span> <span data-ttu-id="cc137-280">Questi ruoli possono essere assegnati a utenti, gruppi o entità servizio</span><span class="sxs-lookup"><span data-stu-id="cc137-280">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="cc137-281">(un'entità servizio è un'identità di sicurezza usata dalle applicazioni).</span><span class="sxs-lookup"><span data-stu-id="cc137-281">(A service principal is a security identity used by applications.)</span></span>

- <span data-ttu-id="cc137-282">I controlli degli accessi in base al ruolo di Kubernetes consentoni di controllare le autorizzazioni per l'API di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-282">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="cc137-283">Ad esempio, la creazione e inserzione dei pod sono azioni che possono essere autorizzate (o negate) a un utente tramite controlli degli accessi in base al ruolo.</span><span class="sxs-lookup"><span data-stu-id="cc137-283">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="cc137-284">Per assegnare le autorizzazioni di Kubernetes agli utenti, creare *ruoli* e *associazioni di ruolo*:</span><span class="sxs-lookup"><span data-stu-id="cc137-284">To assign Kubernetes permissions to users, you create *roles* and *role bindings*:</span></span>

  - <span data-ttu-id="cc137-285">Un ruolo è un set di autorizzazioni che si applica all'interno di uno spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="cc137-285">A Role is a set of permissions that apply within a namespace.</span></span> <span data-ttu-id="cc137-286">Le autorizzazioni sono definite come verbi (ottenere, aggiornare, creare ed eliminare) sulle risorse (pod, distribuzioni e così via).</span><span class="sxs-lookup"><span data-stu-id="cc137-286">Permissions are defined as verbs (get, update, create, delete) on resources (pods, deployments, etc.).</span></span>

  - <span data-ttu-id="cc137-287">Un RoleBinding assegna gli utenti o i gruppi a un ruolo.</span><span class="sxs-lookup"><span data-stu-id="cc137-287">A RoleBinding assigns users or groups to a Role.</span></span>

  - <span data-ttu-id="cc137-288">È inoltre disponibile un oggetto ClusterRole, che è simile a un ruolo, ma si applica all'intero cluster, tra tutti gli spazi dei nomi.</span><span class="sxs-lookup"><span data-stu-id="cc137-288">There is also a ClusterRole object, which is like a Role but applies to the entire cluster, across all namespaces.</span></span> <span data-ttu-id="cc137-289">Per assegnare utenti o gruppi a un ClusterRole, creare un ClusterRoleBinding.</span><span class="sxs-lookup"><span data-stu-id="cc137-289">To assign users or groups to a ClusterRole, create a ClusterRoleBinding.</span></span>

<span data-ttu-id="cc137-290">Il servizio Azure Kubernetes integra questi due meccanismi RBAC.</span><span class="sxs-lookup"><span data-stu-id="cc137-290">AKS integrates these two RBAC mechanisms.</span></span> <span data-ttu-id="cc137-291">Quando si crea un cluster del servizio Azure Kubernetes, è possibile configurarlo in modo da usare Azure AD per l'autenticazione utente.</span><span class="sxs-lookup"><span data-stu-id="cc137-291">When you create an AKS cluster, you can configure it to use Azure AD for user authentication.</span></span> <span data-ttu-id="cc137-292">Per informazioni dettagliate su questa configurazione, vedere [Integrare Azure Active Directory con il servizio Azure Kubernetes](/azure/aks/aad-integration).</span><span class="sxs-lookup"><span data-stu-id="cc137-292">For details on how to set this up, see [Integrate Azure Active Directory with Azure Kubernetes Service](/azure/aks/aad-integration).</span></span>

<span data-ttu-id="cc137-293">Dopo la configurazione, un utente che desidera accedere all'API di Kubernetes (ad esempio, tramite kubectl) dovrà accedere usando le proprie credenziali Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cc137-293">Once this is configured, a user who wants to access the Kubernetes API (for example, through kubectl) must sign in using their Azure AD credentials.</span></span>

<span data-ttu-id="cc137-294">Per impostazione predefinita, un utente Azure AD non ha accesso al cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-294">By default, an Azure AD user has no access to the cluster.</span></span> <span data-ttu-id="cc137-295">Per concedere l'accesso, l'amministratore del cluster crea RoleBindings che fanno riferimento a gruppi o utenti Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cc137-295">To grant access, the cluster administrator creates RoleBindings that refer to Azure AD users or groups.</span></span> <span data-ttu-id="cc137-296">Se un utente non dispone delle autorizzazioni per una determinata operazione, questa avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="cc137-296">If a user doesn't have permissions for a particular operation, it will fail.</span></span>

<span data-ttu-id="cc137-297">Se gli utenti non hanno accesso per impostazione predefinita, come fa l'amministratore del cluster ad avere il permesso di creare le associazioni di ruolo in primo luogo?</span><span class="sxs-lookup"><span data-stu-id="cc137-297">If users have no access by default, how does the cluster admin have permission to create the role bindings in the first place?</span></span> <span data-ttu-id="cc137-298">Un cluster del servizio Azure Kubernetes include effettivamente due tipi di credenziali per la chiamata al server API di Kubernetes: utente del cluster e amministratore del cluster. Le credenziali di amministratore del cluster concedono accesso completo a quest'ultimo.</span><span class="sxs-lookup"><span data-stu-id="cc137-298">An AKS cluster actually has two types of credentials for calling the Kubernetes API server: cluster user and cluster admin. The cluster admin credentials grant full access to the cluster.</span></span> <span data-ttu-id="cc137-299">Il comando dell'interfaccia della riga di comando di Azure `az aks get-credentials --admin` scarica le credenziali di amministratore cluster e li salva nel file kubeconfig.</span><span class="sxs-lookup"><span data-stu-id="cc137-299">The Azure CLI command `az aks get-credentials --admin` downloads the cluster admin credentials and saves them into your kubeconfig file.</span></span> <span data-ttu-id="cc137-300">L'amministratore del cluster può usare questo file kubeconfig per creare i ruoli e le associazioni di ruolo.</span><span class="sxs-lookup"><span data-stu-id="cc137-300">The cluster administrator can use this kubeconfig to create roles and role bindings.</span></span>

<span data-ttu-id="cc137-301">Poiché le credenziali di amministratore del cluster sono così avanzate, usare il controllo degli accessi in base al ruolo di Azure per limitare l'accesso ad essi:</span><span class="sxs-lookup"><span data-stu-id="cc137-301">Because the cluster admin credentials are so powerful, use Azure RBAC to restrict access to them:</span></span>

- <span data-ttu-id="cc137-302">Il "ruolo Admin del cluster servizio Azure Kubernetes" dispone dell'autorizzazione per scaricare le credenziali di amministratore cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-302">The "Azure Kubernetes Service Cluster Admin Role" has permission to download the cluster admin credentials.</span></span> <span data-ttu-id="cc137-303">Solo gli amministratori del cluster devono essere assegnati a questo ruolo.</span><span class="sxs-lookup"><span data-stu-id="cc137-303">Only cluster administrators should be assigned to this role.</span></span>

- <span data-ttu-id="cc137-304">Il "ruolo Utente del cluster Servizio Azure Kubernetes" dispone dell'autorizzazione per scaricare le credenziali di utente cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-304">The "Azure Kubernetes Service Cluster User Role" has permission to download the cluster user credentials.</span></span> <span data-ttu-id="cc137-305">Gli utenti senza privilegi di amministratore possono essere assegnati a questo ruolo.</span><span class="sxs-lookup"><span data-stu-id="cc137-305">Non-admin users can be assigned to this role.</span></span> <span data-ttu-id="cc137-306">Questo ruolo non concede alcuna autorizzazione particolare sulle risorse all'interno del cluster di Kubernetes &mdash; consente solo ad un utente di connettersi al server API.</span><span class="sxs-lookup"><span data-stu-id="cc137-306">This role does not give any particular permissions on Kubernetes resources inside the cluster &mdash; it just allows a user to connect to the API server.</span></span> 

<span data-ttu-id="cc137-307">Quando si definiscono i criteri di controllo degli accessi in base al ruolo (Kubernetes e Azure), considerare i ruoli all'interno della propria organizzazione:</span><span class="sxs-lookup"><span data-stu-id="cc137-307">When you define your RBAC policies (both Kubernetes and Azure), think about the roles in your organization:</span></span>

- <span data-ttu-id="cc137-308">Chi può creare o eliminare un cluster del servizio Azure Kubernetes e scaricare le credenziali amministratore?</span><span class="sxs-lookup"><span data-stu-id="cc137-308">Who can create or delete an AKS cluster and download the admin credentials?</span></span>
- <span data-ttu-id="cc137-309">Chi ha l'autorizzazione ad amministrare un cluster?</span><span class="sxs-lookup"><span data-stu-id="cc137-309">Who can administer a cluster?</span></span>
- <span data-ttu-id="cc137-310">Chi può creare o aggiornare le risorse all'interno di uno spazio dei nomi?</span><span class="sxs-lookup"><span data-stu-id="cc137-310">Who can create or update resources within a namespace?</span></span>

<span data-ttu-id="cc137-311">È buona norma esaminare i permessi del controllo degli accessi in base al ruolo di Kubernetes tramite spazio dei nomi, usando ruoli e RoleBindings, anziché ClusterRoles e ClusterRoleBindings.</span><span class="sxs-lookup"><span data-stu-id="cc137-311">It's a good practice to scope Kubernetes RBAC permissions by namespace, using Roles and RoleBindings, rather than ClusterRoles and ClusterRoleBindings.</span></span>

<span data-ttu-id="cc137-312">Infine, è naturale chiedersi di quali autorizzazioni abbia a disposizione il servizio Azure Kubernetes per creare e gestire le risorse di Azure, ad esempio i servizi di bilanciamento del carico, rete o archiviazione.</span><span class="sxs-lookup"><span data-stu-id="cc137-312">Finally, there is the question of what permissions the AKS cluster has to create and manage Azure resources, such as load balancers, networking, or storage.</span></span> <span data-ttu-id="cc137-313">Per l'autenticazione con le API di Azure, il cluster usa un'entità servizio di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cc137-313">To authenticate itself with Azure APIs, the cluster uses an Azure AD service principal.</span></span> <span data-ttu-id="cc137-314">Se non si specifica un'entità servizio quando si crea il cluster, ne viene creato uno automaticamente.</span><span class="sxs-lookup"><span data-stu-id="cc137-314">If you don't specify a service principal when you create the cluster, one is created automatically.</span></span> <span data-ttu-id="cc137-315">Tuttavia è buona norma creare innanzitutto l'entità servizio, a cui assegnare le autorizzazioni minime per il controllo degli accessi in base al ruolo.</span><span class="sxs-lookup"><span data-stu-id="cc137-315">However, it's a good security practice to create the service principal first and assign the minimal RBAC permissions to it.</span></span> <span data-ttu-id="cc137-316">Per altre informazioni, vedere [Entità servizio con il servizio Azure Kubernetes](/azure/aks/kubernetes-service-principal).</span><span class="sxs-lookup"><span data-stu-id="cc137-316">For more information, see [Service principals with Azure Kubernetes Service](/azure/aks/kubernetes-service-principal).</span></span>

### <a name="secrets-management-and-application-credentials"></a><span data-ttu-id="cc137-317">Gestione dei segreti e credenziali dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="cc137-317">Secrets management and application credentials</span></span>

<span data-ttu-id="cc137-318">Le applicazioni e i servizi spesso necessitano di credenziali che consentono loro di connettersi ai servizi esterni, ad esempio archiviazione di Azure o Database SQL.</span><span class="sxs-lookup"><span data-stu-id="cc137-318">Applications and services often need credentials that allow them to connect to external services such as Azure Storage or SQL Database.</span></span> <span data-ttu-id="cc137-319">La sfida consiste nel proteggere queste credenziali e far sì che non vengano perse.</span><span class="sxs-lookup"><span data-stu-id="cc137-319">The challenge is to keep these credentials safe and not leak them.</span></span> 

<span data-ttu-id="cc137-320">Per le risorse di Azure, una possibilità è quella di usare le identità gestite.</span><span class="sxs-lookup"><span data-stu-id="cc137-320">For Azure resources, one option is to use managed identities.</span></span> <span data-ttu-id="cc137-321">L'idea di un'identità gestita è che un'applicazione o un servizio abbia un'identità archiviata in Azure AD e che usi questa identità per l'autenticazione con un servizio di Azure.</span><span class="sxs-lookup"><span data-stu-id="cc137-321">The idea of a managed identity is that an application or service has an identity stored in Azure AD, and uses this identity to authenticate with an Azure service.</span></span> <span data-ttu-id="cc137-322">L'applicazione o il servizio dispone di un'entità servizio creata in Azure AD e viene autenticato mediante i token OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="cc137-322">The application or service has a Service Principal created for it in Azure AD, and authenticates using OAuth 2.0 tokens.</span></span> <span data-ttu-id="cc137-323">Il processo in esecuzione chiama un indirizzo localhost per ottenere il token.</span><span class="sxs-lookup"><span data-stu-id="cc137-323">The executing process calls a localhost address to get the token.</span></span> <span data-ttu-id="cc137-324">In questo modo, non è necessario archiviare le password o le stringhe di connessione.</span><span class="sxs-lookup"><span data-stu-id="cc137-324">That way, you don't need to store any passwords or connection strings.</span></span> <span data-ttu-id="cc137-325">È possibile usare le identità gestite nel servizio Azure Kubernetes tramite l'assegnazione di identità ai singoli pod, usando il progetto [aad-pod-identity](https://github.com/Azure/aad-pod-identity).</span><span class="sxs-lookup"><span data-stu-id="cc137-325">You can use managed identities in AKS by assigning identities to individual pods, using the [aad-pod-identity](https://github.com/Azure/aad-pod-identity) project.</span></span>

<span data-ttu-id="cc137-326">Attualmente, non tutti i servizi di Azure supportano l'autenticazione con identità gestite.</span><span class="sxs-lookup"><span data-stu-id="cc137-326">Currently, not all Azure services support authentication using managed identities.</span></span> <span data-ttu-id="cc137-327">Per un elenco completo, vedere [Servizi di Azure che supportano l'autenticazione di Azure AD](/azure/active-directory/managed-identities-azure-resources/services-support-msi).</span><span class="sxs-lookup"><span data-stu-id="cc137-327">For a list, see [Azure services that support Azure AD authentication](/azure/active-directory/managed-identities-azure-resources/services-support-msi).</span></span>

<span data-ttu-id="cc137-328">Anche con le identità gestite, sarà probabilmente necessario memorizzare alcune credenziali o altri segreti dell'applicazione, ad esempio per servizi di Azure che non supportano l'identità gestite, servizi di terze parti, le chiavi API e così via.</span><span class="sxs-lookup"><span data-stu-id="cc137-328">Even with managed identities, you'll probably need to store some credentials or other application secrets, whether for Azure services that don't support managed identities, third-party services, API keys, and so on.</span></span> <span data-ttu-id="cc137-329">Ecco alcune opzioni per l'archiviazione sicura di segreti:</span><span class="sxs-lookup"><span data-stu-id="cc137-329">Here are some options for storing secrets securely:</span></span>

- <span data-ttu-id="cc137-330">Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="cc137-330">Azure Key Vault.</span></span> <span data-ttu-id="cc137-331">Nel servizio Azure Kubernetes, è possibile montare uno o più segreti da Key Vault come volume.</span><span class="sxs-lookup"><span data-stu-id="cc137-331">In AKS, you can mount one or more secrets from Key Vault as a volume.</span></span> <span data-ttu-id="cc137-332">Il volume legge i segreti da Key Vault.</span><span class="sxs-lookup"><span data-stu-id="cc137-332">The volume reads the secrets from Key Vault.</span></span> <span data-ttu-id="cc137-333">Il pod può quindi leggere i segreti come un volume normale.</span><span class="sxs-lookup"><span data-stu-id="cc137-333">The pod can then read the secrets just like a regular volume.</span></span> <span data-ttu-id="cc137-334">Per altre informazioni, vedere il progetto [Kubernetes-KeyVault-FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol) su GitHub.</span><span class="sxs-lookup"><span data-stu-id="cc137-334">For more information, see the [Kubernetes-KeyVault-FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol) project on GitHub.</span></span>

    <span data-ttu-id="cc137-335">Il pod esegue l'autenticazione usando un'identità di pod (descritta in precedenza) oppure un'entità servizio Azure AD insieme a un segreto client.</span><span class="sxs-lookup"><span data-stu-id="cc137-335">The pod authenticates itself by using either a pod identity (described above) or by using an Azure AD Service Principal along with a client secret.</span></span> <span data-ttu-id="cc137-336">È consigliabile usare le identità di pod poiché il segreto client non è necessario in questo caso.</span><span class="sxs-lookup"><span data-stu-id="cc137-336">Using pod identities is recommended because the client secret isn't needed in that case.</span></span> 

- <span data-ttu-id="cc137-337">Insieme di credenziali HashiCorp.</span><span class="sxs-lookup"><span data-stu-id="cc137-337">HashiCorp Vault.</span></span> <span data-ttu-id="cc137-338">Le applicazioni Kubernetes possono eseguire l'autenticazione con l'insieme di credenziali HashiCorp usando le identità di Azure AD.</span><span class="sxs-lookup"><span data-stu-id="cc137-338">Kubernetes applications can authenticate with HashiCorp Vault using Azure AD managed identities.</span></span> <span data-ttu-id="cc137-339">Vedere [Insieme di credenziali di HashiCorp comunicano con Azure Active Directory](https://open.microsoft.com/2018/04/10/scaling-tips-hashicorp-vault-azure-active-directory/).</span><span class="sxs-lookup"><span data-stu-id="cc137-339">See [HashiCorp Vault speaks Azure Active Directory](https://open.microsoft.com/2018/04/10/scaling-tips-hashicorp-vault-azure-active-directory/).</span></span> <span data-ttu-id="cc137-340">È possibile distribuire l'insieme di credenziali a Kubernetes, ma è consigliabile eseguirlo in un cluster dedicato, separato dal cluster dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="cc137-340">You can deploy Vault itself to Kubernetes, but it's recommend to run it in a separate dedicated cluster from your application cluster.</span></span> 

- <span data-ttu-id="cc137-341">Segreti di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-341">Kubernetes secrets.</span></span> <span data-ttu-id="cc137-342">Un'altra opzione consiste semplicemente nell'usare segreti Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="cc137-342">Another option is simply to use Kubernetes secrets.</span></span> <span data-ttu-id="cc137-343">Questa opzione è più semplice da configurare ma presenta alcuni problemi.</span><span class="sxs-lookup"><span data-stu-id="cc137-343">This option is the easiest to configure but has some challenges.</span></span> <span data-ttu-id="cc137-344">I segreti vengono archiviati in etcd, ovvero un archivio chiave-valore.</span><span class="sxs-lookup"><span data-stu-id="cc137-344">Secrets are stored in etcd, which is a distributed key-value store.</span></span> <span data-ttu-id="cc137-345">Il servizio Azure Kubernetes [crittografa etcd inattivi](https://github.com/Azure/kubernetes-kms#azure-kubernetes-service-aks).</span><span class="sxs-lookup"><span data-stu-id="cc137-345">AKS [encrypts etcd at rest](https://github.com/Azure/kubernetes-kms#azure-kubernetes-service-aks).</span></span> <span data-ttu-id="cc137-346">Le chiavi di crittografia sono gestite da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="cc137-346">Microsoft manages the encryption keys.</span></span>

<span data-ttu-id="cc137-347">Usare un sistema come HashiCorp Vault o Azure Key Vault offre diversi vantaggi, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="cc137-347">Using a system like HashiCorp Vault or Azure Key Vault provides several advantages, such as:</span></span>

- <span data-ttu-id="cc137-348">Controllo centralizzato dei segreti.</span><span class="sxs-lookup"><span data-stu-id="cc137-348">Centralized control of secrets.</span></span>
- <span data-ttu-id="cc137-349">Verifica che tutti i segreti vengano crittografati quando inattivi.</span><span class="sxs-lookup"><span data-stu-id="cc137-349">Ensuring that all secrets are encrypted at rest.</span></span>
- <span data-ttu-id="cc137-350">Gestione centralizzata delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="cc137-350">Centralized key management.</span></span>
- <span data-ttu-id="cc137-351">Controllo dell'accesso dei segreti.</span><span class="sxs-lookup"><span data-stu-id="cc137-351">Access control of secrets.</span></span>
- <span data-ttu-id="cc137-352">Controllo</span><span class="sxs-lookup"><span data-stu-id="cc137-352">Auditing</span></span>

### <a name="pod-and-container-security"></a><span data-ttu-id="cc137-353">Pod e sicurezza del contenitore</span><span class="sxs-lookup"><span data-stu-id="cc137-353">Pod and container security</span></span>

<span data-ttu-id="cc137-354">Di seguito un elenco non esaustivo di alcune procedure consigliate per proteggere i pod e i contenitori:</span><span class="sxs-lookup"><span data-stu-id="cc137-354">This list is certainly not exhaustive, but here are some recommended practices for securing your pods and containers:</span></span> 

<span data-ttu-id="cc137-355">Non eseguire i contenitori in modalità privilegiata.</span><span class="sxs-lookup"><span data-stu-id="cc137-355">Don't run containers in privileged mode.</span></span> <span data-ttu-id="cc137-356">La modalità privilegiata fornisce a un contenitore l'accesso a tutti i dispositivi nell'host.</span><span class="sxs-lookup"><span data-stu-id="cc137-356">Privileged mode gives a container access to all devices on the host.</span></span> <span data-ttu-id="cc137-357">È possibile impostare criteri di sicurezza pod per non consentire ai contenitori l'esecuzione in modalità privilegiata.</span><span class="sxs-lookup"><span data-stu-id="cc137-357">You can set Pod Security Policy to disallow containers from running in privileged mode.</span></span> 

<span data-ttu-id="cc137-358">Quando possibile, evitare di eseguire i processi come radice all'interno di contenitori.</span><span class="sxs-lookup"><span data-stu-id="cc137-358">When possible, avoid running processes as root inside containers.</span></span> <span data-ttu-id="cc137-359">I contenitori non forniscono isolamento completo dal punto di vista della sicurezza, di conseguenza è preferibile eseguire un processo del contenitore come utente senza privilegi.</span><span class="sxs-lookup"><span data-stu-id="cc137-359">Containers do not provide complete isolation from a security standpoint, so it's better to run a container process as a non-privileged user.</span></span> 

<span data-ttu-id="cc137-360">Archiviare immagini in un registro privato attendibile, ad esempio in Registro Azure Container o nel Registro Docker Trusted.</span><span class="sxs-lookup"><span data-stu-id="cc137-360">Store images in a trusted private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="cc137-361">Usare un webhook di ammissione e di convalida in Kubernetes per garantire che i pod possano eseguire il pull delle immagini solamente dal registro di sistema attendibile.</span><span class="sxs-lookup"><span data-stu-id="cc137-361">Use a validating admission webhook in Kubernetes to ensure that pods can only pull images from the trusted registry.</span></span>

<span data-ttu-id="cc137-362">Analizzare le immagini per le vulnerabilità note usando una soluzione di analisi, ad esempio Twistlock e Aqua, disponibili su Azure Marketplace.</span><span class="sxs-lookup"><span data-stu-id="cc137-362">Scan images for known vulnerabilities, using a scanning solution such as Twistlock and Aqua, which are available through the Azure Marketplace.</span></span>

<span data-ttu-id="cc137-363">Automatizzare l'applicazione di patch all'immagine usando le attività di Registro Azure Container, una funzionalità di Registro Azure Container.</span><span class="sxs-lookup"><span data-stu-id="cc137-363">Automate image patching using ACR Tasks, a feature of Azure Container Registry.</span></span> <span data-ttu-id="cc137-364">Un'immagine del contenitore viene costruita a partire da livelli.</span><span class="sxs-lookup"><span data-stu-id="cc137-364">A container image is built up from layers.</span></span> <span data-ttu-id="cc137-365">I livelli di base includono l'immagine del sistema operativo e le immagini di framework dell'applicazione, ad esempio ASP.NET Core o Node. js.</span><span class="sxs-lookup"><span data-stu-id="cc137-365">The base layers include the OS image and application framework images, such as ASP.NET Core or Node.js.</span></span> <span data-ttu-id="cc137-366">Le immagini di base vengono in genere create upstream dagli sviluppatori delle applicazioni e gestite da altri gestori di progetti.</span><span class="sxs-lookup"><span data-stu-id="cc137-366">The base images are typically created upstream from the application developers, and are maintained by other project maintainers.</span></span> <span data-ttu-id="cc137-367">Quando a queste immagini vengono applicate patch upstream, è importante aggiornare, testare e ridistribuire le proprie immagini, in modo da non lasciare alcuna vulnerabilità di sicurezza nota.</span><span class="sxs-lookup"><span data-stu-id="cc137-367">When these images are patched upstream, it's important to update, test, and redeploy your own images, so that you don't leave any known security vulnerabilities.</span></span> <span data-ttu-id="cc137-368">Le Attività del Registro Azure Container sono in grado di automatizzare questo processo.</span><span class="sxs-lookup"><span data-stu-id="cc137-368">ACR Tasks can help to automate this process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="cc137-369">Considerazioni sulla distribuzione (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="cc137-369">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="cc137-370">Di seguito alcuni obiettivi relativi a un processo di CI/CD affidabile per un'architettura di microservizi:</span><span class="sxs-lookup"><span data-stu-id="cc137-370">Here are some goals of a robust CI/CD process for a microservices architecture:</span></span>

- <span data-ttu-id="cc137-371">Ogni team può creare e distribuire i servizi di sua proprietà in modo indipendente, senza influenzare o interrompere gli altri team.</span><span class="sxs-lookup"><span data-stu-id="cc137-371">Each team can build and deploy the services that it owns independently, without affecting or disrupting other teams.</span></span>

- <span data-ttu-id="cc137-372">Prima che una nuova versione di un servizio venga distribuita all'ambiente di produzione, viene distribuita agli ambienti di sviluppo/test/controllo qualità per la convalida.</span><span class="sxs-lookup"><span data-stu-id="cc137-372">Before a new version of a service is deployed to production, it gets deployed to dev/test/QA environments for validation.</span></span> <span data-ttu-id="cc137-373">I controlli di qualità vengono applicati in ogni fase.</span><span class="sxs-lookup"><span data-stu-id="cc137-373">Quality gates are enforced at each stage.</span></span>

- <span data-ttu-id="cc137-374">Una nuova versione di un servizio può essere distribuita side-by-side con la versione precedente.</span><span class="sxs-lookup"><span data-stu-id="cc137-374">A new version of a service can be deployed side-by-side with the previous version.</span></span>

- <span data-ttu-id="cc137-375">Vengono applicati sufficienti criteri di controllo di accesso.</span><span class="sxs-lookup"><span data-stu-id="cc137-375">Sufficient access control policies are in place.</span></span>

- <span data-ttu-id="cc137-376">Si possono considerare attendibili le immagini del contenitore che vengono distribuite all'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="cc137-376">You can trust the container images that are deployed to production.</span></span>

### <a name="isolation-of-environments"></a><span data-ttu-id="cc137-377">Isolamento degli ambienti</span><span class="sxs-lookup"><span data-stu-id="cc137-377">Isolation of environments</span></span>

<span data-ttu-id="cc137-378">Si avranno più ambienti in cui si distribuiscono servizi, inclusi gli ambienti: per lo sviluppo, per lo smoke test, per il test di integrazione, per il test di carico e infine per la produzione.</span><span class="sxs-lookup"><span data-stu-id="cc137-378">You will have multiple environments where you deploy services, including environments for development, smoke testing, integration testing, load testing, and finally production.</span></span> <span data-ttu-id="cc137-379">Per questi ambienti è necessario un certo livello di isolamento.</span><span class="sxs-lookup"><span data-stu-id="cc137-379">These environments need some level of isolation.</span></span> <span data-ttu-id="cc137-380">In Kubernetes, è possibile scegliere tra isolamento fisico e isolamento logico.</span><span class="sxs-lookup"><span data-stu-id="cc137-380">In Kubernetes, you have a choice between physical isolation and logical isolation.</span></span> <span data-ttu-id="cc137-381">Per isolamento fisico si intende la distribuzione atta a separare i cluster.</span><span class="sxs-lookup"><span data-stu-id="cc137-381">Physical isolation means deploying to separate clusters.</span></span> <span data-ttu-id="cc137-382">L'isolamento logico usa spazi dei nomi e criteri, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="cc137-382">Logical isolation makes use of namespaces and policies, as described earlier.</span></span>

<span data-ttu-id="cc137-383">Si consiglia di creare un cluster di produzione dedicato insieme a un cluster separato per gli ambienti di sviluppo/prova.</span><span class="sxs-lookup"><span data-stu-id="cc137-383">Our recommendation is to create a dedicated production cluster along with a separate cluster for your dev/test environments.</span></span> <span data-ttu-id="cc137-384">Usare l'isolamento logico per separare gli ambienti all'interno del cluster di sviluppo/prova.</span><span class="sxs-lookup"><span data-stu-id="cc137-384">Use logical isolation to separate environments within the dev/test cluster.</span></span> <span data-ttu-id="cc137-385">I servizi distribuiti nel cluster di sviluppo/prova non avranno accesso agli archivi dati che contengono dati aziendali.</span><span class="sxs-lookup"><span data-stu-id="cc137-385">Services deployed to the dev/test cluster should never have access to data stores that hold business data.</span></span> 

### <a name="helm"></a><span data-ttu-id="cc137-386">Helm</span><span class="sxs-lookup"><span data-stu-id="cc137-386">Helm</span></span>

<span data-ttu-id="cc137-387">È consigliabile usare Helm per gestire la compilazione e distribuzione di servizi.</span><span class="sxs-lookup"><span data-stu-id="cc137-387">Consider using Helm to manage building and deploying services.</span></span> <span data-ttu-id="cc137-388">Di seguito alcune delle funzionalità di Helm che costituiscono una guida a CI/CD:</span><span class="sxs-lookup"><span data-stu-id="cc137-388">Some of the features of Helm that help with CI/CD include:</span></span>

- <span data-ttu-id="cc137-389">Organizzazione di tutti gli oggetti Kubernetes per un determinato microservizio in un singolo grafico Helm.</span><span class="sxs-lookup"><span data-stu-id="cc137-389">Organizing all of the Kubernetes objects for a particular microservice into a single Helm chart.</span></span>
- <span data-ttu-id="cc137-390">Distribuzione del grafico come un comando di Helm singolo, invece di una serie di comandi di kubectl.</span><span class="sxs-lookup"><span data-stu-id="cc137-390">Deploying the chart as a single helm command, rather than a series of kubectl commands.</span></span>
- <span data-ttu-id="cc137-391">Rilevamento aggiornamenti e revisioni, con controllo delle versioni semantico, nonché la possibilità di eseguire il rollback a una versione precedente.</span><span class="sxs-lookup"><span data-stu-id="cc137-391">Tracking updates and revisions, using semantic versioning, along with the ability to roll back to a previous version.</span></span>
- <span data-ttu-id="cc137-392">Uso dei modelli per evitare la duplicazione delle informazioni, ad esempio etichette e i selettori, attraverso più file.</span><span class="sxs-lookup"><span data-stu-id="cc137-392">The use of templates to avoid duplicating information, such as labels and selectors, across many files.</span></span>
- <span data-ttu-id="cc137-393">Gestione delle dipendenze tra grafici.</span><span class="sxs-lookup"><span data-stu-id="cc137-393">Managing dependencies between charts.</span></span>
- <span data-ttu-id="cc137-394">Pubblicazione di grafici in un repository Helm, ad esempio il Registro Azure Container, e integrazione con la pipeline di compilazione.</span><span class="sxs-lookup"><span data-stu-id="cc137-394">Publishing charts to a Helm repository, such as Azure Container Registry, and integrating them with the build pipeline.</span></span>

<span data-ttu-id="cc137-395">Per altre informazioni sull'uso del Registro Container come repository Helm, vedere [Usare il Registro Azure Container come repository Helm per i grafici di applicazione](/azure/container-registry/container-registry-helm-repos).</span><span class="sxs-lookup"><span data-stu-id="cc137-395">For more information about using Container Registry as a Helm repository, see [Use Azure Container Registry as a Helm repository for your application charts](/azure/container-registry/container-registry-helm-repos).</span></span>

### <a name="cicd-workflow"></a><span data-ttu-id="cc137-396">Flusso di lavoro CI/CD</span><span class="sxs-lookup"><span data-stu-id="cc137-396">CI/CD workflow</span></span>

<span data-ttu-id="cc137-397">Prima di creare un flusso di lavoro CI/CD, è necessario sapere come verrà strutturata e gestita la base di codice.</span><span class="sxs-lookup"><span data-stu-id="cc137-397">Before creating a CI/CD workflow, you must know how the code base will be structured and managed.</span></span>

- <span data-ttu-id="cc137-398">I team lavorano in repository separati o in un singolo repository?</span><span class="sxs-lookup"><span data-stu-id="cc137-398">Do teams work in separate respositories or in a monorepo (single respository)?</span></span>
- <span data-ttu-id="cc137-399">Qual è la strategia per la creazione dei rami?</span><span class="sxs-lookup"><span data-stu-id="cc137-399">What is your branching strategy?</span></span>
- <span data-ttu-id="cc137-400">Chi può eseguire il push del codice nell'ambiente di produzione?</span><span class="sxs-lookup"><span data-stu-id="cc137-400">Who can push code to production?</span></span> <span data-ttu-id="cc137-401">Esiste un ruolo di responsabile del rilascio?</span><span class="sxs-lookup"><span data-stu-id="cc137-401">Is there a release manager role?</span></span>

<span data-ttu-id="cc137-402">L'approccio con singolo repository sta diventando popolare, ma esistono vantaggi e svantaggi per entrambi.</span><span class="sxs-lookup"><span data-stu-id="cc137-402">The monorepo approach has been gaining favor but there are advantages and disadvantages to both.</span></span>

| &nbsp; | <span data-ttu-id="cc137-403">Singolo repository</span><span class="sxs-lookup"><span data-stu-id="cc137-403">Monorepo</span></span> | <span data-ttu-id="cc137-404">Più repository</span><span class="sxs-lookup"><span data-stu-id="cc137-404">Multiple repos</span></span> |
|--------|----------|----------------|
| <span data-ttu-id="cc137-405">**Vantaggi**</span><span class="sxs-lookup"><span data-stu-id="cc137-405">**Advantages**</span></span> | <span data-ttu-id="cc137-406">Condivisione del codice</span><span class="sxs-lookup"><span data-stu-id="cc137-406">Code sharing</span></span><br/><span data-ttu-id="cc137-407">Più facile standardizzare codice e strumenti</span><span class="sxs-lookup"><span data-stu-id="cc137-407">Easier to standardize code and tooling</span></span><br/><span data-ttu-id="cc137-408">Più semplice effettuare il refactoring del codice</span><span class="sxs-lookup"><span data-stu-id="cc137-408">Easier to refactor code</span></span><br/><span data-ttu-id="cc137-409">Individuabilità - singola visualizzazione del codice</span><span class="sxs-lookup"><span data-stu-id="cc137-409">Discoverability - single view of the code</span></span><br/> | <span data-ttu-id="cc137-410">Proprietà chiara per ogni team</span><span class="sxs-lookup"><span data-stu-id="cc137-410">Clear ownership per team</span></span><br/><span data-ttu-id="cc137-411">Potenzialmente meno conflitti di merge</span><span class="sxs-lookup"><span data-stu-id="cc137-411">Potentially fewer merge conflicts</span></span><br/><span data-ttu-id="cc137-412">Favorire la separazione dei microservizi</span><span class="sxs-lookup"><span data-stu-id="cc137-412">Helps to enforce decoupling of microservices</span></span> |
| <span data-ttu-id="cc137-413">**Problematiche**</span><span class="sxs-lookup"><span data-stu-id="cc137-413">**Challenges**</span></span> | <span data-ttu-id="cc137-414">Le modifiche al codice condiviso possono influire su più microservizi</span><span class="sxs-lookup"><span data-stu-id="cc137-414">Changes to shared code can affect multiple microservices</span></span><br/><span data-ttu-id="cc137-415">Maggiore rischio di conflitti di merge</span><span class="sxs-lookup"><span data-stu-id="cc137-415">Greater potential for merge conflicts</span></span><br/><span data-ttu-id="cc137-416">Gli strumenti devono supportare una base di codice di grandi dimensioni</span><span class="sxs-lookup"><span data-stu-id="cc137-416">Tooling must scale to a large code base</span></span><br/><span data-ttu-id="cc137-417">Controllo di accesso</span><span class="sxs-lookup"><span data-stu-id="cc137-417">Access control</span></span><br/><span data-ttu-id="cc137-418">Processo di distribuzione più complesso</span><span class="sxs-lookup"><span data-stu-id="cc137-418">More complex deployment process</span></span> | <span data-ttu-id="cc137-419">Più difficile la condivisione del codice</span><span class="sxs-lookup"><span data-stu-id="cc137-419">Harder to share code</span></span><br/><span data-ttu-id="cc137-420">Più difficile applicare standard di codifica</span><span class="sxs-lookup"><span data-stu-id="cc137-420">Harder to enforce coding standards</span></span><br/><span data-ttu-id="cc137-421">Gestione delle dipendenze</span><span class="sxs-lookup"><span data-stu-id="cc137-421">Dependency management</span></span><br/><span data-ttu-id="cc137-422">Base di codice diffusa, scarsa individuabilità</span><span class="sxs-lookup"><span data-stu-id="cc137-422">Diffuse code base, poor discoverability</span></span><br/><span data-ttu-id="cc137-423">Mancanza di un'infrastruttura condivisa</span><span class="sxs-lookup"><span data-stu-id="cc137-423">Lack of shared infrastructure</span></span>

<span data-ttu-id="cc137-424">In questa sezione viene presentato un possibile flusso di lavoro CI/CD basato sui presupposti seguenti:</span><span class="sxs-lookup"><span data-stu-id="cc137-424">In this section, we present a possible CI/CD workflow, based on the following assumptions:</span></span>

- <span data-ttu-id="cc137-425">Il repository del codice è singolo, con cartelle organizzate in base ai microservizi.</span><span class="sxs-lookup"><span data-stu-id="cc137-425">The code repository is monorepo, with folders organized by microservice.</span></span>
- <span data-ttu-id="cc137-426">La strategia di creazione dei rami del team è basata sullo [sviluppo basato su trunk](https://trunkbaseddevelopment.com/).</span><span class="sxs-lookup"><span data-stu-id="cc137-426">The team's branching strategy is based on [trunk-based development](https://trunkbaseddevelopment.com/).</span></span>
- <span data-ttu-id="cc137-427">Il team usa [Azure Pipelines](/azure/devops/pipelines) per eseguire il processo CI/CD.</span><span class="sxs-lookup"><span data-stu-id="cc137-427">The team uses [Azure Pipelines](/azure/devops/pipelines) to run the CI/CD process.</span></span>
- <span data-ttu-id="cc137-428">Il team usa [spazi dei nomi](/azure/container-registry/container-registry-best-practices#repository-namespaces) nel Registro Azure Container per isolare le immagini approvate per la produzione dalle immagini ancora in corso di test.</span><span class="sxs-lookup"><span data-stu-id="cc137-428">The team uses [namespaces](/azure/container-registry/container-registry-best-practices#repository-namespaces) in Azure Container Registry to isolate images that are approved for production from images that are still being tested.</span></span>

<span data-ttu-id="cc137-429">In questo esempio, uno sviluppatore sta lavorando a un microservizio denominato Delivery Service (Servizio di recapito).</span><span class="sxs-lookup"><span data-stu-id="cc137-429">In this example, a developer is working on a microservice called Delivery Service.</span></span> <span data-ttu-id="cc137-430">(Il nome deriva dall'implementazione di riferimento descritta [qui](../../microservices/index.md#the-drone-delivery-application).) Durante lo sviluppo di una nuova funzionalità, lo sviluppatore archivia il codice in un ramo di funzionalità.</span><span class="sxs-lookup"><span data-stu-id="cc137-430">(The name comes from the reference implementation described [here](../../microservices/index.md#the-drone-delivery-application).) While developing a new feature, the developer checks code into a feature branch.</span></span>

![Flusso di lavoro CI/CD](./_images/aks-cicd-1.png)

<span data-ttu-id="cc137-432">Il push dei commit per questo ramo attiva una compilazione CI per il microservizio.</span><span class="sxs-lookup"><span data-stu-id="cc137-432">Pushing commits to this branch tiggers a CI build for the microservice.</span></span> <span data-ttu-id="cc137-433">Per convenzione, i rami di funzionalità sono denominati `feature/*`.</span><span class="sxs-lookup"><span data-stu-id="cc137-433">By convention, feature branches are named `feature/*`.</span></span> <span data-ttu-id="cc137-434">Il [file di definizione di compilazione](/azure/devops/pipelines/yaml-schema) include un trigger che applica un filtro in base al nome del ramo e al percorso di origine.</span><span class="sxs-lookup"><span data-stu-id="cc137-434">The [build definition file](/azure/devops/pipelines/yaml-schema) includes a trigger that filters by the branch name and the source path.</span></span> <span data-ttu-id="cc137-435">Con questo approccio, ogni team può avere una propria pipeline di compilazione.</span><span class="sxs-lookup"><span data-stu-id="cc137-435">Using this approach, each team can have its own build pipeline.</span></span>

```yaml
trigger:
  batch: true
  branches:
    include:
    - master
    - feature/*

    exclude:
    - feature/experimental/*

  paths:
     include:
     - /src/shipping/delivery/
```

<span data-ttu-id="cc137-436">A questo punto nel flusso di lavoro, la compilazione CI esegue alcune verifiche minime del codice:</span><span class="sxs-lookup"><span data-stu-id="cc137-436">At this point in the workflow, the CI build runs some minimal code verification:</span></span>

1. <span data-ttu-id="cc137-437">Compilare il codice</span><span class="sxs-lookup"><span data-stu-id="cc137-437">Build code</span></span>
1. <span data-ttu-id="cc137-438">Eseguire unit test</span><span class="sxs-lookup"><span data-stu-id="cc137-438">Run unit tests</span></span>

<span data-ttu-id="cc137-439">L'obiettivo è mantenere brevi i tempi di compilazione in modo che lo sviluppatore possa ottenere un feedback rapido.</span><span class="sxs-lookup"><span data-stu-id="cc137-439">The idea here is to keep the build times short so the developer can get quick feedback.</span></span> <span data-ttu-id="cc137-440">Quando la funzionalità è pronta per il merge nel master, lo sviluppatore apre una richiesta pull.</span><span class="sxs-lookup"><span data-stu-id="cc137-440">When the feature is ready to merge into master, the developer opens a PR.</span></span> <span data-ttu-id="cc137-441">In questo modo viene attivata un'altra compilazione CI che esegue alcuni controlli aggiuntivi:</span><span class="sxs-lookup"><span data-stu-id="cc137-441">This triggers another CI build that performs some additional checks:</span></span>

1. <span data-ttu-id="cc137-442">Compilare il codice</span><span class="sxs-lookup"><span data-stu-id="cc137-442">Build code</span></span>
1. <span data-ttu-id="cc137-443">Eseguire unit test</span><span class="sxs-lookup"><span data-stu-id="cc137-443">Run unit tests</span></span>
1. <span data-ttu-id="cc137-444">Compilare l'immagine del contenitore di runtime</span><span class="sxs-lookup"><span data-stu-id="cc137-444">Build the runtime container image</span></span>
1. <span data-ttu-id="cc137-445">Eseguire analisi delle vulnerabilità sull'immagine</span><span class="sxs-lookup"><span data-stu-id="cc137-445">Run vulnerability scans on the image</span></span>

![Flusso di lavoro CI/CD](./_images/aks-cicd-2.png)

> [!NOTE]
> <span data-ttu-id="cc137-447">In Azure Repos è possibile definire [criteri](/azure/devops/repos/git/branch-policies) per proteggere i rami.</span><span class="sxs-lookup"><span data-stu-id="cc137-447">In Azure Repos, you can define [policies](/azure/devops/repos/git/branch-policies) to protect branches.</span></span> <span data-ttu-id="cc137-448">Ad esempio, i criteri potrebbero richiedere una compilazione CI riuscita oltre all'approvazione da un responsabile per poter eseguire il merge nel master.</span><span class="sxs-lookup"><span data-stu-id="cc137-448">For example, the policy could require a successful CI build plus a sign-off from an approver in order to merge into master.</span></span>

<span data-ttu-id="cc137-449">A un certo punto, il team è pronto per distribuire una nuova versione del servizio di recapito.</span><span class="sxs-lookup"><span data-stu-id="cc137-449">At some point, the team is ready to deploy a new version of the Delivery service.</span></span> <span data-ttu-id="cc137-450">A tale scopo, il responsabile del rilascio crea un ramo dal master con questo modello di denominazione: `release/<microservice name>/<semver>`.</span><span class="sxs-lookup"><span data-stu-id="cc137-450">To do so, the release manager creates a branch from master with this naming pattern: `release/<microservice name>/<semver>`.</span></span> <span data-ttu-id="cc137-451">Ad esempio: `release/delivery/v1.0.2`.</span><span class="sxs-lookup"><span data-stu-id="cc137-451">For example, `release/delivery/v1.0.2`.</span></span>
<span data-ttu-id="cc137-452">Viene così attivata una compilazione CI completa che esegue tutti i passaggi precedenti oltre a:</span><span class="sxs-lookup"><span data-stu-id="cc137-452">This triggers a full CI build that runs all the previous steps plus:</span></span>

1. <span data-ttu-id="cc137-453">Eseguire il push dell'immagine Docker nel Registro Azure Container.</span><span class="sxs-lookup"><span data-stu-id="cc137-453">Push the Docker image to Azure Container Registry.</span></span> <span data-ttu-id="cc137-454">L'immagine viene contrassegnata con il numero di versione ottenuto dal nome del ramo.</span><span class="sxs-lookup"><span data-stu-id="cc137-454">The image is tagged with the version number taken from the branch name.</span></span>
2. <span data-ttu-id="cc137-455">Eseguire `helm package` per creare un pacchetto del grafico Helm</span><span class="sxs-lookup"><span data-stu-id="cc137-455">Run `helm package` to package the Helm chart</span></span>
3. <span data-ttu-id="cc137-456">Eseguire il push del pacchetto Helm nel Registro Container eseguendo `az acr helm push`.</span><span class="sxs-lookup"><span data-stu-id="cc137-456">Push the Helm package to Container Registry by running `az acr helm push`.</span></span>

<span data-ttu-id="cc137-457">Supponendo che la compilazione abbia esito positivo, viene attivato un processo di distribuzione tramite una [pipeline di rilascio](/azure/devops/pipelines/release/what-is-release-management) di Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="cc137-457">Assuming this build succeeds, it triggers a deployment process using an Azure Pipelines [release pipeline](/azure/devops/pipelines/release/what-is-release-management).</span></span> <span data-ttu-id="cc137-458">Questa pipeline</span><span class="sxs-lookup"><span data-stu-id="cc137-458">This pipeline</span></span>

1. <span data-ttu-id="cc137-459">Eseguire `helm upgrade` per distribuire il grafico Helm in un ambiente per il controllo di qualità.</span><span class="sxs-lookup"><span data-stu-id="cc137-459">Run `helm upgrade` to deploy the Helm chart to a QA environment.</span></span>
1. <span data-ttu-id="cc137-460">Un responsabile dà l'approvazione prima che il pacchetto venga spostato nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="cc137-460">An approver signs off before the package moves to production.</span></span> <span data-ttu-id="cc137-461">Vedere [Release deployment control using approvals](/azure/devops/pipelines/release/approvals/approvals) (Controllo della distribuzione della versione tramite approvazioni).</span><span class="sxs-lookup"><span data-stu-id="cc137-461">See [Release deployment control using approvals](/azure/devops/pipelines/release/approvals/approvals).</span></span>
1. <span data-ttu-id="cc137-462">Contrassegnare di nuovo l'immagine Docker per lo spazio dei nomi di produzione nel Registro Azure Container.</span><span class="sxs-lookup"><span data-stu-id="cc137-462">Re-tag the Docker image for the production namespace in Azure Container Registry.</span></span> <span data-ttu-id="cc137-463">Ad esempio, se il tag corrente è `myrepo.azurecr.io/delivery:v1.0.2`, il tag di produzione è `reponame.azurecr.io/prod/delivery:v1.0.2`.</span><span class="sxs-lookup"><span data-stu-id="cc137-463">For example, if the current tag is `myrepo.azurecr.io/delivery:v1.0.2`, the production tag is `reponame.azurecr.io/prod/delivery:v1.0.2`.</span></span>
1. <span data-ttu-id="cc137-464">Eseguire `helm upgrade` per distribuire il grafico Helm nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="cc137-464">Run `helm upgrade` to deploy the Helm chart to the production environment.</span></span>

![Flusso di lavoro CI/CD](./_images/aks-cicd-3.png)

<span data-ttu-id="cc137-466">È importante ricordare che anche in un repository singolo, queste attività possono essere limitate a singoli microservizi, in modo che i team possano eseguire la distribuzione con velocità elevata.</span><span class="sxs-lookup"><span data-stu-id="cc137-466">It's important to remember that even in a monorepo, these tasks can be scoped to individual microservices, so that teams can deploy with high velocity.</span></span> <span data-ttu-id="cc137-467">Il processo include alcuni passaggi manuali: Approvazione delle richieste pull, creazione di rami di rilascio e approvazione delle distribuzioni nel cluster di produzione.</span><span class="sxs-lookup"><span data-stu-id="cc137-467">There are some manual steps in the process: Approving PRs, creating release branches, and approving deployments into the production cluster.</span></span> <span data-ttu-id="cc137-468">Questi passaggi sono manuali per definizione, ma possono essere completamente automatizzati se l'organizzazione lo preferisce.</span><span class="sxs-lookup"><span data-stu-id="cc137-468">These steps are manual by policy &mdash; they could be completely automated if the organization prefers.</span></span>
