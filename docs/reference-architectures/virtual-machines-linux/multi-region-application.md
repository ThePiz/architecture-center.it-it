---
title: "Eseguire macchine virtuali Linux in più aree di Azure per una disponibilità elevata"
description: "Come distribuire le macchine virtuali in più aree in Azure per la disponibilità elevata e la resilienza."
author: MikeWasson
ms.date: 11/22/2016
pnp.series.title: Linux VM workloads
pnp.series.prev: n-tier
ms.openlocfilehash: 7d720a004d21edbffc0ddeba54e291aa817550e0
ms.sourcegitcommit: c9e6d8edb069b8c513de748ce8114c879bad5f49
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2018
---
# <a name="run-linux-vms-in-multiple-regions-for-high-availability"></a><span data-ttu-id="f0e69-103">Eseguire macchine virtuali Linux in più aree per una disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="f0e69-103">Run Linux VMs in multiple regions for high availability</span></span>

<span data-ttu-id="f0e69-104">Questa architettura di riferimento mostra un set di procedure consolidate per l'esecuzione di un'applicazione a più livelli in più aree di Azure, per ottenere disponibilità e un'infrastruttura di ripristino di emergenza affidabile.</span><span class="sxs-lookup"><span data-stu-id="f0e69-104">This reference architecture shows a set of proven practices for running an N-tier application in multiple Azure regions, in order to achieve availability and a robust disaster recovery infrastructure.</span></span> 

<span data-ttu-id="f0e69-105">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="f0e69-105">![[0]][0]</span></span>

<span data-ttu-id="f0e69-106">*Scaricare un [file Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="f0e69-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="f0e69-107">Architecture</span><span class="sxs-lookup"><span data-stu-id="f0e69-107">Architecture</span></span> 

<span data-ttu-id="f0e69-108">Questa architettura si basa su quella illustrata in [Eseguire macchine virtuali Linux per un'applicazione a più livelli](n-tier.md).</span><span class="sxs-lookup"><span data-stu-id="f0e69-108">This architecture builds on the one shown in [Run Linux VMs for an N-tier application](n-tier.md).</span></span> 

* <span data-ttu-id="f0e69-109">**Aree primarie e secondarie**.</span><span class="sxs-lookup"><span data-stu-id="f0e69-109">**Primary and secondary regions**.</span></span> <span data-ttu-id="f0e69-110">Usare due aree per ottenere una maggiore disponibilità:</span><span class="sxs-lookup"><span data-stu-id="f0e69-110">Use two regions to achieve higher availability.</span></span> <span data-ttu-id="f0e69-111">una è l'area primaria, l'altra è per il failover.</span><span class="sxs-lookup"><span data-stu-id="f0e69-111">One is the primary region.The other region is for failover.</span></span>
* <span data-ttu-id="f0e69-112">**DNS di Azure**.</span><span class="sxs-lookup"><span data-stu-id="f0e69-112">**Azure DNS**.</span></span> <span data-ttu-id="f0e69-113">[DNS di Azure][azure-dns] è un servizio di hosting per i domini DNS, che fornisce la risoluzione dei nomi usando l'infrastruttura di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="f0e69-113">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="f0e69-114">Ospitando i domini in Azure, è possibile gestire i record DNS usando le stesse credenziali, API, strumenti e fatturazione come per gli altri servizi Azure.</span><span class="sxs-lookup"><span data-stu-id="f0e69-114">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="f0e69-115">**Gestione traffico di Azure**.</span><span class="sxs-lookup"><span data-stu-id="f0e69-115">**Azure Traffic Manager**.</span></span> <span data-ttu-id="f0e69-116">[Gestione traffico][traffic-manager] indirizza le richieste in ingresso a una delle aree.</span><span class="sxs-lookup"><span data-stu-id="f0e69-116">[Traffic Manager][traffic-manager] routes incoming requests to one of the regions.</span></span> <span data-ttu-id="f0e69-117">Durante il normale funzionamento, le richieste vengono indirizzate all'area primaria.</span><span class="sxs-lookup"><span data-stu-id="f0e69-117">During normal operations, it routes requests to the primary region.</span></span> <span data-ttu-id="f0e69-118">Se tale area non è più disponibile, Gestione traffico effettua il failover all'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="f0e69-118">If that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span> <span data-ttu-id="f0e69-119">Per altre informazioni, vedere la sezione [Configurazione di Gestione traffico](#traffic-manager-configuration).</span><span class="sxs-lookup"><span data-stu-id="f0e69-119">For more information, see the section [Traffic Manager configuration](#traffic-manager-configuration).</span></span>
* <span data-ttu-id="f0e69-120">**Gruppi di risorse**.</span><span class="sxs-lookup"><span data-stu-id="f0e69-120">**Resource groups**.</span></span> <span data-ttu-id="f0e69-121">Creare [gruppi di risorse][resource groups] distinti per l'area primaria, l'area secondaria e Gestione traffico.</span><span class="sxs-lookup"><span data-stu-id="f0e69-121">Create separate [resource groups][resource groups] for the primary region, the secondary region, and for Traffic Manager.</span></span> <span data-ttu-id="f0e69-122">In questo modo si ottiene la flessibilità necessaria per gestire ogni area come un'unica raccolta di risorse.</span><span class="sxs-lookup"><span data-stu-id="f0e69-122">This gives you the flexibility to manage each region as a single collection of resources.</span></span> <span data-ttu-id="f0e69-123">Ad esempio, è possibile ridistribuire un'area, senza rendere non disponibile l'altra.</span><span class="sxs-lookup"><span data-stu-id="f0e69-123">For example, you could redeploy one region, without taking down the other one.</span></span> <span data-ttu-id="f0e69-124">[Collegare i gruppi di risorse][resource-group-links], in modo che sia possibile eseguire una query per elencare tutte le risorse per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f0e69-124">[Link the resource groups][resource-group-links], so that you can run a query to list all the resources for the application.</span></span>
* <span data-ttu-id="f0e69-125">**Reti virtuali**.</span><span class="sxs-lookup"><span data-stu-id="f0e69-125">**VNets**.</span></span> <span data-ttu-id="f0e69-126">Creare una rete virtuale distinta per ogni area.</span><span class="sxs-lookup"><span data-stu-id="f0e69-126">Create a separate VNet for each region.</span></span> <span data-ttu-id="f0e69-127">Assicurarsi che gli spazi degli indirizzi non si sovrappongano.</span><span class="sxs-lookup"><span data-stu-id="f0e69-127">Make sure the address spaces do not overlap.</span></span>
* <span data-ttu-id="f0e69-128">**Apache Cassandra**.</span><span class="sxs-lookup"><span data-stu-id="f0e69-128">**Apache Cassandra**.</span></span> <span data-ttu-id="f0e69-129">Distribuire Cassandra nei data center tra le aree di Azure per una disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="f0e69-129">Deploy Cassandra in data centers across Azure regions for high availability.</span></span> <span data-ttu-id="f0e69-130">All'interno di ogni area, i nodi sono configurati in modo che riconoscano il rack con domini di errore e di aggiornamento, in modo da garantire la resilienza all'interno dell'area.</span><span class="sxs-lookup"><span data-stu-id="f0e69-130">Within each region, nodes are configured in rack-aware mode with fault and upgrade domains, for resiliency inside the region.</span></span>

## <a name="recommendations"></a><span data-ttu-id="f0e69-131">Raccomandazioni</span><span class="sxs-lookup"><span data-stu-id="f0e69-131">Recommendations</span></span>

<span data-ttu-id="f0e69-132">Un'architettura di tipo multi-area può fornire una maggiore disponibilità rispetto alla distribuzione in un'unica area.</span><span class="sxs-lookup"><span data-stu-id="f0e69-132">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="f0e69-133">Se un'interruzione a livello di area interessa l'area primaria, è possibile usare [Gestione traffico][traffic-manager] per effettuare il failover all'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="f0e69-133">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="f0e69-134">Questa architettura è utile anche in caso di errore di un singolo sottosistema dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f0e69-134">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="f0e69-135">Sono disponibili diversi approcci generali per ottenere una disponibilità elevata tra le diverse aree geografiche:</span><span class="sxs-lookup"><span data-stu-id="f0e69-135">There are several general approaches to achieving high availability across regions:</span></span>   

* <span data-ttu-id="f0e69-136">Attivo/passivo con hot standby.</span><span class="sxs-lookup"><span data-stu-id="f0e69-136">Active/passive with hot standby.</span></span> <span data-ttu-id="f0e69-137">Il traffico viene indirizzato a un'area, mentre l'altra attende in modalità hot standby.</span><span class="sxs-lookup"><span data-stu-id="f0e69-137">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="f0e69-138">Hot standby significa che le macchine virtuali nell'area secondaria sono allocate e in esecuzione in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="f0e69-138">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="f0e69-139">Attivo/passivo con cold standby.</span><span class="sxs-lookup"><span data-stu-id="f0e69-139">Active/passive with cold standby.</span></span> <span data-ttu-id="f0e69-140">Il traffico viene indirizzato a un'area, mentre l'altra attende in modalità cold standby.</span><span class="sxs-lookup"><span data-stu-id="f0e69-140">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="f0e69-141">Cold standby significa che le macchine virtuali nell'area secondaria non vengono allocate finché non diventa necessario per il failover.</span><span class="sxs-lookup"><span data-stu-id="f0e69-141">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="f0e69-142">Questo approccio presenta costi inferiori in termini di esecuzione, ma in genere richiederà più tempo per portare online le risorse in caso di errore.</span><span class="sxs-lookup"><span data-stu-id="f0e69-142">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="f0e69-143">Attivo/attivo.</span><span class="sxs-lookup"><span data-stu-id="f0e69-143">Active/active.</span></span> <span data-ttu-id="f0e69-144">Entrambe le aree sono attive e viene effettuato un bilanciamento del carico tra le richieste.</span><span class="sxs-lookup"><span data-stu-id="f0e69-144">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="f0e69-145">Se un'area non è più disponibile, viene esclusa dalla rotazione.</span><span class="sxs-lookup"><span data-stu-id="f0e69-145">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="f0e69-146">Questa architettura è incentrata sulla modalità attivo/passivo con hot standby, usando Gestione traffico per il failover.</span><span class="sxs-lookup"><span data-stu-id="f0e69-146">This architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> <span data-ttu-id="f0e69-147">Si noti che è possibile distribuire un numero ridotto di macchine virtuali per la modalità hot standby e quindi aumentare il numero di istanze in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="f0e69-147">Note that you could deploy a small number of VMs for hot standby and then scale out as needed.</span></span>


### <a name="regional-pairing"></a><span data-ttu-id="f0e69-148">Coppie di aree</span><span class="sxs-lookup"><span data-stu-id="f0e69-148">Regional pairing</span></span>

<span data-ttu-id="f0e69-149">Ogni area di Azure è abbinata a un'altra area con la stessa collocazione geografica.</span><span class="sxs-lookup"><span data-stu-id="f0e69-149">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="f0e69-150">In generale, è consigliabile scegliere aree della stessa coppia di aree (ad esempio, Stati Uniti orientali 2 e Stati Uniti centrali).</span><span class="sxs-lookup"><span data-stu-id="f0e69-150">In general, choose regions from the same regional pair (for example, East US 2 and US Central).</span></span> <span data-ttu-id="f0e69-151">I vantaggi di questa operazione includono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="f0e69-151">Benefits of doing so include:</span></span>

* <span data-ttu-id="f0e69-152">In caso di interruzione su vasta scala, viene data priorità al ripristino di almeno un'area di ogni coppia.</span><span class="sxs-lookup"><span data-stu-id="f0e69-152">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="f0e69-153">Gli aggiornamenti di sistema di Azure pianificati vengono implementati in sequenza tra le aree abbinate, per ridurre al minimo l'eventuale tempo di inattività.</span><span class="sxs-lookup"><span data-stu-id="f0e69-153">Planned Azure system updates are rolled out to paired regions sequentially, to minimize possible downtime.</span></span>
* <span data-ttu-id="f0e69-154">Le coppie si trovano nella stessa area geografica, per soddisfare i requisiti di residenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="f0e69-154">Pairs reside within the same geography, to meet data residency requirements.</span></span>

<span data-ttu-id="f0e69-155">Assicurarsi tuttavia che entrambe le aree supportino tutti i servizi di Azure necessari per l'applicazione (vedere i [servizi disponibili in base all'area][services-by-region]).</span><span class="sxs-lookup"><span data-stu-id="f0e69-155">However, make sure that both regions support all of the Azure services needed for your application (see [Services by region][services-by-region]).</span></span> <span data-ttu-id="f0e69-156">Per altre informazioni sulle coppie di aree, vedere [Continuità aziendale e ripristino di emergenza nelle aree geografiche abbinate di Azure][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="f0e69-156">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="f0e69-157">Configurazione di Gestione traffico</span><span class="sxs-lookup"><span data-stu-id="f0e69-157">Traffic Manager configuration</span></span>

<span data-ttu-id="f0e69-158">Quando si configura Gestione traffico, tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="f0e69-158">Consider the following points when configuring Traffic Manager:</span></span>

* <span data-ttu-id="f0e69-159">**Routing**.</span><span class="sxs-lookup"><span data-stu-id="f0e69-159">**Routing**.</span></span> <span data-ttu-id="f0e69-160">Gestione traffico supporta diversi [algoritmi di routing][tm-routing].</span><span class="sxs-lookup"><span data-stu-id="f0e69-160">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="f0e69-161">Per lo scenario descritto in questo articolo, usare il routing *Priorità* (precedentemente denominato routing *Failover*).</span><span class="sxs-lookup"><span data-stu-id="f0e69-161">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="f0e69-162">Con questa impostazione, Gestione traffico invia tutte le richieste all'area primaria, a meno che l'area primaria non diventi irraggiungibile.</span><span class="sxs-lookup"><span data-stu-id="f0e69-162">With this setting, Traffic Manager sends all requests to the primary region, unless the primary region becomes unreachable.</span></span> <span data-ttu-id="f0e69-163">A questo punto, viene automaticamente effettuato il failover all'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="f0e69-163">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="f0e69-164">Vedere [Configurare il metodo di routing failover][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="f0e69-164">See [Configure Failover routing method][tm-configure-failover].</span></span>
* <span data-ttu-id="f0e69-165">**Probe di integrità**.</span><span class="sxs-lookup"><span data-stu-id="f0e69-165">**Health probe**.</span></span> <span data-ttu-id="f0e69-166">Gestione traffico usa un [probe][tm-monitoring] HTTP (o HTTPS) per monitorare la disponibilità di ogni area.</span><span class="sxs-lookup"><span data-stu-id="f0e69-166">Traffic Manager uses an HTTP (or HTTPS) [probe][tm-monitoring] to monitor the availability of each region.</span></span> <span data-ttu-id="f0e69-167">Il probe verifica una risposta HTTP 200 per un percorso URL specificato.</span><span class="sxs-lookup"><span data-stu-id="f0e69-167">The probe checks for an HTTP 200 response for a specified URL path.</span></span> <span data-ttu-id="f0e69-168">Come procedura consigliata, creare un endpoint che segnali l'integrità complessiva dell'applicazione e usare questo endpoint per il probe di integrità.</span><span class="sxs-lookup"><span data-stu-id="f0e69-168">As a best practice, create an endpoint that reports the overall health of the application, and use this endpoint for the health probe.</span></span> <span data-ttu-id="f0e69-169">In caso contrario, il probe potrebbe segnalare un endpoint integro quando le parti più importanti dell'applicazione in realtà hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="f0e69-169">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span> <span data-ttu-id="f0e69-170">Per altre informazioni, vedere [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern] (Modello di monitoraggio degli endpoint di integrità).</span><span class="sxs-lookup"><span data-stu-id="f0e69-170">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="f0e69-171">Quando Gestione traffico effettua il failover, per un periodo di tempo i client non riescono a raggiungere l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f0e69-171">When Traffic Manager fails over there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="f0e69-172">La durata di questo periodo è influenzata dai fattori seguenti:</span><span class="sxs-lookup"><span data-stu-id="f0e69-172">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="f0e69-173">Il probe di integrità deve rilevare che l'area primaria è diventata irraggiungibile.</span><span class="sxs-lookup"><span data-stu-id="f0e69-173">The health probe must detect that the primary region has become unreachable.</span></span>
* <span data-ttu-id="f0e69-174">I server DNS devono aggiornare i record DNS memorizzati nella cache per l'indirizzo IP, che dipende dalla durata (TTL) DNS.</span><span class="sxs-lookup"><span data-stu-id="f0e69-174">DNS servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="f0e69-175">Il valore TTL predefinito è di 300 secondi (5 minuti), ma è possibile configurare questo valore durante la creazione del profilo di Gestione traffico.</span><span class="sxs-lookup"><span data-stu-id="f0e69-175">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="f0e69-176">Per dettagli, vedere [Informazioni sul monitoraggio di Gestione traffico][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="f0e69-176">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="f0e69-177">Se Gestione traffico effettua il failover, è consigliabile eseguire un failback manuale invece di implementare un failback automatico.</span><span class="sxs-lookup"><span data-stu-id="f0e69-177">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="f0e69-178">In caso contrario, si potrebbe creare una situazione in cui l'applicazione passa alternativamente da un'area all'altra.</span><span class="sxs-lookup"><span data-stu-id="f0e69-178">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="f0e69-179">Verificare che tutti i sottosistemi dell'applicazione siano integri prima del failback.</span><span class="sxs-lookup"><span data-stu-id="f0e69-179">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="f0e69-180">Si noti che Gestione traffico effettua automaticamente il failback per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="f0e69-180">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="f0e69-181">Per evitare questa situazione, ridurre manualmente la priorità dell'area primaria dopo un evento di failover.</span><span class="sxs-lookup"><span data-stu-id="f0e69-181">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="f0e69-182">Ad esempio, si supponga che l'area primaria sia di priorità 1 e la secondaria di priorità 2.</span><span class="sxs-lookup"><span data-stu-id="f0e69-182">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="f0e69-183">Dopo un failover, impostare l'area primaria sul livello di priorità 3 per evitare il failback automatico.</span><span class="sxs-lookup"><span data-stu-id="f0e69-183">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="f0e69-184">Quando si è pronti per il cambio, aggiornare la priorità impostandola su 1.</span><span class="sxs-lookup"><span data-stu-id="f0e69-184">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="f0e69-185">Il comando seguente dell'[interfaccia della riga di comando di Azure][install-azure-cli] aggiorna la priorità:</span><span class="sxs-lookup"><span data-stu-id="f0e69-185">The following [Azure CLI][install-azure-cli] command updates the priority:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --priority 3
```    

<span data-ttu-id="f0e69-186">Un altro approccio consiste nel disabilitare temporaneamente l'endpoint finché non si è pronti per eseguire il failback:</span><span class="sxs-lookup"><span data-stu-id="f0e69-186">Another approach is to temporarily disable the endpoint until you are ready to fail back:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --status Disabled
```    

<span data-ttu-id="f0e69-187">A seconda della causa di un failover, potrebbe essere necessario ridistribuire le risorse all'interno di un'area.</span><span class="sxs-lookup"><span data-stu-id="f0e69-187">Depending on the cause of a failover, you might need to redeploy the resources within a region.</span></span> <span data-ttu-id="f0e69-188">Prima di eseguire nuovamente il failback, eseguire un test della conformità operativa,</span><span class="sxs-lookup"><span data-stu-id="f0e69-188">Before failing back, perform an operational readiness test.</span></span> <span data-ttu-id="f0e69-189">che avrà lo scopo di verificare gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="f0e69-189">The test should verify things like:</span></span>

* <span data-ttu-id="f0e69-190">Le macchine virtuali sono configurate correttamente</span><span class="sxs-lookup"><span data-stu-id="f0e69-190">VMs are configured correctly.</span></span> <span data-ttu-id="f0e69-191">(tutto il software richiesto è installato, IIS è in esecuzione e così via).</span><span class="sxs-lookup"><span data-stu-id="f0e69-191">(All required software is installed, IIS is running, and so on.)</span></span>
* <span data-ttu-id="f0e69-192">I sottosistemi dell'applicazione sono integri.</span><span class="sxs-lookup"><span data-stu-id="f0e69-192">Application subsystems are healthy.</span></span>
* <span data-ttu-id="f0e69-193">Test funzionale</span><span class="sxs-lookup"><span data-stu-id="f0e69-193">Functional testing.</span></span> <span data-ttu-id="f0e69-194">(ad esempio, il livello del database è raggiungibile dal livello Web).</span><span class="sxs-lookup"><span data-stu-id="f0e69-194">(For example, the database tier is reachable from the web tier.)</span></span>

### <a name="cassandra-deployment-across-multiple-regions"></a><span data-ttu-id="f0e69-195">Distribuzione di Cassandra tra più aree</span><span class="sxs-lookup"><span data-stu-id="f0e69-195">Cassandra deployment across multiple regions</span></span>

<span data-ttu-id="f0e69-196">I data center Cassandra sono un gruppo di nodi dati correlati che vengono configurati collettivamente all'interno di un cluster per la replica e la separazione del carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="f0e69-196">Cassandra data centers are a group of related data nodes that are configured together within a cluster for replication and workload segregation.</span></span>

<span data-ttu-id="f0e69-197">È consigliabile usare [DataStax Enterprise][datastax] per l'uso in produzione.</span><span class="sxs-lookup"><span data-stu-id="f0e69-197">We recommend [DataStax Enterprise][datastax] for production use.</span></span> <span data-ttu-id="f0e69-198">Per altre informazioni sull'esecuzione di DataStax in Azure, vedere [DataStax Enterprise Deployment Guide for Azure][cassandra-in-azure] (Guida alla distribuzione di DataStax Enterprise per Azure).</span><span class="sxs-lookup"><span data-stu-id="f0e69-198">For more information on running DataStax in Azure, see [DataStax Enterprise Deployment Guide for Azure][cassandra-in-azure].</span></span> <span data-ttu-id="f0e69-199">Le raccomandazioni generali seguenti si applicano a qualsiasi edizione di Cassandra:</span><span class="sxs-lookup"><span data-stu-id="f0e69-199">The following general recommendations apply to any Cassandra edition:</span></span> 

* <span data-ttu-id="f0e69-200">Assegnare un indirizzo IP pubblico a ogni nodo.</span><span class="sxs-lookup"><span data-stu-id="f0e69-200">Assign a public IP address to each node.</span></span> <span data-ttu-id="f0e69-201">Ciò consente ai cluster di comunicare tra le aree usando l'infrastruttura backbone di Azure, garantendo una velocità effettiva elevata a costo ridotto.</span><span class="sxs-lookup"><span data-stu-id="f0e69-201">This enables the clusters to communicate across regions using the Azure backbone infrastructure, providing high throughput at low cost.</span></span>
* <span data-ttu-id="f0e69-202">Proteggere i nodi usando le configurazioni appropriate per il firewall e il gruppo di sicurezza di rete, consentendo il traffico solo da e verso gli host noti, inclusi i client e altri nodi del cluster.</span><span class="sxs-lookup"><span data-stu-id="f0e69-202">Secure nodes using the appropriate firewall and network security group (NSG) configurations, allowing traffic only to and from known hosts, including clients and other cluster nodes.</span></span> <span data-ttu-id="f0e69-203">Si noti che Cassandra usa porte diverse per la comunicazione, OpsCenter, Spark e così via.</span><span class="sxs-lookup"><span data-stu-id="f0e69-203">Note that Cassandra uses different ports for communication, OpsCenter, Spark, and so forth.</span></span> <span data-ttu-id="f0e69-204">Per l'uso delle porte in Cassandra, vedere [Configuring firewall port access][cassandra-ports] (Configurazione dell'accesso alle porte del firewall).</span><span class="sxs-lookup"><span data-stu-id="f0e69-204">For port usage in Cassandra, see [Configuring firewall port access][cassandra-ports].</span></span>
* <span data-ttu-id="f0e69-205">Usare la crittografia SSL per tutte le comunicazioni [da client a nodo][ssl-client-node] e [da nodo a nodo][ssl-node-node].</span><span class="sxs-lookup"><span data-stu-id="f0e69-205">Use SSL encryption for all [client-to-node][ssl-client-node] and [node-to-node][ssl-node-node] communications.</span></span>
* <span data-ttu-id="f0e69-206">All'interno di un'area, seguire le indicazioni riportate nelle [raccomandazioni per Cassandra](n-tier.md#cassandra).</span><span class="sxs-lookup"><span data-stu-id="f0e69-206">Within a region, follow the guidelines in [Cassandra recommendations](n-tier.md#cassandra).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="f0e69-207">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="f0e69-207">Availability considerations</span></span>

<span data-ttu-id="f0e69-208">Con un'app complessa a più livelli, potrebbe non essere necessario replicare l'intera applicazione nell'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="f0e69-208">With a complex N-tier app, you may not need to replicate the entire application in the secondary region.</span></span> <span data-ttu-id="f0e69-209">In alternativa, è possibile replicare solo un sottosistema critico indispensabile per supportare la continuità aziendale.</span><span class="sxs-lookup"><span data-stu-id="f0e69-209">Instead, you might just replicate a critical subsystem that is needed to support business continuity.</span></span>

<span data-ttu-id="f0e69-210">Gestione traffico è un possibile punto di guasto nel sistema.</span><span class="sxs-lookup"><span data-stu-id="f0e69-210">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="f0e69-211">In caso di interruzione del servizio Gestione traffico, i client non riescono ad accedere all'applicazione durante il tempo di inattività.</span><span class="sxs-lookup"><span data-stu-id="f0e69-211">If the Traffic Manager service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="f0e69-212">Rivedere il [contratto di servizio di Gestione traffico][tm-sla] e determinare se l'uso di Gestione traffico da solo soddisfa i requisiti aziendali per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="f0e69-212">Review the [Traffic Manager SLA][tm-sla], and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="f0e69-213">In caso contrario, considerare di aggiungere un'altra soluzione di gestione del traffico come failback.</span><span class="sxs-lookup"><span data-stu-id="f0e69-213">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="f0e69-214">In caso di errore del servizio Gestione traffico di Azure, modificare i record CNAME in DNS in modo da puntare all'altro servizio di gestione del traffico</span><span class="sxs-lookup"><span data-stu-id="f0e69-214">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="f0e69-215">(questo passaggio deve essere eseguito manualmente e l'applicazione non sarà disponibile finché non vengono propagate le modifiche al DNS).</span><span class="sxs-lookup"><span data-stu-id="f0e69-215">(This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.)</span></span>

<span data-ttu-id="f0e69-216">Per il cluster Cassandra, gli scenari di failover da prendere in considerazione dipendono dai livelli di coerenza usati dall'applicazione, nonché dal numero di repliche usate.</span><span class="sxs-lookup"><span data-stu-id="f0e69-216">For the Cassandra cluster, the failover scenarios to consider depend on the consistency levels used by the application, as well as the number of replicas used.</span></span> <span data-ttu-id="f0e69-217">Per i livelli di coerenza e l'uso in Cassandra, vedere [Configuring data consistency][cassandra-consistency] (Configurazione della coerenza dei dati) e [Cassandra: How many nodes are talked to with Quorum?][cassandra-consistency-usage] (Cassandra: con quanti nodi si stabilisce una comunicazione con Quorum).</span><span class="sxs-lookup"><span data-stu-id="f0e69-217">For consistency levels and usage in Cassandra, see [Configuring data consistency][cassandra-consistency] and [Cassandra: How many nodes are talked to with Quorum?][cassandra-consistency-usage]</span></span> <span data-ttu-id="f0e69-218">La disponibilità dei dati in Cassandra è determinata dal livello di coerenza usato dall'applicazione e dal meccanismo di replica.</span><span class="sxs-lookup"><span data-stu-id="f0e69-218">Data availability in Cassandra is determined by the consistency level used by the application and the replication mechanism.</span></span> <span data-ttu-id="f0e69-219">Per la replica in Cassandra, vedere [Data Replication in NoSQL Databases Explained][cassandra-replication] (Spiegazione della replica dei dati nei database NoSQL).</span><span class="sxs-lookup"><span data-stu-id="f0e69-219">For replication in Cassandra, see [Data Replication in NoSQL Databases Explained][cassandra-replication].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="f0e69-220">Considerazioni sulla gestibilità</span><span class="sxs-lookup"><span data-stu-id="f0e69-220">Manageability considerations</span></span>

<span data-ttu-id="f0e69-221">Quando si aggiorna la distribuzione, aggiornare un'area alla volta per ridurre la probabilità di un errore globale da una configurazione errata o un errore nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f0e69-221">When you update your deployment, update one region at a time to reduce the chance of a global failure from an incorrect configuration or an error in the application.</span></span>

<span data-ttu-id="f0e69-222">Testare la resilienza del sistema agli errori.</span><span class="sxs-lookup"><span data-stu-id="f0e69-222">Test the resiliency of the system to failures.</span></span> <span data-ttu-id="f0e69-223">Di seguito sono riportati alcuni scenari di errore comuni da testare:</span><span class="sxs-lookup"><span data-stu-id="f0e69-223">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="f0e69-224">Arrestare le istanze di macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f0e69-224">Shut down VM instances.</span></span>
* <span data-ttu-id="f0e69-225">Esercitare un uso elevato delle risorse come CPU e memoria.</span><span class="sxs-lookup"><span data-stu-id="f0e69-225">Pressure resources such as CPU and memory.</span></span>
* <span data-ttu-id="f0e69-226">Disconnettere/ritardare la rete.</span><span class="sxs-lookup"><span data-stu-id="f0e69-226">Disconnect/delay network.</span></span>
* <span data-ttu-id="f0e69-227">Arrestare in modo anomalo i processi.</span><span class="sxs-lookup"><span data-stu-id="f0e69-227">Crash processes.</span></span>
* <span data-ttu-id="f0e69-228">Far scadere i certificati.</span><span class="sxs-lookup"><span data-stu-id="f0e69-228">Expire certificates.</span></span>
* <span data-ttu-id="f0e69-229">Simulare errori hardware.</span><span class="sxs-lookup"><span data-stu-id="f0e69-229">Simulate hardware faults.</span></span>
* <span data-ttu-id="f0e69-230">Arrestare il servizio DNS nei controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="f0e69-230">Shut down the DNS service on the domain controllers.</span></span>

<span data-ttu-id="f0e69-231">Misurare i tempi di ripristino e verificare che soddisfino i requisiti aziendali.</span><span class="sxs-lookup"><span data-stu-id="f0e69-231">Measure the recovery times and verify they meet your business requirements.</span></span> <span data-ttu-id="f0e69-232">Testare anche le combinazioni di modalità di errore.</span><span class="sxs-lookup"><span data-stu-id="f0e69-232">Test combinations of failure modes, as well.</span></span>


<!-- Links -->
[hybrid-vpn]: ../hybrid-networking/vpn.md
[azure-dns]: /azure/dns/dns-overview
[cassandra-in-azure]: https://academy.datastax.com/resources/deployment-guide-azure
[cassandra-consistency]: http://docs.datastax.com/en/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html
[cassandra-replication]: http://www.planetcassandra.org/data-replication-in-nosql-databases-explained/
[cassandra-consistency-usage]: https://medium.com/@foundev/cassandra-how-many-nodes-are-talked-to-with-quorum-also-should-i-use-it-98074e75d7d5#.b4pb4alb2
[cassandra-ports]: https://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/sec/configFirewallPorts.html
[datastax]: https://www.datastax.com/products/datastax-enterprise
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[install-azure-cli]: /azure/xplat-cli-install
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview
[resource-group-links]: /azure/resource-group-link-resources
[services-by-region]: https://azure.microsoft.com/regions/#services
[ssl-client-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLClientToNode_t.html
[ssl-node-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLNodeToNode_t.html
[tablediff]: https://msdn.microsoft.com/library/ms162843.aspx
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager/
[visio-download]: https://archcenter.azureedge.net/cdn/vm-reference-architectures.vsdx
[wsfc]: https://msdn.microsoft.com/library/hh270278.aspx
[0]: ./images/multi-region-application-diagram.png "Architettura di rete a disponibilità elevata per applicazioni Azure a più livelli"
