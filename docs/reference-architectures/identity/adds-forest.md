---
title: Creare una foresta di risorse di Active Directory Domain Services in Azure
description: >-
  Come creare un dominio trusted di Active Directory in Azure.

  linee guida, gateway vpn, expressroute, bilanciamento del carico, rete virtuale, active directory
author: telmosampaio
ms.date: 11/28/2016
pnp.series.title: Identity management
pnp.series.prev: adds-extend-domain
pnp.series.next: adfs
cardTitle: Create an AD DS forest in Azure
ms.openlocfilehash: b946afa91e8bd303c51f97e18be170c4105cc8c5
ms.sourcegitcommit: 8ab30776e0c4cdc16ca0dcc881960e3108ad3e94
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 12/08/2017
---
# <a name="create-an-active-directory-domain-services-ad-ds-resource-forest-in-azure"></a><span data-ttu-id="89054-104">Creare una foresta di risorse di Active Directory Domain Services in Azure</span><span class="sxs-lookup"><span data-stu-id="89054-104">Create an Active Directory Domain Services (AD DS) resource forest in Azure</span></span>

<span data-ttu-id="89054-105">Questa architettura di riferimento illustra come creare un dominio di Active Directory separato in Azure considerato attendibile dai domini nella foresta di Active Directory locale.</span><span class="sxs-lookup"><span data-stu-id="89054-105">This reference architecture shows how to create a separate Active Directory domain in Azure that is trusted by domains in your on-premises AD forest.</span></span> [<span data-ttu-id="89054-106">**Distribuire questa soluzione**.</span><span class="sxs-lookup"><span data-stu-id="89054-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="89054-107">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="89054-107">[![0]][0]</span></span> 

<span data-ttu-id="89054-108">*Scaricare un [file Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="89054-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="89054-109">Active Directory Domain Services archivia le informazioni di identità in una struttura gerarchica.</span><span class="sxs-lookup"><span data-stu-id="89054-109">Active Directory Domain Services (AD DS) stores identity information in a hierarchical structure.</span></span> <span data-ttu-id="89054-110">Il nodo principale nella struttura gerarchica è noto come foresta.</span><span class="sxs-lookup"><span data-stu-id="89054-110">The top node in the hierarchical structure is known as a forest.</span></span> <span data-ttu-id="89054-111">Una foresta contiene domini e i domini contengono altri tipi di oggetti.</span><span class="sxs-lookup"><span data-stu-id="89054-111">A forest contains domains, and domains contain other types of objects.</span></span> <span data-ttu-id="89054-112">Questa architettura di riferimento crea una foresta di Active Directory Domain Services in Azure con una relazione di trust unidirezionale in uscita con un dominio locale.</span><span class="sxs-lookup"><span data-stu-id="89054-112">This reference architecture creates an AD DS forest in Azure with a one-way outgoing trust relationship with an on-premises domain.</span></span> <span data-ttu-id="89054-113">La foresta in Azure contiene un dominio che non esiste in locale.</span><span class="sxs-lookup"><span data-stu-id="89054-113">The forest in Azure contains a domain that does not exist on-premises.</span></span> <span data-ttu-id="89054-114">A causa della relazione di trust, gli accessi effettuati nei domini locali possono essere considerati attendibili per accedere alle risorse nel dominio di Azure separato.</span><span class="sxs-lookup"><span data-stu-id="89054-114">Because of the trust relationship, logons made against on-premises domains can be trusted for access to resources in the separate Azure domain.</span></span> 

<span data-ttu-id="89054-115">Gli usi tipici di questa architettura includono mantenere la separazione della sicurezza per le identità e gli oggetti contenuti nel cloud ed eseguire la migrazione di singoli domini da un ambiente locale al cloud.</span><span class="sxs-lookup"><span data-stu-id="89054-115">Typical uses for this architecture include maintaining security separation for objects and identities held in the cloud, and migrating individual domains from on-premises to the cloud.</span></span> 

<span data-ttu-id="89054-116">Per altre considerazioni, vedere l'articolo su come [scegliere una soluzione per l'integrazione di Active Directory locale con Azure][considerations].</span><span class="sxs-lookup"><span data-stu-id="89054-116">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span> 

## <a name="architecture"></a><span data-ttu-id="89054-117">Architecture</span><span class="sxs-lookup"><span data-stu-id="89054-117">Architecture</span></span>

<span data-ttu-id="89054-118">L'architettura include i componenti indicati di seguito.</span><span class="sxs-lookup"><span data-stu-id="89054-118">The architecture has the following components.</span></span>

* <span data-ttu-id="89054-119">**Rete locale**.</span><span class="sxs-lookup"><span data-stu-id="89054-119">**On-premises network**.</span></span> <span data-ttu-id="89054-120">La rete locale contiene la propria foresta di Active Directory con i relativi domini.</span><span class="sxs-lookup"><span data-stu-id="89054-120">The on-premises network contains its own Active Directory forest and domains.</span></span>
* <span data-ttu-id="89054-121">**Server Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="89054-121">**Active Directory servers**.</span></span> <span data-ttu-id="89054-122">Sono i controller di dominio che implementano i servizi di dominio in esecuzione come macchine virtuali nel cloud.</span><span class="sxs-lookup"><span data-stu-id="89054-122">These are domain controllers implementing domain services running as VMs in the cloud.</span></span> <span data-ttu-id="89054-123">Questi server ospitano una foresta che contiene uno o più domini, separati da quelli locali.</span><span class="sxs-lookup"><span data-stu-id="89054-123">These servers host a forest containing one or more domains, separate from those located on-premises.</span></span>
* <span data-ttu-id="89054-124">**Relazione di trust unidirezionale**.</span><span class="sxs-lookup"><span data-stu-id="89054-124">**One-way trust relationship**.</span></span> <span data-ttu-id="89054-125">L'esempio nel diagramma mostra una relazione di trust unidirezionale dal dominio in Azure al dominio locale.</span><span class="sxs-lookup"><span data-stu-id="89054-125">The example in the diagram shows a one-way trust from the domain in Azure to the on-premises domain.</span></span> <span data-ttu-id="89054-126">Questa relazione consente agli utenti locali di accedere alle risorse nel dominio in Azure, ma non viceversa.</span><span class="sxs-lookup"><span data-stu-id="89054-126">This relationship enables on-premises users to access resources in the domain in Azure, but not the other way around.</span></span> <span data-ttu-id="89054-127">È possibile creare un trust bidirezionale se gli utenti cloud richiedono l'accesso anche alle risorse locali.</span><span class="sxs-lookup"><span data-stu-id="89054-127">It is possible to create a two-way trust if cloud users also require access to on-premises resources.</span></span>
* <span data-ttu-id="89054-128">**Subnet di Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="89054-128">**Active Directory subnet**.</span></span> <span data-ttu-id="89054-129">I server di Active Directory Domain Services sono ospitati in una subnet separata.</span><span class="sxs-lookup"><span data-stu-id="89054-129">The AD DS servers are hosted in a separate subnet.</span></span> <span data-ttu-id="89054-130">Le regole del gruppo di sicurezza di rete (NSG) proteggono i server di Active Directory Domain Services e fungono da firewall per il traffico da origini non previste.</span><span class="sxs-lookup"><span data-stu-id="89054-130">Network security group (NSG) rules protect the AD DS servers and provide a firewall against traffic from unexpected sources.</span></span>
* <span data-ttu-id="89054-131">**Gateway di Azure**.</span><span class="sxs-lookup"><span data-stu-id="89054-131">**Azure gateway**.</span></span> <span data-ttu-id="89054-132">Il gateway di Azure fornisce una connessione tra la rete virtuale di Azure e la rete locale.</span><span class="sxs-lookup"><span data-stu-id="89054-132">The Azure gateway provides a connection between the on-premises network and the Azure VNet.</span></span> <span data-ttu-id="89054-133">Può trattarsi di una [connessione VPN][azure-vpn-gateway] o [Azure ExpressRoute][azure-expressroute].</span><span class="sxs-lookup"><span data-stu-id="89054-133">This can be a [VPN connection][azure-vpn-gateway] or [Azure ExpressRoute][azure-expressroute].</span></span> <span data-ttu-id="89054-134">Per altre informazioni, vedere [Implementazione di un'architettura di rete ibrida sicura in Azure][implementing-a-secure-hybrid-network-architecture].</span><span class="sxs-lookup"><span data-stu-id="89054-134">For more information, see [Implementing a secure hybrid network architecture in Azure][implementing-a-secure-hybrid-network-architecture].</span></span>

## <a name="recommendations"></a><span data-ttu-id="89054-135">Raccomandazioni</span><span class="sxs-lookup"><span data-stu-id="89054-135">Recommendations</span></span>

<span data-ttu-id="89054-136">Per consigli specifici sull'implementazione di Active Directory in Azure, vedere gli articoli seguenti:</span><span class="sxs-lookup"><span data-stu-id="89054-136">For specific recommendations on implementing Active Directory in Azure, see the following articles:</span></span>

- <span data-ttu-id="89054-137">[Estensione di Active Directory Domain Services in Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="89054-137">[Extending Active Directory Domain Services (AD DS) to Azure][adds-extend-domain].</span></span> 
- <span data-ttu-id="89054-138">[Linee guida per la distribuzione di Active Directory di Windows Server in macchine virtuali di Azure][ad-azure-guidelines].</span><span class="sxs-lookup"><span data-stu-id="89054-138">[Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines][ad-azure-guidelines].</span></span>

### <a name="trust"></a><span data-ttu-id="89054-139">Trust</span><span class="sxs-lookup"><span data-stu-id="89054-139">Trust</span></span>

<span data-ttu-id="89054-140">I domini locali sono contenuti in una foresta diversa rispetto ai domini nel cloud.</span><span class="sxs-lookup"><span data-stu-id="89054-140">The on-premises domains are contained within a different forest from the domains in the cloud.</span></span> <span data-ttu-id="89054-141">Per abilitare l'autenticazione degli utenti locali nel cloud, i domini in Azure devono considerare attendibile il dominio di accesso nella foresta locale.</span><span class="sxs-lookup"><span data-stu-id="89054-141">To enable authentication of on-premises users in the cloud, the domains in Azure must trust the logon domain in the on-premises forest.</span></span> <span data-ttu-id="89054-142">Analogamente, se il cloud offre un dominio di accesso per gli utenti esterni, può essere necessario che la foresta locale consideri attendibile il dominio cloud.</span><span class="sxs-lookup"><span data-stu-id="89054-142">Similarly, if the cloud provides a logon domain for external users, it may be necessary for the on-premises forest to trust the cloud domain.</span></span>

<span data-ttu-id="89054-143">È possibile stabilire relazioni di trust a livello di foresta, [creando trust tra foreste][creating-forest-trusts], o a livello di dominio, [creando trust esterni][creating-external-trusts].</span><span class="sxs-lookup"><span data-stu-id="89054-143">You can establish trusts at the forest level by [creating forest trusts][creating-forest-trusts], or at the domain level by [creating external trusts][creating-external-trusts].</span></span> <span data-ttu-id="89054-144">Un trust a livello di foresta crea una relazione tra tutti i domini in due foreste.</span><span class="sxs-lookup"><span data-stu-id="89054-144">A forest level trust creates a relationship between all domains in two forests.</span></span> <span data-ttu-id="89054-145">Un trust a livello di dominio esterno crea solo una relazione tra i due domini specificati.</span><span class="sxs-lookup"><span data-stu-id="89054-145">An external domain level trust only creates a relationship between two specified domains.</span></span> <span data-ttu-id="89054-146">È consigliabile creare trust a livello di dominio esterno solo tra domini in foreste diverse.</span><span class="sxs-lookup"><span data-stu-id="89054-146">You should only create external domain level trusts between domains in different forests.</span></span>

<span data-ttu-id="89054-147">I trust possono essere unidirezionali o bidirezionali:</span><span class="sxs-lookup"><span data-stu-id="89054-147">Trusts can be unidirectional (one-way) or bidirectional (two-way):</span></span>

* <span data-ttu-id="89054-148">Un trust unidirezionale consente agli utenti in un dominio o foresta (noti come dominio o foresta *in ingresso*) per accedere alle risorse contenute in un altro dominio o foresta (il dominio o foresta *in uscita*).</span><span class="sxs-lookup"><span data-stu-id="89054-148">A one-way trust enables users in one domain or forest (known as the *incoming* domain or forest) to access the resources held in another (the *outgoing* domain or forest).</span></span>
* <span data-ttu-id="89054-149">Un trust bidirezionale consente agli utenti nel dominio o nella foresta di accedere alle risorse contenute nell'altro dominio o foresta.</span><span class="sxs-lookup"><span data-stu-id="89054-149">A two-way trust enables users in either domain or forest to access resources held in the other.</span></span>

<span data-ttu-id="89054-150">La tabella seguente presenta un riepilogo delle configurazioni di trust per alcuni semplici scenari:</span><span class="sxs-lookup"><span data-stu-id="89054-150">The following table summarizes trust configurations for some simple scenarios:</span></span>

| <span data-ttu-id="89054-151">Scenario</span><span class="sxs-lookup"><span data-stu-id="89054-151">Scenario</span></span> | <span data-ttu-id="89054-152">Trust locale</span><span class="sxs-lookup"><span data-stu-id="89054-152">On-premises trust</span></span> | <span data-ttu-id="89054-153">Trust cloud</span><span class="sxs-lookup"><span data-stu-id="89054-153">Cloud trust</span></span> |
| --- | --- | --- |
| <span data-ttu-id="89054-154">Gli utenti locali richiedono l'accesso alle risorse nel cloud, ma non viceversa</span><span class="sxs-lookup"><span data-stu-id="89054-154">On-premises users require access to resources in the cloud, but not vice versa</span></span> |<span data-ttu-id="89054-155">Unidirezionale in ingresso</span><span class="sxs-lookup"><span data-stu-id="89054-155">One-way, incoming</span></span> |<span data-ttu-id="89054-156">Unidirezionale in uscita</span><span class="sxs-lookup"><span data-stu-id="89054-156">One-way, outgoing</span></span> |
| <span data-ttu-id="89054-157">Gli utenti nel cloud richiedono l'accesso alle risorse nel cloud, ma non viceversa</span><span class="sxs-lookup"><span data-stu-id="89054-157">Users in the cloud require access to resources located on-premises, but not vice versa</span></span> |<span data-ttu-id="89054-158">Unidirezionale in uscita</span><span class="sxs-lookup"><span data-stu-id="89054-158">One-way, outgoing</span></span> |<span data-ttu-id="89054-159">Unidirezionale in ingresso</span><span class="sxs-lookup"><span data-stu-id="89054-159">One-way, incoming</span></span> |
| <span data-ttu-id="89054-160">Gli utenti locali e nel cloud richiedono entrambi l'accesso alle risorse contenute nel cloud e locali</span><span class="sxs-lookup"><span data-stu-id="89054-160">Users in the cloud and on-premises both requires access to resources held in the cloud and on-premises</span></span> |<span data-ttu-id="89054-161">Bidirezionale, in ingresso e in uscita</span><span class="sxs-lookup"><span data-stu-id="89054-161">Two-way, incoming and outgoing</span></span> |<span data-ttu-id="89054-162">Bidirezionale, in ingresso e in uscita</span><span class="sxs-lookup"><span data-stu-id="89054-162">Two-way, incoming and outgoing</span></span> |

## <a name="scalability-considerations"></a><span data-ttu-id="89054-163">Considerazioni sulla scalabilità</span><span class="sxs-lookup"><span data-stu-id="89054-163">Scalability considerations</span></span>

<span data-ttu-id="89054-164">Active Directory offre scalabilità automatica per i controller di dominio che fanno parte dello stesso dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-164">Active Directory is automatically scalable for domain controllers that are part of the same domain.</span></span> <span data-ttu-id="89054-165">Le richieste vengono distribuite tra tutti i controller all'interno di un dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-165">Requests are distributed across all controllers within a domain.</span></span> <span data-ttu-id="89054-166">È possibile aggiungere un altro controller di dominio, che viene sincronizzato automaticamente con il dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-166">You can add another domain controller, and it synchronizes automatically with the domain.</span></span> <span data-ttu-id="89054-167">Non configurare un dispositivo di bilanciamento del carico separato per indirizzare il traffico verso i controller all'interno del dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-167">Do not configure a separate load balancer to direct traffic to controllers within the domain.</span></span> <span data-ttu-id="89054-168">Verificare che tutti i controller di dominio dispongano di risorse di memoria e archiviazione sufficienti per gestire il database del dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-168">Ensure that all domain controllers have sufficient memory and storage resources to handle the domain database.</span></span> <span data-ttu-id="89054-169">Impostare dimensioni uguali per tutte le macchine virtuali del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-169">Make all domain controller VMs the same size.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="89054-170">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="89054-170">Availability considerations</span></span>

<span data-ttu-id="89054-171">Eseguire il provisioning di almeno due controller di dominio per ogni dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-171">Provision at least two domain controllers for each domain.</span></span> <span data-ttu-id="89054-172">Questo consente la replica automatica tra server.</span><span class="sxs-lookup"><span data-stu-id="89054-172">This enables automatic replication between servers.</span></span> <span data-ttu-id="89054-173">Creare un set di disponibilità per le macchine virtuali che fungono da server Active Directory per la gestione di ogni dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-173">Create an availability set for the VMs acting as Active Directory servers handling each domain.</span></span> <span data-ttu-id="89054-174">In questo set di disponibilità, inserire almeno due server.</span><span class="sxs-lookup"><span data-stu-id="89054-174">Put at least two servers in this availability set.</span></span>

<span data-ttu-id="89054-175">Inoltre, è opportuno designare uno o più server in ogni dominio come [master operazioni in standby][standby-operations-masters], in caso di errori di connettività con un server che riveste il ruolo FSMO (Flexible Single Master Operation).</span><span class="sxs-lookup"><span data-stu-id="89054-175">Also, consider designating one or more servers in each domain as [standby operations masters][standby-operations-masters] in case connectivity to a server acting as a flexible single master operation (FSMO) role fails.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="89054-176">Considerazioni sulla gestibilità</span><span class="sxs-lookup"><span data-stu-id="89054-176">Manageability considerations</span></span>

<span data-ttu-id="89054-177">Per considerazioni sulla gestione e il monitoraggio, vedere [Estensione di Active Directory Domain Services in Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="89054-177">For information about management and monitoring considerations, see [Extending Active Directory to Azure][adds-extend-domain].</span></span> 
 
<span data-ttu-id="89054-178">Per altre informazioni, vedere [Monitoring Active Directory][monitoring_ad] (Monitoraggio di Active Directory).</span><span class="sxs-lookup"><span data-stu-id="89054-178">For additional information, see [Monitoring Active Directory][monitoring_ad].</span></span> <span data-ttu-id="89054-179">È possibile installare strumenti come [Microsoft Systems Center][microsoft_systems_center] in un server di monitoraggio della subnet di gestione per agevolare l'esecuzione di queste attività.</span><span class="sxs-lookup"><span data-stu-id="89054-179">You can install tools such as [Microsoft Systems Center][microsoft_systems_center] on a monitoring server in the management subnet to help perform these tasks.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="89054-180">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="89054-180">Security considerations</span></span>

<span data-ttu-id="89054-181">I trust a livello di foresta sono transitivi.</span><span class="sxs-lookup"><span data-stu-id="89054-181">Forest level trusts are transitive.</span></span> <span data-ttu-id="89054-182">Se si stabilisce un trust a livello di foresta tra una foresta locale e una foresta nel cloud, la relazione di trust viene estesa ai nuovi domini creati in entrambe le foreste.</span><span class="sxs-lookup"><span data-stu-id="89054-182">If you establish a forest level trust between an on-premises forest and a forest in the cloud, this trust is extended to other new domains created in either forest.</span></span> <span data-ttu-id="89054-183">Se si usano i domini per implementare la separazione a scopo di sicurezza, è consigliabile creare trust solo a livello di dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-183">If you use domains to provide separation for security purposes, consider creating trusts at the domain level only.</span></span> <span data-ttu-id="89054-184">I trust a livello di dominio sono non transitivi.</span><span class="sxs-lookup"><span data-stu-id="89054-184">Domain level trusts are non-transitive.</span></span>

<span data-ttu-id="89054-185">Per considerazioni sulla sicurezza specifiche di Active Directory, vedere la sezione corrispondente in [Estensione di Active Directory Domain Services in Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="89054-185">For Active Directory-specific security considerations, see the security considerations section in [Extending Active Directory to Azure][adds-extend-domain].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="89054-186">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="89054-186">Deploy the solution</span></span>

<span data-ttu-id="89054-187">Una soluzione per la distribuzione di questa architettura di riferimento è disponibile in [GitHub][github].</span><span class="sxs-lookup"><span data-stu-id="89054-187">A solution is available on [GitHub][github] to deploy this reference architecture.</span></span> <span data-ttu-id="89054-188">Per eseguire lo script di PowerShell che distribuisce la soluzione è necessaria l'ultima versione dell'interfaccia della riga di comando di Azure.</span><span class="sxs-lookup"><span data-stu-id="89054-188">You will need the latest version of the Azure CLI to run the Powershell script that deploys the solution.</span></span> <span data-ttu-id="89054-189">Per distribuire l'architettura di riferimento, eseguire la procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="89054-189">To deploy the reference architecture, follow these steps:</span></span>

1. <span data-ttu-id="89054-190">Scaricare o clonare la cartella della soluzione da [GitHub][github] al computer locale.</span><span class="sxs-lookup"><span data-stu-id="89054-190">Download or clone the solution folder from [GitHub][github] to your local machine.</span></span>

2. <span data-ttu-id="89054-191">Aprire l'interfaccia della riga di comando di Azure e passare alla cartella della soluzione locale.</span><span class="sxs-lookup"><span data-stu-id="89054-191">Open the Azure CLI and navigate to the local solution folder.</span></span>

3. <span data-ttu-id="89054-192">Eseguire il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="89054-192">Run the following command:</span></span>
   
    ```Powershell
    .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> <mode>
    ```
   
    <span data-ttu-id="89054-193">Sostituire `<subscription id>` con l'ID della sottoscrizione di Azure.</span><span class="sxs-lookup"><span data-stu-id="89054-193">Replace `<subscription id>` with your Azure subscription ID.</span></span>
   
    <span data-ttu-id="89054-194">Per `<location>`, specificare un'area di Azure, come `eastus` o `westus`.</span><span class="sxs-lookup"><span data-stu-id="89054-194">For `<location>`, specify an Azure region, such as `eastus` or `westus`.</span></span>
   
    <span data-ttu-id="89054-195">Il parametro `<mode>` controlla la granularità della distribuzione e può essere uno dei valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="89054-195">The `<mode>` parameter controls the granularity of the deployment, and can be one of the following values:</span></span>
   
   * <span data-ttu-id="89054-196">`Onpremise`: distribuisce l'ambiente locale simulato.</span><span class="sxs-lookup"><span data-stu-id="89054-196">`Onpremise`: deploys the simulated on-premises environment.</span></span>
   * <span data-ttu-id="89054-197">`Infrastructure`: distribuisce l'infrastruttura di rete virtuale e il jumpbox in Azure.</span><span class="sxs-lookup"><span data-stu-id="89054-197">`Infrastructure`: deploys the VNet infrastructure and jump box in Azure.</span></span>
   * <span data-ttu-id="89054-198">`CreateVpn`: distribuisce il gateway di rete virtuale di Azure e lo connette alla rete locale simulata.</span><span class="sxs-lookup"><span data-stu-id="89054-198">`CreateVpn`: deploys the Azure virtual network gateway and connects it to the simulated on-premises network.</span></span>
   * <span data-ttu-id="89054-199">`AzureADDS`: distribuisce le macchine virtuali che agiscono come server Active Directory Domain Services, distribuisce Active Directory in queste macchine virtuali e distribuisce il dominio in Azure.</span><span class="sxs-lookup"><span data-stu-id="89054-199">`AzureADDS`: deploys the VMs acting as Active Directory DS servers, deploys Active Directory to these VMs, and deploys the domain in Azure.</span></span>
   * <span data-ttu-id="89054-200">`WebTier`: distribuisce le macchine virtuali e il software di bilanciamento del carico di livello Web.</span><span class="sxs-lookup"><span data-stu-id="89054-200">`WebTier`: deploys the web tier VMs and load balancer.</span></span>
   * <span data-ttu-id="89054-201">`Prepare`: distribuisce tutte le distribuzioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="89054-201">`Prepare`: deploys all of the preceding deployments.</span></span> <span data-ttu-id="89054-202">**Questa è l'opzione consigliata se non si ha una rete locale esistente, ma si vuole distribuire l'architettura di riferimento completa descritta in precedenza a scopo di testing o valutazione.**</span><span class="sxs-lookup"><span data-stu-id="89054-202">**This is the recommended option if If you do not have an existing on-premises network but you want to deploy the complete reference architecture described above for testing or evaluation.**</span></span> 
   * <span data-ttu-id="89054-203">`Workload`: distribuisce le macchine virtuali e il software di bilanciamento del carico di livello Web e business.</span><span class="sxs-lookup"><span data-stu-id="89054-203">`Workload`: deploys the business and data tier VMs and load balancers.</span></span> <span data-ttu-id="89054-204">Si noti che queste macchine virtuali non sono incluse nella distribuzione `Prepare`.</span><span class="sxs-lookup"><span data-stu-id="89054-204">Note that these VMs are not included in the `Prepare` deployment.</span></span>

4. <span data-ttu-id="89054-205">Attendere il completamento della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="89054-205">Wait for the deployment to complete.</span></span> <span data-ttu-id="89054-206">Se si sta distribuendo la distribuzione `Prepare`, saranno necessarie diverse ore.</span><span class="sxs-lookup"><span data-stu-id="89054-206">If you are deploying the `Prepare` deployment, it will take several hours.</span></span>
     
5. <span data-ttu-id="89054-207">Se si usa la configurazione locale simulata, configurare la relazione di trust in ingresso:</span><span class="sxs-lookup"><span data-stu-id="89054-207">If you are using the simulated on-premises configuration, configure the incoming trust relationship:</span></span>
   
   1. <span data-ttu-id="89054-208">Connettersi al jumpbox (*ra-adtrust-mgmt-vm1* nel gruppo di risorse *ra-adtrust-security-rg*).</span><span class="sxs-lookup"><span data-stu-id="89054-208">Connect to the jump box (*ra-adtrust-mgmt-vm1* in the *ra-adtrust-security-rg* resource group).</span></span> <span data-ttu-id="89054-209">Accedere come *testuser* con la password *AweS0me@PW*.</span><span class="sxs-lookup"><span data-stu-id="89054-209">Log in as *testuser* with password *AweS0me@PW*.</span></span>
   2. <span data-ttu-id="89054-210">Nel jumpbox aprire una sessione RDP nella prima macchina virtuale nel dominio *contoso.com* (dominio locale).</span><span class="sxs-lookup"><span data-stu-id="89054-210">On the jump box open an RDP session on the first VM in the *contoso.com* domain (the on-premises domain).</span></span> <span data-ttu-id="89054-211">L'indirizzo IP di questa macchina virtuale è 192.168.0.4.</span><span class="sxs-lookup"><span data-stu-id="89054-211">This VM has the IP address 192.168.0.4.</span></span> <span data-ttu-id="89054-212">Il nome utente è *contoso\testuser* con password *AweS0me@PW*.</span><span class="sxs-lookup"><span data-stu-id="89054-212">The username is *contoso\testuser* with password *AweS0me@PW*.</span></span>
   3. <span data-ttu-id="89054-213">Scaricare lo script [incoming-trust.ps1][incoming-trust] ed eseguirlo per creare il trust in ingresso dal dominio *treyresearch.com*.</span><span class="sxs-lookup"><span data-stu-id="89054-213">Download the [incoming-trust.ps1][incoming-trust] script and run it to create the incoming trust from the *treyresearch.com* domain.</span></span>

6. <span data-ttu-id="89054-214">Se si usa la propria infrastruttura locale:</span><span class="sxs-lookup"><span data-stu-id="89054-214">If you are using your own on-premises infrastructure:</span></span>
   
   1. <span data-ttu-id="89054-215">Scaricare lo script [incoming-trust.ps1][incoming-trust].</span><span class="sxs-lookup"><span data-stu-id="89054-215">Download the [incoming-trust.ps1][incoming-trust] script.</span></span>
   2. <span data-ttu-id="89054-216">Modificare lo script e sostituire il valore della variabile `$TrustedDomainName` con il nome del proprio dominio.</span><span class="sxs-lookup"><span data-stu-id="89054-216">Edit the script and replace the value of the `$TrustedDomainName` variable with the name of your own domain.</span></span>
   3. <span data-ttu-id="89054-217">Eseguire lo script.</span><span class="sxs-lookup"><span data-stu-id="89054-217">Run the script.</span></span>

7. <span data-ttu-id="89054-218">Dal jumpbox connettersi alla prima macchina virtuale nel dominio *treyresearch.com* (il dominio nel cloud).</span><span class="sxs-lookup"><span data-stu-id="89054-218">From the jump-box, connect to the first VM in the *treyresearch.com* domain (the domain in the cloud).</span></span> <span data-ttu-id="89054-219">L'indirizzo IP di questa macchina virtuale è 10.0.4.4.</span><span class="sxs-lookup"><span data-stu-id="89054-219">This VM has the IP address 10.0.4.4.</span></span> <span data-ttu-id="89054-220">Il nome utente è *treyresearch\testuser* con password *AweS0me@PW*.</span><span class="sxs-lookup"><span data-stu-id="89054-220">The username is *treyresearch\testuser* with password *AweS0me@PW*.</span></span>

8. <span data-ttu-id="89054-221">Scaricare lo script [outgoing-trust.ps1][outgoing-trust] ed eseguirlo per creare il trust in ingresso dal dominio *treyresearch.com*.</span><span class="sxs-lookup"><span data-stu-id="89054-221">Download the [outgoing-trust.ps1][outgoing-trust] script and run it to create the incoming trust from the *treyresearch.com* domain.</span></span> <span data-ttu-id="89054-222">Se si usano i propri computer locali, prima di tutto modificare lo script.</span><span class="sxs-lookup"><span data-stu-id="89054-222">If you are using your own on-premises machines, then edit the script first.</span></span> <span data-ttu-id="89054-223">Impostare la variabile `$TrustedDomainName` sul nome del dominio locale e specificare gli indirizzi IP dei server di Active Directory Domain Services per questo dominio nella variabile `$TrustedDomainDnsIpAddresses`.</span><span class="sxs-lookup"><span data-stu-id="89054-223">Set the `$TrustedDomainName` variable to the name of your on-premises domain, and specify the IP addresses of the Active Directory DS servers for this domain in the `$TrustedDomainDnsIpAddresses` variable.</span></span>

9. <span data-ttu-id="89054-224">Attendere qualche minuto per il completamento dei passaggi precedenti, quindi connettersi a una macchina virtuale locale ed eseguire la procedura descritta nell'articolo [Verificare un trust][verify-a-trust] per determinare se la relazione di trust tra i domini *contoso.com* e *treyresearch.com* è configurata correttamente.</span><span class="sxs-lookup"><span data-stu-id="89054-224">Wait a few minutes for the previous steps to complete, then connect to an on-premises VM and perform the steps outlined in the article [Verify a Trust][verify-a-trust] to determine whether the trust relationship between the *contoso.com* and *treyresearch.com* domains is correctly configured.</span></span>

## <a name="next-steps"></a><span data-ttu-id="89054-225">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="89054-225">Next steps</span></span>

* <span data-ttu-id="89054-226">Procedure consigliate per [estendere il dominio di Active Directory Domain Services in Azure][adds-extend-domain]</span><span class="sxs-lookup"><span data-stu-id="89054-226">Learn the best practices for [extending your on-premises AD DS domain to Azure][adds-extend-domain]</span></span>
* <span data-ttu-id="89054-227">Procedure consigliate per [creare un'infrastruttura Active Directory Federation Services][adfs] in Azure.</span><span class="sxs-lookup"><span data-stu-id="89054-227">Learn the best practices for [creating an AD FS infrastructure][adfs] in Azure.</span></span>

<!-- links -->
[adds-extend-domain]: adds-extend-domain.md
[adfs]: adfs.md

[implementing-a-secure-hybrid-network-architecture]: ../dmz/secure-vnet-hybrid.md
[implementing-a-secure-hybrid-network-architecture-with-internet-access]: ../dmz/secure-vnet-dmz.md

[running-VMs-for-an-N-tier-architecture-on-Azure]: ../virtual-machines-windows/n-tier.md

[ad-azure-guidelines]: https://msdn.microsoft.com/library/azure/jj156090.aspx
[azure-expressroute]: https://azure.microsoft.com/documentation/articles/expressroute-introduction/
[azure-vpn-gateway]: https://azure.microsoft.com/documentation/articles/vpn-gateway-about-vpngateways/
[considerations]: ./considerations.md
[creating-external-trusts]: https://technet.microsoft.com/library/cc816837(v=ws.10).aspx
[creating-forest-trusts]: https://technet.microsoft.com/library/cc816810(v=ws.10).aspx
[github]: https://github.com/mspnp/reference-architectures/tree/master/identity/adds-forest
[incoming-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/extensions/incoming-trust.ps1
[microsoft_systems_center]: https://www.microsoft.com/server-cloud/products/system-center-2016/
[monitoring_ad]: https://msdn.microsoft.com/library/bb727046.aspx
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[solution-script]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/Deploy-ReferenceArchitecture.ps1
[standby-operations-masters]: https://technet.microsoft.com/library/cc794737(v=ws.10).aspx
[outgoing-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/extensions/outgoing-trust.ps1
[verify-a-trust]: https://technet.microsoft.com/library/cc753821.aspx
[visio-download]: https://archcenter.azureedge.net/cdn/identity-architectures.vsdx
[0]: ./images/adds-forest.png "Architettura di rete ibrida sicura con domini di Active Directory separati"