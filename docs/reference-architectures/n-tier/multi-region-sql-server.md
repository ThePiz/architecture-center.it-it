---
title: Applicazione a più livelli per più aree per la disponibilità elevata
titleSuffix: Azure Reference Architectures
description: Distribuire un'applicazione sulle macchine virtuali di Azure in più aree per la disponibilità elevata e resilienza.
author: MikeWasson
ms.date: 07/19/2018
ms.custom: seodec18
ms.openlocfilehash: 84da8aaef7e552beff1f06befbaa2e50a3ac3d8b
ms.sourcegitcommit: bb7fcffbb41e2c26a26f8781df32825eb60df70c
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 12/20/2018
ms.locfileid: "53643709"
---
# <a name="run-an-n-tier-application-in-multiple-azure-regions-for-high-availability"></a><span data-ttu-id="03278-103">Eseguire un'applicazione a più livelli in più aree di Azure per una disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="03278-103">Run an N-tier application in multiple Azure regions for high availability</span></span>

<span data-ttu-id="03278-104">Questa architettura di riferimento mostra un set di procedure consolidate per l'esecuzione di un'applicazione a più livelli in più aree di Azure, per ottenere disponibilità e un'infrastruttura di ripristino di emergenza affidabile.</span><span class="sxs-lookup"><span data-stu-id="03278-104">This reference architecture shows a set of proven practices for running an N-tier application in multiple Azure regions, in order to achieve availability and a robust disaster recovery infrastructure.</span></span>

![Architettura di rete a disponibilità elevata per applicazioni Azure a più livelli](./images/multi-region-sql-server.png)

<span data-ttu-id="03278-106">*Scaricare un [file Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="03278-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="03278-107">Architettura</span><span class="sxs-lookup"><span data-stu-id="03278-107">Architecture</span></span>

<span data-ttu-id="03278-108">Questa architettura si basa su quella illustrata in [Applicazione a più livelli con SQL Server](n-tier-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="03278-108">This architecture builds on the one shown in [N-tier application with SQL Server](n-tier-sql-server.md).</span></span>

- <span data-ttu-id="03278-109">**Aree primarie e secondarie**.</span><span class="sxs-lookup"><span data-stu-id="03278-109">**Primary and secondary regions**.</span></span> <span data-ttu-id="03278-110">Usare due aree per ottenere una maggiore disponibilità:</span><span class="sxs-lookup"><span data-stu-id="03278-110">Use two regions to achieve higher availability.</span></span> <span data-ttu-id="03278-111">una è l'area primaria,</span><span class="sxs-lookup"><span data-stu-id="03278-111">One is the primary region.</span></span> <span data-ttu-id="03278-112">l'altra è per il failover.</span><span class="sxs-lookup"><span data-stu-id="03278-112">The other region is for failover.</span></span>

- <span data-ttu-id="03278-113">**Gestione traffico di Azure**.</span><span class="sxs-lookup"><span data-stu-id="03278-113">**Azure Traffic Manager**.</span></span> <span data-ttu-id="03278-114">[Gestione traffico][traffic-manager] indirizza le richieste in ingresso a una delle aree.</span><span class="sxs-lookup"><span data-stu-id="03278-114">[Traffic Manager][traffic-manager] routes incoming requests to one of the regions.</span></span> <span data-ttu-id="03278-115">Durante il normale funzionamento, le richieste vengono indirizzate all'area primaria.</span><span class="sxs-lookup"><span data-stu-id="03278-115">During normal operations, it routes requests to the primary region.</span></span> <span data-ttu-id="03278-116">Se tale area non è più disponibile, Gestione traffico effettua il failover all'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="03278-116">If that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span> <span data-ttu-id="03278-117">Per altre informazioni, vedere la sezione [Configurazione di Gestione traffico](#traffic-manager-configuration).</span><span class="sxs-lookup"><span data-stu-id="03278-117">For more information, see the section [Traffic Manager configuration](#traffic-manager-configuration).</span></span>

- <span data-ttu-id="03278-118">**Gruppi di risorse**.</span><span class="sxs-lookup"><span data-stu-id="03278-118">**Resource groups**.</span></span> <span data-ttu-id="03278-119">Creare [gruppi di risorse][resource groups] distinti per l'area primaria, l'area secondaria e Gestione traffico.</span><span class="sxs-lookup"><span data-stu-id="03278-119">Create separate [resource groups][resource groups] for the primary region, the secondary region, and for Traffic Manager.</span></span> <span data-ttu-id="03278-120">In questo modo si ottiene la flessibilità necessaria per gestire ogni area come un'unica raccolta di risorse.</span><span class="sxs-lookup"><span data-stu-id="03278-120">This gives you the flexibility to manage each region as a single collection of resources.</span></span> <span data-ttu-id="03278-121">Ad esempio, è possibile ridistribuire un'area, senza rendere non disponibile l'altra.</span><span class="sxs-lookup"><span data-stu-id="03278-121">For example, you could redeploy one region, without taking down the other one.</span></span> <span data-ttu-id="03278-122">[Collegare i gruppi di risorse][resource-group-links], in modo che sia possibile eseguire una query per elencare tutte le risorse per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="03278-122">[Link the resource groups][resource-group-links], so that you can run a query to list all the resources for the application.</span></span>

- <span data-ttu-id="03278-123">**Reti virtuali**.</span><span class="sxs-lookup"><span data-stu-id="03278-123">**VNets**.</span></span> <span data-ttu-id="03278-124">Creare una rete virtuale distinta per ogni area.</span><span class="sxs-lookup"><span data-stu-id="03278-124">Create a separate VNet for each region.</span></span> <span data-ttu-id="03278-125">Assicurarsi che gli spazi degli indirizzi non si sovrappongano.</span><span class="sxs-lookup"><span data-stu-id="03278-125">Make sure the address spaces do not overlap.</span></span>

- <span data-ttu-id="03278-126">**Gruppo di disponibilità Always On di SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="03278-126">**SQL Server Always On Availability Group**.</span></span> <span data-ttu-id="03278-127">Se si usa SQL Server, è consigliabile usare i [gruppi di disponibilità Always On di SQL Server][sql-always-on] per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="03278-127">If you are using SQL Server, we recommend [SQL Always On Availability Groups][sql-always-on] for high availability.</span></span> <span data-ttu-id="03278-128">Creare un unico gruppo di disponibilità che includa le istanze di SQL Server in entrambe le aree.</span><span class="sxs-lookup"><span data-stu-id="03278-128">Create a single availability group that includes the SQL Server instances in both regions.</span></span>

    > [!NOTE]
    > <span data-ttu-id="03278-129">Prendere in considerazione anche l'uso del [database SQL di Azure][azure-sql-db], che fornisce un database relazionale come servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="03278-129">Also consider [Azure SQL Database][azure-sql-db], which provides a relational database as a cloud service.</span></span> <span data-ttu-id="03278-130">Con il database SQL, non è necessario configurare un gruppo di disponibilità o gestire il failover.</span><span class="sxs-lookup"><span data-stu-id="03278-130">With SQL Database, you don't need to configure an availability group or manage failover.</span></span>
    >

- <span data-ttu-id="03278-131">**Gateway VPN**.</span><span class="sxs-lookup"><span data-stu-id="03278-131">**VPN Gateways**.</span></span> <span data-ttu-id="03278-132">Creare un [gateway VPN][vpn-gateway] in ogni rete virtuale e configurare una [connessione da rete virtuale a rete virtuale][vnet-to-vnet] per consentire il traffico di rete tra le due reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="03278-132">Create a [VPN gateway][vpn-gateway] in each VNet, and configure a [VNet-to-VNet connection][vnet-to-vnet], to enable network traffic between the two VNets.</span></span> <span data-ttu-id="03278-133">Questa condizione è richiesta per il gruppo di disponibilità Always On di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="03278-133">This is required for the SQL Always On Availability Group.</span></span>

## <a name="recommendations"></a><span data-ttu-id="03278-134">Consigli</span><span class="sxs-lookup"><span data-stu-id="03278-134">Recommendations</span></span>

<span data-ttu-id="03278-135">Un'architettura di tipo multi-area può fornire una maggiore disponibilità rispetto alla distribuzione in un'unica area.</span><span class="sxs-lookup"><span data-stu-id="03278-135">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="03278-136">Se un'interruzione a livello di area interessa l'area primaria, è possibile usare [Gestione traffico][traffic-manager] per effettuare il failover all'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="03278-136">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="03278-137">Questa architettura è utile anche in caso di errore di un singolo sottosistema dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="03278-137">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="03278-138">Sono disponibili diversi approcci generali per ottenere una disponibilità elevata tra le diverse aree geografiche:</span><span class="sxs-lookup"><span data-stu-id="03278-138">There are several general approaches to achieving high availability across regions:</span></span>

- <span data-ttu-id="03278-139">Attivo/passivo con hot standby.</span><span class="sxs-lookup"><span data-stu-id="03278-139">Active/passive with hot standby.</span></span> <span data-ttu-id="03278-140">Il traffico viene indirizzato a un'area, mentre l'altra attende in modalità hot standby.</span><span class="sxs-lookup"><span data-stu-id="03278-140">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="03278-141">Hot standby significa che le macchine virtuali nell'area secondaria sono allocate e in esecuzione in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="03278-141">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
- <span data-ttu-id="03278-142">Attivo/passivo con cold standby.</span><span class="sxs-lookup"><span data-stu-id="03278-142">Active/passive with cold standby.</span></span> <span data-ttu-id="03278-143">Il traffico viene indirizzato a un'area, mentre l'altra attende in modalità cold standby.</span><span class="sxs-lookup"><span data-stu-id="03278-143">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="03278-144">Cold standby significa che le macchine virtuali nell'area secondaria non vengono allocate finché non diventa necessario per il failover.</span><span class="sxs-lookup"><span data-stu-id="03278-144">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="03278-145">Questo approccio presenta costi inferiori in termini di esecuzione, ma in genere richiederà più tempo per portare online le risorse in caso di errore.</span><span class="sxs-lookup"><span data-stu-id="03278-145">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
- <span data-ttu-id="03278-146">Attivo/attivo.</span><span class="sxs-lookup"><span data-stu-id="03278-146">Active/active.</span></span> <span data-ttu-id="03278-147">Entrambe le aree sono attive e viene effettuato un bilanciamento del carico tra le richieste.</span><span class="sxs-lookup"><span data-stu-id="03278-147">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="03278-148">Se un'area non è più disponibile, viene esclusa dalla rotazione.</span><span class="sxs-lookup"><span data-stu-id="03278-148">If one region becomes unavailable, it is taken out of rotation.</span></span>

<span data-ttu-id="03278-149">Questa architettura di riferimento è incentrata sulla modalità attivo/passivo con hot standby, usando Gestione traffico per il failover.</span><span class="sxs-lookup"><span data-stu-id="03278-149">This reference architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> <span data-ttu-id="03278-150">Si noti che è possibile distribuire un numero ridotto di macchine virtuali per la modalità hot standby e quindi aumentare il numero di istanze in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="03278-150">Note that you could deploy a small number of VMs for hot standby and then scale out as needed.</span></span>

### <a name="regional-pairing"></a><span data-ttu-id="03278-151">Coppie di aree</span><span class="sxs-lookup"><span data-stu-id="03278-151">Regional pairing</span></span>

<span data-ttu-id="03278-152">Ogni area di Azure è abbinata a un'altra area con la stessa collocazione geografica.</span><span class="sxs-lookup"><span data-stu-id="03278-152">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="03278-153">In generale, è consigliabile scegliere aree della stessa coppia di aree (ad esempio, Stati Uniti orientali 2 e Stati Uniti centrali).</span><span class="sxs-lookup"><span data-stu-id="03278-153">In general, choose regions from the same regional pair (for example, East US 2 and US Central).</span></span> <span data-ttu-id="03278-154">I vantaggi di questa operazione includono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="03278-154">Benefits of doing so include:</span></span>

- <span data-ttu-id="03278-155">In caso di interruzione su vasta scala, viene data priorità al ripristino di almeno un'area di ogni coppia.</span><span class="sxs-lookup"><span data-stu-id="03278-155">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
- <span data-ttu-id="03278-156">Gli aggiornamenti di sistema di Azure pianificati vengono implementati in sequenza tra le aree abbinate, per ridurre al minimo l'eventuale tempo di inattività.</span><span class="sxs-lookup"><span data-stu-id="03278-156">Planned Azure system updates are rolled out to paired regions sequentially, to minimize possible downtime.</span></span>
- <span data-ttu-id="03278-157">Le coppie si trovano nella stessa area geografica, per soddisfare i requisiti di residenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="03278-157">Pairs reside within the same geography, to meet data residency requirements.</span></span>

<span data-ttu-id="03278-158">Assicurarsi tuttavia che entrambe le aree supportino tutti i servizi di Azure necessari per l'applicazione (vedere i [servizi disponibili in base all'area][services-by-region]).</span><span class="sxs-lookup"><span data-stu-id="03278-158">However, make sure that both regions support all of the Azure services needed for your application (see [Services by region][services-by-region]).</span></span> <span data-ttu-id="03278-159">Per altre informazioni sulle coppie di aree, vedere [Continuità aziendale e ripristino di emergenza (BCDR): aree geografiche abbinate di Azure][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="03278-159">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="03278-160">Configurazione di Gestione traffico</span><span class="sxs-lookup"><span data-stu-id="03278-160">Traffic Manager configuration</span></span>

<span data-ttu-id="03278-161">Quando si configura Gestione traffico, tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="03278-161">Consider the following points when configuring Traffic Manager:</span></span>

- <span data-ttu-id="03278-162">**Routing**.</span><span class="sxs-lookup"><span data-stu-id="03278-162">**Routing**.</span></span> <span data-ttu-id="03278-163">Gestione traffico supporta diversi [algoritmi di routing][tm-routing].</span><span class="sxs-lookup"><span data-stu-id="03278-163">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="03278-164">Per lo scenario descritto in questo articolo, usare il routing *Priorità* (precedentemente denominato routing *Failover*).</span><span class="sxs-lookup"><span data-stu-id="03278-164">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="03278-165">Con questa impostazione, Gestione traffico invia tutte le richieste all'area primaria, a meno che l'area primaria non diventi irraggiungibile.</span><span class="sxs-lookup"><span data-stu-id="03278-165">With this setting, Traffic Manager sends all requests to the primary region, unless the primary region becomes unreachable.</span></span> <span data-ttu-id="03278-166">A questo punto, viene automaticamente effettuato il failover all'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="03278-166">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="03278-167">Vedere [Configurare il metodo di routing failover][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="03278-167">See [Configure Failover routing method][tm-configure-failover].</span></span>
- <span data-ttu-id="03278-168">**Probe di integrità**.</span><span class="sxs-lookup"><span data-stu-id="03278-168">**Health probe**.</span></span> <span data-ttu-id="03278-169">Gestione traffico usa un [probe][tm-monitoring] HTTP (o HTTPS) per monitorare la disponibilità di ogni area.</span><span class="sxs-lookup"><span data-stu-id="03278-169">Traffic Manager uses an HTTP (or HTTPS) [probe][tm-monitoring] to monitor the availability of each region.</span></span> <span data-ttu-id="03278-170">Il probe verifica una risposta HTTP 200 per un percorso URL specificato.</span><span class="sxs-lookup"><span data-stu-id="03278-170">The probe checks for an HTTP 200 response for a specified URL path.</span></span> <span data-ttu-id="03278-171">Come procedura consigliata, creare un endpoint che segnali l'integrità complessiva dell'applicazione e usare questo endpoint per il probe di integrità.</span><span class="sxs-lookup"><span data-stu-id="03278-171">As a best practice, create an endpoint that reports the overall health of the application, and use this endpoint for the health probe.</span></span> <span data-ttu-id="03278-172">In caso contrario, il probe potrebbe segnalare un endpoint integro quando le parti più importanti dell'applicazione in realtà hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="03278-172">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span> <span data-ttu-id="03278-173">Per altre informazioni, vedere [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern] (Modello di monitoraggio degli endpoint di integrità).</span><span class="sxs-lookup"><span data-stu-id="03278-173">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="03278-174">Quando Gestione traffico effettua il failover, per un periodo di tempo i client non riescono a raggiungere l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="03278-174">When Traffic Manager fails over there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="03278-175">La durata di questo periodo è influenzata dai fattori seguenti:</span><span class="sxs-lookup"><span data-stu-id="03278-175">The duration is affected by the following factors:</span></span>

- <span data-ttu-id="03278-176">Il probe di integrità deve rilevare che l'area primaria è diventata irraggiungibile.</span><span class="sxs-lookup"><span data-stu-id="03278-176">The health probe must detect that the primary region has become unreachable.</span></span>
- <span data-ttu-id="03278-177">I server DNS devono aggiornare i record DNS memorizzati nella cache per l'indirizzo IP, che dipende dalla durata (TTL) DNS.</span><span class="sxs-lookup"><span data-stu-id="03278-177">DNS servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="03278-178">Il valore TTL predefinito è di 300 secondi (5 minuti), ma è possibile configurare questo valore durante la creazione del profilo di Gestione traffico.</span><span class="sxs-lookup"><span data-stu-id="03278-178">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="03278-179">Per dettagli, vedere [Informazioni sul monitoraggio di Gestione traffico][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="03278-179">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="03278-180">Se Gestione traffico effettua il failover, è consigliabile eseguire un failback manuale invece di implementare un failback automatico.</span><span class="sxs-lookup"><span data-stu-id="03278-180">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="03278-181">In caso contrario, si potrebbe creare una situazione in cui l'applicazione passa alternativamente da un'area all'altra.</span><span class="sxs-lookup"><span data-stu-id="03278-181">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="03278-182">Verificare che tutti i sottosistemi dell'applicazione siano integri prima del failback.</span><span class="sxs-lookup"><span data-stu-id="03278-182">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="03278-183">Si noti che Gestione traffico effettua automaticamente il failback per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="03278-183">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="03278-184">Per evitare questa situazione, ridurre manualmente la priorità dell'area primaria dopo un evento di failover.</span><span class="sxs-lookup"><span data-stu-id="03278-184">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="03278-185">Ad esempio, si supponga che l'area primaria sia di priorità 1 e la secondaria di priorità 2.</span><span class="sxs-lookup"><span data-stu-id="03278-185">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="03278-186">Dopo un failover, impostare l'area primaria sul livello di priorità 3 per evitare il failback automatico.</span><span class="sxs-lookup"><span data-stu-id="03278-186">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="03278-187">Quando si è pronti per il cambio, aggiornare la priorità impostandola su 1.</span><span class="sxs-lookup"><span data-stu-id="03278-187">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="03278-188">Il comando seguente dell'[interfaccia della riga di comando di Azure][azure-cli] aggiorna la priorità:</span><span class="sxs-lookup"><span data-stu-id="03278-188">The following [Azure CLI][azure-cli] command updates the priority:</span></span>

```azurecli
az network traffic-manager endpoint update --resource-group <resource-group> --profile-name <profile>
    --name <endpoint-name> --type azureEndpoints --priority 3
```

<span data-ttu-id="03278-189">Un altro approccio consiste nel disabilitare temporaneamente l'endpoint finché non si è pronti per eseguire il failback:</span><span class="sxs-lookup"><span data-stu-id="03278-189">Another approach is to temporarily disable the endpoint until you are ready to fail back:</span></span>

```azurecli
az network traffic-manager endpoint update --resource-group <resource-group> --profile-name <profile>
    --name <endpoint-name> --type azureEndpoints --endpoint-status Disabled
```

<span data-ttu-id="03278-190">A seconda della causa di un failover, potrebbe essere necessario ridistribuire le risorse all'interno di un'area.</span><span class="sxs-lookup"><span data-stu-id="03278-190">Depending on the cause of a failover, you might need to redeploy the resources within a region.</span></span> <span data-ttu-id="03278-191">Prima di eseguire nuovamente il failback, eseguire un test della conformità operativa,</span><span class="sxs-lookup"><span data-stu-id="03278-191">Before failing back, perform an operational readiness test.</span></span> <span data-ttu-id="03278-192">che avrà lo scopo di verificare gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="03278-192">The test should verify things like:</span></span>

- <span data-ttu-id="03278-193">Le macchine virtuali sono configurate correttamente</span><span class="sxs-lookup"><span data-stu-id="03278-193">VMs are configured correctly.</span></span> <span data-ttu-id="03278-194">(tutto il software richiesto è installato, IIS è in esecuzione e così via).</span><span class="sxs-lookup"><span data-stu-id="03278-194">(All required software is installed, IIS is running, and so on.)</span></span>
- <span data-ttu-id="03278-195">I sottosistemi dell'applicazione sono integri.</span><span class="sxs-lookup"><span data-stu-id="03278-195">Application subsystems are healthy.</span></span>
- <span data-ttu-id="03278-196">Test funzionale</span><span class="sxs-lookup"><span data-stu-id="03278-196">Functional testing.</span></span> <span data-ttu-id="03278-197">(ad esempio, il livello del database è raggiungibile dal livello Web).</span><span class="sxs-lookup"><span data-stu-id="03278-197">(For example, the database tier is reachable from the web tier.)</span></span>

### <a name="configure-sql-server-always-on-availability-groups"></a><span data-ttu-id="03278-198">Configurare i gruppi di disponibilità Always On di SQL Server</span><span class="sxs-lookup"><span data-stu-id="03278-198">Configure SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="03278-199">Nelle versioni precedenti a Windows Server 2016 i gruppi di disponibilità Always On di SQL Server richiedono un controller di dominio e tutti i nodi del gruppo di disponibilità devono far parte dello stesso dominio Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="03278-199">Prior to Windows Server 2016, SQL Server Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same Active Directory (AD) domain.</span></span>

<span data-ttu-id="03278-200">Per configurare il gruppo di disponibilità:</span><span class="sxs-lookup"><span data-stu-id="03278-200">To configure the availability group:</span></span>

- <span data-ttu-id="03278-201">Collocare almeno due controller di dominio in ogni area.</span><span class="sxs-lookup"><span data-stu-id="03278-201">At a minimum, place two domain controllers in each region.</span></span>
- <span data-ttu-id="03278-202">Assegnare a ogni controller di dominio un indirizzo IP statico.</span><span class="sxs-lookup"><span data-stu-id="03278-202">Give each domain controller a static IP address.</span></span>
- <span data-ttu-id="03278-203">Creare una connessione da rete virtuale a rete virtuale per consentire la comunicazione tra le reti virtuali.</span><span class="sxs-lookup"><span data-stu-id="03278-203">Create a VNet-to-VNet connection to enable communication between the VNets.</span></span>
- <span data-ttu-id="03278-204">Per ogni rete virtuale, aggiungere gli indirizzi IP dei controller di dominio (da entrambe le aree) all'elenco dei server DNS.</span><span class="sxs-lookup"><span data-stu-id="03278-204">For each VNet, add the IP addresses of the domain controllers (from both regions) to the DNS server list.</span></span> <span data-ttu-id="03278-205">È possibile usare il comando dell'interfaccia della riga di comando seguente.</span><span class="sxs-lookup"><span data-stu-id="03278-205">You can use the following CLI command.</span></span> <span data-ttu-id="03278-206">Per altre informazioni, vedere [Modificare i server DNS][vnet-dns].</span><span class="sxs-lookup"><span data-stu-id="03278-206">For more information, see [Change DNS servers][vnet-dns].</span></span>

    ```azurecli
    az network vnet update --resource-group <resource-group> --name <vnet-name> --dns-servers "10.0.0.4,10.0.0.6,172.16.0.4,172.16.0.6"
    ```

- <span data-ttu-id="03278-207">Creare un [Windows Server Failover Clustering][wsfc] (WSFC) che includa le istanze di SQL Server in entrambe le aree.</span><span class="sxs-lookup"><span data-stu-id="03278-207">Create a [Windows Server Failover Clustering][wsfc] (WSFC) cluster that includes the SQL Server instances in both regions.</span></span>
- <span data-ttu-id="03278-208">Creare un gruppo di disponibilità Always On di SQL Server che includa le istanze di SQL Server in entrambe le aree primaria e secondaria.</span><span class="sxs-lookup"><span data-stu-id="03278-208">Create a SQL Server Always On Availability Group that includes the SQL Server instances in both the primary and secondary regions.</span></span> <span data-ttu-id="03278-209">Per la procedura, vedere [Extending Always On Availability Group to Remote Azure Datacenter (PowerShell)](https://blogs.msdn.microsoft.com/sqlcat/2014/09/22/extending-alwayson-availability-group-to-remote-azure-datacenter-powershell/) (Estensione del gruppo di disponibilità Always On al data center di Azure remoto (PowerShell)).</span><span class="sxs-lookup"><span data-stu-id="03278-209">See [Extending Always On Availability Group to Remote Azure Datacenter (PowerShell)](https://blogs.msdn.microsoft.com/sqlcat/2014/09/22/extending-alwayson-availability-group-to-remote-azure-datacenter-powershell/) for the steps.</span></span>

  - <span data-ttu-id="03278-210">Inserire la replica primaria nell'area primaria.</span><span class="sxs-lookup"><span data-stu-id="03278-210">Put the primary replica in the primary region.</span></span>
  - <span data-ttu-id="03278-211">Inserire una o più repliche secondarie nell'area primaria.</span><span class="sxs-lookup"><span data-stu-id="03278-211">Put one or more secondary replicas in the primary region.</span></span> <span data-ttu-id="03278-212">Configurarle per l'uso del commit sincrono con il failover automatico.</span><span class="sxs-lookup"><span data-stu-id="03278-212">Configure these to use synchronous commit with automatic failover.</span></span>
  - <span data-ttu-id="03278-213">Inserire una o più repliche secondarie nell'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="03278-213">Put one or more secondary replicas in the secondary region.</span></span> <span data-ttu-id="03278-214">Configurarle per l'uso del commit *asincrono* per motivi di prestazioni</span><span class="sxs-lookup"><span data-stu-id="03278-214">Configure these to use *asynchronous* commit, for performance reasons.</span></span> <span data-ttu-id="03278-215">(in caso contrario, tutte le transazioni T-SQL dovranno attendere l'esecuzione di un round trip in rete all'area secondaria).</span><span class="sxs-lookup"><span data-stu-id="03278-215">(Otherwise, all T-SQL transactions have to wait on a round trip over the network to the secondary region.)</span></span>

    > [!NOTE]
    > <span data-ttu-id="03278-216">Le repliche con commit asincrono non supportano il failover automatico.</span><span class="sxs-lookup"><span data-stu-id="03278-216">Asynchronous commit replicas do not support automatic failover.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="03278-217">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="03278-217">Availability considerations</span></span>

<span data-ttu-id="03278-218">Con un'app complessa a più livelli, potrebbe non essere necessario replicare l'intera applicazione nell'area secondaria.</span><span class="sxs-lookup"><span data-stu-id="03278-218">With a complex N-tier app, you may not need to replicate the entire application in the secondary region.</span></span> <span data-ttu-id="03278-219">In alternativa, è possibile replicare solo un sottosistema critico indispensabile per supportare la continuità aziendale.</span><span class="sxs-lookup"><span data-stu-id="03278-219">Instead, you might just replicate a critical subsystem that is needed to support business continuity.</span></span>

<span data-ttu-id="03278-220">Gestione traffico è un possibile punto di guasto nel sistema.</span><span class="sxs-lookup"><span data-stu-id="03278-220">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="03278-221">In caso di interruzione del servizio Gestione traffico, i client non riescono ad accedere all'applicazione durante il tempo di inattività.</span><span class="sxs-lookup"><span data-stu-id="03278-221">If the Traffic Manager service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="03278-222">Rivedere il [contratto di servizio di Gestione traffico][tm-sla] e determinare se l'uso di Gestione traffico da solo soddisfa i requisiti aziendali per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="03278-222">Review the [Traffic Manager SLA][tm-sla], and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="03278-223">In caso contrario, considerare di aggiungere un'altra soluzione di gestione del traffico come failback.</span><span class="sxs-lookup"><span data-stu-id="03278-223">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="03278-224">In caso di errore del servizio Gestione traffico di Azure, modificare i record CNAME in DNS in modo da puntare all'altro servizio di gestione del traffico</span><span class="sxs-lookup"><span data-stu-id="03278-224">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="03278-225">(questo passaggio deve essere eseguito manualmente e l'applicazione non sarà disponibile finché non vengono propagate le modifiche al DNS).</span><span class="sxs-lookup"><span data-stu-id="03278-225">(This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.)</span></span>

<span data-ttu-id="03278-226">Per il cluster di SQL Server, sono da considerare due scenari di failover:</span><span class="sxs-lookup"><span data-stu-id="03278-226">For the SQL Server cluster, there are two failover scenarios to consider:</span></span>

- <span data-ttu-id="03278-227">Tutte le repliche del database SQL Server nell'area primaria hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="03278-227">All of the SQL Server database replicas in the primary region fail.</span></span> <span data-ttu-id="03278-228">Ad esempio, questo problema potrebbe verificarsi durante un'interruzione a livello di area.</span><span class="sxs-lookup"><span data-stu-id="03278-228">For example, this could happen during a regional outage.</span></span> <span data-ttu-id="03278-229">In questo caso, è necessario effettuare manualmente il failover del gruppo di disponibilità, anche se Gestione traffico effettua il failover automaticamente sul front-end.</span><span class="sxs-lookup"><span data-stu-id="03278-229">In that case, you must manually fail over the availability group, even though Traffic Manager automatically fails over on the front end.</span></span> <span data-ttu-id="03278-230">Seguire i passaggi in [Eseguire un failover manuale forzato di un gruppo di disponibilità di SQL Server](https://msdn.microsoft.com/library/ff877957.aspx), che descrive come effettuare un failover forzato usando SQL Server Management Studio, Transact-SQL o PowerShell in SQL Server 2016.</span><span class="sxs-lookup"><span data-stu-id="03278-230">Follow the steps in [Perform a Forced Manual Failover of a SQL Server Availability Group](https://msdn.microsoft.com/library/ff877957.aspx), which describes how to perform a forced failover by using SQL Server Management Studio, Transact-SQL, or PowerShell in SQL Server 2016.</span></span>

   > [!WARNING]
   > <span data-ttu-id="03278-231">Con il failover forzato, sussiste il rischio di perdita dei dati.</span><span class="sxs-lookup"><span data-stu-id="03278-231">With forced failover, there is a risk of data loss.</span></span> <span data-ttu-id="03278-232">Quando l'area primaria torna online, eseguire uno snapshot del database e usare [tablediff] per individuare le differenze.</span><span class="sxs-lookup"><span data-stu-id="03278-232">Once the primary region is back online, take a snapshot of the database and use [tablediff] to find the differences.</span></span>

- <span data-ttu-id="03278-233">Gestione traffico effettua il failover all'area secondaria, ma la replica primaria del database SQL Server è ancora disponibile.</span><span class="sxs-lookup"><span data-stu-id="03278-233">Traffic Manager fails over to the secondary region, but the primary SQL Server database replica is still available.</span></span> <span data-ttu-id="03278-234">Ad esempio, nel livello front-end potrebbe verificarsi un errore che non si ripercuote sulle macchine virtuali di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="03278-234">For example, the front-end tier might fail, without affecting the SQL Server VMs.</span></span> <span data-ttu-id="03278-235">In tal caso, il traffico Internet viene indirizzato all'area secondaria e tale area può comunque connettersi alla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="03278-235">In that case, Internet traffic is routed to the secondary region, and that region can still connect to the primary replica.</span></span> <span data-ttu-id="03278-236">Tuttavia, vi sarà un aumento della latenza, poiché le connessioni di SQL Server attraversano le aree geografiche.</span><span class="sxs-lookup"><span data-stu-id="03278-236">However, there will be increased latency, because the SQL Server connections are going across regions.</span></span> <span data-ttu-id="03278-237">In questa situazione è necessario effettuare un failover manuale come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="03278-237">In this situation, you should perform a manual failover as follows:</span></span>

   1. <span data-ttu-id="03278-238">Passare temporaneamente una replica del database SQL Server nell'area secondaria al commit *sincrono*,</span><span class="sxs-lookup"><span data-stu-id="03278-238">Temporarily switch a SQL Server database replica in the secondary region to *synchronous* commit.</span></span> <span data-ttu-id="03278-239">in modo da garantire che non si verifichino perdite di dati durante il failover.</span><span class="sxs-lookup"><span data-stu-id="03278-239">This ensures there won't be data loss during the failover.</span></span>
   2. <span data-ttu-id="03278-240">Effettuare il failover a tale replica.</span><span class="sxs-lookup"><span data-stu-id="03278-240">Fail over to that replica.</span></span>
   3. <span data-ttu-id="03278-241">Quando si effettua il failback all'area primaria, ripristinare l'impostazione di commit asincrono.</span><span class="sxs-lookup"><span data-stu-id="03278-241">When you fail back to the primary region, restore the asynchronous commit setting.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="03278-242">Considerazioni sulla gestibilità</span><span class="sxs-lookup"><span data-stu-id="03278-242">Manageability considerations</span></span>

<span data-ttu-id="03278-243">Quando si aggiorna la distribuzione, aggiornare un'area alla volta per ridurre la probabilità di un errore globale da una configurazione errata o un errore nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="03278-243">When you update your deployment, update one region at a time to reduce the chance of a global failure from an incorrect configuration or an error in the application.</span></span>

<span data-ttu-id="03278-244">Testare la resilienza del sistema agli errori.</span><span class="sxs-lookup"><span data-stu-id="03278-244">Test the resiliency of the system to failures.</span></span> <span data-ttu-id="03278-245">Di seguito sono riportati alcuni scenari di errore comuni da testare:</span><span class="sxs-lookup"><span data-stu-id="03278-245">Here are some common failure scenarios to test:</span></span>

- <span data-ttu-id="03278-246">Arrestare le istanze di macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="03278-246">Shut down VM instances.</span></span>
- <span data-ttu-id="03278-247">Esercitare un uso elevato delle risorse come CPU e memoria.</span><span class="sxs-lookup"><span data-stu-id="03278-247">Pressure resources such as CPU and memory.</span></span>
- <span data-ttu-id="03278-248">Disconnettere/ritardare la rete.</span><span class="sxs-lookup"><span data-stu-id="03278-248">Disconnect/delay network.</span></span>
- <span data-ttu-id="03278-249">Arrestare in modo anomalo i processi.</span><span class="sxs-lookup"><span data-stu-id="03278-249">Crash processes.</span></span>
- <span data-ttu-id="03278-250">Far scadere i certificati.</span><span class="sxs-lookup"><span data-stu-id="03278-250">Expire certificates.</span></span>
- <span data-ttu-id="03278-251">Simulare errori hardware.</span><span class="sxs-lookup"><span data-stu-id="03278-251">Simulate hardware faults.</span></span>
- <span data-ttu-id="03278-252">Arrestare il servizio DNS nei controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="03278-252">Shut down the DNS service on the domain controllers.</span></span>

<span data-ttu-id="03278-253">Misurare i tempi di ripristino e verificare che soddisfino i requisiti aziendali.</span><span class="sxs-lookup"><span data-stu-id="03278-253">Measure the recovery times and verify they meet your business requirements.</span></span> <span data-ttu-id="03278-254">Testare anche le combinazioni di modalità di errore.</span><span class="sxs-lookup"><span data-stu-id="03278-254">Test combinations of failure modes, as well.</span></span>

## <a name="related-resources"></a><span data-ttu-id="03278-255">Risorse correlate</span><span class="sxs-lookup"><span data-stu-id="03278-255">Related resources</span></span>

<span data-ttu-id="03278-256">Può essere utile esaminare gli [scenari di esempio di Azure](/azure/architecture/example-scenario) seguenti, che illustrano soluzioni specifiche usando alcune delle stesse tecnologie:</span><span class="sxs-lookup"><span data-stu-id="03278-256">You may wish to review the following [Azure example scenarios](/azure/architecture/example-scenario) that demonstrate specific solutions using some of the same technologies:</span></span>

- [<span data-ttu-id="03278-257">Applicazione Web multilivello per disponibilità elevata e ripristino di emergenza in Azure</span><span class="sxs-lookup"><span data-stu-id="03278-257">Multitier web application built for high availability and disaster recovery on Azure</span></span>](/azure/architecture/example-scenario/infrastructure/multi-tier-app-disaster-recovery)
- [<span data-ttu-id="03278-258">Creazione di applicazioni Web sicure con macchine virtuali Windows in Azure</span><span class="sxs-lookup"><span data-stu-id="03278-258">Building secure web applications with Windows virtual machines on Azure</span></span>](/azure/architecture/example-scenario/infrastructure/regulated-multitier-app)

<!-- links -->

[hybrid-vpn]: ../hybrid-networking/vpn.md
[azure-dns]: /azure/dns/dns-overview
[azure-sla]: https://azure.microsoft.com/support/legal/sla/
[azure-sql-db]: https://azure.microsoft.com/documentation/services/sql-database/
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[azure-cli]: /cli/azure/
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview
[resource-group-links]: /azure/resource-group-link-resources
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[services-by-region]: https://azure.microsoft.com/regions/#services
[sql-always-on]: https://msdn.microsoft.com/library/hh510230.aspx
[tablediff]: https://msdn.microsoft.com/library/ms162843.aspx
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[vnet-dns]: /azure/virtual-network/manage-virtual-network#change-dns-servers
[vnet-to-vnet]: /azure/vpn-gateway/vpn-gateway-vnet-vnet-rm-ps
[vpn-gateway]: /azure/vpn-gateway/vpn-gateway-about-vpngateways
[wsfc]: https://msdn.microsoft.com/library/hh270278.aspx
