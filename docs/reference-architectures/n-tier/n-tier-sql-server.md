---
title: Applicazione a più livelli con SQL Server
description: Come implementare un'architettura a più livelli in Azure per la disponibilità, la sicurezza, la scalabilità e la gestibilità.
author: MikeWasson
ms.date: 07/19/2018
ms.openlocfilehash: 3a291b9492c94450a42de96bea2135190c163fe7
ms.sourcegitcommit: 25bf02e89ab4609ae1b2eb4867767678a9480402
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 09/14/2018
ms.locfileid: "45584749"
---
# <a name="n-tier-application-with-sql-server"></a><span data-ttu-id="06a8e-103">Applicazione a più livelli con SQL Server</span><span class="sxs-lookup"><span data-stu-id="06a8e-103">N-tier application with SQL Server</span></span>

<span data-ttu-id="06a8e-104">Questa architettura di riferimento illustra come distribuire macchine virtuali e una rete virtuale configurata per un'applicazione a più livelli tramite SQL Server in Windows per il livello dati.</span><span class="sxs-lookup"><span data-stu-id="06a8e-104">This reference architecture shows how to deploy VMs and a virtual network configured for an N-tier application, using SQL Server on Windows for the data tier.</span></span> [<span data-ttu-id="06a8e-105">**Distribuire questa soluzione**.</span><span class="sxs-lookup"><span data-stu-id="06a8e-105">**Deploy this solution**.</span></span>](#deploy-the-solution) 

<span data-ttu-id="06a8e-106">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="06a8e-106">![[0]][0]</span></span>

<span data-ttu-id="06a8e-107">*Scaricare un [file Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="06a8e-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="06a8e-108">Architettura</span><span class="sxs-lookup"><span data-stu-id="06a8e-108">Architecture</span></span> 

<span data-ttu-id="06a8e-109">L'architettura include i componenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="06a8e-109">The architecture has the following components:</span></span>

* <span data-ttu-id="06a8e-110">**Gruppo di risorse.**</span><span class="sxs-lookup"><span data-stu-id="06a8e-110">**Resource group.**</span></span> <span data-ttu-id="06a8e-111">I [gruppi di risorse][resource-manager-overview] vengono usati per raggruppare le risorse in modo che possano essere gestite in base alla durata, al proprietario o ad altri criteri.</span><span class="sxs-lookup"><span data-stu-id="06a8e-111">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>

* <span data-ttu-id="06a8e-112">**Rete virtuale e subnet.**</span><span class="sxs-lookup"><span data-stu-id="06a8e-112">**Virtual network (VNet) and subnets.**</span></span> <span data-ttu-id="06a8e-113">Ogni macchina virtuale di Azure viene distribuita in una rete virtuale che può essere suddivisa in più subnet.</span><span class="sxs-lookup"><span data-stu-id="06a8e-113">Every Azure VM is deployed into a VNet that can be segmented into multiple subnets.</span></span> <span data-ttu-id="06a8e-114">Creare una subnet separata per ogni livello.</span><span class="sxs-lookup"><span data-stu-id="06a8e-114">Create a separate subnet for each tier.</span></span> 

* <span data-ttu-id="06a8e-115">**Gateway applicazione**.</span><span class="sxs-lookup"><span data-stu-id="06a8e-115">**Application gateway**.</span></span> <span data-ttu-id="06a8e-116">Il [gateway applicazione di Azure](/azure/application-gateway/) è un servizio di bilanciamento del carico di livello 7.</span><span class="sxs-lookup"><span data-stu-id="06a8e-116">[Azure Application Gateway](/azure/application-gateway/) is a layer 7 load balancer.</span></span> <span data-ttu-id="06a8e-117">In questa architettura, instrada le richieste HTTP al front-end Web.</span><span class="sxs-lookup"><span data-stu-id="06a8e-117">In this architecture, it routes HTTP requests to the web front end.</span></span> <span data-ttu-id="06a8e-118">Il gateway applicazione fornisce anche un [Web application firewall](/azure/application-gateway/waf-overview) (WAF) che protegge l'applicazione da exploit e vulnerabilità comuni.</span><span class="sxs-lookup"><span data-stu-id="06a8e-118">Application Gateway also provides a [web application firewall](/azure/application-gateway/waf-overview) (WAF) that protects the application from common exploits and vulnerabilities.</span></span> 

* <span data-ttu-id="06a8e-119">**Gruppi di sicurezza di rete.**</span><span class="sxs-lookup"><span data-stu-id="06a8e-119">**NSGs.**</span></span> <span data-ttu-id="06a8e-120">Usare i [gruppi di sicurezza di rete][nsg] (NSG) per limitare il traffico di rete nella rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="06a8e-120">Use [network security groups][nsg] (NSGs) to restrict network traffic within the VNet.</span></span> <span data-ttu-id="06a8e-121">Ad esempio, nell'architettura a 3 livelli illustrata qui il livello database non accetta traffico dal front-end Web, solo dal livello business e dalla subnet di gestione.</span><span class="sxs-lookup"><span data-stu-id="06a8e-121">For example, in the 3-tier architecture shown here, the database tier does not accept traffic from the web front end, only from the business tier and the management subnet.</span></span>

* <span data-ttu-id="06a8e-122">**Macchine virtuali**.</span><span class="sxs-lookup"><span data-stu-id="06a8e-122">**Virtual machines**.</span></span> <span data-ttu-id="06a8e-123">Per indicazioni su come configurare le macchine virtuali, vedere [Eseguire una VM Windows in Azure](./windows-vm.md) ed [Eseguire una VM Linux in Azure](./linux-vm.md).</span><span class="sxs-lookup"><span data-stu-id="06a8e-123">For recommendations on configuring VMs, see [Run a Windows VM on Azure](./windows-vm.md) and [Run a Linux VM on Azure](./linux-vm.md).</span></span>

* <span data-ttu-id="06a8e-124">**Set di disponibilità.**</span><span class="sxs-lookup"><span data-stu-id="06a8e-124">**Availability sets.**</span></span> <span data-ttu-id="06a8e-125">Creare un [set di disponibilità][azure-availability-sets] per ogni livello ed eseguire il provisioning di almeno due macchine virtuali in ogni livello.</span><span class="sxs-lookup"><span data-stu-id="06a8e-125">Create an [availability set][azure-availability-sets] for each tier, and provision at least two VMs in each tier.</span></span> <span data-ttu-id="06a8e-126">In questo modo le macchine virtuali sono idonee per un [contratto di servizio][vm-sla] di livello superiore.</span><span class="sxs-lookup"><span data-stu-id="06a8e-126">This makes the VMs eligible for a higher [service level agreement (SLA)][vm-sla] for VMs.</span></span> 

* <span data-ttu-id="06a8e-127">**Set di scalabilità di macchine virtuali** (non illustrato).</span><span class="sxs-lookup"><span data-stu-id="06a8e-127">**VM scale set** (not shown).</span></span> <span data-ttu-id="06a8e-128">Un [set di scalabilità di macchine virtuali][vmss] rappresenta un'alternativa all'uso di un set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="06a8e-128">A [VM scale set][vmss] is an alternative to using an availability set.</span></span> <span data-ttu-id="06a8e-129">Un set di scalabilità rende più facile aumentare il numero di istanze delle VM in un livello, manualmente o automaticamente in base a regole predefinite.</span><span class="sxs-lookup"><span data-stu-id="06a8e-129">A scale sets makes it easy to scale out the VMs in a tier, either manually or automatically based on predefined rules.</span></span>

* <span data-ttu-id="06a8e-130">**Servizi di bilanciamento del carico.**</span><span class="sxs-lookup"><span data-stu-id="06a8e-130">**Load balancers.**</span></span> <span data-ttu-id="06a8e-131">Usare [Azure Load Balancer][load-balancer] per distribuire il traffico di rete dal livello Web al livello aziendale e dal livello aziendale a SQL Server.</span><span class="sxs-lookup"><span data-stu-id="06a8e-131">Use [Azure Load Balancer][load-balancer] to distribute network traffic from the web tier to the business tier, and from the business tier to SQL Server.</span></span>

* <span data-ttu-id="06a8e-132">**Indirizzo IP pubblico**.</span><span class="sxs-lookup"><span data-stu-id="06a8e-132">**Public IP address**.</span></span> <span data-ttu-id="06a8e-133">Affinché l'applicazione possa ricevere il traffico Internet, è necessario un indirizzo IP pubblico.</span><span class="sxs-lookup"><span data-stu-id="06a8e-133">A public IP address is needed for the application to receive Internet traffic.</span></span>

* <span data-ttu-id="06a8e-134">**Jumpbox.**</span><span class="sxs-lookup"><span data-stu-id="06a8e-134">**Jumpbox.**</span></span> <span data-ttu-id="06a8e-135">Detto anche [bastion host].</span><span class="sxs-lookup"><span data-stu-id="06a8e-135">Also called a [bastion host].</span></span> <span data-ttu-id="06a8e-136">È una macchina virtuale sicura in rete che viene usata dagli amministratori per connettersi alle altre macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="06a8e-136">A secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="06a8e-137">Il jumpbox ha un gruppo di sicurezza di rete (NSG) che consente il traffico remoto solo da Indirizzi IP pubblici inclusi in un elenco di indirizzi attendibili.</span><span class="sxs-lookup"><span data-stu-id="06a8e-137">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="06a8e-138">L'NSG dovrebbe consentire il traffico RDP (Remote Desktop Protocol).</span><span class="sxs-lookup"><span data-stu-id="06a8e-138">The NSG should permit remote desktop (RDP) traffic.</span></span>

* <span data-ttu-id="06a8e-139">**Gruppo di disponibilità AlwaysOn di SQL Server.**</span><span class="sxs-lookup"><span data-stu-id="06a8e-139">**SQL Server Always On Availability Group.**</span></span> <span data-ttu-id="06a8e-140">Assicura disponibilità elevata al livello dati, abilitando la replica e il failover.</span><span class="sxs-lookup"><span data-stu-id="06a8e-140">Provides high availability at the data tier, by enabling replication and failover.</span></span> <span data-ttu-id="06a8e-141">Usa la tecnologia Windows Server Failover Cluster (WSFC) per il failover.</span><span class="sxs-lookup"><span data-stu-id="06a8e-141">It uses Windows Server Failover Cluster (WSFC) technology for failover.</span></span>

* <span data-ttu-id="06a8e-142">**Server di Active Directory Domain Services.**</span><span class="sxs-lookup"><span data-stu-id="06a8e-142">**Active Directory Domain Services (AD DS) Servers**.</span></span> <span data-ttu-id="06a8e-143">Gli oggetti computer per il cluster di failover e i ruoli del cluster associati vengono creati in Active Directory Domain Services (AD DS).</span><span class="sxs-lookup"><span data-stu-id="06a8e-143">The computer objects for the failover cluster and its associated clustered roles are created in Active Directory Domain Services (AD DS).</span></span>

* <span data-ttu-id="06a8e-144">**Cloud di controllo**.</span><span class="sxs-lookup"><span data-stu-id="06a8e-144">**Cloud Witness**.</span></span> <span data-ttu-id="06a8e-145">Un cluster di failover richiede che più della metà dei nodi sia in esecuzione (quorum).</span><span class="sxs-lookup"><span data-stu-id="06a8e-145">A failover cluster requires more than half of its nodes to be running, which is known as having quorum.</span></span> <span data-ttu-id="06a8e-146">Se il cluster ha solo due nodi, una partizione di rete potrebbe indurre ogni nodo a ritenere di essere il nodo master.</span><span class="sxs-lookup"><span data-stu-id="06a8e-146">If the cluster has just two nodes, a network partition could cause each node to think it's the master node.</span></span> <span data-ttu-id="06a8e-147">In tal caso, è necessario un *controllo* per stabilire la prevalenza e ottenere il quorum.</span><span class="sxs-lookup"><span data-stu-id="06a8e-147">In that case, you need a *witness* to break ties and establish quorum.</span></span> <span data-ttu-id="06a8e-148">Un controllo è una risorsa, ad esempio un disco condiviso, che può stabilire la prevalenza per ottenere il quorum.</span><span class="sxs-lookup"><span data-stu-id="06a8e-148">A witness is a resource such as a shared disk that can act as a tie breaker to establish quorum.</span></span> <span data-ttu-id="06a8e-149">Il cloud di controllo è un tipo di controllo che usa Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="06a8e-149">Cloud Witness is a type of witness that uses Azure Blob Storage.</span></span> <span data-ttu-id="06a8e-150">Per altre informazioni sul concetto di quorum, vedere [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum) (Informazioni su cluster e quorum del pool).</span><span class="sxs-lookup"><span data-stu-id="06a8e-150">To learn more about the concept of quorum, see [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum).</span></span> <span data-ttu-id="06a8e-151">Per altre informazioni sul controllo cloud, vedere [Distribuire un cloud di controllo per un cluster di failover](/windows-server/failover-clustering/deploy-cloud-witness).</span><span class="sxs-lookup"><span data-stu-id="06a8e-151">For more information about Cloud Witness, see [Deploy a Cloud Witness for a Failover Cluster](/windows-server/failover-clustering/deploy-cloud-witness).</span></span> 

* <span data-ttu-id="06a8e-152">**DNS di Azure**.</span><span class="sxs-lookup"><span data-stu-id="06a8e-152">**Azure DNS**.</span></span> <span data-ttu-id="06a8e-153">[DNS di Azure][azure-dns] è un servizio di hosting per i domini DNS, che fornisce la risoluzione dei nomi usando l'infrastruttura di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="06a8e-153">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="06a8e-154">Ospitando i domini in Azure, è possibile gestire i record DNS usando le stesse credenziali, API, strumenti e fatturazione come per gli altri servizi Azure.</span><span class="sxs-lookup"><span data-stu-id="06a8e-154">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>

## <a name="recommendations"></a><span data-ttu-id="06a8e-155">Consigli</span><span class="sxs-lookup"><span data-stu-id="06a8e-155">Recommendations</span></span>

<span data-ttu-id="06a8e-156">I requisiti della propria organizzazione potrebbero essere diversi da quelli dell'architettura descritta in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="06a8e-156">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="06a8e-157">Usare queste indicazioni come punto di partenza.</span><span class="sxs-lookup"><span data-stu-id="06a8e-157">Use these recommendations as a starting point.</span></span> 

### <a name="vnet--subnets"></a><span data-ttu-id="06a8e-158">Rete virtuale/subnet</span><span class="sxs-lookup"><span data-stu-id="06a8e-158">VNet / Subnets</span></span>

<span data-ttu-id="06a8e-159">Quando si crea la rete virtuale, determinare quanti indirizzi IP saranno necessari alle risorse in ogni subnet.</span><span class="sxs-lookup"><span data-stu-id="06a8e-159">When you create the VNet, determine how many IP addresses your resources in each subnet require.</span></span> <span data-ttu-id="06a8e-160">Specificare una subnet mask e un intervallo di indirizzi della rete virtuale abbastanza ampio da contenere gli indirizzi IP necessari, usando la notazione [CIDR].</span><span class="sxs-lookup"><span data-stu-id="06a8e-160">Specify a subnet mask and a VNet address range large enough for the required IP addresses, using [CIDR] notation.</span></span> <span data-ttu-id="06a8e-161">Usare uno spazio indirizzi che rientri nei [blocchi di indirizzi IP privati][private-ip-space] standard, ossia 10.0.0.0/8, 172.16.0.0/12 e 192.168.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="06a8e-161">Use an address space that falls within the standard [private IP address blocks][private-ip-space], which are 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</span></span>

<span data-ttu-id="06a8e-162">Scegliere un intervallo di indirizzi che non si sovrapponga alla rete locale, in caso occorra in seguito configurare un gateway tra la rete virtuale e la rete locale.</span><span class="sxs-lookup"><span data-stu-id="06a8e-162">Choose an address range that does not overlap with your on-premises network, in case you need to set up a gateway between the VNet and your on-premise network later.</span></span> <span data-ttu-id="06a8e-163">Una volta creata la rete virtuale, non è più possibile cambiare l'intervallo di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="06a8e-163">Once you create the VNet, you can't change the address range.</span></span>

<span data-ttu-id="06a8e-164">Progettare le subnet tenendo presenti i requisiti di funzionamento e sicurezza.</span><span class="sxs-lookup"><span data-stu-id="06a8e-164">Design subnets with functionality and security requirements in mind.</span></span> <span data-ttu-id="06a8e-165">Tutte le macchine virtuali nello stesso livello o nello stesso ruolo dovrebbero far parte della stessa subnet, che può essere un limite di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="06a8e-165">All VMs within the same tier or role should go into the same subnet, which can be a security boundary.</span></span> <span data-ttu-id="06a8e-166">Per altre informazioni sulla progettazione di reti virtuali e subnet, vedere [Pianificare e progettare reti virtuali di Azure][plan-network].</span><span class="sxs-lookup"><span data-stu-id="06a8e-166">For more information about designing VNets and subnets, see [Plan and design Azure Virtual Networks][plan-network].</span></span>

### <a name="load-balancers"></a><span data-ttu-id="06a8e-167">Servizi di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="06a8e-167">Load balancers</span></span>

<span data-ttu-id="06a8e-168">Non esporre le macchine virtuali direttamente su Internet, ma assegnare un indirizzo IP privato a ogni macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="06a8e-168">Do not expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="06a8e-169">I client si connettono usando l'indirizzo IP pubblico associato al gateway applicazione.</span><span class="sxs-lookup"><span data-stu-id="06a8e-169">Clients connect using the public IP address  associated with the Application Gateway.</span></span>

<span data-ttu-id="06a8e-170">Definire regole di bilanciamento del carico per indirizzare il traffico di rete alle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="06a8e-170">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="06a8e-171">Ad esempio, per consentire il traffico HTTP, creare una regola che esegua il mapping della porta 80 dalla configurazione front-end alla porta 80 sul pool di indirizzi back-end.</span><span class="sxs-lookup"><span data-stu-id="06a8e-171">For example, to enable HTTP traffic, create a rule that maps port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="06a8e-172">Quando un client invia una richiesta HTTP alla porta 80, il servizio di bilanciamento del carico consente di selezionare un indirizzo IP back-end usando un [algoritmo di hash][load-balancer-hashing] che include l'indirizzo IP di origine.</span><span class="sxs-lookup"><span data-stu-id="06a8e-172">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="06a8e-173">In tal modo, le richieste client vengono distribuite tra tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="06a8e-173">In that way, client requests are distributed across all the VMs.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="06a8e-174">Gruppi di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="06a8e-174">Network security groups</span></span>

<span data-ttu-id="06a8e-175">Usare le regole NSG per limitare il traffico fra livelli.</span><span class="sxs-lookup"><span data-stu-id="06a8e-175">Use NSG rules to restrict traffic between tiers.</span></span> <span data-ttu-id="06a8e-176">Ad esempio, nell'architettura a 3 livelli illustrata sopra il livello Web non comunica direttamente con il livello database.</span><span class="sxs-lookup"><span data-stu-id="06a8e-176">For example, in the 3-tier architecture shown above, the web tier does not communicate directly with the database tier.</span></span> <span data-ttu-id="06a8e-177">Per applicare questo comportamento, il livello database deve bloccare il traffico in entrata dalla subnet del livello Web.</span><span class="sxs-lookup"><span data-stu-id="06a8e-177">To enforce this, the database tier should block incoming traffic from the web tier subnet.</span></span>  

1. <span data-ttu-id="06a8e-178">Rifiutare tutto il traffico in ingresso dalla rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="06a8e-178">Deny all inbound traffic from the VNet.</span></span> <span data-ttu-id="06a8e-179">(usare il tag `VIRTUAL_NETWORK` nella regola).</span><span class="sxs-lookup"><span data-stu-id="06a8e-179">(Use the `VIRTUAL_NETWORK` tag in the rule.)</span></span> 
2. <span data-ttu-id="06a8e-180">Consentire il traffico in ingresso dalla subnet del livello business.</span><span class="sxs-lookup"><span data-stu-id="06a8e-180">Allow inbound traffic from the business tier subnet.</span></span>  
3. <span data-ttu-id="06a8e-181">Consentire il traffico in ingresso dalla subnet del livello database.</span><span class="sxs-lookup"><span data-stu-id="06a8e-181">Allow inbound traffic from the database tier subnet itself.</span></span> <span data-ttu-id="06a8e-182">Questa regola consente la comunicazione tra le macchine virtuali del database, condizione necessaria per la replica e il failover del database.</span><span class="sxs-lookup"><span data-stu-id="06a8e-182">This rule allows communication between the database VMs, which is needed for database replication and failover.</span></span>
4. <span data-ttu-id="06a8e-183">Consentire il traffico RDP (porta 3389) dalla subnet del jumpbox.</span><span class="sxs-lookup"><span data-stu-id="06a8e-183">Allow RDP traffic (port 3389) from the jumpbox subnet.</span></span> <span data-ttu-id="06a8e-184">Questa regola consente agli amministratori di connettersi al livello database dal jumpbox.</span><span class="sxs-lookup"><span data-stu-id="06a8e-184">This rule lets administrators connect to the database tier from the jumpbox.</span></span>

<span data-ttu-id="06a8e-185">Creare le regole 2 &ndash; 4 con priorità più alta rispetto alla prima regola, in modo da eseguirne l'override.</span><span class="sxs-lookup"><span data-stu-id="06a8e-185">Create rules 2 &ndash; 4 with higher priority than the first rule, so they override it.</span></span>


### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="06a8e-186">Gruppi di disponibilità AlwaysOn di SQL Server</span><span class="sxs-lookup"><span data-stu-id="06a8e-186">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="06a8e-187">È consigliabile usare i [gruppi di disponibilità AlwaysOn][sql-alwayson] per ottenere la disponibilità elevata di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="06a8e-187">We recommend [Always On Availability Groups][sql-alwayson] for SQL Server high availability.</span></span> <span data-ttu-id="06a8e-188">Nelle versioni precedenti a Windows Server 2016 i gruppi di disponibilità AlwaysOn richiedono un controller di dominio e tutti i nodi del gruppo di disponibilità devono far parte dello stesso dominio Active Directory.</span><span class="sxs-lookup"><span data-stu-id="06a8e-188">Prior to Windows Server 2016, Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same AD domain.</span></span>

<span data-ttu-id="06a8e-189">Altri livelli si connettono al database tramite un [listener del gruppo di disponibilità][sql-alwayson-listeners].</span><span class="sxs-lookup"><span data-stu-id="06a8e-189">Other tiers connect to the database through an [availability group listener][sql-alwayson-listeners].</span></span> <span data-ttu-id="06a8e-190">Il listener consente a un client SQL di connettersi senza conoscere il nome dell'istanza fisica di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="06a8e-190">The listener enables a SQL client to connect without knowing the name of the physical instance of SQL Server.</span></span> <span data-ttu-id="06a8e-191">Le macchine virtuali che accedono al database devono far parte del dominio.</span><span class="sxs-lookup"><span data-stu-id="06a8e-191">VMs that access the database must be joined to the domain.</span></span> <span data-ttu-id="06a8e-192">Il client (in questo caso un altro livello) usa il DNS per risolvere il nome della rete virtuale del listener in indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="06a8e-192">The client (in this case, another tier) uses DNS to resolve the listener's virtual network name into IP addresses.</span></span>

<span data-ttu-id="06a8e-193">Configurare il gruppo di disponibilità AlwaysOn di SQL Server nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="06a8e-193">Configure the SQL Server Always On Availability Group as follows:</span></span>

1. <span data-ttu-id="06a8e-194">Creare un cluster WSFC (Windows Server Failover Clustering), un gruppo di disponibilità AlwaysOn di SQL Server e una replica primaria.</span><span class="sxs-lookup"><span data-stu-id="06a8e-194">Create a Windows Server Failover Clustering (WSFC) cluster, a SQL Server Always On Availability Group, and a primary replica.</span></span> <span data-ttu-id="06a8e-195">Per altre informazioni, vedere [Introduzione ai gruppi di disponibilità AlwaysOn (SQL Server)][sql-alwayson-getting-started].</span><span class="sxs-lookup"><span data-stu-id="06a8e-195">For more information, see [Getting Started with Always On Availability Groups][sql-alwayson-getting-started].</span></span> 
2. <span data-ttu-id="06a8e-196">Creare un servizio di bilanciamento del carico interno con un indirizzo privato statico.</span><span class="sxs-lookup"><span data-stu-id="06a8e-196">Create an internal load balancer with a static private IP address.</span></span>
3. <span data-ttu-id="06a8e-197">Creare un listener del gruppo di disponibilità ed eseguire il mapping del nome DNS del listener all'indirizzo IP di un servizio di bilanciamento del carico interno.</span><span class="sxs-lookup"><span data-stu-id="06a8e-197">Create an availability group listener, and map the listener's DNS name to the IP address of an internal load balancer.</span></span> 
4. <span data-ttu-id="06a8e-198">Creare una regola di bilanciamento del carico per la porta di ascolto di SQL Server (porta TCP 1433 per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="06a8e-198">Create a load balancer rule for the SQL Server listening port (TCP port 1433 by default).</span></span> <span data-ttu-id="06a8e-199">La regola di bilanciamento del carico deve abilitare l'*indirizzo IP mobile*, detto anche Direct Server Return,</span><span class="sxs-lookup"><span data-stu-id="06a8e-199">The load balancer rule must enable *floating IP*, also called Direct Server Return.</span></span> <span data-ttu-id="06a8e-200">per fare in modo che la macchina virtuale risponda direttamente al client, permettendo una connessione diretta alla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="06a8e-200">This causes the VM to reply directly to the client, which enables a direct connection to the primary replica.</span></span>
  
   > [!NOTE]
   > <span data-ttu-id="06a8e-201">Quando l'indirizzo IP mobile è abilitato, il numero di porta front-end deve corrispondere al numero di porta back-end nella regola di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="06a8e-201">When floating IP is enabled, the front-end port number must be the same as the back-end port number in the load balancer rule.</span></span>
   > 
   > 

<span data-ttu-id="06a8e-202">Quando un client SQL cerca di connettersi, il servizio di bilanciamento del carico indirizza la richiesta di connessione alla replica primaria.</span><span class="sxs-lookup"><span data-stu-id="06a8e-202">When a SQL client tries to connect, the load balancer routes the connection request to the primary replica.</span></span> <span data-ttu-id="06a8e-203">In caso di failover a un'altra replica, il servizio di bilanciamento del carico indirizza automaticamente le richieste successive a una nuova replica primaria.</span><span class="sxs-lookup"><span data-stu-id="06a8e-203">If there is a failover to another replica, the load balancer automatically routes subsequent requests to a new primary replica.</span></span> <span data-ttu-id="06a8e-204">Per altre informazioni, vedere [Configure an ILB listener for SQL Server Always On Availability Groups][sql-alwayson-ilb] (Configurare un listener ILB per i gruppi di disponibilità AlwaysOn di SQL Server).</span><span class="sxs-lookup"><span data-stu-id="06a8e-204">For more information, see [Configure an ILB listener for SQL Server Always On Availability Groups][sql-alwayson-ilb].</span></span>

<span data-ttu-id="06a8e-205">Durante un failover, le connessioni client esistenti vengono chiuse.</span><span class="sxs-lookup"><span data-stu-id="06a8e-205">During a failover, existing client connections are closed.</span></span> <span data-ttu-id="06a8e-206">Dopo il completamento del failover, le nuove connessioni verranno indirizzate alla nuova replica primaria.</span><span class="sxs-lookup"><span data-stu-id="06a8e-206">After the failover completes, new connections will be routed to the new primary replica.</span></span>

<span data-ttu-id="06a8e-207">Se l'applicazione esegue molte più letture che scritture, è possibile eseguire l'offload di alcune delle query di sola lettura a una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="06a8e-207">If your application makes significantly more reads than writes, you can offload some of the read-only queries to a secondary replica.</span></span> <span data-ttu-id="06a8e-208">Vedere [Utilizzo di un listener per connettersi a una replica secondaria di sola lettura (routing di sola lettura)][sql-alwayson-read-only-routing].</span><span class="sxs-lookup"><span data-stu-id="06a8e-208">See [Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)][sql-alwayson-read-only-routing].</span></span>

<span data-ttu-id="06a8e-209">Testare la distribuzione [forzando un failover manuale][sql-alwayson-force-failover] del gruppo di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="06a8e-209">Test your deployment by [forcing a manual failover][sql-alwayson-force-failover] of the availability group.</span></span>

### <a name="jumpbox"></a><span data-ttu-id="06a8e-210">Jumpbox</span><span class="sxs-lookup"><span data-stu-id="06a8e-210">Jumpbox</span></span>

<span data-ttu-id="06a8e-211">Non consentire l'accesso RDP dalla rete Internet pubblica alle macchine virtuali che eseguono il carico di lavoro dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="06a8e-211">Do not allow RDP access from the public Internet to the VMs that run the application workload.</span></span> <span data-ttu-id="06a8e-212">L'accesso RDP a queste macchine virtuali deve sempre passare attraverso il jumpbox.</span><span class="sxs-lookup"><span data-stu-id="06a8e-212">Instead, all RDP access to these VMs must come through the jumpbox.</span></span> <span data-ttu-id="06a8e-213">Un amministratore accede al jumpbox, quindi accede alle altre macchine virtuali dal jumpbox.</span><span class="sxs-lookup"><span data-stu-id="06a8e-213">An administrator logs into the jumpbox, and then logs into the other VM from the jumpbox.</span></span> <span data-ttu-id="06a8e-214">Il jumpbox consente il traffico RDP da Internet, ma solo da indirizzi IP conosciuti e attendibili.</span><span class="sxs-lookup"><span data-stu-id="06a8e-214">The jumpbox allows RDP traffic from the Internet, but only from known, safe IP addresses.</span></span>

<span data-ttu-id="06a8e-215">Il jumpbox ha requisiti di prestazioni minimi, quindi selezionare una macchina virtuale di piccole dimensioni.</span><span class="sxs-lookup"><span data-stu-id="06a8e-215">The jumpbox has minimal performance requirements, so select a small VM size.</span></span> <span data-ttu-id="06a8e-216">Creare un [indirizzo IP pubblico] per il jumpbox.</span><span class="sxs-lookup"><span data-stu-id="06a8e-216">Create a [public IP address] for the jumpbox.</span></span> <span data-ttu-id="06a8e-217">Collocare il jumpbox nella stessa rete virtuale delle altre macchine virtuali, ma in una subnet di gestione separata.</span><span class="sxs-lookup"><span data-stu-id="06a8e-217">Place the jumpbox in the same VNet as the other VMs, but in a separate management subnet.</span></span>

<span data-ttu-id="06a8e-218">Per proteggere il jumpbox aggiungere una regola del gruppo di sicurezza di rete che consenta le connessioni RDP solo da un set di indirizzi IP pubblici attendibili.</span><span class="sxs-lookup"><span data-stu-id="06a8e-218">To secure the jumpbox, add an NSG rule that allows RDP connections only from a safe set of public IP addresses.</span></span> <span data-ttu-id="06a8e-219">Configurare i gruppi di sicurezza di rete per le altre subnet per consentire il traffico RDP dalla subnet di gestione.</span><span class="sxs-lookup"><span data-stu-id="06a8e-219">Configure the NSGs for the other subnets to allow RDP traffic from the management subnet.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="06a8e-220">Considerazioni sulla scalabilità</span><span class="sxs-lookup"><span data-stu-id="06a8e-220">Scalability considerations</span></span>

<span data-ttu-id="06a8e-221">I [set di scalabilità di macchine virtuali][vmss] consentono di distribuire e gestire un set di macchine virtuali identiche.</span><span class="sxs-lookup"><span data-stu-id="06a8e-221">[VM scale sets][vmss] help you to deploy and manage a set of identical VMs.</span></span> <span data-ttu-id="06a8e-222">I set di scalabilità supportano il ridimensionamento automatico in base alle metriche delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="06a8e-222">Scale sets support autoscaling based on performance metrics.</span></span> <span data-ttu-id="06a8e-223">Di pari passo con l'aumento del carico sulle macchine virtuali, vengono aggiunte automaticamente altre macchine virtuali al servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="06a8e-223">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="06a8e-224">Prendere in considerazione i set di scalabilità se è necessario aumentare rapidamente le istanze delle macchine virtuali o se si necessita del ridimensionamento automatico.</span><span class="sxs-lookup"><span data-stu-id="06a8e-224">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="06a8e-225">Esistono due modi per configurare le macchine virtuali distribuite in un set di scalabilità:</span><span class="sxs-lookup"><span data-stu-id="06a8e-225">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="06a8e-226">Usare le estensioni per configurare la macchina virtuale dopo il provisioning.</span><span class="sxs-lookup"><span data-stu-id="06a8e-226">Use extensions to configure the VM after it is provisioned.</span></span> <span data-ttu-id="06a8e-227">Con questo approccio, le nuove istanze delle macchine virtuali possono richiedere più tempo per l'avvio di una macchina virtuale senza estensioni.</span><span class="sxs-lookup"><span data-stu-id="06a8e-227">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="06a8e-228">Distribuire un [disco gestito](/azure/storage/storage-managed-disks-overview) con un'immagine del disco personalizzata.</span><span class="sxs-lookup"><span data-stu-id="06a8e-228">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="06a8e-229">Questa opzione può risultare più veloce da distribuire.</span><span class="sxs-lookup"><span data-stu-id="06a8e-229">This option may be quicker to deploy.</span></span> <span data-ttu-id="06a8e-230">Tuttavia, richiede che l'immagine sia mantenuta aggiornata.</span><span class="sxs-lookup"><span data-stu-id="06a8e-230">However, it requires you to keep the image up to date.</span></span>

<span data-ttu-id="06a8e-231">Per altre considerazioni, vedere [Considerazioni sulla progettazione per i set di scalabilità][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="06a8e-231">For additional considerations, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="06a8e-232">Quando si usa una soluzione di ridimensionamento automatico, occorre testarla in anticipo con carichi di lavoro a livello di produzione.</span><span class="sxs-lookup"><span data-stu-id="06a8e-232">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="06a8e-233">Ogni sottoscrizione di Azure ha limiti predefiniti, tra cui il numero massimo di macchine virtuali per area.</span><span class="sxs-lookup"><span data-stu-id="06a8e-233">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="06a8e-234">È possibile aumentare il limite presentando una richiesta di supporto.</span><span class="sxs-lookup"><span data-stu-id="06a8e-234">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="06a8e-235">Per altre informazioni, vedere [Sottoscrizione di Azure e limiti, quote e vincoli dei servizi][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="06a8e-235">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="06a8e-236">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="06a8e-236">Availability considerations</span></span>

<span data-ttu-id="06a8e-237">Se non si usano i set di scalabilità di macchine virtuali, inserire le macchine virtuali dello stesso livello in un set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="06a8e-237">If you are not using VM scale sets, put VMs in the same tier into an availability set.</span></span> <span data-ttu-id="06a8e-238">Creare almeno due macchine virtuali nel set di disponibilità in modo da supportare il [contratto di servizio relativo alla disponibilità per le macchine virtuali di Azure][vm-sla].</span><span class="sxs-lookup"><span data-stu-id="06a8e-238">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="06a8e-239">Per altre informazioni, vedere [Gestire la disponibilità delle macchine virtuali][availability-set].</span><span class="sxs-lookup"><span data-stu-id="06a8e-239">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> 

<span data-ttu-id="06a8e-240">Il servizio di bilanciamento del carico usa i [probe di integrità][health-probes] per monitorare la disponibilità delle istanze delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="06a8e-240">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="06a8e-241">Se un probe non riesce a raggiungere un'istanza entro il periodo di timeout, il bilanciamento del carico interrompe l'invio di traffico a quella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="06a8e-241">If a probe cannot reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="06a8e-242">Tuttavia, il servizio di bilanciamento del carico continuerà a eseguire la verifica e, se la macchina virtuale diventa nuovamente disponibile, il servizio di bilanciamento del carico riprenderà a inviare il traffico a quella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="06a8e-242">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="06a8e-243">Ecco alcune raccomandazioni per i probe di integrità del servizio di bilanciamento del carico:</span><span class="sxs-lookup"><span data-stu-id="06a8e-243">Here are some recommendations on load balancer health probes:</span></span>

* <span data-ttu-id="06a8e-244">I probe possono testare protocolli HTTP o TCP.</span><span class="sxs-lookup"><span data-stu-id="06a8e-244">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="06a8e-245">Se le macchine virtuali eseguono un server HTTP, creare un probe HTTP.</span><span class="sxs-lookup"><span data-stu-id="06a8e-245">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="06a8e-246">In caso contrario, creare un probe TCP.</span><span class="sxs-lookup"><span data-stu-id="06a8e-246">Otherwise create a TCP probe.</span></span>
* <span data-ttu-id="06a8e-247">Per un probe HTTP, specificare il percorso di un endpoint HTTP.</span><span class="sxs-lookup"><span data-stu-id="06a8e-247">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="06a8e-248">Il probe controlla una risposta HTTP 200 da questo percorso.</span><span class="sxs-lookup"><span data-stu-id="06a8e-248">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="06a8e-249">Può trattarsi del percorso radice ("/") o di un endpoint di monitoraggio dell'integrità che implementa una logica personalizzata per controllare l'integrità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="06a8e-249">This can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="06a8e-250">L'endpoint deve consentire richieste HTTP anonime.</span><span class="sxs-lookup"><span data-stu-id="06a8e-250">The endpoint must allow anonymous HTTP requests.</span></span>
* <span data-ttu-id="06a8e-251">Il probe viene inviato da un [indirizzo IP noto][health-probe-ip], 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="06a8e-251">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="06a8e-252">Verificare di non bloccare il traffico da o verso questo indirizzo IP in eventuali criteri del firewall o regole del gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="06a8e-252">Make sure you don't block traffic to or from this IP address in any firewall policies or network security group (NSG) rules.</span></span>
* <span data-ttu-id="06a8e-253">Usare i [log dei probe di integrità][health-probe-log] per visualizzare lo stato dei probe di integrità.</span><span class="sxs-lookup"><span data-stu-id="06a8e-253">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="06a8e-254">Abilitare la registrazione nel portale di Azure per ogni servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="06a8e-254">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="06a8e-255">I log vengono scritti in Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="06a8e-255">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="06a8e-256">Il log mostra il numero di macchine virtuali sul back-end che non ricevono traffico di rete a causa di risposte del probe non riuscite.</span><span class="sxs-lookup"><span data-stu-id="06a8e-256">The logs show how many VMs on the back end are not receiving network traffic due to failed probe responses.</span></span>

<span data-ttu-id="06a8e-257">Se occorre una disponibilità più elevata di quella fornita dal [contratto di servizio di Azure per le macchine virtuali][vm-sla], è consigliabile eseguire la replica dell'applicazione in due aree e usare Gestione traffico di Azure per il failover.</span><span class="sxs-lookup"><span data-stu-id="06a8e-257">If you need higher availability than the [Azure SLA for VMs][vm-sla] provides, consider replication the application across two regions, using Azure Traffic Manager for failover.</span></span> <span data-ttu-id="06a8e-258">Per altre informazioni, vedere [Applicazione a più livelli per più aree per la disponibilità elevata][multi-dc].</span><span class="sxs-lookup"><span data-stu-id="06a8e-258">For more information, see [Multi-region N-tier application for high availability][multi-dc].</span></span>  

## <a name="security-considerations"></a><span data-ttu-id="06a8e-259">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="06a8e-259">Security considerations</span></span>

<span data-ttu-id="06a8e-260">Le reti virtuali sono un limite di isolamento del traffico in Azure.</span><span class="sxs-lookup"><span data-stu-id="06a8e-260">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="06a8e-261">Le macchine virtuali in una rete virtuale possono comunicare direttamente con quelle in una rete virtuale diversa.</span><span class="sxs-lookup"><span data-stu-id="06a8e-261">VMs in one VNet cannot communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="06a8e-262">Le macchine virtuali all'interno della stessa rete virtuale possono comunicare, a meno che non si creino [gruppi di sicurezza di rete][nsg] per limitare il traffico.</span><span class="sxs-lookup"><span data-stu-id="06a8e-262">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="06a8e-263">Per altre informazioni, vedere [Servizi cloud Microsoft e sicurezza di rete][network-security].</span><span class="sxs-lookup"><span data-stu-id="06a8e-263">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="06a8e-264">Valutare l'aggiunta di un'appliance virtuale di rete per creare una rete perimetrale tra la rete Internet e la rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="06a8e-264">Consider adding a network virtual appliance (NVA) to create a DMZ between the Internet and the Azure virtual network.</span></span> <span data-ttu-id="06a8e-265">Un'appliance virtuale di rete esegue attività correlate alla rete, ad esempio impostazione di un firewall, ispezione di pacchetti, controllo e routing personalizzato.</span><span class="sxs-lookup"><span data-stu-id="06a8e-265">NVA is a generic term for a virtual appliance that can perform network-related tasks, such as firewall, packet inspection, auditing, and custom routing.</span></span> <span data-ttu-id="06a8e-266">Per altre informazioni, vedere [Implementazione di una rete perimetrale tra Azure e Internet][dmz].</span><span class="sxs-lookup"><span data-stu-id="06a8e-266">For more information, see [Implementing a DMZ between Azure and the Internet][dmz].</span></span>

<span data-ttu-id="06a8e-267">Crittografare i dati sensibili inattivi e usare[Azure Key Vault][azure-key-vault] per gestire le chiavi di crittografia del database.</span><span class="sxs-lookup"><span data-stu-id="06a8e-267">Encrypt sensitive data at rest and use [Azure Key Vault][azure-key-vault] to manage the database encryption keys.</span></span> <span data-ttu-id="06a8e-268">Key Vault consente di archiviare le chiavi di crittografia in moduli di protezione hardware.</span><span class="sxs-lookup"><span data-stu-id="06a8e-268">Key Vault can store encryption keys in hardware security modules (HSMs).</span></span> <span data-ttu-id="06a8e-269">Per altre informazioni, vedere [Configurare l'integrazione di Azure Key Vault per SQL Server in macchine virtuali di Azure][sql-keyvault].</span><span class="sxs-lookup"><span data-stu-id="06a8e-269">For more information, see [Configure Azure Key Vault Integration for SQL Server on Azure VMs][sql-keyvault].</span></span> <span data-ttu-id="06a8e-270">È anche consigliabile archiviare in Key Vault i segreti dell'applicazione, ad esempio le stringhe di connessione di database.</span><span class="sxs-lookup"><span data-stu-id="06a8e-270">It's also recommended to store application secrets, such as database connection strings, in Key Vault.</span></span>

<span data-ttu-id="06a8e-271">Si consiglia di abilitare [Protezione DDoS standard](/azure/virtual-network/ddos-protection-overview), che offre una mitigazione DDoS aggiuntiva per le risorse in una rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="06a8e-271">We recommend enabling [DDoS Protection Standard](/azure/virtual-network/ddos-protection-overview), which provides additional DDoS mitigation for resources in a VNet.</span></span> <span data-ttu-id="06a8e-272">Anche se la protezione DDoS di base è abilitata automaticamente come parte della piattaforma Azure, Protezione DDoS standard offre funzionalità di mitigazione ottimizzate in modo specifico per le risorse di rete virtuale di Azure.</span><span class="sxs-lookup"><span data-stu-id="06a8e-272">Although basic DDoS protection is automatically enabled as part of the Azure platform, DDoS Protection Standard provides mitigation capabilities that are tuned specifically to Azure Virtual Network resources.</span></span>  

## <a name="deploy-the-solution"></a><span data-ttu-id="06a8e-273">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="06a8e-273">Deploy the solution</span></span>

<span data-ttu-id="06a8e-274">Una distribuzione di questa architettura di riferimento è disponibile in [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="06a8e-274">A deployment for this reference architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="06a8e-275">Si noti che l'intera distribuzione può richiedere fino a due ore, inclusa l'esecuzione di script per configurare Active Directory Domain Services, il cluster di failover di Windows Server e il gruppo di disponibilità di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="06a8e-275">Note that the entire deployment can take up to two hours, which includes running the scripts to configure AD DS, the Windows Server failover cluster, and the SQL Server availability group.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="06a8e-276">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="06a8e-276">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-the-solution"></a><span data-ttu-id="06a8e-277">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="06a8e-277">Deploy the solution</span></span>

1. <span data-ttu-id="06a8e-278">Usare il comando seguente per creare un gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="06a8e-278">Run the following command to create a resource group.</span></span>

    ```bash
    az group create --location <location> --name <resource-group-name>
    ```

2. <span data-ttu-id="06a8e-279">Usare il comando seguente per creare un account di archiviazione per il cloud di controllo.</span><span class="sxs-lookup"><span data-stu-id="06a8e-279">Run the following command to create a Storage account for the Cloud Witness.</span></span>

    ```bash
    az storage account create --location <location> \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --sku Standard_LRS
    ```

3. <span data-ttu-id="06a8e-280">Passare alla cartella `virtual-machines\n-tier-windows` del repository GitHub di architetture di riferimento.</span><span class="sxs-lookup"><span data-stu-id="06a8e-280">Navigate to the `virtual-machines\n-tier-windows` folder of the reference architectures GitHub repository.</span></span>

4. <span data-ttu-id="06a8e-281">Aprire il file `n-tier-windows.json` .</span><span class="sxs-lookup"><span data-stu-id="06a8e-281">Open the `n-tier-windows.json` file.</span></span> 

5. <span data-ttu-id="06a8e-282">Cercare tutte le istanze di "witnessStorageBlobEndPoint" e sostituire il testo segnaposto con il nome dell'account di archiviazione del passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="06a8e-282">Search for all instances of "witnessStorageBlobEndPoint" and replace the placeholder text with the name of the Storage account from step 2.</span></span>

    ```json
    "witnessStorageBlobEndPoint": "https://[replace-with-storageaccountname].blob.core.windows.net",
    ```

6. <span data-ttu-id="06a8e-283">Usare il comando seguente per elencare le chiavi dell'account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="06a8e-283">Run the following command to list the account keys for the storage account.</span></span>

    ```bash
    az storage account keys list \
      --account-name <storage-account-name> \
      --resource-group <resource-group-name>
    ```

    <span data-ttu-id="06a8e-284">L'output sarà simile al seguente.</span><span class="sxs-lookup"><span data-stu-id="06a8e-284">The output should look like the following.</span></span> <span data-ttu-id="06a8e-285">Copiare il valore di `key1`.</span><span class="sxs-lookup"><span data-stu-id="06a8e-285">Copy the value of `key1`.</span></span>

    ```json
    [
    {
        "keyName": "key1",
        "permissions": "Full",
        "value": "..."
    },
    {
        "keyName": "key2",
        "permissions": "Full",
        "value": "..."
    }
    ]
    ```

7. <span data-ttu-id="06a8e-286">Nel file `n-tier-windows.json` cercare tutte le istanze di "witnessStorageAccountKey" e incollare la chiave dell'account.</span><span class="sxs-lookup"><span data-stu-id="06a8e-286">In the `n-tier-windows.json` file, search for all instances of "witnessStorageAccountKey" and paste in the account key.</span></span>

    ```json
    "witnessStorageAccountKey": "[replace-with-storagekey]"
    ```

8. <span data-ttu-id="06a8e-287">Nel file `n-tier-windows.json` cercare tutte le istanze di `[replace-with-password]` e `[replace-with-sql-password]`, poi sostituirle con una password complessa.</span><span class="sxs-lookup"><span data-stu-id="06a8e-287">In the `n-tier-windows.json` file, search for all instances of `[replace-with-password]` and `[replace-with-sql-password]` replace them with a strong password.</span></span> <span data-ttu-id="06a8e-288">Salvare il file.</span><span class="sxs-lookup"><span data-stu-id="06a8e-288">Save the file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="06a8e-289">Se si modifica il nome dell'utente amministratore, è necessario aggiornare anche i blocchi `extensions` nel file JSON.</span><span class="sxs-lookup"><span data-stu-id="06a8e-289">If you change the adminstrator user name, you must also update the `extensions` blocks in the JSON file.</span></span> 

9. <span data-ttu-id="06a8e-290">Usare il comando seguente per distribuire l'architettura.</span><span class="sxs-lookup"><span data-stu-id="06a8e-290">Run the following command to deploy the architecture.</span></span>

    ```bash
    azbb -s <your subscription_id> -g <resource_group_name> -l <location> -p n-tier-windows.json --deploy
    ```

<span data-ttu-id="06a8e-291">Per altre informazioni sulla distribuzione di questa architettura di riferimento di esempio usando blocchi predefiniti di Azure, visitare il [repository GitHub][git].</span><span class="sxs-lookup"><span data-stu-id="06a8e-291">For more information on deploying this sample reference architecture using Azure Building Blocks, visit the [GitHub repository][git].</span></span>


<!-- links -->
[dmz]: ../dmz/secure-vnet-dmz.md
[multi-dc]: multi-region-sql-server.md
[n-tier]: n-tier.md
[azure-administration]: /azure/automation/automation-intro
[azure-availability-sets]: /azure/virtual-machines/virtual-machines-windows-manage-availability#configure-each-application-tier-into-separate-availability-sets
[azure-cli]: /azure/virtual-machines-command-line-tools
[azure-dns]: /azure/dns/dns-overview
[azure-key-vault]: https://azure.microsoft.com/services/key-vault
[bastion host]: https://en.wikipedia.org/wiki/Bastion_host
[CIDR]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[cidr]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[chef]: https://www.chef.io/solutions/azure/
[git]: https://github.com/mspnp/template-building-blocks
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/n-tier-windows
[nsg]: /azure/virtual-network/virtual-networks-nsg
[operations-management-suite]: https://www.microsoft.com/server-cloud/operations-management-suite/overview.aspx
[plan-network]: /azure/virtual-network/virtual-network-vnet-plan-design-arm
[private-ip-space]: https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
[indirizzo IP pubblico]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[public IP address]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[puppet]: https://puppetlabs.com/blog/managing-azure-virtual-machines-puppet
[sql-alwayson]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-alwayson-force-failover]: https://msdn.microsoft.com/library/ff877957.aspx
[sql-alwayson-getting-started]: https://msdn.microsoft.com/library/gg509118.aspx
[sql-alwayson-ilb]: /azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-alwayson-int-listener
[sql-alwayson-listeners]: https://msdn.microsoft.com/library/hh213417.aspx
[sql-alwayson-read-only-routing]: https://technet.microsoft.com/library/hh213417.aspx#ConnectToSecondary
[sql-keyvault]: /azure/virtual-machines/virtual-machines-windows-ps-sql-keyvault
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[vnet faq]: /azure/virtual-network/virtual-networks-faq
[wsfc-whats-new]: https://technet.microsoft.com/windows-server-docs/failover-clustering/whats-new-in-failover-clustering
[Nagios]: https://www.nagios.org/
[Zabbix]: http://www.zabbix.com/
[Icinga]: http://www.icinga.org/
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[0]: ./images/n-tier-sql-server.png "Architettura a più livelli con Microsoft Azure"
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview 
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[load-balancer]: /azure/load-balancer/
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[subscription-limits]: /azure/azure-subscription-service-limits
[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[network-security]: /azure/best-practices-network-security
