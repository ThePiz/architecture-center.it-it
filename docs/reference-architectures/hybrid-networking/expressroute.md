---
title: Connettere una rete locale ad Azure tramite ExpressRoute
description: Come implementare un'architettura di rete sicura da sito a sito, che si estende su una rete virtuale di Azure e su una rete locale connessa tramite Azure ExpressRoute.
author: telmosampaio
ms.date: 10/22/2017
pnp.series.title: Connect an on-premises network to Azure
pnp.series.next: expressroute-vpn-failover
pnp.series.prev: vpn
cardTitle: ExpressRoute
ms.openlocfilehash: 16711acb179c05152fc5ef8c7bf3eeb8d067a382
ms.sourcegitcommit: dbbf914757b03cdee7a274204f9579fa63d7eed2
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 11/02/2018
ms.locfileid: "50916618"
---
# <a name="connect-an-on-premises-network-to-azure-using-expressroute"></a><span data-ttu-id="c80ca-103">Connettere una rete locale ad Azure tramite ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="c80ca-103">Connect an on-premises network to Azure using ExpressRoute</span></span>

<span data-ttu-id="c80ca-104">Questa architettura di riferimento illustra come connettere una rete locale a reti virtuali in Azure usando [Azure ExpressRoute][expressroute-introduction].</span><span class="sxs-lookup"><span data-stu-id="c80ca-104">This reference architecture shows how to connect an on-premises network to virtual networks on Azure, using [Azure ExpressRoute][expressroute-introduction].</span></span> <span data-ttu-id="c80ca-105">Le connessioni ExpressRoute usano una connessione privata dedicata tramite un provider di connettività di terze parti.</span><span class="sxs-lookup"><span data-stu-id="c80ca-105">ExpressRoute connections use a private, dedicated connection through a third-party connectivity provider.</span></span> <span data-ttu-id="c80ca-106">La connessione privata estende la rete locale in Azure.</span><span class="sxs-lookup"><span data-stu-id="c80ca-106">The private connection extends your on-premises network into Azure.</span></span> [<span data-ttu-id="c80ca-107">**Distribuire questa soluzione**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-107">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="c80ca-108">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="c80ca-108">![[0]][0]</span></span>

<span data-ttu-id="c80ca-109">*Scaricare un [file Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="c80ca-109">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="c80ca-110">Architettura</span><span class="sxs-lookup"><span data-stu-id="c80ca-110">Architecture</span></span>

<span data-ttu-id="c80ca-111">L'architettura è costituita dai componenti seguenti.</span><span class="sxs-lookup"><span data-stu-id="c80ca-111">The architecture consists of the following components.</span></span>

* <span data-ttu-id="c80ca-112">**Rete aziendale locale**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-112">**On-premises corporate network**.</span></span> <span data-ttu-id="c80ca-113">Una rete LAN privata in esecuzione all'interno di un'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="c80ca-113">A private local-area network running within an organization.</span></span>

* <span data-ttu-id="c80ca-114">**Circuito ExpressRoute**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-114">**ExpressRoute circuit**.</span></span> <span data-ttu-id="c80ca-115">Un circuito di livello 2 o di livello 3 fornito dal provider di connettività che unisce la rete locale ad Azure attraverso i router perimetrali.</span><span class="sxs-lookup"><span data-stu-id="c80ca-115">A layer 2 or layer 3 circuit supplied by the connectivity provider that joins the on-premises network with Azure through the edge routers.</span></span> <span data-ttu-id="c80ca-116">Il circuito usa l'infrastruttura hardware gestita dal provider di connettività.</span><span class="sxs-lookup"><span data-stu-id="c80ca-116">The circuit uses the hardware infrastructure managed by the connectivity provider.</span></span>

* <span data-ttu-id="c80ca-117">**Router perimetrali locali**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-117">**Local edge routers**.</span></span> <span data-ttu-id="c80ca-118">Router che connettono la rete locale al circuito gestito dal provider.</span><span class="sxs-lookup"><span data-stu-id="c80ca-118">Routers that connect the on-premises network to the circuit managed by the provider.</span></span> <span data-ttu-id="c80ca-119">A seconda di come viene eseguito il provisioning della connessione, è necessario fornire gli indirizzi IP pubblici usati dai router.</span><span class="sxs-lookup"><span data-stu-id="c80ca-119">Depending on how your connection is provisioned, you may need to provide the public IP addresses used by the routers.</span></span>
* <span data-ttu-id="c80ca-120">**Router perimetrali Microsoft**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-120">**Microsoft edge routers**.</span></span> <span data-ttu-id="c80ca-121">Due router in una configurazione a disponibilità elevata di tipo attivo-attivo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-121">Two routers in an active-active highly available configuration.</span></span> <span data-ttu-id="c80ca-122">Questi router consentono a un provider di connettività di connettere i circuiti direttamente al data center.</span><span class="sxs-lookup"><span data-stu-id="c80ca-122">These routers enable a connectivity provider to connect their circuits directly to their datacenter.</span></span> <span data-ttu-id="c80ca-123">A seconda di come viene eseguito il provisioning della connessione, è necessario fornire gli indirizzi IP pubblici usati dai router.</span><span class="sxs-lookup"><span data-stu-id="c80ca-123">Depending on how your connection is provisioned, you may need to provide the public IP addresses used by the routers.</span></span>

* <span data-ttu-id="c80ca-124">**Reti virtuali di Azure**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-124">**Azure virtual networks (VNets)**.</span></span> <span data-ttu-id="c80ca-125">Ogni rete virtuale si trova in una singola area di Azure e può contenere più livelli applicazione.</span><span class="sxs-lookup"><span data-stu-id="c80ca-125">Each VNet resides in a single Azure region, and can host multiple application tiers.</span></span> <span data-ttu-id="c80ca-126">I livelli applicazione possono essere segmentati usando subnet in ogni rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="c80ca-126">Application tiers can be segmented using subnets in each VNet.</span></span>

* <span data-ttu-id="c80ca-127">**Servizi pubblici di Azure**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-127">**Azure public services**.</span></span> <span data-ttu-id="c80ca-128">Servizi di Azure che possono essere usati all'interno di un'applicazione ibrida.</span><span class="sxs-lookup"><span data-stu-id="c80ca-128">Azure services that can be used within a hybrid application.</span></span> <span data-ttu-id="c80ca-129">Questi servizi sono disponibili anche tramite Internet, ma l'accesso tramite un circuito ExpressRoute assicura bassa latenza e prestazioni più prevedibili, perché il traffico non passa attraverso Internet.</span><span class="sxs-lookup"><span data-stu-id="c80ca-129">These services are also available over the Internet, but accessing them using an ExpressRoute circuit provides low latency and more predictable performance, because traffic does not go through the Internet.</span></span> <span data-ttu-id="c80ca-130">Le connessioni vengono eseguite usando il [peering pubblico][expressroute-peering], con indirizzi di proprietà dell'organizzazione o forniti dal provider di connettività.</span><span class="sxs-lookup"><span data-stu-id="c80ca-130">Connections are performed using [public peering][expressroute-peering], with addresses that are either owned by your organization or supplied by your connectivity provider.</span></span>

* <span data-ttu-id="c80ca-131">**Servizi di Office 365**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-131">**Office 365 services**.</span></span> <span data-ttu-id="c80ca-132">Le applicazioni e i servizi di Office 365 disponibili pubblicamente forniti da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c80ca-132">The publicly available Office 365 applications and services provided by Microsoft.</span></span> <span data-ttu-id="c80ca-133">Le connessioni vengono eseguite usando il [peering Microsoft][expressroute-peering], con indirizzi di proprietà dell'organizzazione o forniti dal provider di connettività.</span><span class="sxs-lookup"><span data-stu-id="c80ca-133">Connections are performed using [Microsoft peering][expressroute-peering], with addresses that are either owned by your organization or supplied by your connectivity provider.</span></span> <span data-ttu-id="c80ca-134">È inoltre possibile connettersi direttamente a Microsoft CRM Online tramite il peering Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c80ca-134">You can also connect directly to Microsoft CRM Online through Microsoft peering.</span></span>

* <span data-ttu-id="c80ca-135">**Provider di connettività** (non visualizzato).</span><span class="sxs-lookup"><span data-stu-id="c80ca-135">**Connectivity providers** (not shown).</span></span> <span data-ttu-id="c80ca-136">Società che forniscono una connessione usando la connettività di livello 2 o di livello 3 tra il data center dell'utente e un data center di Azure.</span><span class="sxs-lookup"><span data-stu-id="c80ca-136">Companies that provide a connection either using layer 2 or layer 3 connectivity between your datacenter and an Azure datacenter.</span></span>

## <a name="recommendations"></a><span data-ttu-id="c80ca-137">Consigli</span><span class="sxs-lookup"><span data-stu-id="c80ca-137">Recommendations</span></span>

<span data-ttu-id="c80ca-138">Le raccomandazioni seguenti sono valide per la maggior parte degli scenari.</span><span class="sxs-lookup"><span data-stu-id="c80ca-138">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="c80ca-139">Seguire queste indicazioni, a meno che non si disponga di un requisito specifico che le escluda.</span><span class="sxs-lookup"><span data-stu-id="c80ca-139">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="connectivity-providers"></a><span data-ttu-id="c80ca-140">Provider di connettività</span><span class="sxs-lookup"><span data-stu-id="c80ca-140">Connectivity providers</span></span>

<span data-ttu-id="c80ca-141">Selezionare un provider di connettività ExpressRoute adatto alla propria località.</span><span class="sxs-lookup"><span data-stu-id="c80ca-141">Select a suitable ExpressRoute connectivity provider for your location.</span></span> <span data-ttu-id="c80ca-142">Per ottenere un elenco di provider di connettività disponibili per la propria località, usare il comando di Azure PowerShell seguente:</span><span class="sxs-lookup"><span data-stu-id="c80ca-142">To get a list of connectivity providers available at your location, use the following Azure PowerShell command:</span></span>

```powershell
Get-AzureRmExpressRouteServiceProvider
```

<span data-ttu-id="c80ca-143">I provider di connettività di ExpressRoute connettono il data center dell'utente a Microsoft nei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="c80ca-143">ExpressRoute connectivity providers connect your datacenter to Microsoft in the following ways:</span></span>

* <span data-ttu-id="c80ca-144">**Percorso condiviso in una struttura con scambio cloud**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-144">**Co-located at a cloud exchange**.</span></span> <span data-ttu-id="c80ca-145">Nel caso di percorso condiviso in una struttura con scambio cloud, è possibile ordinare Cross Connection virtuali ad Azure tramite lo scambio Ethernet del provider di condivisione del percorso.</span><span class="sxs-lookup"><span data-stu-id="c80ca-145">If you're co-located in a facility with a cloud exchange, you can order virtual cross-connections to Azure through the co-location provider’s Ethernet exchange.</span></span> <span data-ttu-id="c80ca-146">I provider di condivisione del percorso possono fornire connessioni incrociate di livello 2 oppure gestite di livello 3 tra l'infrastruttura nella struttura di condivisione percorso e Azure.</span><span class="sxs-lookup"><span data-stu-id="c80ca-146">Co-location providers can offer either layer 2 cross-connections, or managed layer 3 cross-connections between your infrastructure in the co-location facility and Azure.</span></span>
* <span data-ttu-id="c80ca-147">**Connessioni Ethernet da punto a punto**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-147">**Point-to-point Ethernet connections**.</span></span> <span data-ttu-id="c80ca-148">È possibile connettere i data center o gli uffici locali ad Azure tramite collegamenti Ethernet punto a punto.</span><span class="sxs-lookup"><span data-stu-id="c80ca-148">You can connect your on-premises datacenters/offices to Azure through point-to-point Ethernet links.</span></span> <span data-ttu-id="c80ca-149">I provider Ethernet punto a punto forniscono connessioni di livello 2 o connessioni gestite di livello 3 tra la sede dell'utente e Azure.</span><span class="sxs-lookup"><span data-stu-id="c80ca-149">Point-to-point Ethernet providers can offer layer 2 connections, or managed layer 3 connections between your site and Azure.</span></span>
* <span data-ttu-id="c80ca-150">**Reti Any-to-any (IPVPN)**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-150">**Any-to-any (IPVPN) networks**.</span></span> <span data-ttu-id="c80ca-151">È possibile integrare una rete WAN con Azure.</span><span class="sxs-lookup"><span data-stu-id="c80ca-151">You can integrate your wide area network (WAN) with Azure.</span></span> <span data-ttu-id="c80ca-152">I provider IPVPN (in genere VPN MPLS) forniscono connettività any-to-any tra le succursali e i data center.</span><span class="sxs-lookup"><span data-stu-id="c80ca-152">Internet protocol virtual private network (IPVPN) providers (typically a multiprotocol label switching VPN) offer any-to-any connectivity between your branch offices and datacenters.</span></span> <span data-ttu-id="c80ca-153">Azure può essere interconnesso a una rete WAN in modo che abbia l'aspetto di qualsiasi altra succursale.</span><span class="sxs-lookup"><span data-stu-id="c80ca-153">Azure can be interconnected to your WAN to make it look just like any other branch office.</span></span> <span data-ttu-id="c80ca-154">I provider WAN offrono in genere connettività gestita di livello 3.</span><span class="sxs-lookup"><span data-stu-id="c80ca-154">WAN providers typically offer managed layer 3 connectivity.</span></span>

<span data-ttu-id="c80ca-155">Per altre informazioni sui provider di connettività, vedere [Introduzione a ExpressRoute][expressroute-introduction].</span><span class="sxs-lookup"><span data-stu-id="c80ca-155">For more information about connectivity providers, see the [ExpressRoute introduction][expressroute-introduction].</span></span>

### <a name="expressroute-circuit"></a><span data-ttu-id="c80ca-156">Circuito ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="c80ca-156">ExpressRoute circuit</span></span>

<span data-ttu-id="c80ca-157">Assicurarsi che l'organizzazione sia in linea con i [Prerequisiti di ExpressRoute][expressroute-prereqs] per connettersi ad Azure.</span><span class="sxs-lookup"><span data-stu-id="c80ca-157">Ensure that your organization has met the [ExpressRoute prerequisite requirements][expressroute-prereqs] for connecting to Azure.</span></span>

<span data-ttu-id="c80ca-158">Se non è già stato fatto, aggiungere una subnet denominata `GatewaySubnet` alla rete virtuale di Azure e creare un gateway di rete virtuale ExpressRoute tramite il servizio gateway VPN di Azure.</span><span class="sxs-lookup"><span data-stu-id="c80ca-158">If you haven't already done so, add a subnet named `GatewaySubnet` to your Azure VNet and create an ExpressRoute virtual network gateway using the Azure VPN gateway service.</span></span> <span data-ttu-id="c80ca-159">Per altre informazioni su questo processo, vedere [Flussi di lavoro ExpressRoute per provisioning di un circuito e stati di circuito][ExpressRoute-provisioning].</span><span class="sxs-lookup"><span data-stu-id="c80ca-159">For more information about this process, see [ExpressRoute workflows for circuit provisioning and circuit states][ExpressRoute-provisioning].</span></span>

<span data-ttu-id="c80ca-160">Creare un circuito ExpressRoute nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="c80ca-160">Create an ExpressRoute circuit as follows:</span></span>

1. <span data-ttu-id="c80ca-161">Eseguire il seguente comando PowerShell:</span><span class="sxs-lookup"><span data-stu-id="c80ca-161">Run the following PowerShell command:</span></span>
   
    ```powershell
    New-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>> -Location <<location>> -SkuTier <<sku-tier>> -SkuFamily <<sku-family>> -ServiceProviderName <<service-provider-name>> -PeeringLocation <<peering-location>> -BandwidthInMbps <<bandwidth-in-mbps>>
    ```
2. <span data-ttu-id="c80ca-162">Inviare `ServiceKey` per il nuovo percorso al provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="c80ca-162">Send the `ServiceKey` for the new circuit to the service provider.</span></span>

3. <span data-ttu-id="c80ca-163">Attendere che il provider esegua il provisioning del circuito.</span><span class="sxs-lookup"><span data-stu-id="c80ca-163">Wait for the provider to provision the circuit.</span></span> <span data-ttu-id="c80ca-164">Per verificare lo stato del provisioning di un circuito, eseguire il seguente comando PowerShell:</span><span class="sxs-lookup"><span data-stu-id="c80ca-164">To verify the provisioning state of a circuit, run the following PowerShell command:</span></span>
   
    ```powershell
    Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    ```

    <span data-ttu-id="c80ca-165">Il campo `Provisioning state` nella sezione `Service Provider` dell'output che passerà da `NotProvisioned` a `Provisioned` quando il circuito è pronto.</span><span class="sxs-lookup"><span data-stu-id="c80ca-165">The `Provisioning state` field in the `Service Provider` section of the output will change from `NotProvisioned` to `Provisioned` when the circuit is ready.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c80ca-166">Se si usa una connessione di livello 3, il provider deve configurare e gestire il routing per l'utente.</span><span class="sxs-lookup"><span data-stu-id="c80ca-166">If you're using a layer 3 connection, the provider should configure and manage routing for you.</span></span> <span data-ttu-id="c80ca-167">Fornire le informazioni necessarie per consentire al provider di implementare le route appropriate.</span><span class="sxs-lookup"><span data-stu-id="c80ca-167">You provide the information necessary to enable the provider to implement the appropriate routes.</span></span>
    > 
    > 

4. <span data-ttu-id="c80ca-168">Se si usa una connessione di livello 2:</span><span class="sxs-lookup"><span data-stu-id="c80ca-168">If you're using a layer 2 connection:</span></span>

    1. <span data-ttu-id="c80ca-169">Riservare due subnet /30 costituite da indirizzi IP pubblici validi per ogni tipo di peering che si vuole implementare.</span><span class="sxs-lookup"><span data-stu-id="c80ca-169">Reserve two /30 subnets composed of valid public IP addresses for each type of peering you want to implement.</span></span> <span data-ttu-id="c80ca-170">Queste subnet /30 verranno usate per fornire indirizzi IP per i router usati per il circuito.</span><span class="sxs-lookup"><span data-stu-id="c80ca-170">These /30 subnets will be used to provide IP addresses for the routers used for the circuit.</span></span> <span data-ttu-id="c80ca-171">Se si sta implementano un peering privato, pubblico e Microsoft, sono necessarie 6 subnet /30 con indirizzi IP pubblici validi.</span><span class="sxs-lookup"><span data-stu-id="c80ca-171">If you are implementing private, public, and Microsoft peering, you'll need 6 /30 subnets with valid public IP addresses.</span></span>     

    2. <span data-ttu-id="c80ca-172">Configurare il routing per il circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c80ca-172">Configure routing for the ExpressRoute circuit.</span></span> <span data-ttu-id="c80ca-173">Eseguire i seguenti comandi PowerShell per ciascun tipo di peering che si intende configurare (privato, pubblico e Microsoft).</span><span class="sxs-lookup"><span data-stu-id="c80ca-173">Run the following PowerShell commands for each type of peering you want to configure (private, public, and Microsoft).</span></span> <span data-ttu-id="c80ca-174">Per altre informazioni, vedere [Creare e modificare il routing per un circuito ExpressRoute][configure-expressroute-routing].</span><span class="sxs-lookup"><span data-stu-id="c80ca-174">For more information, see [Create and modify routing for an ExpressRoute circuit][configure-expressroute-routing].</span></span>
   
        ```powershell
        Set-AzureRmExpressRouteCircuitPeeringConfig -Name <<peering-name>> -Circuit <<circuit-name>> -PeeringType <<peering-type>> -PeerASN <<peer-asn>> -PrimaryPeerAddressPrefix <<primary-peer-address-prefix>> -SecondaryPeerAddressPrefix <<secondary-peer-address-prefix>> -VlanId <<vlan-id>>

        Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit <<circuit-name>>
        ```

    3. <span data-ttu-id="c80ca-175">Riservare un altro pool di indirizzi IP pubblici validi da usare per NAT (Network Address Translation) per il peering Microsoft e pubblico.</span><span class="sxs-lookup"><span data-stu-id="c80ca-175">Reserve another pool of valid public IP addresses to use for network address translation (NAT) for public and Microsoft peering.</span></span> <span data-ttu-id="c80ca-176">È consigliabile disporre di un pool diverso per ogni tipo di peering.</span><span class="sxs-lookup"><span data-stu-id="c80ca-176">It is recommended to have a different pool for each peering.</span></span> <span data-ttu-id="c80ca-177">Specificare il pool al provider di connettività, per consentirgli di configurare gli annunci BGP (Border Gateway Protocol) per tali intervalli.</span><span class="sxs-lookup"><span data-stu-id="c80ca-177">Specify the pool to your connectivity provider, so they can configure border gateway protocol (BGP) advertisements for those ranges.</span></span>

5. <span data-ttu-id="c80ca-178">Eseguire i comandi PowerShell seguenti per collegare le reti virtuali al circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c80ca-178">Run the following PowerShell commands to link your private VNet(s) to the ExpressRoute circuit.</span></span> <span data-ttu-id="c80ca-179">Per altre informazioni, vedere [Collegare una rete virtuale a un circuito ExpressRoute][link-vnet-to-expressroute].</span><span class="sxs-lookup"><span data-stu-id="c80ca-179">For more information,see [Link a virtual network to an ExpressRoute circuit][link-vnet-to-expressroute].</span></span>

    ```powershell
    $circuit = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    $gw = Get-AzureRmVirtualNetworkGateway -Name <<gateway-name>> -ResourceGroupName <<resource-group>>
    New-AzureRmVirtualNetworkGatewayConnection -Name <<connection-name>> -ResourceGroupName <<resource-group>> -Location <<location> -VirtualNetworkGateway1 $gw -PeerId $circuit.Id -ConnectionType ExpressRoute
    ```

<span data-ttu-id="c80ca-180">È possibile connettere più reti virtuali situate in diverse aree dello stesso circuito ExpressRoute, a condizione che tutte le reti virtuali e il circuito ExpressRoute si trovino nella stessa area geopolitica.</span><span class="sxs-lookup"><span data-stu-id="c80ca-180">You can connect multiple VNets located in different regions to the same ExpressRoute circuit, as long as all VNets and the ExpressRoute circuit are located within the same geopolitical region.</span></span>

### <a name="troubleshooting"></a><span data-ttu-id="c80ca-181">risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="c80ca-181">Troubleshooting</span></span> 

<span data-ttu-id="c80ca-182">Se un circuito ExpressRoute precedentemente funzionante non si connette, in assenza di eventuali modifiche di configurazione in locale o all'interno della rete virtuale privata, potrebbe essere necessario contattare il provider di connettività e collaborare con lui per risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="c80ca-182">If a previously functioning ExpressRoute circuit now fails to connect, in the absence of any configuration changes on-premises or within your private VNet, you may need to contact the connectivity provider and work with them to correct the issue.</span></span> <span data-ttu-id="c80ca-183">Usare i seguenti comandi Powershell per verificare che sia stato eseguito il provisioning del circuito ExpressRoute:</span><span class="sxs-lookup"><span data-stu-id="c80ca-183">Use the following Powershell commands to verify that the ExpressRoute circuit has been provisioned:</span></span>

```powershell
Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
```

<span data-ttu-id="c80ca-184">L'output di questo comando mostra diverse proprietà per il circuito, tra cui `ProvisioningState`, `CircuitProvisioningState` e `ServiceProviderProvisioningState` come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="c80ca-184">The output of this command shows several properties for your circuit, including `ProvisioningState`, `CircuitProvisioningState`, and `ServiceProviderProvisioningState` as shown below.</span></span>

```
ProvisioningState                : Succeeded
Sku                              : {
                                     "Name": "Standard_MeteredData",
                                     "Tier": "Standard",
                                     "Family": "MeteredData"
                                   }
CircuitProvisioningState         : Enabled
ServiceProviderProvisioningState : NotProvisioned
```

<span data-ttu-id="c80ca-185">Se `ProvisioningState` non è impostato su `Succeeded` dopo aver tentato di creare un nuovo circuito, rimuovere il circuito usando il comando di seguito e tentare di ricrearlo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-185">If the `ProvisioningState` is not set to `Succeeded` after you tried to create a new circuit, remove the circuit by using the command below and try to create it again.</span></span>

```powershell
Remove-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
```

<span data-ttu-id="c80ca-186">Se il provider ha già eseguito il provisioning del circuito e `ProvisioningState` è impostato su `Failed` o `CircuitProvisioningState` non `Enabled` contattare il provider per ulteriore assistenza.</span><span class="sxs-lookup"><span data-stu-id="c80ca-186">If your provider had already provisioned the circuit, and the `ProvisioningState` is set to `Failed`, or the `CircuitProvisioningState` is not `Enabled`, contact your provider for further assistance.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="c80ca-187">Considerazioni sulla scalabilità</span><span class="sxs-lookup"><span data-stu-id="c80ca-187">Scalability considerations</span></span>

<span data-ttu-id="c80ca-188">I circuiti ExpressRoute offrono un percorso di larghezza di banda elevata tra le reti.</span><span class="sxs-lookup"><span data-stu-id="c80ca-188">ExpressRoute circuits provide a high bandwidth path between networks.</span></span> <span data-ttu-id="c80ca-189">In genere, maggiore è la larghezza di banda maggiore sarà il costo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-189">Generally, the higher the bandwidth the greater the cost.</span></span> 

<span data-ttu-id="c80ca-190">ExpressRoute offre ai clienti due [piani tariffari] [ expressroute-pricing], un piano a consumo e un piano dati senza limiti.</span><span class="sxs-lookup"><span data-stu-id="c80ca-190">ExpressRoute offers two [pricing plans][expressroute-pricing] to customers, a metered plan and an unlimited data plan.</span></span> <span data-ttu-id="c80ca-191">Gli addebiti variano a seconda della larghezza di banda del circuito.</span><span class="sxs-lookup"><span data-stu-id="c80ca-191">Charges vary according to circuit bandwidth.</span></span> <span data-ttu-id="c80ca-192">La larghezza di banda disponibile probabilmente varierà da provider a provider.</span><span class="sxs-lookup"><span data-stu-id="c80ca-192">Available bandwidth will likely vary from provider to provider.</span></span> <span data-ttu-id="c80ca-193">Usare cmdlet `Get-AzureRmExpressRouteServiceProvider` per visualizzare i provider disponibili nella propria area geografica e le larghezze di banda offerte.</span><span class="sxs-lookup"><span data-stu-id="c80ca-193">Use the `Get-AzureRmExpressRouteServiceProvider` cmdlet to see the providers available in your region and the bandwidths that they offer.</span></span>
 
<span data-ttu-id="c80ca-194">Un singolo circuito ExpressRoute può supportare un determinato numero di peering e collegamenti di rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="c80ca-194">A single ExpressRoute circuit can support a certain number of peerings and VNet links.</span></span> <span data-ttu-id="c80ca-195">Per altre informazioni, vedere [Limiti di ExpressRoute](/azure/azure-subscription-service-limits).</span><span class="sxs-lookup"><span data-stu-id="c80ca-195">See [ExpressRoute limits](/azure/azure-subscription-service-limits) for more information.</span></span>

<span data-ttu-id="c80ca-196">Per un addebito aggiuntivo, il componente aggiuntivo ExpressRoute Premium offre alcune funzionalità aggiuntive:</span><span class="sxs-lookup"><span data-stu-id="c80ca-196">For an extra charge, the ExpressRoute Premium add-on provides some additional capability:</span></span>

* <span data-ttu-id="c80ca-197">Maggiori limiti delle route per peering pubblici e privati.</span><span class="sxs-lookup"><span data-stu-id="c80ca-197">Increased route limits for public and private peering.</span></span> 
* <span data-ttu-id="c80ca-198">Maggior numero di collegamenti della rete virtuale per il circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c80ca-198">Increased number of VNet links per ExpressRoute circuit.</span></span> 
* <span data-ttu-id="c80ca-199">Connettività globale per i servizi.</span><span class="sxs-lookup"><span data-stu-id="c80ca-199">Global connectivity for services.</span></span>

<span data-ttu-id="c80ca-200">Per altri dettagli, vedere [Prezzi ExpressRoute][expressroute-pricing].</span><span class="sxs-lookup"><span data-stu-id="c80ca-200">See [ExpressRoute pricing][expressroute-pricing] for details.</span></span> 

<span data-ttu-id="c80ca-201">I circuiti ExpressRoute sono progettati per consentire di potenziare fino al doppio il limite di larghezza di banda acquistato delle reti temporanee, senza alcun costo aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-201">ExpressRoute circuits are designed to allow temporary network bursts up to two times the bandwidth limit that you procured for no additional cost.</span></span> <span data-ttu-id="c80ca-202">Questo risultato viene ottenuto tramite collegamenti ridondanti.</span><span class="sxs-lookup"><span data-stu-id="c80ca-202">This is achieved by using redundant links.</span></span> <span data-ttu-id="c80ca-203">Tuttavia, non tutti i provider di connettività supportano questa funzione.</span><span class="sxs-lookup"><span data-stu-id="c80ca-203">However, not all connectivity providers support this feature.</span></span> <span data-ttu-id="c80ca-204">Verificare che il provider di connettività consenta questa funzionalità prima di dipendere da essa.</span><span class="sxs-lookup"><span data-stu-id="c80ca-204">Verify that your connectivity provider enables this feature before depending on it.</span></span>

<span data-ttu-id="c80ca-205">Anche se alcuni provider consentono di modificare la larghezza di banda, assicurarsi di scegliere una larghezza di banda iniziale superiore alle proprie esigenze e che offra spazio per la crescita.</span><span class="sxs-lookup"><span data-stu-id="c80ca-205">Although some providers allow you to change your bandwidth, make sure you pick an initial bandwidth that surpasses your needs and provides room for growth.</span></span> <span data-ttu-id="c80ca-206">Se è necessario aumentare la larghezza di banda in futuro, restano a disposizione due opzioni:</span><span class="sxs-lookup"><span data-stu-id="c80ca-206">If you need to increase bandwidth in the future, you are left with two options:</span></span>

- <span data-ttu-id="c80ca-207">Aumentare la larghezza di banda.</span><span class="sxs-lookup"><span data-stu-id="c80ca-207">Increase the bandwidth.</span></span> <span data-ttu-id="c80ca-208">È consigliabile evitare questa opzione quando possibile inoltre, non tutti i provider consentono di aumentare in modo dinamico la larghezza di banda.</span><span class="sxs-lookup"><span data-stu-id="c80ca-208">You should avoid this option as much as possible, and not all providers allow you to increase bandwidth dynamically.</span></span> <span data-ttu-id="c80ca-209">Ma se è necessario un aumento della larghezza di banda, verificare con il provider se supporta la modifica delle proprietà della larghezza di banda ExpressRoute tramite i comandi Powershell.</span><span class="sxs-lookup"><span data-stu-id="c80ca-209">But if a bandwidth increase is needed, check with your provider to verify they support changing ExpressRoute bandwidth properties via Powershell commands.</span></span> <span data-ttu-id="c80ca-210">In caso affermativo, eseguire i comandi riportati di seguito.</span><span class="sxs-lookup"><span data-stu-id="c80ca-210">If they do, run the commands below.</span></span>

    ```powershell
    $ckt = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>
    $ckt.ServiceProviderProperties.BandwidthInMbps = <<bandwidth-in-mbps>>
    Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt
    ```

    <span data-ttu-id="c80ca-211">È possibile aumentare la larghezza di banda senza perdita di connettività.</span><span class="sxs-lookup"><span data-stu-id="c80ca-211">You can increase the bandwidth without loss of connectivity.</span></span> <span data-ttu-id="c80ca-212">Il downgrade della larghezza di banda comporterà interruzioni della connettività, perché è necessario eliminare il circuito e ricrearlo con la nuova configurazione.</span><span class="sxs-lookup"><span data-stu-id="c80ca-212">Downgrading the bandwidth will result in disruption in connectivity, because you must delete the circuit and recreate it with the new configuration.</span></span>

- <span data-ttu-id="c80ca-213">Modificare il piano tariffario e/o eseguire l'aggiornamento a Premium.</span><span class="sxs-lookup"><span data-stu-id="c80ca-213">Change your pricing plan and/or upgrade to Premium.</span></span> <span data-ttu-id="c80ca-214">A tale scopo, eseguire i comandi seguenti.</span><span class="sxs-lookup"><span data-stu-id="c80ca-214">To do so, run the following commands.</span></span> <span data-ttu-id="c80ca-215">La proprietà `Sku.Tier` può essere `Standard` o `Premium`; la proprietà `Sku.Name` può essere `MeteredData` o `UnlimitedData`.</span><span class="sxs-lookup"><span data-stu-id="c80ca-215">The `Sku.Tier` property can be `Standard` or `Premium`; the `Sku.Name` property can be `MeteredData` or `UnlimitedData`.</span></span>

    ```powershell
    $ckt = Get-AzureRmExpressRouteCircuit -Name <<circuit-name>> -ResourceGroupName <<resource-group>>

    $ckt.Sku.Tier = "Premium"
    $ckt.Sku.Family = "MeteredData"
    $ckt.Sku.Name = "Premium_MeteredData"

    Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt
    ```

    > [!IMPORTANT]
    > <span data-ttu-id="c80ca-216">Verificare che la proprietà `Sku.Name` corrisponda a `Sku.Tier` e `Sku.Family`.</span><span class="sxs-lookup"><span data-stu-id="c80ca-216">Make sure the `Sku.Name` property matches the `Sku.Tier` and `Sku.Family`.</span></span> <span data-ttu-id="c80ca-217">Se si modifica la famiglia e il livello ma non il nome, la connessione verrà disabilitata.</span><span class="sxs-lookup"><span data-stu-id="c80ca-217">If you change the family and tier, but not the name, your connection will be disabled.</span></span>
    > 
    > 

    <span data-ttu-id="c80ca-218">È possibile aggiornare lo SKU senza interruzioni, ma non è possibile passare dal piano tariffario illimitato a quello a consumo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-218">You can upgrade the SKU without disruption, but you cannot switch from the unlimited pricing plan to metered.</span></span> <span data-ttu-id="c80ca-219">Quando si esegue il downgrade dello SKU, il consumo di larghezza di banda deve rimanere entro il limite predefinito dello SKU standard.</span><span class="sxs-lookup"><span data-stu-id="c80ca-219">When downgrading the SKU, your bandwidth consumption must remain within the default limit of the standard SKU.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="c80ca-220">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="c80ca-220">Availability considerations</span></span>

<span data-ttu-id="c80ca-221">ExpressRoute non supporta protocolli di ridondanza router, ad esempio HSRP (Standby Routing Protocol) e VRRP (Virtual Router Redundancy Protocol) per implementare la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="c80ca-221">ExpressRoute does not support router redundancy protocols such as hot standby routing protocol (HSRP) and virtual router redundancy protocol (VRRP) to implement high availability.</span></span> <span data-ttu-id="c80ca-222">Usa invece una coppia ridondante di sessioni BGP per il peering.</span><span class="sxs-lookup"><span data-stu-id="c80ca-222">Instead, it uses a redundant pair of BGP sessions per peering.</span></span> <span data-ttu-id="c80ca-223">Per facilitare le connessioni a disponibilità elevata per la rete, Azure esegue il provisioning di due porte ridondanti su due router (parte di Microsoft Edge) in una configurazione di tipo attivo-attivo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-223">To facilitate highly-available connections to your network, Azure provisions you with two redundant ports on two routers (part of the Microsoft edge) in an active-active configuration.</span></span>

<span data-ttu-id="c80ca-224">Per impostazione predefinita, le sessioni BGP usano un valore di timeout inattività di 60 secondi.</span><span class="sxs-lookup"><span data-stu-id="c80ca-224">By default, BGP sessions use an idle timeout value of 60 seconds.</span></span> <span data-ttu-id="c80ca-225">In caso di tre timeout della sessione (180 secondi in totale), il router viene contrassegnato come non disponibile e tutto il traffico viene reindirizzato al router rimanente.</span><span class="sxs-lookup"><span data-stu-id="c80ca-225">If a session times out three times (180 seconds total), the router is marked as unavailable, and all traffic is redirected to the remaining router.</span></span> <span data-ttu-id="c80ca-226">Questo timeout di 180 secondi potrebbe essere troppo lungo per le applicazioni critiche.</span><span class="sxs-lookup"><span data-stu-id="c80ca-226">This 180-second timeout might be too long for critical applications.</span></span> <span data-ttu-id="c80ca-227">In questo caso, è possibile modificare le impostazioni di timeout BGP sul router locale su un valore inferiore.</span><span class="sxs-lookup"><span data-stu-id="c80ca-227">If so, you can change your BGP time-out settings on the on-premises router to a smaller value.</span></span>

<span data-ttu-id="c80ca-228">È possibile configurare la disponibilità elevata per la connessione di Azure in modi diversi, in base al tipo di provider in uso e al numero di circuiti ExpressRoute e di connessioni del gateway di rete virtuale che si desidera configurare.</span><span class="sxs-lookup"><span data-stu-id="c80ca-228">You can configure high availability for your Azure connection in different ways, depending on the type of provider you use, and the number of ExpressRoute circuits and virtual network gateway connections you're willing to configure.</span></span> <span data-ttu-id="c80ca-229">Di seguito sono riepilogate le opzioni di disponibilità:</span><span class="sxs-lookup"><span data-stu-id="c80ca-229">The following summarizes your availability options:</span></span>

* <span data-ttu-id="c80ca-230">Se si usa una connessione di livello 2, distribuire router ridondanti nella rete locale in una configurazione di tipo attivo-attivo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-230">If you're using a layer 2 connection, deploy redundant routers in your on-premises network in an active-active configuration.</span></span> <span data-ttu-id="c80ca-231">Connettere il circuito primario a un router e il circuito secondario all'altro.</span><span class="sxs-lookup"><span data-stu-id="c80ca-231">Connect the primary circuit to one router, and the secondary circuit to the other.</span></span> <span data-ttu-id="c80ca-232">In questo modo si otterrà una connessione a disponibilità elevata a entrambe le estremità della connessione.</span><span class="sxs-lookup"><span data-stu-id="c80ca-232">This will give you a highly available connection at both ends of the connection.</span></span> <span data-ttu-id="c80ca-233">Questo è necessario se si richiede il contratto di servizio di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c80ca-233">This is necessary if you require the ExpressRoute service level agreement (SLA).</span></span> <span data-ttu-id="c80ca-234">Per altri dettagli, vedere [Contratto di servizio per Azure ExpressRoute][sla-for-expressroute].</span><span class="sxs-lookup"><span data-stu-id="c80ca-234">See [SLA for Azure ExpressRoute][sla-for-expressroute] for details.</span></span>

    <span data-ttu-id="c80ca-235">Il diagramma seguente illustra una configurazione con router ridondanti locali connessi ai circuiti primari e secondari.</span><span class="sxs-lookup"><span data-stu-id="c80ca-235">The following diagram shows a configuration with redundant on-premises routers connected to the primary and secondary circuits.</span></span> <span data-ttu-id="c80ca-236">Ogni circuito gestisce il traffico per un peering pubblico e un peering privato (a ogni peering viene designata una coppia di spazi di indirizzi /30, come descritto nella sezione precedente).</span><span class="sxs-lookup"><span data-stu-id="c80ca-236">Each circuit handles the traffic for a public peering and a private peering (each peering is designated a pair of /30 address spaces, as described in the previous section).</span></span>

    <span data-ttu-id="c80ca-237">![[1]][1]</span><span class="sxs-lookup"><span data-stu-id="c80ca-237">![[1]][1]</span></span>

* <span data-ttu-id="c80ca-238">Se si usa una connessione di livello 3, verificare che fornisca sessioni BGP ridondanti che gestiscono la disponibilità per l'utente.</span><span class="sxs-lookup"><span data-stu-id="c80ca-238">If you're using a layer 3 connection, verify that it provides redundant BGP sessions that handle availability for you.</span></span>

* <span data-ttu-id="c80ca-239">Connettere la rete virtuale a più circuiti ExpressRoute, forniti da diversi provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="c80ca-239">Connect the VNet to multiple ExpressRoute circuits, supplied by different service providers.</span></span> <span data-ttu-id="c80ca-240">Questa strategia offre funzionalità di disponibilità elevata e di ripristino di emergenza aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="c80ca-240">This strategy provides additional high-availability and disaster recovery capabilities.</span></span>

* <span data-ttu-id="c80ca-241">Configurare una VPN da sito a sito come percorso di failover per ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c80ca-241">Configure a site-to-site VPN as a failover path for ExpressRoute.</span></span> <span data-ttu-id="c80ca-242">Per altre informazioni su questa opzione, vedere [Connettere una rete locale ad Azure tramite ExpressRoute con failover VPN][highly-available-network-architecture].</span><span class="sxs-lookup"><span data-stu-id="c80ca-242">For more about this option, see [Connect an on-premises network to Azure using ExpressRoute with VPN failover][highly-available-network-architecture].</span></span>
 <span data-ttu-id="c80ca-243">Questa opzione si applica solo al peering privato.</span><span class="sxs-lookup"><span data-stu-id="c80ca-243">This option only applies to private peering.</span></span> <span data-ttu-id="c80ca-244">Per i servizi di Azure e Office 365, Internet è l'unico percorso di failover.</span><span class="sxs-lookup"><span data-stu-id="c80ca-244">For Azure and Office 365 services, the Internet is the only failover path.</span></span> 

## <a name="manageability-considerations"></a><span data-ttu-id="c80ca-245">Considerazioni sulla gestibilità</span><span class="sxs-lookup"><span data-stu-id="c80ca-245">Manageability considerations</span></span>

<span data-ttu-id="c80ca-246">È possibile usare [AzureCT (Azure Connectivity Toolkit)] [ azurect] per controllare la connettività tra il data center locale e Azure.</span><span class="sxs-lookup"><span data-stu-id="c80ca-246">You can use the [Azure Connectivity Toolkit (AzureCT)][azurect] to monitor connectivity between your on-premises datacenter and Azure.</span></span> 

## <a name="security-considerations"></a><span data-ttu-id="c80ca-247">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="c80ca-247">Security considerations</span></span>

<span data-ttu-id="c80ca-248">È possibile configurare opzioni di sicurezza per la connessione di Azure in diversi modi, a seconda delle preoccupazioni relative alla sicurezza e alle esigenze di conformità.</span><span class="sxs-lookup"><span data-stu-id="c80ca-248">You can configure security options for your Azure connection in different ways, depending on your security concerns and compliance needs.</span></span> 

<span data-ttu-id="c80ca-249">ExpressRoute funzione al livello 3.</span><span class="sxs-lookup"><span data-stu-id="c80ca-249">ExpressRoute operates in layer 3.</span></span> <span data-ttu-id="c80ca-250">Le minacce a livello dell'applicazione possono essere impedite usando un dispositivo di sicurezza di rete per limitare il traffico alle risorse legittime.</span><span class="sxs-lookup"><span data-stu-id="c80ca-250">Threats in the application layer can be prevented by using a network security appliance that restricts traffic to legitimate resources.</span></span> <span data-ttu-id="c80ca-251">Inoltre, le connessioni ExpressRoute tramite il peering pubblico possono essere avviate solo da locale.</span><span class="sxs-lookup"><span data-stu-id="c80ca-251">Additionally, ExpressRoute connections using public peering can only be initiated from on-premises.</span></span> <span data-ttu-id="c80ca-252">In questo modo si impedisce a un servizio non autorizzato di accedere e compromettere i dati in locale da Internet.</span><span class="sxs-lookup"><span data-stu-id="c80ca-252">This prevents a rogue service from accessing and compromising on-premises data from the Internet.</span></span>

<span data-ttu-id="c80ca-253">Per ottimizzare la sicurezza, aggiungere dispositivi di sicurezza di rete tra la rete locale e i router perimetrali dei provider.</span><span class="sxs-lookup"><span data-stu-id="c80ca-253">To maximize security, add network security appliances between the on-premises network and the provider edge routers.</span></span> <span data-ttu-id="c80ca-254">Ciò è utile per limitare il carico del traffico non autorizzato dalla rete virtuale:</span><span class="sxs-lookup"><span data-stu-id="c80ca-254">This will help to restrict the inflow of unauthorized traffic from the VNet:</span></span>

<span data-ttu-id="c80ca-255">![[2]][2]</span><span class="sxs-lookup"><span data-stu-id="c80ca-255">![[2]][2]</span></span>

<span data-ttu-id="c80ca-256">Per motivi di conformità o di controllo, potrebbe essere necessario impedire l'accesso diretto da componenti in esecuzione nella rete virtuale a Internet e implementare il [tunneling forzato][forced-tuneling].</span><span class="sxs-lookup"><span data-stu-id="c80ca-256">For auditing or compliance purposes, it may be necessary to prohibit direct access from components running in the VNet to the Internet and implement [forced tunneling][forced-tuneling].</span></span> <span data-ttu-id="c80ca-257">In questo caso, il traffico Internet deve essere reindirizzato attraverso un proxy in esecuzione in locale in cui può essere controllato.</span><span class="sxs-lookup"><span data-stu-id="c80ca-257">In this situation, Internet traffic should be redirected back through a proxy running  on-premises where it can be audited.</span></span> <span data-ttu-id="c80ca-258">Il proxy può essere configurato per bloccare i flussi di traffico in uscita non autorizzato e filtrare il traffico in ingresso potenzialmente dannoso.</span><span class="sxs-lookup"><span data-stu-id="c80ca-258">The proxy can be configured to block unauthorized traffic flowing out, and filter potentially malicious inbound traffic.</span></span>

<span data-ttu-id="c80ca-259">![[3]][3]</span><span class="sxs-lookup"><span data-stu-id="c80ca-259">![[3]][3]</span></span>

<span data-ttu-id="c80ca-260">Per ottimizzare la sicurezza, non abilitare un indirizzo IP pubblico per le macchine virtuali e usare gruppi di sicurezza di rete per assicurarsi che tali macchine virtuali non siano accessibili pubblicamente.</span><span class="sxs-lookup"><span data-stu-id="c80ca-260">To maximize security, do not enable a public IP address for your VMs, and use NSGs to ensure that these VMs aren't publicly accessible.</span></span> <span data-ttu-id="c80ca-261">È consigliabile rendere disponibili le macchine virtuali solo tramite l'indirizzo IP interno. </span><span class="sxs-lookup"><span data-stu-id="c80ca-261">VMs should only be available using the internal IP address.</span></span> <span data-ttu-id="c80ca-262">Questi indirizzi possono essere resi accessibili tramite la rete di ExpressRoute, consentendo al personale DevOps locale di eseguire la configurazione o la manutenzione.</span><span class="sxs-lookup"><span data-stu-id="c80ca-262">These addresses can be made accessible through the ExpressRoute network, enabling on-premises DevOps staff to perform configuration or maintenance.</span></span>

<span data-ttu-id="c80ca-263">Se è necessario esporre gli endpoint di gestione per le macchine virtuali a una rete esterna, usare gruppi di sicurezza di rete o elenchi di controllo di accesso per limitare la visibilità di queste porte a un elenco di indirizzi IP o reti consentite.</span><span class="sxs-lookup"><span data-stu-id="c80ca-263">If you must expose management endpoints for VMs to an external network, use NSGs or access control lists to restrict the visibility of these ports to a whitelist of IP addresses or networks.</span></span>

> [!NOTE]
> <span data-ttu-id="c80ca-264">Per impostazione predefinita, le macchine virtuali di Azure distribuite tramite il portale di Azure includono un indirizzo IP pubblico che offre un account di accesso.</span><span class="sxs-lookup"><span data-stu-id="c80ca-264">By default, Azure VMs deployed through the Azure portal include a public IP address that provides login access.</span></span>  
> 
> 


## <a name="deploy-the-solution"></a><span data-ttu-id="c80ca-265">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="c80ca-265">Deploy the solution</span></span>

<span data-ttu-id="c80ca-266">**Prerequisiti.**</span><span class="sxs-lookup"><span data-stu-id="c80ca-266">**Prequisites.**</span></span> <span data-ttu-id="c80ca-267">È necessario disporre di un'infrastruttura locale esistente già configurata con un'appliance di rete adatta.</span><span class="sxs-lookup"><span data-stu-id="c80ca-267">You must have an existing on-premises infrastructure already configured with a suitable network appliance.</span></span>

<span data-ttu-id="c80ca-268">Per distribuire la soluzione, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="c80ca-268">To deploy the solution, perform the following steps.</span></span>

1. <span data-ttu-id="c80ca-269">Fare clic sul pulsante seguente:</span><span class="sxs-lookup"><span data-stu-id="c80ca-269">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fhybrid-networking%2Fexpressroute%2Fazuredeploy.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>
2. <span data-ttu-id="c80ca-270">Attendere che il collegamento si apra nel portale di Azure e quindi eseguire questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="c80ca-270">Wait for the link to open in the Azure portal, then follow these steps:</span></span>
   * <span data-ttu-id="c80ca-271">Poiché il nome del **gruppo di risorse** è già definito nel file dei parametri, selezionare **Crea nuovo** e immettere `ra-hybrid-er-rg` nella casella di testo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-271">The **Resource group** name is already defined in the parameter file, so select **Create New** and enter `ra-hybrid-er-rg` in the text box.</span></span>
   * <span data-ttu-id="c80ca-272">Selezionare l'area dalla casella di riepilogo a discesa **Località**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-272">Select the region from the **Location** drop down box.</span></span>
   * <span data-ttu-id="c80ca-273">Non modificare le caselle di testo **Template Root Uri** (URI radice modello) né **Parameter Root Uri** (URI radice parametro).</span><span class="sxs-lookup"><span data-stu-id="c80ca-273">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   * <span data-ttu-id="c80ca-274">Leggere i termini e le condizioni, quindi fare clic sulla casella di controllo **Accetto le condizioni riportate sopra**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-274">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   * <span data-ttu-id="c80ca-275">Fare clic sul pulsante **Acquista**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-275">Click the **Purchase** button.</span></span>
3. <span data-ttu-id="c80ca-276">Attendere il completamento della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="c80ca-276">Wait for the deployment to complete.</span></span>
4. <span data-ttu-id="c80ca-277">Fare clic sul pulsante seguente:</span><span class="sxs-lookup"><span data-stu-id="c80ca-277">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Freference-architectures%2Fmaster%2Fhybrid-networking%2Fexpressroute%2Fazuredeploy-expressRouteCircuit.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>
5. <span data-ttu-id="c80ca-278">Attendere che il collegamento si apra nel portale di Azure e quindi eseguire questi passaggi:</span><span class="sxs-lookup"><span data-stu-id="c80ca-278">Wait for the link to open in the Azure portal, then follow these steps:</span></span>
   * <span data-ttu-id="c80ca-279">Selezionare **Usa esistente** nella sezione **Gruppo di risorse** e immettere `ra-hybrid-er-rg` nella casella di testo.</span><span class="sxs-lookup"><span data-stu-id="c80ca-279">Select **Use existing** in the **Resource group** section and enter `ra-hybrid-er-rg` in the text box.</span></span>
   * <span data-ttu-id="c80ca-280">Selezionare l'area dalla casella di riepilogo a discesa **Località**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-280">Select the region from the **Location** drop down box.</span></span>
   * <span data-ttu-id="c80ca-281">Non modificare le caselle di testo **Template Root Uri** (URI radice modello) né **Parameter Root Uri** (URI radice parametro).</span><span class="sxs-lookup"><span data-stu-id="c80ca-281">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   * <span data-ttu-id="c80ca-282">Leggere i termini e le condizioni, quindi fare clic sulla casella di controllo **Accetto le condizioni riportate sopra**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-282">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   * <span data-ttu-id="c80ca-283">Fare clic sul pulsante **Acquista**.</span><span class="sxs-lookup"><span data-stu-id="c80ca-283">Click the **Purchase** button.</span></span>
6. <span data-ttu-id="c80ca-284">Attendere il completamento della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="c80ca-284">Wait for the deployment to complete.</span></span>


<!-- links -->
[forced-tuneling]: ../dmz/secure-vnet-hybrid.md
[highly-available-network-architecture]: ./expressroute-vpn-failover.md

[expressroute-technical-overview]: /azure/expressroute/expressroute-introduction
[expressroute-prereqs]: /azure/expressroute/expressroute-prerequisites
[configure-expressroute-routing]: /azure/expressroute/expressroute-howto-routing-arm
[sla-for-expressroute]: https://azure.microsoft.com/support/legal/sla/expressroute
[link-vnet-to-expressroute]: /azure/expressroute/expressroute-howto-linkvnet-arm
[ExpressRoute-provisioning]: /azure/expressroute/expressroute-workflows
[expressroute-introduction]: /azure/expressroute/expressroute-introduction
[expressroute-peering]: /azure/expressroute/expressroute-circuit-peerings
[expressroute-pricing]: https://azure.microsoft.com/pricing/details/expressroute/
[expressroute-limits]: /azure/azure-subscription-service-limits#networking-limits
[azurect]: https://github.com/Azure/NetworkMonitoring/tree/master/AzureCT
[visio-download]: https://archcenter.blob.core.windows.net/cdn/hybrid-network-architectures.vsdx
[er-circuit-parameters]: https://github.com/mspnp/reference-architectures/tree/master/hybrid-networking/expressroute/parameters/expressRouteCircuit.parameters.json
[azure-powershell-download]: https://azure.microsoft.com/documentation/articles/powershell-install-configure/
[azure-cli]: https://azure.microsoft.com/documentation/articles/xplat-cli-install/
[0]: ./images/expressroute.png "Architettura di rete ibrida tramite Azure ExpressRoute"
[1]: ../_images/guidance-hybrid-network-expressroute/figure2.png "Uso di router ridondanti con circuiti di ExpressRoute primari e secondari"
[2]: ../_images/guidance-hybrid-network-expressroute/figure3.png "Aggiunta di dispositivi di sicurezza alla rete locale"
[3]: ../_images/guidance-hybrid-network-expressroute/figure4.png "Uso del tunneling forzato per controllare il traffico associato a Internet"
[4]: ../_images/guidance-hybrid-network-expressroute/figure5.png "Individuazione della ServiceKey di un circuito ExpressRoute"  