---
title: Implementare un'architettura di rete ibrida sicura
titleSuffix: Azure Reference Architectures
description: Implementare un'architettura di rete ibrida sicura in Azure.
author: telmosampaio
ms.date: 10/22/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, networking
ms.openlocfilehash: 82327cca08e614bfe5226c9ca1a414388878a7c2
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 03/20/2019
ms.locfileid: "58243512"
---
# <a name="implement-a-dmz-between-azure-and-your-on-premises-datacenter"></a><span data-ttu-id="8f592-103">Implementare una rete perimetrale tra Azure e il data center locale</span><span class="sxs-lookup"><span data-stu-id="8f592-103">Implement a DMZ between Azure and your on-premises datacenter</span></span>

<span data-ttu-id="8f592-104">Questa architettura di riferimento consente di visualizzare una rete ibrida sicura che estende una rete locale in Azure.</span><span class="sxs-lookup"><span data-stu-id="8f592-104">This reference architecture shows a secure hybrid network that extends an on-premises network to Azure.</span></span> <span data-ttu-id="8f592-105">L'architettura implementa una *rete perimetrale* tra la rete locale e una rete virtuale di Azure (VNet).</span><span class="sxs-lookup"><span data-stu-id="8f592-105">The architecture implements a DMZ, also called a *perimeter network*, between the on-premises network and an Azure virtual network (VNet).</span></span> <span data-ttu-id="8f592-106">La rete perimetrale include appliance virtuali di rete (NVA) che implementano funzionalità di sicurezza quali firewall e ispezione dei pacchetti.</span><span class="sxs-lookup"><span data-stu-id="8f592-106">The DMZ includes network virtual appliances (NVAs) that implement security functionality such as firewalls and packet inspection.</span></span> <span data-ttu-id="8f592-107">Tutto il traffico in uscita dalla rete virtuale viene sottoposto a tunneling forzato verso Internet attraverso la rete locale, in modo da poter essere controllato.</span><span class="sxs-lookup"><span data-stu-id="8f592-107">All outgoing traffic from the VNet is force-tunneled to the Internet through the on-premises network, so that it can be audited.</span></span> <span data-ttu-id="8f592-108">[**Distribuire questa soluzione**](#deploy-the-solution).</span><span class="sxs-lookup"><span data-stu-id="8f592-108">[**Deploy this solution**](#deploy-the-solution).</span></span>

> [!NOTE]
> <span data-ttu-id="8f592-109">Questo scenario può essere eseguito anche usando [Firewall di Azure](/azure/firewall/), un servizio di sicurezza di rete basato sul cloud.</span><span class="sxs-lookup"><span data-stu-id="8f592-109">This scenario can also be accomplished using [Azure Firewall](/azure/firewall/), a cloud-based network security service.</span></span>

![Architettura di rete ibrida sicura](./images/dmz-private.png)

<span data-ttu-id="8f592-111">*Scaricare un [file Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="8f592-111">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="8f592-112">Questa architettura richiede una connessione al data center locale mediante un [gateway VPN][ra-vpn] o una connessione [ExpressRoute][ra-expressroute].</span><span class="sxs-lookup"><span data-stu-id="8f592-112">This architecture requires a connection to your on-premises datacenter, using either a [VPN gateway][ra-vpn] or an [ExpressRoute][ra-expressroute] connection.</span></span> <span data-ttu-id="8f592-113">Tra gli usi tipici di questa architettura sono inclusi:</span><span class="sxs-lookup"><span data-stu-id="8f592-113">Typical uses for this architecture include:</span></span>

- <span data-ttu-id="8f592-114">Applicazioni ibride in cui i carichi di lavoro vengono eseguiti in parte in locale e in parte in Azure.</span><span class="sxs-lookup"><span data-stu-id="8f592-114">Hybrid applications where workloads run partly on-premises and partly in Azure.</span></span>
- <span data-ttu-id="8f592-115">Infrastruttura che richiede un controllo granulare sul traffico in ingresso in una rete virtuale di Azure da un data center locale.</span><span class="sxs-lookup"><span data-stu-id="8f592-115">Infrastructure that requires granular control over traffic entering an Azure VNet from an on-premises datacenter.</span></span>
- <span data-ttu-id="8f592-116">Applicazioni che devono controllare il traffico in uscita.</span><span class="sxs-lookup"><span data-stu-id="8f592-116">Applications that must audit outgoing traffic.</span></span> <span data-ttu-id="8f592-117">Questo è spesso un requisito normativo di molti sistemi commerciali, usato per evitare la divulgazione di informazioni private.</span><span class="sxs-lookup"><span data-stu-id="8f592-117">This is often a regulatory requirement of many commercial systems and can help to prevent public disclosure of private information.</span></span>

## <a name="architecture"></a><span data-ttu-id="8f592-118">Architettura</span><span class="sxs-lookup"><span data-stu-id="8f592-118">Architecture</span></span>

<span data-ttu-id="8f592-119">L'architettura è costituita dai componenti seguenti.</span><span class="sxs-lookup"><span data-stu-id="8f592-119">The architecture consists of the following components.</span></span>

- <span data-ttu-id="8f592-120">**Rete locale**.</span><span class="sxs-lookup"><span data-stu-id="8f592-120">**On-premises network**.</span></span> <span data-ttu-id="8f592-121">Una rete LAN privata implementata all'interno di un'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="8f592-121">A private local-area network implemented in an organization.</span></span>
- <span data-ttu-id="8f592-122">**Rete virtuale di Azure (VNet)**.</span><span class="sxs-lookup"><span data-stu-id="8f592-122">**Azure virtual network (VNet)**.</span></span> <span data-ttu-id="8f592-123">La rete VNet ospita l'applicazione e altre risorse in esecuzione in Azure.</span><span class="sxs-lookup"><span data-stu-id="8f592-123">The VNet hosts the application and other resources running in Azure.</span></span>
- <span data-ttu-id="8f592-124">**Gateway**.</span><span class="sxs-lookup"><span data-stu-id="8f592-124">**Gateway**.</span></span> <span data-ttu-id="8f592-125">Il gateway offre la connettività tra i router nella rete locale e nella rete VNet.</span><span class="sxs-lookup"><span data-stu-id="8f592-125">The gateway provides connectivity between the routers in the on-premises network and the VNet.</span></span>
- <span data-ttu-id="8f592-126">**Appliance virtuale di rete (NVA)**.</span><span class="sxs-lookup"><span data-stu-id="8f592-126">**Network virtual appliance (NVA)**.</span></span> <span data-ttu-id="8f592-127">NVA è un termine generico che descrive una macchina virtuale che esegue attività quali consentire o negare l'accesso come firewall, ottimizzare le operazioni della rete WAN (compresa la compressione di rete), routing personalizzato o altre funzionalità di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-127">NVA is a generic term that describes a VM performing tasks such as allowing or denying access as a firewall, optimizing wide area network (WAN) operations (including network compression), custom routing, or other network functionality.</span></span>
- <span data-ttu-id="8f592-128">**Subnet di livello Web, business e dati**.</span><span class="sxs-lookup"><span data-stu-id="8f592-128">**Web tier, business tier, and data tier subnets**.</span></span> <span data-ttu-id="8f592-129">Subnet che ospitano le macchine virtuali e i servizi che implementano un'applicazione a 3 livelli di esempio in esecuzione nel cloud.</span><span class="sxs-lookup"><span data-stu-id="8f592-129">Subnets hosting the VMs and services that implement an example 3-tier application running in the cloud.</span></span> <span data-ttu-id="8f592-130">Per altre informazioni, vedere [Esecuzione di macchine virtuali Windows per un'architettura a più livelli in Azure][ra-n-tier].</span><span class="sxs-lookup"><span data-stu-id="8f592-130">See [Running Windows VMs for an N-tier architecture on Azure][ra-n-tier] for more information.</span></span>
- <span data-ttu-id="8f592-131">**Route definite dall'utente**.</span><span class="sxs-lookup"><span data-stu-id="8f592-131">**User defined routes (UDR)**.</span></span> <span data-ttu-id="8f592-132">Le [route definite dall'utente][udr-overview] vengono usate per definire il flusso del traffico IP nelle reti virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="8f592-132">[User defined routes][udr-overview] define the flow of IP traffic within Azure VNets.</span></span>

    > [!NOTE]
    > <span data-ttu-id="8f592-133">A seconda dei requisiti della connessione VPN, è possibile configurare le route del protocollo BGP (Border Gateway Protocol) anziché le UDR per implementare le regole di inoltro che indirizzano il traffico attraverso la rete locale.</span><span class="sxs-lookup"><span data-stu-id="8f592-133">Depending on the requirements of your VPN connection, you can configure Border Gateway Protocol (BGP) routes instead of using UDRs to implement the forwarding rules that direct traffic back through the on-premises network.</span></span>
    >

- <span data-ttu-id="8f592-134">**Subnet di gestione**.</span><span class="sxs-lookup"><span data-stu-id="8f592-134">**Management subnet**.</span></span> <span data-ttu-id="8f592-135">Questa subnet include macchine virtuali che implementano le funzionalità di gestione e monitoraggio per i componenti in esecuzione nella rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="8f592-135">This subnet contains VMs that implement management and monitoring capabilities for the components running in the VNet.</span></span>

## <a name="recommendations"></a><span data-ttu-id="8f592-136">Consigli</span><span class="sxs-lookup"><span data-stu-id="8f592-136">Recommendations</span></span>

<span data-ttu-id="8f592-137">Le raccomandazioni seguenti sono valide per la maggior parte degli scenari.</span><span class="sxs-lookup"><span data-stu-id="8f592-137">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="8f592-138">Seguire queste indicazioni, a meno che non si disponga di un requisito specifico che le escluda.</span><span class="sxs-lookup"><span data-stu-id="8f592-138">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="access-control-recommendations"></a><span data-ttu-id="8f592-139">Consigli per il controllo degli accessi</span><span class="sxs-lookup"><span data-stu-id="8f592-139">Access control recommendations</span></span>

<span data-ttu-id="8f592-140">Usare il [Controllo degli accessi in base al ruolo][rbac] per gestire le risorse dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8f592-140">Use [Role-Based Access Control][rbac] (RBAC) to manage the resources in your application.</span></span> <span data-ttu-id="8f592-141">È consigliabile creare i [ruoli personalizzati][rbac-custom-roles] seguenti:</span><span class="sxs-lookup"><span data-stu-id="8f592-141">Consider creating the following [custom roles][rbac-custom-roles]:</span></span>

- <span data-ttu-id="8f592-142">Un ruolo DevOps con le autorizzazioni per amministrare l'infrastruttura per l'applicazione, distribuire i componenti dell'applicazione e monitorare e riavviare le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="8f592-142">A DevOps role with permissions to administer the infrastructure for the application, deploy the application components, and monitor and restart VMs.</span></span>

- <span data-ttu-id="8f592-143">Un ruolo di amministratore IT centralizzato per gestire e monitorare le risorse di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-143">A centralized IT administrator role to manage and monitor network resources.</span></span>

- <span data-ttu-id="8f592-144">Un ruolo di amministratore IT della sicurezza per gestire le risorse di rete sicura, ad esempio le appliance NVA.</span><span class="sxs-lookup"><span data-stu-id="8f592-144">A security IT administrator role to manage secure network resources such as the NVAs.</span></span>

<span data-ttu-id="8f592-145">I ruoli DevOps e di amministratore IT non devono disporre di accesso alle risorse NVA.</span><span class="sxs-lookup"><span data-stu-id="8f592-145">The DevOps and IT administrator roles should not have access to the NVA resources.</span></span> <span data-ttu-id="8f592-146">Questa condizione deve essere limitata al ruolo di amministratore IT della sicurezza.</span><span class="sxs-lookup"><span data-stu-id="8f592-146">This should be restricted to the security IT administrator role.</span></span>

### <a name="resource-group-recommendations"></a><span data-ttu-id="8f592-147">Consigli per i gruppi di risorse</span><span class="sxs-lookup"><span data-stu-id="8f592-147">Resource group recommendations</span></span>

<span data-ttu-id="8f592-148">Le risorse di Azure, ad esempio le macchine virtuali e i servizi di bilanciamento del carico, vengono gestite facilmente tramite il raggruppamento in gruppi di risorse.</span><span class="sxs-lookup"><span data-stu-id="8f592-148">Azure resources such as VMs, VNets, and load balancers can be easily managed by grouping them together into resource groups.</span></span> <span data-ttu-id="8f592-149">Assegnare ruoli RBAC a ogni gruppo di risorse per limitare l'accesso.</span><span class="sxs-lookup"><span data-stu-id="8f592-149">Assign RBAC roles to each resource group to restrict access.</span></span>

<span data-ttu-id="8f592-150">Si consiglia di creare i gruppi di risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="8f592-150">We recommend creating the following resource groups:</span></span>

- <span data-ttu-id="8f592-151">Un gruppo di risorse contenente la rete virtuale (escluse le macchine virtuali), gruppi di sicurezza di rete e risorse gateway per la connessione alla rete locale.</span><span class="sxs-lookup"><span data-stu-id="8f592-151">A resource group containing the VNet (excluding the VMs), NSGs, and the gateway resources for connecting to the on-premises network.</span></span> <span data-ttu-id="8f592-152">Assegnare il ruolo di amministratore IT centralizzato al gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="8f592-152">Assign the centralized IT administrator role to this resource group.</span></span>
- <span data-ttu-id="8f592-153">Un gruppo di risorse contenente le macchine virtuali per le appliance virtuali di rete (incluso il bilanciamento del carico), il jumpbox e altre macchine virtuali di gestione, nonché la UDR per la subnet del gateway che forza tutto il traffico attraverso le appliance virtuali di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-153">A resource group containing the VMs for the NVAs (including the load balancer), the jumpbox and other management VMs, and the UDR for the gateway subnet that forces all traffic through the NVAs.</span></span> <span data-ttu-id="8f592-154">Assegnare il ruolo di amministratore IT della sicurezza al gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="8f592-154">Assign the security IT administrator role to this resource group.</span></span>
- <span data-ttu-id="8f592-155">Gruppi di risorse separati per ogni livello di applicazione che contengono il bilanciamento del carico e le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="8f592-155">Separate resource groups for each application tier that contain the load balancer and VMs.</span></span> <span data-ttu-id="8f592-156">Si noti che questo gruppo di risorse non deve includere le subnet per ogni livello.</span><span class="sxs-lookup"><span data-stu-id="8f592-156">Note that this resource group shouldn't include the subnets for each tier.</span></span> <span data-ttu-id="8f592-157">Assegnare il ruolo DevOps al gruppo di risorse.</span><span class="sxs-lookup"><span data-stu-id="8f592-157">Assign the DevOps role to this resource group.</span></span>

### <a name="virtual-network-gateway-recommendations"></a><span data-ttu-id="8f592-158">Raccomandazioni per il gateway della rete virtuale</span><span class="sxs-lookup"><span data-stu-id="8f592-158">Virtual network gateway recommendations</span></span>

<span data-ttu-id="8f592-159">Il traffico locale passa alla rete virtuale tramite un gateway della rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="8f592-159">On-premises traffic passes to the VNet through a virtual network gateway.</span></span> <span data-ttu-id="8f592-160">È consigliabile usare un [gateway VPN di Azure][guidance-vpn-gateway] o un [gateway Azure ExpressRoute][guidance-expressroute].</span><span class="sxs-lookup"><span data-stu-id="8f592-160">We recommend an [Azure VPN gateway][guidance-vpn-gateway] or an [Azure ExpressRoute gateway][guidance-expressroute].</span></span>

### <a name="nva-recommendations"></a><span data-ttu-id="8f592-161">Raccomandazioni per le appliance virtuali di rete</span><span class="sxs-lookup"><span data-stu-id="8f592-161">NVA recommendations</span></span>

<span data-ttu-id="8f592-162">Le appliance virtuali di rete forniscono servizi differenti per la gestione e il monitoraggio del traffico di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-162">NVAs provide different services for managing and monitoring network traffic.</span></span> <span data-ttu-id="8f592-163">L'[Azure Marketplace][azure-marketplace-nva] offre appliance virtuali di rete di diversi fornitori di terze parti che è possibile usare.</span><span class="sxs-lookup"><span data-stu-id="8f592-163">The [Azure Marketplace][azure-marketplace-nva] offers several third-party vendor NVAs that you can use.</span></span> <span data-ttu-id="8f592-164">Se nessuno di questa appliance di terze parti soddisfa i propri requisiti, è possibile creare un'appliance virtuale di rete personalizzata usando le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="8f592-164">If none of these third-party NVAs meet your requirements, you can create a custom NVA using VMs.</span></span>

<span data-ttu-id="8f592-165">La distribuzione della soluzione per questa architettura di riferimento implementa, ad esempio, un'appliance di rete virtuale con le funzionalità seguenti in una macchina virtuale:</span><span class="sxs-lookup"><span data-stu-id="8f592-165">For example, the solution deployment for this reference architecture implements an NVA with the following functionality on a VM:</span></span>

- <span data-ttu-id="8f592-166">Il traffico viene instradato tramite [inoltro IP][ip-forwarding] sulle interfacce di rete (NIC) dell'appliance virtuale di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-166">Traffic is routed using [IP forwarding][ip-forwarding] on the NVA network interfaces (NICs).</span></span>
- <span data-ttu-id="8f592-167">Il passaggio del traffico attraverso l'appliance virtuale di rete è consentito solo se opportuno.</span><span class="sxs-lookup"><span data-stu-id="8f592-167">Traffic is permitted to pass through the NVA only if it is appropriate to do so.</span></span> <span data-ttu-id="8f592-168">Ogni macchina virtuale per l'appliance virtuale di rete nell'architettura di riferimento è un router Linux semplice.</span><span class="sxs-lookup"><span data-stu-id="8f592-168">Each NVA VM in the reference architecture is a simple Linux router.</span></span> <span data-ttu-id="8f592-169">Il traffico in ingresso arriva sull'interfaccia di rete *eth0* e il traffico in uscita corrisponde a regole definite da script personalizzati inviati tramite l'interfaccia di rete *eth1*.</span><span class="sxs-lookup"><span data-stu-id="8f592-169">Inbound traffic arrives on network interface *eth0*, and outbound traffic matches rules defined by custom scripts dispatched through network interface *eth1*.</span></span>
- <span data-ttu-id="8f592-170">Le appliance virtuali di rete possono essere configurate solo dalla subnet di gestione.</span><span class="sxs-lookup"><span data-stu-id="8f592-170">The NVAs can only be configured from the management subnet.</span></span>
- <span data-ttu-id="8f592-171">Il traffico indirizzato alla subnet di gestione non passa attraverso le appliance virtuali di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-171">Traffic routed to the management subnet does not pass through the NVAs.</span></span> <span data-ttu-id="8f592-172">In caso contrario, se le appliance hanno esito negativo, non sarà disponibile alcuna route alla subnet di gestione per correggerle.</span><span class="sxs-lookup"><span data-stu-id="8f592-172">Otherwise, if the NVAs fail, there would be no route to the management subnet to fix them.</span></span>
- <span data-ttu-id="8f592-173">Le macchine virtuali per l'appliance virtuale di rete vengono inserite in un [set di disponibilità][availability-set] dietro un bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="8f592-173">The VMs for the NVA are placed in an [availability set][availability-set] behind a load balancer.</span></span> <span data-ttu-id="8f592-174">La UDR nella subnet del gateway indirizza le richieste delle appliance di rete virtuale al bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="8f592-174">The UDR in the gateway subnet directs NVA requests to the load balancer.</span></span>

<span data-ttu-id="8f592-175">Includere un'appliance di rete virtuale di livello 7 per terminare le connessioni dell'applicazione al livello dell'appliance e mantenere l'affinità con i livelli back-end.</span><span class="sxs-lookup"><span data-stu-id="8f592-175">Include a layer-7 NVA to terminate application connections at the NVA level and maintain affinity with the backend tiers.</span></span> <span data-ttu-id="8f592-176">In questo modo si garantisce la connettività simmetrica in cui il traffico di risposta proveniente dai livelli back-end viene restituito tramite l'appliance di rete virtuale.</span><span class="sxs-lookup"><span data-stu-id="8f592-176">This guarantees symmetric connectivity, in which response traffic from the backend tiers returns through the NVA.</span></span>

<span data-ttu-id="8f592-177">Un'altra opzione possibile è la connessione di più appliance virtuali di rete in serie, in cui ogni appliance esegue un'attività di sicurezza specifica.</span><span class="sxs-lookup"><span data-stu-id="8f592-177">Another option to consider is connecting multiple NVAs in series, with each NVA performing a specialized security task.</span></span> <span data-ttu-id="8f592-178">Questo consente di gestire ogni funzione di sicurezza in base alla singola appliance virtuale di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-178">This allows each security function to be managed on a per-NVA basis.</span></span> <span data-ttu-id="8f592-179">È ad esempio possibile disporre in serie un'appliance virtuale di rete che implementa un firewall con un'appliance virtuale di rete che esegue servizi di identità.</span><span class="sxs-lookup"><span data-stu-id="8f592-179">For example, an NVA implementing a firewall could be placed in series with an NVA running identity services.</span></span> <span data-ttu-id="8f592-180">Per semplificare la gestione è tuttavia necessario aggiungere ulteriori hop di rete che potrebbero aumentare la latenza. È pertanto consigliabile verificare che questa operazione non influisca sulle prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8f592-180">The tradeoff for ease of management is the addition of extra network hops that may increase latency, so ensure that this doesn't affect your application's performance.</span></span>

### <a name="nsg-recommendations"></a><span data-ttu-id="8f592-181">Consigli per i gruppi di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="8f592-181">NSG recommendations</span></span>

<span data-ttu-id="8f592-182">Il gateway VPN espone un indirizzo IP pubblico per la connessione alla rete locale.</span><span class="sxs-lookup"><span data-stu-id="8f592-182">The VPN gateway exposes a public IP address for the connection to the on-premises network.</span></span> <span data-ttu-id="8f592-183">È consigliabile creare un gruppo di sicurezza di rete per la subnet NVA in ingresso, con regole che blocchino tutto il traffico non proveniente dalla rete locale.</span><span class="sxs-lookup"><span data-stu-id="8f592-183">We recommend creating a network security group (NSG) for the inbound NVA subnet, with rules to block all traffic not originating from the on-premises network.</span></span>

<span data-ttu-id="8f592-184">I gruppi di sicurezza di rete sono anche consigliati per ogni subnet al fine di offrire un secondo livello di protezione dal traffico in ingresso, ignorando un'appliance virtuale di rete non configurata correttamente o disabilitata.</span><span class="sxs-lookup"><span data-stu-id="8f592-184">We also recommend NSGs for each subnet to provide a second level of protection against inbound traffic bypassing an incorrectly configured or disabled NVA.</span></span> <span data-ttu-id="8f592-185">La subnet di livello Web nell'architettura di riferimento implementa, ad esempio, un gruppo di sicurezza di rete con una regola per ignorare tutte le richieste diverse da quelle ricevute dalla rete locale (192.168.0.0/16) o dalla rete virtuale e un'altra regola per ignorare tutte le richieste non eseguite sulla porta 80.</span><span class="sxs-lookup"><span data-stu-id="8f592-185">For example, the web tier subnet in the reference architecture implements an NSG with a rule to ignore all requests other than those received from the on-premises network (192.168.0.0/16) or the VNet, and another rule that ignores all requests not made on port 80.</span></span>

### <a name="internet-access-recommendations"></a><span data-ttu-id="8f592-186">Raccomandazioni per l'accesso a Internet</span><span class="sxs-lookup"><span data-stu-id="8f592-186">Internet access recommendations</span></span>

<span data-ttu-id="8f592-187">Eseguire il [tunneling forzato][azure-forced-tunneling] di tutto il traffico Internet in uscita tramite la rete locale usando il tunnel VPN da sito a sito ed effettuare l'instradamento alla rete Internet tramite il servizio NAT (Network Address Translation).</span><span class="sxs-lookup"><span data-stu-id="8f592-187">[Force-tunnel][azure-forced-tunneling] all outbound Internet traffic through your on-premises network using the site-to-site VPN tunnel, and route to the Internet using network address translation (NAT).</span></span> <span data-ttu-id="8f592-188">Questo impedisce la diffusione accidentale di informazioni riservate archiviate nel livello dati e consente l'ispezione e il controllo di tutto il traffico in uscita.</span><span class="sxs-lookup"><span data-stu-id="8f592-188">This prevents accidental leakage of any confidential information stored in your data tier and allows inspection and auditing of all outgoing traffic.</span></span>

> [!NOTE]
> <span data-ttu-id="8f592-189">Non bloccare completamente il traffico Internet proveniente dai livelli dell'applicazione, poiché ciò impedirà l'uso su questi livelli dei servizi PaaS di Azure che si basano su indirizzi IP pubblici, ad esempio la registrazione diagnostica della macchina virtuale, il download delle estensioni della macchina virtuale e altre funzionalità.</span><span class="sxs-lookup"><span data-stu-id="8f592-189">Don't completely block Internet traffic from the application tiers, as this will prevent these tiers from using Azure PaaS services that rely on public IP addresses, such as VM diagnostics logging, downloading of VM extensions, and other functionality.</span></span> <span data-ttu-id="8f592-190">La diagnostica di Azure richiede anche che i componenti siano in grado di leggere e scrivere in un account di archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="8f592-190">Azure diagnostics also requires that components can read and write to an Azure Storage account.</span></span>

<span data-ttu-id="8f592-191">Verificare la corretta esecuzione del tunneling forzato del traffico Internet in uscita.</span><span class="sxs-lookup"><span data-stu-id="8f592-191">Verify that outbound internet traffic is force-tunneled correctly.</span></span> <span data-ttu-id="8f592-192">Se si sta usando una connessione VPN con il [servizio di routing e di accesso remoto][routing-and-remote-access-service] su un server locale, usare uno strumento quale [WireShark][wireshark] o [Microsoft Message Analyzer](https://www.microsoft.com/download/details.aspx?id=44226).</span><span class="sxs-lookup"><span data-stu-id="8f592-192">If you're using a VPN connection with the [routing and remote access service][routing-and-remote-access-service] on an on-premises server, use a tool such as [WireShark][wireshark] or [Microsoft Message Analyzer](https://www.microsoft.com/download/details.aspx?id=44226).</span></span>

### <a name="management-subnet-recommendations"></a><span data-ttu-id="8f592-193">Raccomandazioni per la subnet di gestione</span><span class="sxs-lookup"><span data-stu-id="8f592-193">Management subnet recommendations</span></span>

<span data-ttu-id="8f592-194">La subnet di gestione contiene un jumpbox che esegue le funzionalità di gestione e monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="8f592-194">The management subnet contains a jumpbox that performs management and monitoring functionality.</span></span> <span data-ttu-id="8f592-195">Limitare l'esecuzione di tutte le attività di gestione della sicurezza al jumpbox.</span><span class="sxs-lookup"><span data-stu-id="8f592-195">Restrict execution of all secure management tasks to the jumpbox.</span></span>

<span data-ttu-id="8f592-196">Non creare un indirizzo IP pubblico per il jumpbox.</span><span class="sxs-lookup"><span data-stu-id="8f592-196">Do not create a public IP address for the jumpbox.</span></span> <span data-ttu-id="8f592-197">In alternativa, creare una route per l'accesso del jumpbox attraverso il gateway in ingresso.</span><span class="sxs-lookup"><span data-stu-id="8f592-197">Instead, create one route to access the jumpbox through the incoming gateway.</span></span> <span data-ttu-id="8f592-198">Creare regole del gruppo di sicurezza di rete in modo che la subnet di gestione risponda solo alle richieste provenienti dalla route consentita.</span><span class="sxs-lookup"><span data-stu-id="8f592-198">Create NSG rules so the management subnet only responds to requests from the allowed route.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="8f592-199">Considerazioni sulla scalabilità</span><span class="sxs-lookup"><span data-stu-id="8f592-199">Scalability considerations</span></span>

<span data-ttu-id="8f592-200">L'architettura di riferimento usa un servizio di bilanciamento del carico per indirizzare il traffico di rete locale a un pool di dispositivi NVA, che instradano il traffico.</span><span class="sxs-lookup"><span data-stu-id="8f592-200">The reference architecture uses a load balancer to direct on-premises network traffic to a pool of NVA devices, which route the traffic.</span></span> <span data-ttu-id="8f592-201">I dispositivi NVA vengono inseriti in un [set di disponibilità][availability-set].</span><span class="sxs-lookup"><span data-stu-id="8f592-201">The NVAs are placed in an [availability set][availability-set].</span></span> <span data-ttu-id="8f592-202">Questa progettazione consente di monitorare la velocità effettiva dei dispositivi NVA nel tempo e aggiungere dispositivi NVA in risposta agli aumenti di carico.</span><span class="sxs-lookup"><span data-stu-id="8f592-202">This design allows you to monitor the throughput of the NVAs over time and add NVA devices in response to increases in load.</span></span>

<span data-ttu-id="8f592-203">Il gateway VPN SKU standard supporta una velocità effettiva sostenibile fino a 100 Mbps.</span><span class="sxs-lookup"><span data-stu-id="8f592-203">The standard SKU VPN gateway supports sustained throughput of up to 100 Mbps.</span></span> <span data-ttu-id="8f592-204">La SKU con prestazioni elevate fornisce fino a 200 Mbps.</span><span class="sxs-lookup"><span data-stu-id="8f592-204">The High Performance SKU provides up to 200 Mbps.</span></span> <span data-ttu-id="8f592-205">Per larghezze di banda superiori, è possibile eseguire l'aggiornamento a un gateway ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="8f592-205">For higher bandwidths, consider upgrading to an ExpressRoute gateway.</span></span> <span data-ttu-id="8f592-206">ExpressRoute offre larghezze di banda fino a 10 Gbps con una latenza inferiore rispetto a una connessione VPN.</span><span class="sxs-lookup"><span data-stu-id="8f592-206">ExpressRoute provides up to 10 Gbps bandwidth with lower latency than a VPN connection.</span></span>

<span data-ttu-id="8f592-207">Per ulteriori informazioni sulla scalabilità dei gateway di Azure, vedere la sezione relativa alle considerazioni sulla scalabilità negli articoli [Implementazione di un'architettura di rete ibrida con Azure e una VPN locale] [ guidance-vpn-gateway-scalability] e [Implementazione di un'architettura di rete ibrida con Azure ExpressRoute][guidance-expressroute-scalability].</span><span class="sxs-lookup"><span data-stu-id="8f592-207">For more information about the scalability of Azure gateways, see the scalability consideration section in [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-scalability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-scalability].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="8f592-208">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="8f592-208">Availability considerations</span></span>

<span data-ttu-id="8f592-209">Come accennato, l'architettura di riferimento usa un pool di dispositivi NVA dietro un servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="8f592-209">As mentioned, the reference architecture uses a pool of NVA devices behind a load balancer.</span></span> <span data-ttu-id="8f592-210">Il bilanciamento del carico usa un probe di integrità per monitorare ogni NVA e rimuovere dal pool gli eventuali dispositivi NVA che non rispondono.</span><span class="sxs-lookup"><span data-stu-id="8f592-210">The load balancer uses a health probe to monitor each NVA and will remove any unresponsive NVAs from the pool.</span></span>

<span data-ttu-id="8f592-211">Se si usa Azure ExpressRoute per consentire la connettività tra la rete virtuale e la rete locale, [configurare un gateway VPN per eseguire il failover][ra-vpn-failover] quando la connessione ExpressRoute diventa non disponibile.</span><span class="sxs-lookup"><span data-stu-id="8f592-211">If you're using Azure ExpressRoute to provide connectivity between the VNet and on-premises network, [configure a VPN gateway to provide failover][ra-vpn-failover] if the ExpressRoute connection becomes unavailable.</span></span>

<span data-ttu-id="8f592-212">Per informazioni specifiche su come garantire la disponibilità per le connessioni VPN ed ExpressRoute, vedere le considerazioni sulla disponibilità negli articoli [Implementazione di un'architettura di rete ibrida con Azure e una VPN locale] [ guidance-vpn-gateway-availability] e [Implementazione di un'architettura di rete ibrida con Azure ExpressRoute][guidance-expressroute-availability].</span><span class="sxs-lookup"><span data-stu-id="8f592-212">For specific information on maintaining availability for VPN and ExpressRoute connections, see the availability considerations in [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-availability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-availability].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="8f592-213">Considerazioni sulla gestibilità</span><span class="sxs-lookup"><span data-stu-id="8f592-213">Manageability considerations</span></span>

<span data-ttu-id="8f592-214">Tutte le attività di monitoraggio delle applicazioni e delle risorse dovrebbero essere eseguite dal jumpbox nella subnet di gestione.</span><span class="sxs-lookup"><span data-stu-id="8f592-214">All application and resource monitoring should be performed by the jumpbox in the management subnet.</span></span> <span data-ttu-id="8f592-215">A seconda dei requisiti dell'applicazione, potrebbe essere necessario aggiungere ulteriori risorse di monitoraggio nella subnet di gestione.</span><span class="sxs-lookup"><span data-stu-id="8f592-215">Depending on your application requirements, you may need additional monitoring resources in the management subnet.</span></span> <span data-ttu-id="8f592-216">In questo caso, sarà necessario accedere a queste risorse tramite il jumpbox.</span><span class="sxs-lookup"><span data-stu-id="8f592-216">If so, these resources should be accessed through the jumpbox.</span></span>

<span data-ttu-id="8f592-217">Se la connettività gateway dalla rete locale ad Azure non è attiva, è comunque possibile raggiungere il jumpbox distribuendo un indirizzo IP pubblico, aggiungendolo al jumpbox e comunicando in remoto tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="8f592-217">If gateway connectivity from your on-premises network to Azure is down, you can still reach the jumpbox by deploying a public IP address, adding it to the jumpbox, and remoting in from the internet.</span></span>

<span data-ttu-id="8f592-218">La subnet di ogni livello nell'architettura di riferimento è protetta dalle regole del gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-218">Each tier's subnet in the reference architecture is protected by NSG rules.</span></span> <span data-ttu-id="8f592-219">Potrebbe essere necessario creare una regola per aprire la porta 3389 per l'accesso RDP (Remote Desktop Protocol) sulle macchine virtuali di Windows o la porta 22 per l'accesso SSH (Secure Shell) sulle macchine virtuali Linux.</span><span class="sxs-lookup"><span data-stu-id="8f592-219">You may need to create a rule to open port 3389 for remote desktop protocol (RDP) access on Windows VMs or port 22 for secure shell (SSH) access on Linux VMs.</span></span> <span data-ttu-id="8f592-220">Altri strumenti di gestione e monitoraggio potrebbero richiedere regole per l'apertura di porte aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="8f592-220">Other management and monitoring tools may require rules to open additional ports.</span></span>

<span data-ttu-id="8f592-221">Se si usa ExpressRoute per consentire la connettività tra il data center locale e Azure, usare l'[Azure Connectivity Toolkit (AzureCT)][azurect] per monitorare e risolvere i problemi di connessione.</span><span class="sxs-lookup"><span data-stu-id="8f592-221">If you're using ExpressRoute to provide the connectivity between your on-premises datacenter and Azure, use the [Azure Connectivity Toolkit (AzureCT)][azurect] to monitor and troubleshoot connection issues.</span></span>

<span data-ttu-id="8f592-222">Per ulteriori informazioni specifiche sul monitoraggio e la gestione delle connessioni VPN ed ExpressRoute, vedere gli articoli [Implementazione di un'architettura di rete ibrida con Azure e una VPN locale][guidance-vpn-gateway-manageability] e [Implementazione di un'architettura di rete ibrida con Azure ExpressRoute][guidance-expressroute-manageability].</span><span class="sxs-lookup"><span data-stu-id="8f592-222">You can find additional information specifically aimed at monitoring and managing VPN and ExpressRoute connections in the articles [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-manageability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-manageability].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="8f592-223">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="8f592-223">Security considerations</span></span>

<span data-ttu-id="8f592-224">Questa architettura di riferimento implementa più livelli di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="8f592-224">This reference architecture implements multiple levels of security.</span></span>

### <a name="routing-all-on-premises-user-requests-through-the-nva"></a><span data-ttu-id="8f592-225">Routing di tutte le richieste utente locali tramite il dispositivo NVA</span><span class="sxs-lookup"><span data-stu-id="8f592-225">Routing all on-premises user requests through the NVA</span></span>

<span data-ttu-id="8f592-226">L'UDR nella subnet del gateway blocca tutte le richieste utente diverse da quelle ricevute dalla rete locale.</span><span class="sxs-lookup"><span data-stu-id="8f592-226">The UDR in the gateway subnet blocks all user requests other than those received from on-premises.</span></span> <span data-ttu-id="8f592-227">L'UDR passa le richieste consentite ai dispositivi NVA nella subnet della rete perimetrale privata. Le richieste vengono quindi trasmesse all'applicazione se consentite dalle regole NVA.</span><span class="sxs-lookup"><span data-stu-id="8f592-227">The UDR passes allowed requests to the NVAs in the private DMZ subnet, and these requests are passed on to the application if they are allowed by the NVA rules.</span></span> <span data-ttu-id="8f592-228">È possibile aggiungere altre route per l'UDR, ma è necessario assicurarsi che non ignorino inavvertitamente i dispositivi NVA, né blocchino il traffico amministrativo destinato alla subnet di gestione.</span><span class="sxs-lookup"><span data-stu-id="8f592-228">You can add other routes to the UDR, but make sure they don't inadvertently bypass the NVAs or block administrative traffic intended for the management subnet.</span></span>

<span data-ttu-id="8f592-229">Il bilanciamento del carico davanti ai dispositivi NVA funge anche da strumento di sicurezza in quanto consente di ignorare il traffico sulle porte che non sono aperte in base alle regole di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="8f592-229">The load balancer in front of the NVAs also acts as a security device by ignoring traffic on ports that are not open in the load balancing rules.</span></span> <span data-ttu-id="8f592-230">I servizi di bilanciamento del carico nell'architettura di riferimento restano in ascolto solo delle richieste HTTP sulla porta 80 e delle richieste HTTPS sulla porta 443.</span><span class="sxs-lookup"><span data-stu-id="8f592-230">The load balancers in the reference architecture only listen for HTTP requests on port 80 and HTTPS requests on port 443.</span></span> <span data-ttu-id="8f592-231">Documentare tutte le regole supplementari aggiunte ai servizi di bilanciamento del carico e monitorare il traffico per assicurarsi che non vi siano problemi di protezione.</span><span class="sxs-lookup"><span data-stu-id="8f592-231">Document any additional rules that you add to the load balancers, and monitor traffic to ensure there are no security issues.</span></span>

### <a name="using-nsgs-to-blockpass-traffic-between-application-tiers"></a><span data-ttu-id="8f592-232">Uso dei gruppi di sicurezza di rete per bloccare/consentire il traffico tra i livelli di applicazione</span><span class="sxs-lookup"><span data-stu-id="8f592-232">Using NSGs to block/pass traffic between application tiers</span></span>

<span data-ttu-id="8f592-233">Il traffico tra i livelli viene limitato tramite i gruppi di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="8f592-233">Traffic between tiers is restricted by using NSGs.</span></span> <span data-ttu-id="8f592-234">Il livello business blocca tutto il traffico non originato nel livello Web e il livello dati blocca tutto il traffico non originato nel livello business.</span><span class="sxs-lookup"><span data-stu-id="8f592-234">The business tier blocks all traffic that doesn't originate in the web tier, and the data tier blocks all traffic that doesn't originate in the business tier.</span></span> <span data-ttu-id="8f592-235">Se è necessario espandere le regole dei gruppi di sicurezza di rete per consentire un accesso più ampio a questi livelli, valutare questi requisiti rispetto ai rischi per la sicurezza.</span><span class="sxs-lookup"><span data-stu-id="8f592-235">If you have a requirement to expand the NSG rules to allow broader access to these tiers, weigh these requirements against the security risks.</span></span> <span data-ttu-id="8f592-236">Ogni nuovo percorso in ingresso espone al rischio di perdite di dati o danni alle applicazioni, sia di natura accidentale che intenzionale.</span><span class="sxs-lookup"><span data-stu-id="8f592-236">Each new inbound pathway represents an opportunity for accidental or purposeful data leakage or application damage.</span></span>

### <a name="devops-access"></a><span data-ttu-id="8f592-237">Accesso DevOps</span><span class="sxs-lookup"><span data-stu-id="8f592-237">DevOps access</span></span>

<span data-ttu-id="8f592-238">Utilizzare il [controllo degli accessi in base al ruolo][rbac] per limitare le operazioni che il team DevOps può eseguire in ogni livello.</span><span class="sxs-lookup"><span data-stu-id="8f592-238">Use [RBAC][rbac] to restrict the operations that DevOps can perform on each tier.</span></span> <span data-ttu-id="8f592-239">Quando si concedono le autorizzazioni, usare il [principio del privilegio minimo][security-principle-of-least-privilege].</span><span class="sxs-lookup"><span data-stu-id="8f592-239">When granting permissions, use the [principle of least privilege][security-principle-of-least-privilege].</span></span> <span data-ttu-id="8f592-240">Registrare tutte le operazioni amministrative ed eseguire controlli regolari per assicurare che eventuali modifiche alla configurazione siano state pianificate.</span><span class="sxs-lookup"><span data-stu-id="8f592-240">Log all administrative operations and perform regular audits to ensure any configuration changes were planned.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="8f592-241">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="8f592-241">Deploy the solution</span></span>

<span data-ttu-id="8f592-242">È disponibile una distribuzione per un'architettura di riferimento che implementa queste raccomandazioni su [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="8f592-242">A deployment for a reference architecture that implements these recommendations is available on [GitHub][github-folder].</span></span>

### <a name="prerequisites"></a><span data-ttu-id="8f592-243">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="8f592-243">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-resources"></a><span data-ttu-id="8f592-244">Distribuire le risorse</span><span class="sxs-lookup"><span data-stu-id="8f592-244">Deploy resources</span></span>

1. <span data-ttu-id="8f592-245">Passare alla cartella `/dmz/secure-vnet-hybrid` del repository GitHub di architetture di riferimento.</span><span class="sxs-lookup"><span data-stu-id="8f592-245">Navigate to the `/dmz/secure-vnet-hybrid` folder of the reference architectures GitHub repository.</span></span>

2. <span data-ttu-id="8f592-246">Eseguire il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="8f592-246">Run the following command:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <region> -p onprem.json --deploy
    ```

3. <span data-ttu-id="8f592-247">Eseguire il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="8f592-247">Run the following command:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <region> -p secure-vnet-hybrid.json --deploy
    ```

### <a name="connect-the-on-premises-and-azure-gateways"></a><span data-ttu-id="8f592-248">Connettere i gateway locali e di Azure</span><span class="sxs-lookup"><span data-stu-id="8f592-248">Connect the on-premises and Azure gateways</span></span>

<span data-ttu-id="8f592-249">In questo passaggio verranno connessi i due gateway di rete locali.</span><span class="sxs-lookup"><span data-stu-id="8f592-249">In this step, you will connect the two local network gateways.</span></span>

1. <span data-ttu-id="8f592-250">Nel portale di Azure passare al gruppo di risorse creato.</span><span class="sxs-lookup"><span data-stu-id="8f592-250">In the Azure Portal, navigate to the resource group that you created.</span></span>

2. <span data-ttu-id="8f592-251">Trovare la risorsa denominata `ra-vpn-vgw-pip` e copiare l'indirizzo IP mostrato nel pannello **Panoramica**.</span><span class="sxs-lookup"><span data-stu-id="8f592-251">Find the resource named `ra-vpn-vgw-pip` and copy the IP address shown in the **Overview** blade.</span></span>

3. <span data-ttu-id="8f592-252">Trovare la risorsa denominata `onprem-vpn-lgw`.</span><span class="sxs-lookup"><span data-stu-id="8f592-252">Find the resource named `onprem-vpn-lgw`.</span></span>

4. <span data-ttu-id="8f592-253">Fare clic sul pannello **Configurazione**.</span><span class="sxs-lookup"><span data-stu-id="8f592-253">Click the **Configuration** blade.</span></span> <span data-ttu-id="8f592-254">In **Indirizzo IP** incollare l'indirizzo IP dal passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="8f592-254">Under **IP address**, paste in the IP address from step 2.</span></span>

    ![Screenshot del campo Indirizzo IP](./images/local-net-gw.png)

5. <span data-ttu-id="8f592-256">Fare clic su **Salva** e attendere il completamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="8f592-256">Click **Save** and wait for the operation to complete.</span></span> <span data-ttu-id="8f592-257">L'operazione potrebbe richiedere circa 5 minuti.</span><span class="sxs-lookup"><span data-stu-id="8f592-257">It can take about 5 minutes.</span></span>

6. <span data-ttu-id="8f592-258">Trovare la risorsa denominata `onprem-vpn-gateway1-pip`.</span><span class="sxs-lookup"><span data-stu-id="8f592-258">Find the resource named `onprem-vpn-gateway1-pip`.</span></span> <span data-ttu-id="8f592-259">Copiare l'indirizzo IP mostrato nel pannello **Panoramica**.</span><span class="sxs-lookup"><span data-stu-id="8f592-259">Copy the IP address shown in the **Overview** blade.</span></span>

7. <span data-ttu-id="8f592-260">Trovare la risorsa denominata `ra-vpn-lgw`.</span><span class="sxs-lookup"><span data-stu-id="8f592-260">Find the resource named `ra-vpn-lgw`.</span></span>

8. <span data-ttu-id="8f592-261">Fare clic sul pannello **Configurazione**.</span><span class="sxs-lookup"><span data-stu-id="8f592-261">Click the **Configuration** blade.</span></span> <span data-ttu-id="8f592-262">In **Indirizzo IP** incollare l'indirizzo IP dal passaggio 6.</span><span class="sxs-lookup"><span data-stu-id="8f592-262">Under **IP address**, paste in the IP address from step 6.</span></span>

9. <span data-ttu-id="8f592-263">Fare clic su **Salva** e attendere il completamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="8f592-263">Click **Save** and wait for the operation to complete.</span></span>

10. <span data-ttu-id="8f592-264">Per verificare la connessione, passare al pannello **Connessioni** per ogni gateway.</span><span class="sxs-lookup"><span data-stu-id="8f592-264">To verify the connection, go to the **Connections** blade for each gateway.</span></span> <span data-ttu-id="8f592-265">Lo stato dovrebbe essere **Connesso**.</span><span class="sxs-lookup"><span data-stu-id="8f592-265">The status should be **Connected**.</span></span>

### <a name="verify-that-network-traffic-reaches-the-web-tier"></a><span data-ttu-id="8f592-266">Verificare che il traffico di rete raggiunga il livello Web</span><span class="sxs-lookup"><span data-stu-id="8f592-266">Verify that network traffic reaches the web tier</span></span>

1. <span data-ttu-id="8f592-267">Nel portale di Azure passare al gruppo di risorse creato.</span><span class="sxs-lookup"><span data-stu-id="8f592-267">In the Azure Portal, navigate to the resource group that you created.</span></span>

2. <span data-ttu-id="8f592-268">Trovare la risorsa denominata `int-dmz-lb`, che corrisponde al servizio di bilanciamento del carico situato davanti alla rete perimetrale privata.</span><span class="sxs-lookup"><span data-stu-id="8f592-268">Find the resource named `int-dmz-lb`, which is the load balancer in front of the private DMZ.</span></span> <span data-ttu-id="8f592-269">Copiare l'indirizzo IP privato dal pannello **Panoramica**.</span><span class="sxs-lookup"><span data-stu-id="8f592-269">Copy the private IP address from the **Overview** blade.</span></span>

3. <span data-ttu-id="8f592-270">Trovare la macchina virtuale denominata `jb-vm1`.</span><span class="sxs-lookup"><span data-stu-id="8f592-270">Find the VM named `jb-vm1`.</span></span> <span data-ttu-id="8f592-271">Fare clic su **Connetti** e usare Desktop remoto per connettersi alla VM.</span><span class="sxs-lookup"><span data-stu-id="8f592-271">Click **Connect** and use Remote Desktop to connect to the VM.</span></span> <span data-ttu-id="8f592-272">Il nome utente e la password sono specificati nel file onprem.json.</span><span class="sxs-lookup"><span data-stu-id="8f592-272">The user name and password are specified in the onprem.json file.</span></span>

4. <span data-ttu-id="8f592-273">Dalla sessione di Desktop remoto aprire un Web browser e passare all'indirizzo IP specificato nel passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="8f592-273">From the Remote Desktop Session, open a web browser and navigate to the IP address from step 2.</span></span> <span data-ttu-id="8f592-274">Dovrebbe essere visualizzata la home page predefinita del server Apache2.</span><span class="sxs-lookup"><span data-stu-id="8f592-274">You should see the default Apache2 server home page.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8f592-275">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="8f592-275">Next steps</span></span>

- <span data-ttu-id="8f592-276">Informazioni su come implementare una [rete perimetrale tra Azure e Internet](./secure-vnet-dmz.md).</span><span class="sxs-lookup"><span data-stu-id="8f592-276">Learn how to implement a [DMZ between Azure and the Internet](./secure-vnet-dmz.md).</span></span>
- <span data-ttu-id="8f592-277">Informazioni su come implementare un'[architettura di rete ibrida a disponibilità elevata][ra-vpn-failover].</span><span class="sxs-lookup"><span data-stu-id="8f592-277">Learn how to implement a [highly available hybrid network architecture][ra-vpn-failover].</span></span>
- <span data-ttu-id="8f592-278">Per ulteriori informazioni sulla gestione della sicurezza di rete con Azure, vedere [Servizi cloud Microsoft e sicurezza di rete][cloud-services-network-security].</span><span class="sxs-lookup"><span data-stu-id="8f592-278">For more information about managing network security with Azure, see [Microsoft cloud services and network security][cloud-services-network-security].</span></span>
- <span data-ttu-id="8f592-279">Per informazioni dettagliate sulla protezione delle risorse in Azure, vedere [Introduzione alla sicurezza in Microsoft Azure][getting-started-with-azure-security].</span><span class="sxs-lookup"><span data-stu-id="8f592-279">For detailed information about protecting resources in Azure, see [Getting started with Microsoft Azure security][getting-started-with-azure-security].</span></span>
- <span data-ttu-id="8f592-280">Per ulteriori dettagli su come risolvere i problemi di sicurezza in una connessione al gateway di Azure, vedere gli articoli [Implementazione di un'architettura di rete ibrida con Azure e una VPN locale][guidance-vpn-gateway-security] e [Implementazione di un'architettura di rete ibrida con Azure ExpressRoute][guidance-expressroute-security].</span><span class="sxs-lookup"><span data-stu-id="8f592-280">For additional details on addressing security concerns across an Azure gateway connection, see [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-security] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-security].</span></span>
- [<span data-ttu-id="8f592-281">Risoluzione dei problemi delle appliance virtuali di rete in Azure</span><span class="sxs-lookup"><span data-stu-id="8f592-281">Troubleshoot network virtual appliance issues in Azure</span></span>](/azure/virtual-network/virtual-network-troubleshoot-nva)

<!-- links -->

[availability-set]: /azure/virtual-machines/virtual-machines-windows-create-availability-set
[azurect]: https://github.com/Azure/NetworkMonitoring/tree/master/AzureCT
[azure-forced-tunneling]: https://azure.microsoft.com/en-gb/documentation/articles/vpn-gateway-forced-tunneling-rm/
[azure-marketplace-nva]: https://azuremarketplace.microsoft.com/marketplace/apps/category/networking
[cloud-services-network-security]: /azure/best-practices-network-security
[getting-started-with-azure-security]: /azure/security/azure-security-getting-started
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/dmz/secure-vnet-hybrid
[guidance-expressroute]: ../hybrid-networking/expressroute.md
[guidance-expressroute-availability]: ../hybrid-networking/expressroute.md#availability-considerations
[guidance-expressroute-manageability]: ../hybrid-networking/expressroute.md#manageability-considerations
[guidance-expressroute-security]: ../hybrid-networking/expressroute.md#security-considerations
[guidance-expressroute-scalability]: ../hybrid-networking/expressroute.md#scalability-considerations
[guidance-vpn-gateway]: ../hybrid-networking/vpn.md
[guidance-vpn-gateway-availability]: ../hybrid-networking/vpn.md#availability-considerations
[guidance-vpn-gateway-manageability]: ../hybrid-networking/vpn.md#manageability-considerations
[guidance-vpn-gateway-scalability]: ../hybrid-networking/vpn.md#scalability-considerations
[guidance-vpn-gateway-security]: ../hybrid-networking/vpn.md#security-considerations
[ip-forwarding]: /azure/virtual-network/virtual-networks-udr-overview#ip-forwarding
[ra-expressroute]: ../hybrid-networking/expressroute.md
[ra-n-tier]: ../virtual-machines-windows/n-tier.md
[ra-vpn]: ../hybrid-networking/vpn.md
[ra-vpn-failover]: ../hybrid-networking/expressroute-vpn-failover.md
[rbac]: /azure/active-directory/role-based-access-control-configure
[rbac-custom-roles]: /azure/active-directory/role-based-access-control-custom-roles
[routing-and-remote-access-service]: https://technet.microsoft.com/library/dd469790(v=ws.11).aspx
[security-principle-of-least-privilege]: https://msdn.microsoft.com/library/hdb58b2f(v=vs.110).aspx#Anchor_1
[udr-overview]: /azure/virtual-network/virtual-networks-udr-overview
[visio-download]: https://archcenter.blob.core.windows.net/cdn/dmz-reference-architectures.vsdx
[wireshark]: https://www.wireshark.org/
