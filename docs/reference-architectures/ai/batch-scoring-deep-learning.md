---
title: Punteggio batch per i modelli di Deep Learning
titleSuffix: Azure Reference Architectures
description: Questa architettura di riferimento mostra come applicare la procedura di neural style transfer a un video tramite Azure Machine Learning.
author: jiata
ms.date: 10/02/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: 3fc0b85380b6b46f7a52382e0184490104ead5a3
ms.sourcegitcommit: eee3a35dd5a5a2f0dc117fa1c30f16d6db213ba2
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 02/06/2019
ms.locfileid: "55782048"
---
# <a name="batch-scoring-on-azure-for-deep-learning-models"></a><span data-ttu-id="a53d5-103">Punteggio batch in Azure per modelli di Deep Learning</span><span class="sxs-lookup"><span data-stu-id="a53d5-103">Batch scoring on Azure for deep learning models</span></span>

<span data-ttu-id="a53d5-104">Questa architettura di riferimento mostra come applicare la procedura di neural style transfer a un video tramite Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="a53d5-104">This reference architecture shows how to apply neural style transfer to a video, using Azure Machine Learning.</span></span> <span data-ttu-id="a53d5-105">Lo *style transfer* è una tecnica di Deep Learning che ridefinisce un'immagine esistente usando lo stile di un'altra immagine.</span><span class="sxs-lookup"><span data-stu-id="a53d5-105">*Style transfer* is a deep learning technique that composes an existing image in the style of another image.</span></span> <span data-ttu-id="a53d5-106">Questa architettura può essere generalizzata per qualsiasi scenario che usa l'assegnazione del punteggio batch con Deep Learning.</span><span class="sxs-lookup"><span data-stu-id="a53d5-106">This architecture can be generalized for any scenario that uses batch scoring with deep learning.</span></span> <span data-ttu-id="a53d5-107">[**Distribuire questa soluzione**](#deploy-the-solution).</span><span class="sxs-lookup"><span data-stu-id="a53d5-107">[**Deploy this solution**](#deploy-the-solution).</span></span>

![Diagramma dell'architettura per modelli di Deep Learning con Azure Machine Learning](./_images/aml-scoring-deep-learning.png)

<span data-ttu-id="a53d5-109">**Scenario**: Un'organizzazione di supporti dispone di un video di cui desidera modificare l'aspetto, rendendolo simile a un dipinto specifico.</span><span class="sxs-lookup"><span data-stu-id="a53d5-109">**Scenario**: A media organization has a video whose style they want to change to look like a specific painting.</span></span> <span data-ttu-id="a53d5-110">L'organizzazione vuole applicare questo stile a tutti i frame del video in modo tempestivo e automatico.</span><span class="sxs-lookup"><span data-stu-id="a53d5-110">The organization wants to be able to apply this style to all frames of the video in a timely manner and in an automated fashion.</span></span> <span data-ttu-id="a53d5-111">Per altre informazioni sugli algoritmi di neural style transfer, vedere il PDF [Image Style Transfer Using Convolutional Neural Networks][image-style-transfer] (Style transfer di immagini tramite reti neurali convoluzionali).</span><span class="sxs-lookup"><span data-stu-id="a53d5-111">For more background about neural style transfer algorithms, see [Image Style Transfer Using Convolutional Neural Networks][image-style-transfer] (PDF).</span></span>

| <span data-ttu-id="a53d5-112">Immagine stile:</span><span class="sxs-lookup"><span data-stu-id="a53d5-112">Style image:</span></span> | <span data-ttu-id="a53d5-113">Video di input/contenuto:</span><span class="sxs-lookup"><span data-stu-id="a53d5-113">Input/content video:</span></span> | <span data-ttu-id="a53d5-114">Video di output:</span><span class="sxs-lookup"><span data-stu-id="a53d5-114">Output video:</span></span> |
|--------|--------|---------|
| <img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/style_image.jpg" width="300"> | <span data-ttu-id="a53d5-115">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video.mp4 "Video di input") *fare clic per visualizzare il video*</span><span class="sxs-lookup"><span data-stu-id="a53d5-115">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video.mp4 "Input Video") *click to view video*</span></span> | <span data-ttu-id="a53d5-116">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video.mp4 "Video di output") *fare clic per visualizzare il video*</span><span class="sxs-lookup"><span data-stu-id="a53d5-116">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video.mp4 "Output Video") *click to view video*</span></span> |

<span data-ttu-id="a53d5-117">Questa architettura di riferimento è progettata per carichi di lavoro che vengono attivati dalla presenza di nuovi supporti in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="a53d5-117">This reference architecture is designed for workloads that are triggered by the presence of new media in Azure storage.</span></span>

<span data-ttu-id="a53d5-118">L'elaborazione prevede i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="a53d5-118">Processing involves the following steps:</span></span>

1. <span data-ttu-id="a53d5-119">Caricare un file video nello spazio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="a53d5-119">Upload a video file to storage.</span></span>
1. <span data-ttu-id="a53d5-120">Il file video attiva un'app per la logica per l'invio di una richiesta all'endpoint pubblicato della pipeline di Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="a53d5-120">The video file triggers a Logic App to send a request to the Azure Machine Learning pipeline published endpoint.</span></span>
1. <span data-ttu-id="a53d5-121">La pipeline elabora il video, applica lo style transfer con MPI e poi lo post-elabora.</span><span class="sxs-lookup"><span data-stu-id="a53d5-121">The pipeline processes the video, applies style transfer with MPI, and postprocesses the video.</span></span>
1. <span data-ttu-id="a53d5-122">Quando la pipeline viene completata, l'output viene salvato di nuovo nell'archiviazione BLOB.</span><span class="sxs-lookup"><span data-stu-id="a53d5-122">The output is saved back to blob storage once the pipeline is completed.</span></span>

## <a name="architecture"></a><span data-ttu-id="a53d5-123">Architettura</span><span class="sxs-lookup"><span data-stu-id="a53d5-123">Architecture</span></span>

<span data-ttu-id="a53d5-124">L'architettura è costituita dai componenti seguenti.</span><span class="sxs-lookup"><span data-stu-id="a53d5-124">This architecture consists of the following components.</span></span>

### <a name="compute"></a><span data-ttu-id="a53d5-125">Calcolo</span><span class="sxs-lookup"><span data-stu-id="a53d5-125">Compute</span></span>

<span data-ttu-id="a53d5-126">**[Servizio Azure Machine Learning][amls]**: usa le pipeline di Azure Machine Learning per creare sequenze di calcolo riproducibili e facilmente gestibili.</span><span class="sxs-lookup"><span data-stu-id="a53d5-126">**[Azure Machine Learning Service][amls]** uses Azure Machine Learning Pipelines to create reproducible and easy-to-manage sequences of computation.</span></span> <span data-ttu-id="a53d5-127">Offre anche una destinazione di calcolo gestita (in cui è possibile eseguire il calcolo della pipeline), l'[ambiente di calcolo di Machine Learning di Azure][aml-compute] per il training, la distribuzione e l'assegnazione di punteggi ai modelli di Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="a53d5-127">It also offers a managed compute target (on which a pipeline computation can run) called [Azure Machine Learning Compute][aml-compute] for training, deploying, and scoring machine learning models.</span></span> 

### <a name="storage"></a><span data-ttu-id="a53d5-128">Archiviazione</span><span class="sxs-lookup"><span data-stu-id="a53d5-128">Storage</span></span>

<span data-ttu-id="a53d5-129">**[Archiviazione BLOB][blob-storage]**: si usa per archiviare tutte le immagini (di input, di stile e di output).</span><span class="sxs-lookup"><span data-stu-id="a53d5-129">**[Blob storage][blob-storage]** is used to store all images (input images, style images, and output images).</span></span> <span data-ttu-id="a53d5-130">Il servizio Azure Machine Learning si integra con l'archiviazione BLOB, per cui gli utenti non devono spostare manualmente i dati tra le piattaforme di calcolo e l'archiviazione BLOB.</span><span class="sxs-lookup"><span data-stu-id="a53d5-130">Azure Machine Learning Service integrates with Blob storage so that users do not have to manually move data across compute platforms and Blob storage.</span></span> <span data-ttu-id="a53d5-131">Archiviazione BLOB è anche molto conveniente per le prestazioni richieste da questo carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="a53d5-131">Blob storage is also very cost-effective for the performance that this workload requires.</span></span>

### <a name="trigger--scheduling"></a><span data-ttu-id="a53d5-132">Trigger/pianificazione</span><span class="sxs-lookup"><span data-stu-id="a53d5-132">Trigger / scheduling</span></span>

<span data-ttu-id="a53d5-133">**[App per la logica di Azure][logic-apps]** viene usato per attivare il flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="a53d5-133">**[Azure Logic Apps][logic-apps]** is used to trigger the workflow.</span></span> <span data-ttu-id="a53d5-134">Quando l'app per la logica rileva che un BLOB è stato aggiunto al contenitore, attiva la pipeline di Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="a53d5-134">When the Logic App detects that a blob has been added to the container, it triggers the Azure Machine Learning Pipeline.</span></span> <span data-ttu-id="a53d5-135">App per la logica rappresenta una buona base per questa architettura di riferimento perché offre un modo semplice per rilevare le modifiche apportate ad Archiviazione BLOB e fornisce una procedura semplice per la modifica del trigger.</span><span class="sxs-lookup"><span data-stu-id="a53d5-135">Logic Apps is a good fit for this reference architecture because it's an easy way to detect changes to blob storage and provides an easy process for changing the trigger.</span></span>

### <a name="preprocessing-and-postprocessing-our-data"></a><span data-ttu-id="a53d5-136">Pre-elaborazione e post-elaborazione dei dati</span><span class="sxs-lookup"><span data-stu-id="a53d5-136">Preprocessing and postprocessing our data</span></span>

<span data-ttu-id="a53d5-137">Questa architettura di riferimento usa un filmato di repertorio di un orangutan in una struttura ad albero.</span><span class="sxs-lookup"><span data-stu-id="a53d5-137">This reference architecture uses video footage of an orangutan in a tree.</span></span> <span data-ttu-id="a53d5-138">Il filmato è disponibile per il download [qui][source-video].</span><span class="sxs-lookup"><span data-stu-id="a53d5-138">You can download the footage from [here][source-video].</span></span>

1. <span data-ttu-id="a53d5-139">Usare [FFmpeg][ffmpeg] per estrarre il file audio dal filmato video, in modo da riunirlo al video di output in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="a53d5-139">Use [FFmpeg][ffmpeg] to extract the audio file from the video footage, so that the audio file can be stitched back into the output video later.</span></span>
1. <span data-ttu-id="a53d5-140">Usare FFmpeg per suddividere il video in singoli fotogrammi,</span><span class="sxs-lookup"><span data-stu-id="a53d5-140">Use FFmpeg to break the video into individual frames.</span></span> <span data-ttu-id="a53d5-141">che verranno elaborati in modo indipendente, in parallelo.</span><span class="sxs-lookup"><span data-stu-id="a53d5-141">The frames will be processed independently, in parallel.</span></span>
1. <span data-ttu-id="a53d5-142">A questo punto è possibile applicare il neural style transfer a ogni singolo fotogramma in parallelo.</span><span class="sxs-lookup"><span data-stu-id="a53d5-142">At this point, we can apply neural style transfer to each individual frame in parallel.</span></span>
1. <span data-ttu-id="a53d5-143">Una volta elaborato ogni fotogramma, è necessario usare FFmpeg per riunirli di nuovo.</span><span class="sxs-lookup"><span data-stu-id="a53d5-143">One each frame has been processed, we need to use FFmpeg to restitch the frames back together.</span></span>
1. <span data-ttu-id="a53d5-144">Infine, il file audio verrà ricollegato al filmato riunito.</span><span class="sxs-lookup"><span data-stu-id="a53d5-144">Finally we reattach the audio file to the restitched footage.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="a53d5-145">Considerazioni sulle prestazioni</span><span class="sxs-lookup"><span data-stu-id="a53d5-145">Performance considerations</span></span>

### <a name="gpu-vs-cpu"></a><span data-ttu-id="a53d5-146">GPU e CPU a confronto</span><span class="sxs-lookup"><span data-stu-id="a53d5-146">GPU vs CPU</span></span>

<span data-ttu-id="a53d5-147">Per carichi di lavoro di Deep Learning, le GPU in genere garantiscono prestazioni nettamente superiori rispetto alle CPU, per cui di norma è necessario un cluster consistente di CPU per ottenere prestazioni analoghe.</span><span class="sxs-lookup"><span data-stu-id="a53d5-147">For deep learning workloads, GPUs will generally out-perform CPUs by a considerable amount, to the extent that a sizeable cluster of CPUs is usually needed to get comparable performance.</span></span> <span data-ttu-id="a53d5-148">Anche se in questa architettura è possibile usare soltanto CPU, le GPU offrono comunque un rapporto costi/prestazioni di gran lunga superiore.</span><span class="sxs-lookup"><span data-stu-id="a53d5-148">While it's an option to use only CPUs in this architecture, GPUs will provide a much better cost/performance profile.</span></span> <span data-ttu-id="a53d5-149">Si consiglia l'utilizzo della più recente combinazione macchina virtuale-dimensioni-gpu [serie NCv3] di macchine virtuali ottimizzate per la GPU.</span><span class="sxs-lookup"><span data-stu-id="a53d5-149">We recommend using the latest [NCv3 series]vm-sizes-gpu of GPU optimized VMs.</span></span>

<span data-ttu-id="a53d5-150">Le GPU non sono abilitate per impostazione predefinita in tutte le aree.</span><span class="sxs-lookup"><span data-stu-id="a53d5-150">GPUs are not enabled by default in all regions.</span></span> <span data-ttu-id="a53d5-151">Assicurarsi di selezionare un'area con GPU abilitate.</span><span class="sxs-lookup"><span data-stu-id="a53d5-151">Make sure to select a region with GPUs enabled.</span></span> <span data-ttu-id="a53d5-152">Le sottoscrizioni prevedono anche una quota predefinita di un numero di core pari a zero per macchine virtuali ottimizzate per la GPU.</span><span class="sxs-lookup"><span data-stu-id="a53d5-152">In addition, subscriptions have a default quota of zero cores for GPU-optimized VMs.</span></span> <span data-ttu-id="a53d5-153">È possibile aumentare questa quota inoltrando una richiesta di supporto.</span><span class="sxs-lookup"><span data-stu-id="a53d5-153">You can raise this quota by opening a support request.</span></span> <span data-ttu-id="a53d5-154">Assicurarsi che la sottoscrizione disponga di una quota sufficiente per eseguire il carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="a53d5-154">Make sure that your subscription has enough quota to run your workload.</span></span>

### <a name="parallelizing-across-vms-vs-cores"></a><span data-ttu-id="a53d5-155">Esecuzione in parallelo tra macchine virtuali e core a confronto</span><span class="sxs-lookup"><span data-stu-id="a53d5-155">Parallelizing across VMs vs cores</span></span>

<span data-ttu-id="a53d5-156">Quando si esegue un processo di style transfer come processo batch, i processi che vengono eseguiti principalmente nelle GPU dovranno essere eseguiti in parallelo tra le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="a53d5-156">When running a style transfer process as a batch job, the jobs that run primarily on GPUs will have to be parallelized across VMs.</span></span> <span data-ttu-id="a53d5-157">Sono possibili due approcci: è possibile creare un cluster di dimensioni maggiori tramite macchine virtuali con una GPU singola o creare un cluster più piccolo tramite macchine virtuali con più GPU.</span><span class="sxs-lookup"><span data-stu-id="a53d5-157">Two approaches are possible: You can create a larger cluster using VMs that have a single GPU, or create a smaller cluster using VMs with many GPUs.</span></span>

<span data-ttu-id="a53d5-158">Per questo carico di lavoro, queste due opzioni garantiranno prestazioni analoghe.</span><span class="sxs-lookup"><span data-stu-id="a53d5-158">For this workload, these two options will have comparable performance.</span></span> <span data-ttu-id="a53d5-159">L'utilizzo di un minor numero di macchine virtuali con più GPU per ognuna può contribuire a ridurre lo spostamento dati.</span><span class="sxs-lookup"><span data-stu-id="a53d5-159">Using fewer VMs with more GPUs per VM can help to reduce data movement.</span></span> <span data-ttu-id="a53d5-160">Tuttavia, il volume di dati per processo per questo carico di lavoro non è molto grande, per cui non si osserverà una limitazione eccessiva da parte dell'archiviazione BLOB.</span><span class="sxs-lookup"><span data-stu-id="a53d5-160">However, the data volume per job for this workload is not very big, so you won't observe much throttling by blob storage.</span></span>

### <a name="mpi-step"></a><span data-ttu-id="a53d5-161">Passaggio MPI</span><span class="sxs-lookup"><span data-stu-id="a53d5-161">MPI step</span></span> 

<span data-ttu-id="a53d5-162">Quando si crea la pipeline in Azure Machine Learning, uno dei passaggi usati per eseguire il calcolo parallelo è il passaggio MPI,</span><span class="sxs-lookup"><span data-stu-id="a53d5-162">When creating the pipeline in Azure Machine Learning, one of the steps used to perform parallel computation is the MPI step.</span></span> <span data-ttu-id="a53d5-163">che consente di dividere uniformemente i dati tra i nodi disponibili.</span><span class="sxs-lookup"><span data-stu-id="a53d5-163">The MPI step will help split the data evenly across the available nodes.</span></span> <span data-ttu-id="a53d5-164">Questo passaggio viene eseguito solo quando tutti i nodi richiesti sono pronti.</span><span class="sxs-lookup"><span data-stu-id="a53d5-164">The MPI step will not executed until all the requested nodes are ready.</span></span> <span data-ttu-id="a53d5-165">Se un nodo presenta un errore o viene annullato (nel caso di una macchina virtuale a bassa priorità), il passaggio MPI dovrà essere eseguito di nuovo.</span><span class="sxs-lookup"><span data-stu-id="a53d5-165">Should one node fail or get pre-empted (if it is a low-priority virtual machine), the MPI step will have to be re-run.</span></span> 

## <a name="security-considerations"></a><span data-ttu-id="a53d5-166">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="a53d5-166">Security considerations</span></span>

### <a name="restricting-access-to-azure-blob-storage"></a><span data-ttu-id="a53d5-167">Limitazione dell'accesso ad Archiviazione BLOB di Azure</span><span class="sxs-lookup"><span data-stu-id="a53d5-167">Restricting access to Azure blob storage</span></span>

<span data-ttu-id="a53d5-168">In questa architettura di riferimento, Archiviazione BLOB di Azure è il componente di archiviazione principale che deve essere protetto.</span><span class="sxs-lookup"><span data-stu-id="a53d5-168">In this reference architecture, Azure blob storage is the main storage component that needs to be protected.</span></span> <span data-ttu-id="a53d5-169">La distribuzione della baseline illustrata nel repository GitHub usa chiavi dell'account di archiviazione per accedere all'archiviazione BLOB.</span><span class="sxs-lookup"><span data-stu-id="a53d5-169">The baseline deployment shown in the GitHub repo uses storage account keys to access the blob storage.</span></span> <span data-ttu-id="a53d5-170">Per livelli maggiori di controllo e protezione, provare a usare una firma di accesso condiviso (SAS),</span><span class="sxs-lookup"><span data-stu-id="a53d5-170">For further control and protection, consider using a shared access signature (SAS) instead.</span></span> <span data-ttu-id="a53d5-171">che consente l'accesso limitato agli oggetti presenti nell'archiviazione, senza la necessità di codificare le chiavi dell'account o salvarle in testo non crittografato.</span><span class="sxs-lookup"><span data-stu-id="a53d5-171">This grants limited access to objects in storage, without needing to hard code the account keys or save them in plaintext.</span></span> <span data-ttu-id="a53d5-172">Questo approccio è particolarmente utile in quanto le chiavi dell'account sono visibili in testo non crittografato nell'interfaccia della finestra di progettazione di App per la logica.</span><span class="sxs-lookup"><span data-stu-id="a53d5-172">This approach is especially useful because account keys are visible in plaintext inside of Logic App's designer interface.</span></span> <span data-ttu-id="a53d5-173">L'uso di una firma di accesso condiviso consente anche di garantire che l'account di archiviazione disponga di una governance appropriata e che l'accesso sia concesso soltanto agli utenti desiderati.</span><span class="sxs-lookup"><span data-stu-id="a53d5-173">Using an SAS also helps to ensure that the storage account has proper governance, and that access is granted only to the people intended to have it.</span></span>

<span data-ttu-id="a53d5-174">Per gli scenari con più dati sensibili, assicurarsi che tutte le chiavi di archiviazione siano protette, poiché concedono un accesso completo a tutti i dati di input e output dal carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="a53d5-174">For scenarios with more sensitive data, make sure that all of your storage keys are protected, because these keys grant full access to all input and output data from the workload.</span></span>

### <a name="data-encryption-and-data-movement"></a><span data-ttu-id="a53d5-175">Crittografia e spostamento dei dati</span><span class="sxs-lookup"><span data-stu-id="a53d5-175">Data encryption and data movement</span></span>

<span data-ttu-id="a53d5-176">Questa architettura di riferimento usa lo style transfer come esempio di processo di punteggio batch.</span><span class="sxs-lookup"><span data-stu-id="a53d5-176">This reference architecture uses style transfer as an example of a batch scoring process.</span></span> <span data-ttu-id="a53d5-177">Per altri scenari basati su dati sensibili, i dati contenuti nella risorsa di archiviazione dovranno essere crittografati a riposo.</span><span class="sxs-lookup"><span data-stu-id="a53d5-177">For more data-sensitive scenarios, the data in storage should be encrypted at rest.</span></span> <span data-ttu-id="a53d5-178">Ogni volta che i dati vengono spostati da una posizione a quella successiva, usare SSL per proteggere il trasferimento dei dati.</span><span class="sxs-lookup"><span data-stu-id="a53d5-178">Each time data is moved from one location to the next, use SSL to secure the data transfer.</span></span> <span data-ttu-id="a53d5-179">Per altre informazioni, vedere la [Guida alla sicurezza di Archiviazione di Azure][storage-security].</span><span class="sxs-lookup"><span data-stu-id="a53d5-179">For more information, see [Azure Storage security guide][storage-security].</span></span>

### <a name="securing-your-computation-in-a-virtual-network"></a><span data-ttu-id="a53d5-180">Protezione del calcolo in una rete virtuale</span><span class="sxs-lookup"><span data-stu-id="a53d5-180">Securing your computation in a virtual network</span></span>

<span data-ttu-id="a53d5-181">Quando si distribuisce un cluster dell'ambiente di calcolo di Machine Learning, è possibile configurarlo in modo che ne venga eseguito il provisioning all'interno di una subnet di una [rete virtuale][virtual-network].</span><span class="sxs-lookup"><span data-stu-id="a53d5-181">When deploying your Machine Learning compute cluster, you can configure your cluster to be provisioned inside a subnet of a [virtual network][virtual-network].</span></span> <span data-ttu-id="a53d5-182">I nodi di calcolo nel cluster possono così comunicare in modo sicuro con altre macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="a53d5-182">This allows the compute nodes in the cluster to communicate securely with other virtual machines.</span></span> 

### <a name="protecting-against-malicious-activity"></a><span data-ttu-id="a53d5-183">Protezione da attività dannose</span><span class="sxs-lookup"><span data-stu-id="a53d5-183">Protecting against malicious activity</span></span>

<span data-ttu-id="a53d5-184">Negli scenari in cui sono presenti più utenti, assicurarsi che i dati sensibili siano protetti da attività dannose.</span><span class="sxs-lookup"><span data-stu-id="a53d5-184">In scenarios where there are multiple users, make sure that sensitive data is protected against malicious activity.</span></span> <span data-ttu-id="a53d5-185">Se l'accesso a questa distribuzione è concesso anche ad altri utenti per personalizzare i dati di input, prendere nota delle precauzioni e delle considerazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="a53d5-185">If other users are given access to this deployment to customize the input data, take note of the following precautions and considerations:</span></span>

- <span data-ttu-id="a53d5-186">Usare RBAC per limitare l'accesso degli utenti alle sole risorse di cui necessitano.</span><span class="sxs-lookup"><span data-stu-id="a53d5-186">Use RBAC to limit users' access to only the resources they need.</span></span>
- <span data-ttu-id="a53d5-187">Fornire due account di archiviazione separati.</span><span class="sxs-lookup"><span data-stu-id="a53d5-187">Provision two separate storage accounts.</span></span> <span data-ttu-id="a53d5-188">Archiviare i dati di input e output nel primo account.</span><span class="sxs-lookup"><span data-stu-id="a53d5-188">Store input and output data in the first account.</span></span> <span data-ttu-id="a53d5-189">Gli utenti esterni potranno avere accesso a questo account.</span><span class="sxs-lookup"><span data-stu-id="a53d5-189">External users can be given access to this account.</span></span> <span data-ttu-id="a53d5-190">Archiviare script eseguibili e file di log di output nell'altro account.</span><span class="sxs-lookup"><span data-stu-id="a53d5-190">Store executable scripts and output log files in the other account.</span></span> <span data-ttu-id="a53d5-191">Gli utenti esterni non dovranno avere accesso a questo account.</span><span class="sxs-lookup"><span data-stu-id="a53d5-191">External users should not have access to this account.</span></span> <span data-ttu-id="a53d5-192">In questo modo gli utenti esterni non potranno modificare alcun file eseguibile (per inserire codici dannosi), né avranno accesso ai file di log, che potrebbero contenere informazioni riservate.</span><span class="sxs-lookup"><span data-stu-id="a53d5-192">This will ensure that external users cannot modify any executable files (to inject malicious code), and don't have access to logfiles, which could hold sensitive information.</span></span>
- <span data-ttu-id="a53d5-193">Gli utenti malintenzionati possono perpetrare attacchi DDoS alla coda processi o inserire in essa messaggi non elaborabili in formato non valido, causando il blocco del sistema o errori di rimozione dalla coda.</span><span class="sxs-lookup"><span data-stu-id="a53d5-193">Malicious users can DDOS the job queue or inject malformed poison messages in the job queue, causing the system to lock up or causing dequeuing errors.</span></span>

## <a name="monitoring-and-logging"></a><span data-ttu-id="a53d5-194">Monitoraggio e registrazione</span><span class="sxs-lookup"><span data-stu-id="a53d5-194">Monitoring and logging</span></span>

### <a name="monitoring-batch-jobs"></a><span data-ttu-id="a53d5-195">Monitoraggio dei processi Batch</span><span class="sxs-lookup"><span data-stu-id="a53d5-195">Monitoring Batch jobs</span></span>

<span data-ttu-id="a53d5-196">Quando si esegue un processo, è importante monitorare lo stato di avanzamento e assicurarsi che tutto funzioni come previsto.</span><span class="sxs-lookup"><span data-stu-id="a53d5-196">While running your job, it's important to monitor the progress and make sure that things are working as expected.</span></span> <span data-ttu-id="a53d5-197">Tuttavia, il monitoraggio in un cluster di nodi attivi può rivelarsi un problema.</span><span class="sxs-lookup"><span data-stu-id="a53d5-197">However, it can be a challenge to monitor across a cluster of active nodes.</span></span>

<span data-ttu-id="a53d5-198">Per avere un'idea dello stato complessivo del cluster, passare al pannello Machine Learning del portale di Azure per controllare lo stato dei nodi del cluster.</span><span class="sxs-lookup"><span data-stu-id="a53d5-198">To get a sense of the overall state of the cluster, go to the Machine Learning blade of the Azure Portal to inspect the state of the nodes in the cluster.</span></span> <span data-ttu-id="a53d5-199">Se un nodo è inattivo oppure un processo ha avuto esito negativo, i log degli errori vengono salvati nell'archiviazione BLOB e sono accessibili anche dal portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="a53d5-199">If a node is inactive or a job has failed, the error logs are saved to blob storage, and are also accessible in the Azure Portal.</span></span>

<span data-ttu-id="a53d5-200">È possibile arricchire ulteriormente il monitoraggio connettendo i log ad Application Insights o eseguendo processi separati per il polling dello stato del cluster e dei relativi processi.</span><span class="sxs-lookup"><span data-stu-id="a53d5-200">Monitoring can be further enriched by connecting logs to Application Insights or by running separate processes to poll for the state of the cluster and its jobs.</span></span>

### <a name="logging-with-azure-machine-learning"></a><span data-ttu-id="a53d5-201">Registrazione con Azure Machine Learning</span><span class="sxs-lookup"><span data-stu-id="a53d5-201">Logging with Azure Machine Learning</span></span>

<span data-ttu-id="a53d5-202">Azure Machine Learning registra automaticamente tutti i flussi StdOut/StdEr per l'account di archiviazione BLOB associato.</span><span class="sxs-lookup"><span data-stu-id="a53d5-202">Azure Machine Learing will automatically log all stdout/stderr to the associate blob storage account.</span></span> <span data-ttu-id="a53d5-203">Se non diversamente specificato, l'area di lavoro di Machine Learning effettua automaticamente il provisioning di un account di archiviazione in cui vi scarica i log.</span><span class="sxs-lookup"><span data-stu-id="a53d5-203">Unless otherwise specified, your Azure Machine Learning Workspace will automatically provision a storage account and dump your logs into it.</span></span> <span data-ttu-id="a53d5-204">È anche possibile usare uno strumento di esplorazione dell'archiviazione, come ad esempio Storage Explorer, che offre un'esperienza molto più semplice per scorrere i file di log.</span><span class="sxs-lookup"><span data-stu-id="a53d5-204">You can also use a storage navigation tool such as Storage Explorer which will provide a much easier experience for navigating log files.</span></span>

## <a name="cost-considerations"></a><span data-ttu-id="a53d5-205">Considerazioni sul costo</span><span class="sxs-lookup"><span data-stu-id="a53d5-205">Cost considerations</span></span>

<span data-ttu-id="a53d5-206">Rispetto ai componenti di pianificazione e archiviazione, le risorse di calcolo usate in questa architettura di riferimento sono nettamente superiori in termini di costi.</span><span class="sxs-lookup"><span data-stu-id="a53d5-206">Compared to the storage and scheduling components, the compute resources used in this reference architecture by far dominate in terms of costs.</span></span> <span data-ttu-id="a53d5-207">Una delle sfide principali consiste nel riuscire ad abbinare efficacemente in parallelo il lavoro all'interno di un cluster di computer abilitati per GPU.</span><span class="sxs-lookup"><span data-stu-id="a53d5-207">One of the main challenges is effectively parallelizing the work across a cluster of GPU-enabled machines.</span></span>

<span data-ttu-id="a53d5-208">Le dimensioni del cluster dell'ambiente di calcolo di Machine Learning possono aumentare o diminuire automaticamente a seconda dei processi presenti nella coda.</span><span class="sxs-lookup"><span data-stu-id="a53d5-208">The Machine Learning Compute cluster size can automatically scale up and down depending on the jobs in the queue.</span></span> <span data-ttu-id="a53d5-209">È possibile abilitare il ridimensionamento automatico a livello di codice impostando i nodi minimo e massimo.</span><span class="sxs-lookup"><span data-stu-id="a53d5-209">You can enable auto-scale programmatically by setting the minimum and maximum nodes.</span></span>

<span data-ttu-id="a53d5-210">Per i lavori che non richiedono un'elaborazione immediata, configurare il ridimensionamento automatico in modo che lo stato predefinito (minimo) sia rappresentato da un cluster con zero nodi.</span><span class="sxs-lookup"><span data-stu-id="a53d5-210">For work that doesn't require immediate processing, configure auto-scale so the default state (minimum) is a cluster of zero nodes.</span></span> <span data-ttu-id="a53d5-211">Con questa configurazione, il cluster inizia con un numero di nodi pari a zero, per poi aumentare quando rileva processi nella coda.</span><span class="sxs-lookup"><span data-stu-id="a53d5-211">With this configuration, the cluster starts with zero nodes and only scales up when it detects jobs in the queue.</span></span> <span data-ttu-id="a53d5-212">Se il processo di assegnazione punteggio batch si verifica poche volte al giorno, questa impostazione consente di ottenere risparmi significativi sui costi.</span><span class="sxs-lookup"><span data-stu-id="a53d5-212">If the batch scoring process only happens a few times a day or less, this setting enables significant cost savings.</span></span>

<span data-ttu-id="a53d5-213">La scalabilità automatica potrebbe non essere appropriata per i processi batch eseguiti in tempi troppo ravvicinati.</span><span class="sxs-lookup"><span data-stu-id="a53d5-213">Auto-scaling may not be appropriate for batch jobs that happen too close to each other.</span></span> <span data-ttu-id="a53d5-214">Anche il tempo necessario per avviare e interrompere un cluster comporta dei costi. Pertanto, se un carico di lavoro batch inizia solo pochi minuti dopo il termine del processo precedente, potrebbe essere più conveniente lasciare il cluster attivo tra i processi.</span><span class="sxs-lookup"><span data-stu-id="a53d5-214">The time that it takes for a cluster to spin up and spin down also incur a cost, so if a batch workload begins only a few minutes after the previous job ends, it might be more cost effective to keep the cluster running between jobs.</span></span>

<span data-ttu-id="a53d5-215">L'ambiente di calcolo di Machine Learning supporta anche macchine virtuali a bassa priorità.</span><span class="sxs-lookup"><span data-stu-id="a53d5-215">Machine Learning Compute also supports low-priority virtual machines.</span></span> <span data-ttu-id="a53d5-216">In questo modo è possibile eseguire il calcolo in macchine virtuali scontate, con l'avvertenza che potrebbero essere annullate in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="a53d5-216">This allows you to run your computation on discounted virtual machines, with the caveat that they may be pre-empted at any time.</span></span> <span data-ttu-id="a53d5-217">Le macchine virtuali a bassa priorità sono ideali per carichi di lavoro di assegnazione di punteggi non critici.</span><span class="sxs-lookup"><span data-stu-id="a53d5-217">Low-priority virtual machines are ideal for non-critical batch scoring workloads.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="a53d5-218">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="a53d5-218">Deploy the solution</span></span>

<span data-ttu-id="a53d5-219">Per distribuire questa architettura di riferimento, seguire la procedura descritta nel [repository GitHub][deployment].</span><span class="sxs-lookup"><span data-stu-id="a53d5-219">To deploy this reference architecture, follow the steps described in the [GitHub repo][deployment].</span></span>

> [!NOTE]
> <span data-ttu-id="a53d5-220">È anche possibile distribuire un'architettura di assegnazione del punteggio in batch per i modelli di Deep Learning usando il servizio Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="a53d5-220">You can also deploy a batch scoring architecture for deep learning models using the Azure Kubernetes Service.</span></span> <span data-ttu-id="a53d5-221">Seguire la procedura descritta nel [repository Github][deployment2].</span><span class="sxs-lookup"><span data-stu-id="a53d5-221">Follow the steps described in this [Github repo][deployment2].</span></span>


<!-- links -->

[aml-compute]: /azure/machine-learning/service/how-to-set-up-training-targets#amlcompute
[amls]: /azure/machine-learning/service/overview-what-is-azure-ml
[azcopy]: /azure/storage/common/storage-use-azcopy-linux
[blob-storage]: /azure/storage/blobs/storage-blobs-introduction
[container-instances]: /azure/container-instances/
[container-registry]: /azure/container-registry/
[deployment]: https://github.com/Azure/Batch-Scoring-Deep-Learning-Models-With-AML
[deployment2]: https://github.com/Azure/Batch-Scoring-Deep-Learning-Models-With-AKS
[ffmpeg]: https://www.ffmpeg.org/
[image-style-transfer]: https://www.cv-foundation.org/openaccess/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf
[logic-apps]: /azure/logic-apps/
[source-video]: https://happypathspublic.blob.core.windows.net/videos/orangutan.mp4
[storage-security]: /azure/storage/common/storage-security-guide
[vm-sizes-gpu]: /azure/virtual-machines/windows/sizes-gpu
[virtual-network]: /azure/machine-learning/service/how-to-enable-virtual-network
