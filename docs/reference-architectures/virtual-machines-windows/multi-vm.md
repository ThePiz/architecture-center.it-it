---
title: "Eseguire macchine virtuali con carico bilanciato in Azure per la scalabilità e la disponibilità"
description: "Come eseguire più macchine virtuali Windows in Azure per la scalabilità e la disponibilità."
author: telmosampaio
ms.date: 11/16/2017
pnp.series.title: Windows VM workloads
pnp.series.next: n-tier
pnp.series.prev: single-vm
ms.openlocfilehash: 14e7e023afd7cb7cbe0e8db8e224ba777f6fe863
ms.sourcegitcommit: c9e6d8edb069b8c513de748ce8114c879bad5f49
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2018
---
# <a name="run-load-balanced-vms-for-scalability-and-availability"></a><span data-ttu-id="c4e11-103">Eseguire macchine virtuali con carico bilanciato per la scalabilità e la disponibilità</span><span class="sxs-lookup"><span data-stu-id="c4e11-103">Run load-balanced VMs for scalability and availability</span></span>

<span data-ttu-id="c4e11-104">Questa architettura di riferimento mostra un set di procedure consolidate per l'esecuzione di più macchine virtuali Windows in un set di scalabilità dietro a un servizio di bilanciamento del carico, in modo da migliorare la disponibilità e la scalabilità.</span><span class="sxs-lookup"><span data-stu-id="c4e11-104">This reference architecture shows a set of proven practices for running multiple Windows virtual machines (VMs) in a scale set behind a load balancer, to improve availability and scalability.</span></span> <span data-ttu-id="c4e11-105">L'architettura può essere usata per qualsiasi carico di lavoro senza stato, ad esempio un server Web, e rappresenta una base per la distribuzione di applicazioni a più livelli.</span><span class="sxs-lookup"><span data-stu-id="c4e11-105">This architecture can be used for any stateless workload, such as a web server, and is a foundation for deploying n-tier applications.</span></span> [<span data-ttu-id="c4e11-106">**Distribuire questa soluzione**.</span><span class="sxs-lookup"><span data-stu-id="c4e11-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="c4e11-107">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="c4e11-107">![[0]][0]</span></span>

<span data-ttu-id="c4e11-108">*Scaricare un [file Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="c4e11-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="c4e11-109">Architecture</span><span class="sxs-lookup"><span data-stu-id="c4e11-109">Architecture</span></span>

<span data-ttu-id="c4e11-110">Questa architettura si basa sull'[architettura di riferimento della macchina virtuale singola][single-vm],</span><span class="sxs-lookup"><span data-stu-id="c4e11-110">This architecture builds on the [Single VM reference architecture][single-vm].</span></span> <span data-ttu-id="c4e11-111">pertanto si applicano le stesse raccomandazioni.</span><span class="sxs-lookup"><span data-stu-id="c4e11-111">Those recommendations also apply to this architecture.</span></span>

<span data-ttu-id="c4e11-112">In questa architettura un carico di lavoro viene distribuito tra più istanze di macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c4e11-112">In this architecture, a workload is distributed across multiple VM instances.</span></span> <span data-ttu-id="c4e11-113">L'indirizzo IP pubblico è unico e il traffico Internet viene distribuito alle macchine virtuali tramite un servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-113">There is a single public IP address, and Internet traffic is distributed to the VMs using a load balancer.</span></span> <span data-ttu-id="c4e11-114">Questa architettura può essere usata per un'applicazione a livello singolo, ad esempio un'applicazione Web senza stato.</span><span class="sxs-lookup"><span data-stu-id="c4e11-114">This architecture can be used for a single-tier application, such as a stateless web application.</span></span>

<span data-ttu-id="c4e11-115">L'architettura include i componenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="c4e11-115">The architecture has the following components:</span></span>

* <span data-ttu-id="c4e11-116">**Gruppo di risorse.**</span><span class="sxs-lookup"><span data-stu-id="c4e11-116">**Resource group.**</span></span> <span data-ttu-id="c4e11-117">I [gruppi di risorse][resource-manager-overview] vengono usati per raggruppare le risorse in modo che possano essere gestite in base alla durata, al proprietario o ad altri criteri.</span><span class="sxs-lookup"><span data-stu-id="c4e11-117">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>
* <span data-ttu-id="c4e11-118">**Rete virtuale (VNet) e subnet.**</span><span class="sxs-lookup"><span data-stu-id="c4e11-118">**Virtual network (VNet) and subnet.**</span></span> <span data-ttu-id="c4e11-119">Ogni macchina virtuale di Azure viene distribuita in una rete virtuale che può essere suddivisa in più subnet.</span><span class="sxs-lookup"><span data-stu-id="c4e11-119">Every Azure VM is deployed into a VNet that can be segmented into multiple subnets.</span></span>
* <span data-ttu-id="c4e11-120">**Azure Load Balancer**.</span><span class="sxs-lookup"><span data-stu-id="c4e11-120">**Azure Load Balancer**.</span></span> <span data-ttu-id="c4e11-121">Il [servizio di bilanciamento del carico][load-balancer] distribuisce le richieste Internet in ingresso alle istanze delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-121">The [load balancer][load-balancer] distributes incoming Internet requests to the VM instances.</span></span> 
* <span data-ttu-id="c4e11-122">**Indirizzo IP pubblico**.</span><span class="sxs-lookup"><span data-stu-id="c4e11-122">**Public IP address**.</span></span> <span data-ttu-id="c4e11-123">Affinché il servizio di bilanciamento del carico possa ricevere il traffico Internet, è richiesto un indirizzo IP pubblico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-123">A public IP address is needed for the load balancer to receive Internet traffic.</span></span>
* <span data-ttu-id="c4e11-124">**DNS di Azure**.</span><span class="sxs-lookup"><span data-stu-id="c4e11-124">**Azure DNS**.</span></span> <span data-ttu-id="c4e11-125">[DNS di Azure][azure-dns] è un servizio di hosting per i domini DNS, che fornisce la risoluzione dei nomi usando l'infrastruttura di Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="c4e11-125">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="c4e11-126">Ospitando i domini in Azure, è possibile gestire i record DNS usando le stesse credenziali, API, strumenti e fatturazione come per gli altri servizi Azure.</span><span class="sxs-lookup"><span data-stu-id="c4e11-126">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="c4e11-127">**Set di scalabilità di macchine virtuali**.</span><span class="sxs-lookup"><span data-stu-id="c4e11-127">**VM scale set**.</span></span> <span data-ttu-id="c4e11-128">Un [set di scalabilità di macchine virtuali][vm-scaleset] è un set di macchine virtuali identiche usato per ospitare un carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c4e11-128">A [VM scale set][vm-scaleset] is a set of identical VMs used to host a workload.</span></span> <span data-ttu-id="c4e11-129">I set di scalabilità consentono di aumentare o ridurre il numero di macchine virtuali manualmente o automaticamente in base a regole predefinite.</span><span class="sxs-lookup"><span data-stu-id="c4e11-129">Scale sets allow the number of VMs to be scaled in or out manually, or automatically based on predefined rules.</span></span>
* <span data-ttu-id="c4e11-130">**Set di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="c4e11-130">**Availability set**.</span></span> <span data-ttu-id="c4e11-131">Il [set di disponibilità][availability-set] include le macchine virtuali, rendendole idonee per un [contratto di servizio (SLA)][vm-sla] superiore.</span><span class="sxs-lookup"><span data-stu-id="c4e11-131">The [availability set][availability-set] contains the VMs, making the VMs eligible for a higher [service level agreement (SLA)][vm-sla].</span></span> <span data-ttu-id="c4e11-132">Per consentire l'applicazione del contratto di servizio superiore, il set di disponibilità deve includere almeno due macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-132">For the higher SLA to apply, the availability set must include a minimum of two VMs.</span></span> <span data-ttu-id="c4e11-133">I set di disponibilità sono impliciti nei set di scalabilità.</span><span class="sxs-lookup"><span data-stu-id="c4e11-133">Availability sets are implicit in scale sets.</span></span> <span data-ttu-id="c4e11-134">Se si creano macchine virtuali al di fuori di un set di scalabilità, è necessario creare il set di disponibilità in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="c4e11-134">If you create VMs outside a scale set, you need to create the availability set independently.</span></span>
* <span data-ttu-id="c4e11-135">**Dischi gestiti**.</span><span class="sxs-lookup"><span data-stu-id="c4e11-135">**Managed disks**.</span></span> <span data-ttu-id="c4e11-136">Il servizio Azure Managed Disks gestisce i file di disco rigido virtuale (VHD) per i dischi delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-136">Azure Managed Disks manage the virtual hard disk (VHD) files for the VM disks.</span></span> 
* <span data-ttu-id="c4e11-137">**Archiviazione**.</span><span class="sxs-lookup"><span data-stu-id="c4e11-137">**Storage**.</span></span> <span data-ttu-id="c4e11-138">Creare un account di archiviazione di Azure per contenere i log di diagnostica per le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-138">Create an Azure Storage acount to hold diagnostic logs for the VMs.</span></span>

## <a name="recommendations"></a><span data-ttu-id="c4e11-139">Raccomandazioni</span><span class="sxs-lookup"><span data-stu-id="c4e11-139">Recommendations</span></span>

<span data-ttu-id="c4e11-140">I requisiti dell'utente potrebbero non essere perfettamente allineati con l'architettura descritta di seguito.</span><span class="sxs-lookup"><span data-stu-id="c4e11-140">Your requirements may not align completely with the architecture described here.</span></span> <span data-ttu-id="c4e11-141">Usare queste indicazioni come punto di partenza.</span><span class="sxs-lookup"><span data-stu-id="c4e11-141">Use these recommendations as a starting point.</span></span> 

### <a name="availability-and-scalability-recommendations"></a><span data-ttu-id="c4e11-142">Raccomandazioni per la disponibilità e la scalabilità</span><span class="sxs-lookup"><span data-stu-id="c4e11-142">Availability and scalability recommendations</span></span>

<span data-ttu-id="c4e11-143">Un'opzione per la disponibilità e la scalabilità consiste nell'usare un [set di scalabilità di macchine virtuali][vmss].</span><span class="sxs-lookup"><span data-stu-id="c4e11-143">An option for availability and scalability is to use a [virtual machine scale set][vmss].</span></span> <span data-ttu-id="c4e11-144">I set di scalabilità di macchine virtuali consentono di distribuire e gestire un set di macchine virtuali identiche.</span><span class="sxs-lookup"><span data-stu-id="c4e11-144">VM scale sets help you to deploy and manage a set of identical VMs.</span></span> <span data-ttu-id="c4e11-145">I set di scalabilità supportano il ridimensionamento automatico in base alle metriche delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="c4e11-145">Scale sets support autoscaling based on performance metrics.</span></span> <span data-ttu-id="c4e11-146">Di pari passo con l'aumento del carico sulle macchine virtuali, vengono aggiunte automaticamente altre macchine virtuali al servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-146">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="c4e11-147">Prendere in considerazione i set di scalabilità se è necessario aumentare rapidamente le istanze delle macchine virtuali o se si necessita del ridimensionamento automatico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-147">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="c4e11-148">Per impostazione predefinita, i set di scalabilità usano il "provisioning eccessivo", ovvero inizialmente il set di scalabilità esegue il provisioning di un numero di macchine virtuali maggiore di quello richiesto e quindi elimina le macchine virtuali aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="c4e11-148">By default, scale sets use "overprovisioning," which means the scale set initially provisions more VMs than you ask for, then deletes the extra VMs.</span></span> <span data-ttu-id="c4e11-149">Ciò migliora la percentuale di successo complessiva durante il provisioning delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-149">This improves the overall success rate when provisioning the VMs.</span></span> <span data-ttu-id="c4e11-150">Se non si usano [dischi gestiti](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-managed-disks), si consigliano non più di 20 macchine virtuali per account di archiviazione con provisioning eccessivo abilitato e non più di 40 macchine virtuali con provisioning eccessivo disabilitato.</span><span class="sxs-lookup"><span data-stu-id="c4e11-150">If you are not using [managed disks](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-managed-disks), we recommend no more than 20 VMs per storage account with overprovisioning enabled, and no more than 40 VMs with overprovisioning disabled.</span></span>

<span data-ttu-id="c4e11-151">Esistono due modi per configurare le macchine virtuali distribuite in un set di scalabilità:</span><span class="sxs-lookup"><span data-stu-id="c4e11-151">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="c4e11-152">Usare le estensioni per configurare la macchina virtuale dopo il provisioning.</span><span class="sxs-lookup"><span data-stu-id="c4e11-152">Use extensions to configure the VM after it is provisioned.</span></span> <span data-ttu-id="c4e11-153">Con questo approccio, le nuove istanze delle macchine virtuali possono richiedere più tempo per l'avvio di una macchina virtuale senza estensioni.</span><span class="sxs-lookup"><span data-stu-id="c4e11-153">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="c4e11-154">Distribuire un [disco gestito](/azure/storage/storage-managed-disks-overview) con un'immagine del disco personalizzata.</span><span class="sxs-lookup"><span data-stu-id="c4e11-154">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="c4e11-155">Questa opzione può risultare più veloce da distribuire.</span><span class="sxs-lookup"><span data-stu-id="c4e11-155">This option may be quicker to deploy.</span></span> <span data-ttu-id="c4e11-156">Tuttavia, richiede che l'immagine sia mantenuta aggiornata.</span><span class="sxs-lookup"><span data-stu-id="c4e11-156">However, it requires you to keep the image up to date.</span></span>

<span data-ttu-id="c4e11-157">Per altre considerazioni, vedere [Considerazioni sulla progettazione per i set di scalabilità][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="c4e11-157">For additional considerations, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="c4e11-158">Quando si usa una soluzione di ridimensionamento automatico, occorre testarla in anticipo con carichi di lavoro a livello di produzione.</span><span class="sxs-lookup"><span data-stu-id="c4e11-158">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="c4e11-159">Se non si usa un set di scalabilità, prendere in considerazione almeno l'uso di un set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c4e11-159">If you do not use a scale set, consider at least using an availability set.</span></span> <span data-ttu-id="c4e11-160">Creare almeno due macchine virtuali nel set di disponibilità in modo da supportare il [contratto di servizio relativo alla disponibilità per le macchine virtuali di Azure][vm-sla].</span><span class="sxs-lookup"><span data-stu-id="c4e11-160">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="c4e11-161">Azure Load Balancer richiede inoltre che le macchine virtuali con carico bilanciato appartengano allo stesso set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c4e11-161">The Azure load balancer also requires that load-balanced VMs belong to the same availability set.</span></span>

<span data-ttu-id="c4e11-162">Ogni sottoscrizione di Azure ha limiti predefiniti, tra cui il numero massimo di macchine virtuali per area.</span><span class="sxs-lookup"><span data-stu-id="c4e11-162">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="c4e11-163">È possibile aumentare il limite presentando una richiesta di supporto.</span><span class="sxs-lookup"><span data-stu-id="c4e11-163">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="c4e11-164">Per altre informazioni, vedere [Sottoscrizione di Azure e limiti, quote e vincoli dei servizi][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="c4e11-164">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

### <a name="network-recommendations"></a><span data-ttu-id="c4e11-165">Indicazioni per la rete</span><span class="sxs-lookup"><span data-stu-id="c4e11-165">Network recommendations</span></span>

<span data-ttu-id="c4e11-166">Distribuire le macchine virtuali all'interno della stessa subnet.</span><span class="sxs-lookup"><span data-stu-id="c4e11-166">Deploy the VMs within the same subnet.</span></span> <span data-ttu-id="c4e11-167">Non esporre le macchine virtuali direttamente su Internet, ma assegnare un indirizzo IP privato a ogni macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c4e11-167">Do not expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="c4e11-168">I client si connettono usando l'indirizzo IP pubblico del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-168">Clients connect using the public IP address of the load balancer.</span></span>

<span data-ttu-id="c4e11-169">Se è necessario accedere alle macchine virtuali dietro al servizio di bilanciamento del carico, valutare l'opportunità di aggiungere una singola macchina virtuale come jumpbox (anche noto come bastion host) con un indirizzo IP pubblico a cui è possibile eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c4e11-169">If you need to log into the VMs behind the load balancer, consider adding a single VM as a jumpbox (also called a bastion host) with a public IP address you can log into.</span></span> <span data-ttu-id="c4e11-170">Accedere quindi alle macchine virtuali dietro al servizio di bilanciamento del carico dal jumpbox.</span><span class="sxs-lookup"><span data-stu-id="c4e11-170">And then log into the VMs behind the load balancer from the jumpbox.</span></span> <span data-ttu-id="c4e11-171">In alternativa, è possibile configurare le regole Network Address Translation (NAT) in ingresso del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-171">Alternatively, you can configure the load balancer's inbound network address translation (NAT) rules.</span></span> <span data-ttu-id="c4e11-172">Tuttavia, un jumpbox è la soluzione migliore quando si ospitano carichi di lavoro a più livelli o più carichi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c4e11-172">However, having a jumpbox is a better solution when you are hosting n-tier workloads or multiple workloads.</span></span>

### <a name="load-balancer-recommendations"></a><span data-ttu-id="c4e11-173">Raccomandazioni per il servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="c4e11-173">Load balancer recommendations</span></span>

<span data-ttu-id="c4e11-174">Aggiungere tutte le macchine virtuali nel set di disponibilità al pool di indirizzi back-end del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-174">Add all VMs in the availability set to the back-end address pool of the load balancer.</span></span>

<span data-ttu-id="c4e11-175">Definire regole di bilanciamento del carico per indirizzare il traffico di rete alle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-175">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="c4e11-176">Ad esempio, per consentire il traffico HTTP, creare una regola che esegua il mapping della porta 80 dalla configurazione front-end alla porta 80 sul pool di indirizzi back-end.</span><span class="sxs-lookup"><span data-stu-id="c4e11-176">For example, to enable HTTP traffic, create a rule that maps port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="c4e11-177">Quando un client invia una richiesta HTTP alla porta 80, il servizio di bilanciamento del carico consente di selezionare un indirizzo IP back-end usando un [algoritmo di hash][load-balancer-hashing] che include l'indirizzo IP di origine.</span><span class="sxs-lookup"><span data-stu-id="c4e11-177">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="c4e11-178">In tal modo, le richieste client vengono distribuite tra tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-178">In that way, client requests are distributed across all the VMs.</span></span>

<span data-ttu-id="c4e11-179">Per indirizzare il traffico a una macchina virtuale specifica, usare le regole NAT.</span><span class="sxs-lookup"><span data-stu-id="c4e11-179">To route traffic to a specific VM, use NAT rules.</span></span> <span data-ttu-id="c4e11-180">Ad esempio, per abilitare RDP per le macchine virtuali, creare una regola NAT distinta per ogni macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c4e11-180">For example, to enable RDP to the VMs, create a separate NAT rule for each VM.</span></span> <span data-ttu-id="c4e11-181">Ogni regola dovrebbe eseguire il mapping di un numero di porta distinto alla porta 3389, la porta predefinita per RDP.</span><span class="sxs-lookup"><span data-stu-id="c4e11-181">Each rule should map a distinct port number to port 3389, the default port for RDP.</span></span> <span data-ttu-id="c4e11-182">Ad esempio, usare la porta 50001 per "VM1", la porta 50002 per "VM2" e così via.</span><span class="sxs-lookup"><span data-stu-id="c4e11-182">For example, use port 50001 for "VM1," port 50002 for "VM2," and so on.</span></span> <span data-ttu-id="c4e11-183">Assegnare le regole NAT alle schede di interfaccia di rete nelle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-183">Assign the NAT rules to the NICs on the VMs.</span></span>

### <a name="storage-account-recommendations"></a><span data-ttu-id="c4e11-184">Raccomandazioni per gli account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="c4e11-184">Storage account recommendations</span></span>

<span data-ttu-id="c4e11-185">Si consiglia l'uso di [dischi gestiti](/azure/storage/storage-managed-disks-overview) con [archiviazione Premium][premium].</span><span class="sxs-lookup"><span data-stu-id="c4e11-185">We recommend the use of [managed disks](/azure/storage/storage-managed-disks-overview) with [premium storage][premium].</span></span> <span data-ttu-id="c4e11-186">I dischi gestiti non richiedono un account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c4e11-186">Managed disks do not require a storage account.</span></span> <span data-ttu-id="c4e11-187">È sufficiente specificare le dimensioni e il tipo di disco per distribuirlo come risorsa a disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="c4e11-187">You simply specify the size and type of disk and it is deployed as a highly available resource.</span></span>

<span data-ttu-id="c4e11-188">Se si usano dischi non gestiti, creare account di archiviazione di Azure distinti per ogni macchina virtuale per contenere i dischi rigidi virtuali, in modo da evitare di raggiungere i [limiti di operazioni di input/output al secondo (IOPS)][vm-disk-limits] per gli account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c4e11-188">If you are using unmanaged disks, create separate Azure storage accounts for each VM to hold the virtual hard disks (VHDs), in order to avoid hitting the input/output operations per second [(IOPS) limits][vm-disk-limits] for storage accounts.</span></span>

<span data-ttu-id="c4e11-189">Creare un account di archiviazione per i log di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="c4e11-189">Create one storage account for diagnostic logs.</span></span> <span data-ttu-id="c4e11-190">Questo account di archiviazione può essere condiviso da tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-190">This storage account can be shared by all the VMs.</span></span> <span data-ttu-id="c4e11-191">Può trattarsi di un account di archiviazione non gestito basato sull'uso di dischi standard.</span><span class="sxs-lookup"><span data-stu-id="c4e11-191">This can be an unmanaged storage account using standard disks.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="c4e11-192">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="c4e11-192">Availability considerations</span></span>

<span data-ttu-id="c4e11-193">Il set di disponibilità rende l'applicazione più resiliente agli eventi di manutenzione pianificata e non pianificata.</span><span class="sxs-lookup"><span data-stu-id="c4e11-193">The availability set makes your application more resilient to both planned and unplanned maintenance events.</span></span>

* <span data-ttu-id="c4e11-194">La *manutenzione pianificata* si verifica quando Microsoft aggiorna la piattaforma sottostante, causando talvolta il riavvio delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-194">*Planned maintenance* occurs when Microsoft updates the underlying platform, sometimes causing VMs to be restarted.</span></span> <span data-ttu-id="c4e11-195">Azure garantisce che le macchine virtuali in un set di disponibilità non siano tutte riavviate nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="c4e11-195">Azure makes sure the VMs in an availability set are not all restarted at the same time.</span></span> <span data-ttu-id="c4e11-196">Almeno una viene mantenuta in esecuzione mentre le altre si riavviano.</span><span class="sxs-lookup"><span data-stu-id="c4e11-196">At least one is kept running while others are restarting.</span></span>
* <span data-ttu-id="c4e11-197">La *manutenzione non pianificata* ha luogo se si verifica un errore hardware.</span><span class="sxs-lookup"><span data-stu-id="c4e11-197">*Unplanned maintenance* happens if there is a hardware failure.</span></span> <span data-ttu-id="c4e11-198">Azure garantisce che sia eseguito il provisioning delle macchine virtuali in un set di disponibilità tra più rack di server.</span><span class="sxs-lookup"><span data-stu-id="c4e11-198">Azure makes sure that VMs in an availability set are provisioned across more than one server rack.</span></span> <span data-ttu-id="c4e11-199">Ciò consente di ridurre l'impatto di errori hardware, interruzioni di rete, interruzioni di alimentazione e così via.</span><span class="sxs-lookup"><span data-stu-id="c4e11-199">This helps to reduce the impact of hardware failures, network outages, power interruptions, and so on.</span></span>

<span data-ttu-id="c4e11-200">Per altre informazioni, vedere [Gestire la disponibilità delle macchine virtuali][availability-set].</span><span class="sxs-lookup"><span data-stu-id="c4e11-200">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> <span data-ttu-id="c4e11-201">Il video seguente offre inoltre una valida panoramica dei set di disponibilità: [How Do I Configure an Availability Set to Scale VMs][availability-set-ch9] (Come configurare un set di disponibilità per ridimensionare le macchine virtuali).</span><span class="sxs-lookup"><span data-stu-id="c4e11-201">The following video also provides a good overview of availability sets: [How Do I Configure an Availability Set to Scale VMs][availability-set-ch9].</span></span>

> [!WARNING]
> <span data-ttu-id="c4e11-202">Assicurarsi di configurare il set di disponibilità quando si esegue il provisioning della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c4e11-202">Make sure to configure the availability set when you provision the VM.</span></span> <span data-ttu-id="c4e11-203">Attualmente, non è possibile aggiungere una macchina virtuale di Gestione risorse a un set di disponibilità dopo che è stato eseguito il provisioning della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c4e11-203">Currently, there is no way to add a Resource Manager VM to an availability set after the VM is provisioned.</span></span>

<span data-ttu-id="c4e11-204">Il servizio di bilanciamento del carico usa i [probe di integrità][health-probes] per monitorare la disponibilità delle istanze delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-204">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="c4e11-205">Se un probe non riesce a raggiungere un'istanza entro il periodo di timeout, il bilanciamento del carico interrompe l'invio di traffico a quella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c4e11-205">If a probe cannot reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="c4e11-206">Tuttavia, il servizio di bilanciamento del carico continuerà a eseguire la verifica e, se la macchina virtuale diventa nuovamente disponibile, il servizio di bilanciamento del carico riprenderà a inviare il traffico a quella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c4e11-206">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="c4e11-207">Ecco alcune raccomandazioni per i probe di integrità del servizio di bilanciamento del carico:</span><span class="sxs-lookup"><span data-stu-id="c4e11-207">Here are some recommendations on load balancer health probes:</span></span>

* <span data-ttu-id="c4e11-208">I probe possono testare protocolli HTTP o TCP.</span><span class="sxs-lookup"><span data-stu-id="c4e11-208">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="c4e11-209">Se le macchine virtuali eseguono un server HTTP, creare un probe HTTP.</span><span class="sxs-lookup"><span data-stu-id="c4e11-209">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="c4e11-210">In caso contrario, creare un probe TCP.</span><span class="sxs-lookup"><span data-stu-id="c4e11-210">Otherwise create a TCP probe.</span></span>
* <span data-ttu-id="c4e11-211">Per un probe HTTP, specificare il percorso di un endpoint HTTP.</span><span class="sxs-lookup"><span data-stu-id="c4e11-211">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="c4e11-212">Il probe controlla una risposta HTTP 200 da questo percorso.</span><span class="sxs-lookup"><span data-stu-id="c4e11-212">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="c4e11-213">Può trattarsi del percorso radice ("/") o di un endpoint di monitoraggio dell'integrità che implementa una logica personalizzata per controllare l'integrità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c4e11-213">This can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="c4e11-214">L'endpoint deve consentire richieste HTTP anonime.</span><span class="sxs-lookup"><span data-stu-id="c4e11-214">The endpoint must allow anonymous HTTP requests.</span></span>
* <span data-ttu-id="c4e11-215">Il probe viene inviato da un [indirizzo IP noto][health-probe-ip], 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="c4e11-215">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="c4e11-216">Verificare di non bloccare il traffico da o verso questo indirizzo IP in eventuali criteri del firewall o regole del gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="c4e11-216">Make sure you don't block traffic to or from this IP address in any firewall policies or network security group (NSG) rules.</span></span>
* <span data-ttu-id="c4e11-217">Usare i [log dei probe di integrità][health-probe-log] per visualizzare lo stato dei probe di integrità.</span><span class="sxs-lookup"><span data-stu-id="c4e11-217">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="c4e11-218">Abilitare la registrazione nel portale di Azure per ogni servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-218">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="c4e11-219">I log vengono scritti in Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="c4e11-219">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="c4e11-220">Il log mostra il numero di macchine virtuali sul back-end che non ricevono traffico di rete a causa di risposte del probe non riuscite.</span><span class="sxs-lookup"><span data-stu-id="c4e11-220">The logs show how many VMs on the back end are not receiving network traffic due to failed probe responses.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="c4e11-221">Considerazioni sulla gestibilità</span><span class="sxs-lookup"><span data-stu-id="c4e11-221">Manageability considerations</span></span>

<span data-ttu-id="c4e11-222">Con più macchine virtuali, è importante automatizzare i processi in modo che siano ripetibili e affidabili.</span><span class="sxs-lookup"><span data-stu-id="c4e11-222">With multiple VMs, it is important to automate processes so they are reliable and repeatable.</span></span> <span data-ttu-id="c4e11-223">È possibile usare [Automazione di Azure][azure-automation] per automatizzare la distribuzione, l'applicazione di patch del sistema operativo e altre attività.</span><span class="sxs-lookup"><span data-stu-id="c4e11-223">You can use [Azure Automation][azure-automation] to automate deployment, OS patching, and other tasks.</span></span> <span data-ttu-id="c4e11-224">[Automazione di Azure][azure-automation] è un servizio di automazione basato su PowerShell che può essere usato a questo scopo.</span><span class="sxs-lookup"><span data-stu-id="c4e11-224">[Azure Automation][azure-automation] is an automation service based on PowerShell that can be used for this.</span></span> <span data-ttu-id="c4e11-225">Script di automazione di esempio sono disponibili nella [raccolta di Runbook][runbook-gallery].</span><span class="sxs-lookup"><span data-stu-id="c4e11-225">Example automation scripts are available from the [Runbook Gallery][runbook-gallery].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="c4e11-226">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="c4e11-226">Security considerations</span></span>

<span data-ttu-id="c4e11-227">Le reti virtuali sono un limite di isolamento del traffico in Azure.</span><span class="sxs-lookup"><span data-stu-id="c4e11-227">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="c4e11-228">Le macchine virtuali in una rete virtuale possono comunicare direttamente con quelle in una rete virtuale diversa.</span><span class="sxs-lookup"><span data-stu-id="c4e11-228">VMs in one VNet cannot communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="c4e11-229">Le macchine virtuali all'interno della stessa rete virtuale possono comunicare, a meno che non si creino [gruppi di sicurezza di rete][nsg] per limitare il traffico.</span><span class="sxs-lookup"><span data-stu-id="c4e11-229">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="c4e11-230">Per altre informazioni, vedere [Servizi cloud Microsoft e sicurezza di rete][network-security].</span><span class="sxs-lookup"><span data-stu-id="c4e11-230">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="c4e11-231">Per il traffico Internet in ingresso, le regole di bilanciamento del carico definiscono il tipo di traffico che può raggiungere il back-end.</span><span class="sxs-lookup"><span data-stu-id="c4e11-231">For incoming Internet traffic, the load balancer rules define which traffic can reach the back end.</span></span> <span data-ttu-id="c4e11-232">Tuttavia, le regole di bilanciamento del carico non supportano gli elenchi di indirizzi IP attendibili, pertanto se si vogliono aggiungere determinati indirizzi IP pubblici a un elenco di indirizzi attendibili, aggiungere un gruppo di sicurezza di rete alla subnet.</span><span class="sxs-lookup"><span data-stu-id="c4e11-232">However, load balancer rules don't support IP safe lists, so if you want to add certain public IP addresses to a safe list, add an NSG to the subnet.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="c4e11-233">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="c4e11-233">Deploy the solution</span></span>

<span data-ttu-id="c4e11-234">Una distribuzione di questa architettura è disponibile in [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="c4e11-234">A deployment for this architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="c4e11-235">Ecco cosa viene distribuito:</span><span class="sxs-lookup"><span data-stu-id="c4e11-235">It deploys the following:</span></span>

  * <span data-ttu-id="c4e11-236">Una rete virtuale con una sola subnet denominata **Web** che contiene le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-236">A virtual network with a single subnet named **web** that contains the VMs.</span></span>
  * <span data-ttu-id="c4e11-237">Un set di scalabilità di macchine virtuali contenenti macchine virtuali che eseguono la versione più recente di Windows Server 2016 Datacenter Edition.</span><span class="sxs-lookup"><span data-stu-id="c4e11-237">A VM scale set that contains VMs running the latest version of Windows Server 2016 Datacenter Edition.</span></span> <span data-ttu-id="c4e11-238">Il ridimensionamento automatico è abilitato.</span><span class="sxs-lookup"><span data-stu-id="c4e11-238">Autoscale is enabled.</span></span>
  * <span data-ttu-id="c4e11-239">Un servizio di bilanciamento del carico posizionato davanti al set di scalabilità di macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-239">A load balancer that sits in front of the VM scale set.</span></span>
  * <span data-ttu-id="c4e11-240">Un gruppo di sicurezza di rete con regole in ingresso per consentire il traffico HTTP al set di scalabilità di macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c4e11-240">An NSG with incoming rules that allow HTTP traffic to the VM scale set.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="c4e11-241">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="c4e11-241">Prerequisites</span></span>

<span data-ttu-id="c4e11-242">Prima di poter distribuire l'architettura di riferimento nella propria sottoscrizione, è necessario eseguire i passaggi seguenti.</span><span class="sxs-lookup"><span data-stu-id="c4e11-242">Before you can deploy the reference architecture to your own subscription, you must perform the following steps.</span></span>

1. <span data-ttu-id="c4e11-243">Clonare, creare una copia tramite fork o scaricare il file ZIP per il repository GitHub delle [architetture di riferimento AzureCAT][ref-arch-repo].</span><span class="sxs-lookup"><span data-stu-id="c4e11-243">Clone, fork, or download the zip file for the [AzureCAT reference architectures][ref-arch-repo] GitHub repository.</span></span>

2. <span data-ttu-id="c4e11-244">Verificare che nel computer sia installata l'interfaccia della riga di comando di Azure 2.0.</span><span class="sxs-lookup"><span data-stu-id="c4e11-244">Make sure you have the Azure CLI 2.0 installed on your computer.</span></span> <span data-ttu-id="c4e11-245">Per istruzioni sull'installazione dell'interfaccia della riga di comando, vedere [Installare l'interfaccia della riga di comando di Azure 2.0][azure-cli-2].</span><span class="sxs-lookup"><span data-stu-id="c4e11-245">For CLI installation instructions, see [Install Azure CLI 2.0][azure-cli-2].</span></span>

3. <span data-ttu-id="c4e11-246">Installare il pacchetto npm dei [blocchi predefiniti di Azure][azbb].</span><span class="sxs-lookup"><span data-stu-id="c4e11-246">Install the [Azure building blocks][azbb] npm package.</span></span>

4. <span data-ttu-id="c4e11-247">Da un prompt dei comandi, di Bash o di PowerShell accedere al proprio account di Azure usando uno dei comandi riportati di seguito e seguire le istruzioni.</span><span class="sxs-lookup"><span data-stu-id="c4e11-247">From a command prompt, bash prompt, or PowerShell prompt, login to your Azure account by using one of the commands below, and follow the prompts.</span></span>

  ```bash
  az login
  ```

### <a name="deploy-the-solution-using-azbb"></a><span data-ttu-id="c4e11-248">Distribuire la soluzione mediante azbb</span><span class="sxs-lookup"><span data-stu-id="c4e11-248">Deploy the solution using azbb</span></span>

<span data-ttu-id="c4e11-249">Per distribuire il carico di lavoro della singola macchina virtuale di esempio, eseguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="c4e11-249">To deploy the sample single VM workload, follow these steps:</span></span>

1. <span data-ttu-id="c4e11-250">Passare alla cartella `virtual-machines\multi-vm\parameters\windows` per il repository scaricato nel passaggio dei prerequisiti precedente.</span><span class="sxs-lookup"><span data-stu-id="c4e11-250">Navigate to the `virtual-machines\multi-vm\parameters\windows` folder for the repository you downloaded in the pre-requisites step above.</span></span>

2. <span data-ttu-id="c4e11-251">Aprire il file `multi-vm-v2.json` e immettere un nome utente e una password tra virgolette, come illustrato di seguito, quindi salvare il file.</span><span class="sxs-lookup"><span data-stu-id="c4e11-251">Open the `multi-vm-v2.json` file and enter a username and password between the quotes, as shown below, then save the file.</span></span>

  ```bash
  "adminUsername": "",
  "adminPassword": "",
  ```

3. <span data-ttu-id="c4e11-252">Eseguire `azbb` per distribuire le macchine virtuali, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="c4e11-252">Run `azbb` to deploy the VMs as shown below.</span></span>

  ```bash
  azbb -s <subscription_id> -g <resource_group_name> -l <location> -p multi-vm-v2.json --deploy
  ```

<span data-ttu-id="c4e11-253">Per altre informazioni sulla distribuzione di questa architettura di riferimento di esempio, visitare il [repository GitHub][git].</span><span class="sxs-lookup"><span data-stu-id="c4e11-253">For more information on deploying this sample reference architecture, visit our [GitHub repository][git].</span></span>

<!-- links -->

[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[availability-set-ch9]: https://channel9.msdn.com/Series/Microsoft-Azure-Fundamentals-Virtual-Machines/08
[azbb]: https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks
[azure-automation]: /azure/automation/automation-intro
[azure-cli]: /azure/virtual-machines-command-line-tools
[azure-cli-2]: /azure/install-azure-cli?view=azure-cli-latest
[azure-dns]: /azure/dns/dns-overview
[git]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[load-balancer]: /azure/load-balancer/load-balancer-get-started-internet-arm-cli
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[naming-conventions]: ../../best-practices/naming-conventions.md
[network-security]: /azure/best-practices-network-security
[nsg]: /azure/virtual-network/virtual-networks-nsg
[premium]: /azure/storage/common/storage-premium-storage
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview 
[runbook-gallery]: /azure/automation/automation-runbook-gallery#runbooks-in-runbook-gallery
[single-vm]: single-vm.md
[subscription-limits]: /azure/azure-subscription-service-limits
[visio-download]: https://archcenter.azureedge.net/cdn/vm-reference-architectures.vsdx
[vm-disk-limits]: /azure/azure-subscription-service-limits#virtual-machine-disk-limits
[vm-scaleset]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vm-sizes]: https://azure.microsoft.com/documentation/articles/virtual-machines-windows-sizes/
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_2/
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[vmss-quickstart]: https://azure.microsoft.com/documentation/templates/?term=scale+set
[0]: ./images/multi-vm-diagram.png "Architettura di una soluzione di più macchine virtuali in Azure che comprende un set di disponibilità con due macchine virtuali e un servizio di bilanciamento del carico"
