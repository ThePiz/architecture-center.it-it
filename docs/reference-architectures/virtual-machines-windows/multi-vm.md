---
title: "Eseguire macchine virtuali con carico bilanciato in Azure per la scalabilità e la disponibilità"
description: "Come eseguire più macchine virtuali Windows in Azure per la scalabilità e la disponibilità."
author: telmosampaio
ms.date: 09/07/2017
pnp.series.title: Windows VM workloads
pnp.series.next: n-tier
pnp.series.prev: single-vm
ms.openlocfilehash: d38cfb41255c547f1f1e87ef289c7a79033df778
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 11/14/2017
---
# <a name="run-load-balanced-vms-for-scalability-and-availability"></a><span data-ttu-id="c1889-103">Eseguire macchine virtuali con carico bilanciato per la scalabilità e la disponibilità</span><span class="sxs-lookup"><span data-stu-id="c1889-103">Run load-balanced VMs for scalability and availability</span></span>

<span data-ttu-id="c1889-104">Questa architettura di riferimento mostra un set di procedure consolidate per l'esecuzione di diverse macchine virtuali Windows in un set di scalabilità dietro a un servizio di bilanciamento del carico, in modo da migliorare la disponibilità e la scalabilità.</span><span class="sxs-lookup"><span data-stu-id="c1889-104">This reference architecture shows a set of proven practices for running several Windows virtual machines (VMs) in a scale set behind a load balancer, to improve availability and scalability.</span></span> <span data-ttu-id="c1889-105">Questa architettura può essere usata per qualsiasi carico di lavoro senza stato, ad esempio un server Web, ed è un blocco predefinito per la distribuzione di applicazioni a più livelli.</span><span class="sxs-lookup"><span data-stu-id="c1889-105">This architecture can be used for any stateless workload, such as a web server, and is a building block for deploying n-tier applications.</span></span> [<span data-ttu-id="c1889-106">**Distribuire questa soluzione**.</span><span class="sxs-lookup"><span data-stu-id="c1889-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="c1889-107">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="c1889-107">![[0]][0]</span></span>

<span data-ttu-id="c1889-108">*Scaricare un [file di Visio][visio-download] di questa architettura.*</span><span class="sxs-lookup"><span data-stu-id="c1889-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="c1889-109">Architettura</span><span class="sxs-lookup"><span data-stu-id="c1889-109">Architecture</span></span>

<span data-ttu-id="c1889-110">Questa architettura si basa su quella illustrata in [Eseguire una macchina virtuale Windows in Azure][single vm].</span><span class="sxs-lookup"><span data-stu-id="c1889-110">This architecture builds on the one shown in [Run a Windows VM on Azure][single vm].</span></span> <span data-ttu-id="c1889-111">Le raccomandazioni riportate in questo riferimento si applicano anche a questa architettura.</span><span class="sxs-lookup"><span data-stu-id="c1889-111">The recommendations there also apply to this architecture.</span></span>

<span data-ttu-id="c1889-112">In questa architettura un carico di lavoro viene distribuito tra più istanze di macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c1889-112">In this architecture, a workload is distributed across several VM instances.</span></span> <span data-ttu-id="c1889-113">L'indirizzo IP pubblico è unico e il traffico Internet viene distribuito alle macchine virtuali tramite un servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c1889-113">There is a single public IP address, and Internet traffic is distributed to the VMs using a load balancer.</span></span> <span data-ttu-id="c1889-114">Questa architettura può essere usata per un'applicazione a livello singolo, ad esempio un'applicazione Web senza stato.</span><span class="sxs-lookup"><span data-stu-id="c1889-114">This architecture can be used for a single-tier application, such as a stateless web application.</span></span>

<span data-ttu-id="c1889-115">L'architettura include i componenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="c1889-115">The architecture has the following components:</span></span>

* <span data-ttu-id="c1889-116">**Gruppo di risorse.**</span><span class="sxs-lookup"><span data-stu-id="c1889-116">**Resource group.**</span></span> <span data-ttu-id="c1889-117">I [*gruppi di risorse*][resource-manager-overview] vengono usati per raggruppare le risorse in modo che possano essere gestite in base alla durata, al proprietario e ad altri criteri.</span><span class="sxs-lookup"><span data-stu-id="c1889-117">[*Resource groups*][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, and other criteria.</span></span>
* <span data-ttu-id="c1889-118">**Rete virtuale (VNet) e subnet.**</span><span class="sxs-lookup"><span data-stu-id="c1889-118">**Virtual network (VNet) and subnet.**</span></span> <span data-ttu-id="c1889-119">Ogni VM in Azure viene distribuita in una rete virtuale (VNet), che viene a sua volta suddivisa in subnet.</span><span class="sxs-lookup"><span data-stu-id="c1889-119">Every VM in Azure is deployed into a VNet that is further divided into subnets.</span></span>
* <span data-ttu-id="c1889-120">**Azure Load Balancer**.</span><span class="sxs-lookup"><span data-stu-id="c1889-120">**Azure Load Balancer**.</span></span> <span data-ttu-id="c1889-121">Il [servizio di bilanciamento del carico] distribuisce le richieste Internet in ingresso alle istanze delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-121">The [load balancer] distributes incoming Internet requests to the VM instances.</span></span> 
* <span data-ttu-id="c1889-122">**Indirizzo IP pubblico**.</span><span class="sxs-lookup"><span data-stu-id="c1889-122">**Public IP address**.</span></span> <span data-ttu-id="c1889-123">Affinché il servizio di bilanciamento del carico possa ricevere il traffico Internet, è richiesto un indirizzo IP pubblico.</span><span class="sxs-lookup"><span data-stu-id="c1889-123">A public IP address is needed for the load balancer to receive Internet traffic.</span></span>
* <span data-ttu-id="c1889-124">**Set di scalabilità di macchine virtuali**.</span><span class="sxs-lookup"><span data-stu-id="c1889-124">**VM scale set**.</span></span> <span data-ttu-id="c1889-125">Un [set di scalabilità di macchine virtuali][vm-scaleset] è un set di macchine virtuali identiche usato per ospitare un carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c1889-125">A [VM scale set][vm-scaleset] is a set of identical VMs used to host a workload.</span></span> <span data-ttu-id="c1889-126">I set di scalabilità consentono di aumentare o ridurre il numero di istanze delle macchine virtuali manualmente o in base a regole predefinite.</span><span class="sxs-lookup"><span data-stu-id="c1889-126">Scale sets allow the number of VMs to be scaled in or out manually, or based on predefined rules.</span></span>
* <span data-ttu-id="c1889-127">**Set di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="c1889-127">**Availability set**.</span></span> <span data-ttu-id="c1889-128">Il [set di disponibilità][availability set] include le macchine virtuali, rendendole idonee per un [contratto di servizio (SLA)][vm-sla] superiore.</span><span class="sxs-lookup"><span data-stu-id="c1889-128">The [availability set][availability set] contains the VMs, making the VMs eligible for a higher [service level agreement (SLA)][vm-sla].</span></span> <span data-ttu-id="c1889-129">Per consentire l'applicazione del contratto di servizio superiore, il set di disponibilità deve includere almeno due macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-129">For the higher SLA to apply, the availability set must include a minimum of two VMs.</span></span> <span data-ttu-id="c1889-130">I set di disponibilità sono impliciti nei set di scalabilità.</span><span class="sxs-lookup"><span data-stu-id="c1889-130">Availability sets are implicit in scale sets.</span></span> <span data-ttu-id="c1889-131">Se si creano macchine virtuali al di fuori di un set di scalabilità, è necessario creare il set di disponibilità in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="c1889-131">If you create VMs outside a scale set, you need to create the availability set independently.</span></span>
* <span data-ttu-id="c1889-132">**Dischi gestiti**.</span><span class="sxs-lookup"><span data-stu-id="c1889-132">**Managed disks**.</span></span> <span data-ttu-id="c1889-133">Il servizio Azure Managed Disks gestisce i file di disco rigido virtuale (VHD) per i dischi delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-133">Azure Managed Disks manage the virtual hard disk (VHD) files for the VM disks.</span></span> 
* <span data-ttu-id="c1889-134">**Archiviazione**.</span><span class="sxs-lookup"><span data-stu-id="c1889-134">**Storage**.</span></span> <span data-ttu-id="c1889-135">Creare un account di archiviazione di Azure per contenere i log di diagnostica per le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-135">Create an Azure Storage acount to hold diagnostic logs for the VMs.</span></span>

## <a name="recommendations"></a><span data-ttu-id="c1889-136">Raccomandazioni</span><span class="sxs-lookup"><span data-stu-id="c1889-136">Recommendations</span></span>

<span data-ttu-id="c1889-137">I requisiti della propria organizzazione potrebbero essere diversi da quelli dell'architettura descritta in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="c1889-137">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="c1889-138">Usare queste indicazioni come punto di partenza.</span><span class="sxs-lookup"><span data-stu-id="c1889-138">Use these recommendations as a starting point.</span></span> 

### <a name="availability-and-scalability-recommendations"></a><span data-ttu-id="c1889-139">Raccomandazioni per la disponibilità e la scalabilità</span><span class="sxs-lookup"><span data-stu-id="c1889-139">Availability and scalability recommendations</span></span>

<span data-ttu-id="c1889-140">Un'opzione per la disponibilità e la scalabilità consiste nell'usare un [set di scalabilità di macchine virtuali][vmss].</span><span class="sxs-lookup"><span data-stu-id="c1889-140">An option for availability and scalability is to use a [virtual machine scale set][vmss].</span></span> <span data-ttu-id="c1889-141">I set di scalabilità di macchine virtuali consentono di distribuire e gestire un set di macchine virtuali identiche.</span><span class="sxs-lookup"><span data-stu-id="c1889-141">VM scale sets help you to deploy and manage a set of identical VMs.</span></span> <span data-ttu-id="c1889-142">I set di scalabilità supportano il ridimensionamento automatico in base alle metriche delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="c1889-142">Scale sets support autoscaling based on performance metrics.</span></span> <span data-ttu-id="c1889-143">Di pari passo con l'aumento del carico sulle macchine virtuali, vengono aggiunte automaticamente altre macchine virtuali al servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c1889-143">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="c1889-144">Prendere in considerazione i set di scalabilità se è necessario aumentare rapidamente le istanze delle macchine virtuali o se si necessita del ridimensionamento automatico.</span><span class="sxs-lookup"><span data-stu-id="c1889-144">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="c1889-145">Per impostazione predefinita, i set di scalabilità usano il "provisioning eccessivo", ovvero inizialmente il set di scalabilità esegue il provisioning di un numero di macchine virtuali maggiore di quello richiesto e quindi elimina le macchine virtuali aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="c1889-145">By default, scale sets use "overprovisioning," which means the scale set initially provisions more VMs than you ask for, then deletes the extra VMs.</span></span> <span data-ttu-id="c1889-146">Ciò migliora la percentuale di successo complessiva durante il provisioning delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-146">This improves the overall success rate when provisioning the VMs.</span></span> <span data-ttu-id="c1889-147">Se non si usano [dischi gestiti](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-managed-disks), si consigliano non più di 20 macchine virtuali per account di archiviazione con provisioning eccessivo abilitato o non più di 40 macchine virtuali con provisioning eccessivo disabilitato.</span><span class="sxs-lookup"><span data-stu-id="c1889-147">If you are not using [managed disks](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-managed-disks), we recommend no more than 20 VMs per storage account with overprovisioning enabled, or no more than 40 VMs with overprovisioning disabled.</span></span>

<span data-ttu-id="c1889-148">Esistono due modi per configurare le macchine virtuali distribuite in un set di scalabilità:</span><span class="sxs-lookup"><span data-stu-id="c1889-148">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="c1889-149">Usare le estensioni per configurare la macchina virtuale dopo il provisioning.</span><span class="sxs-lookup"><span data-stu-id="c1889-149">Use extensions to configure the VM after it is provisioned.</span></span> <span data-ttu-id="c1889-150">Con questo approccio, le nuove istanze delle macchine virtuali possono richiedere più tempo per l'avvio di una macchina virtuale senza estensioni.</span><span class="sxs-lookup"><span data-stu-id="c1889-150">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="c1889-151">Distribuire un [disco gestito](/azure/storage/storage-managed-disks-overview) con un'immagine del disco personalizzata.</span><span class="sxs-lookup"><span data-stu-id="c1889-151">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="c1889-152">Questa opzione può risultare più veloce da distribuire.</span><span class="sxs-lookup"><span data-stu-id="c1889-152">This option may be quicker to deploy.</span></span> <span data-ttu-id="c1889-153">Tuttavia, richiede che l'immagine sia mantenuta aggiornata.</span><span class="sxs-lookup"><span data-stu-id="c1889-153">However, it requires you to keep the image up to date.</span></span>

<span data-ttu-id="c1889-154">Per altre considerazioni, vedere [Considerazioni sulla progettazione per i set di scalabilità][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="c1889-154">For additional considerations, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="c1889-155">Quando si usa una soluzione di ridimensionamento automatico, occorre testarla in anticipo con carichi di lavoro a livello di produzione.</span><span class="sxs-lookup"><span data-stu-id="c1889-155">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="c1889-156">Se non si usa un set di scalabilità, prendere in considerazione almeno l'uso di un set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c1889-156">If you do not use a scale set, consider at least using an availability set.</span></span> <span data-ttu-id="c1889-157">Creare almeno due macchine virtuali nel set di disponibilità in modo da supportare il [contratto di servizio relativo alla disponibilità per le macchine virtuali di Azure][vm-sla].</span><span class="sxs-lookup"><span data-stu-id="c1889-157">Create at least two VMs in the availability set, to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="c1889-158">Azure Load Balancer richiede inoltre che le macchine virtuali con carico bilanciato appartengano allo stesso set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="c1889-158">The Azure load balancer also requires that load-balanced VMs belong to the same availability set.</span></span>

<span data-ttu-id="c1889-159">Ogni sottoscrizione di Azure ha limiti predefiniti, tra cui il numero massimo di macchine virtuali per area.</span><span class="sxs-lookup"><span data-stu-id="c1889-159">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="c1889-160">È possibile aumentare il limite presentando una richiesta di supporto.</span><span class="sxs-lookup"><span data-stu-id="c1889-160">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="c1889-161">Per altre informazioni, vedere [Sottoscrizione di Azure e limiti, quote e vincoli dei servizi][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="c1889-161">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

### <a name="network-recommendations"></a><span data-ttu-id="c1889-162">Indicazioni per la rete</span><span class="sxs-lookup"><span data-stu-id="c1889-162">Network recommendations</span></span>

<span data-ttu-id="c1889-163">Posizionare le macchine virtuali all'interno della stessa subnet.</span><span class="sxs-lookup"><span data-stu-id="c1889-163">Place the VMs within the same subnet.</span></span> <span data-ttu-id="c1889-164">Non esporre le macchine virtuali direttamente su Internet, ma assegnare un indirizzo IP privato a ogni macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c1889-164">Do not expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="c1889-165">I client si connettono usando l'indirizzo IP pubblico del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c1889-165">Clients connect using the public IP address of the load balancer.</span></span>

<span data-ttu-id="c1889-166">Se è necessario accedere alle macchine virtuali dietro al servizio di bilanciamento del carico, prendere in considerazione l'aggiunta di una singola macchina virtuale come bastion host/jumpbox con un indirizzo IP pubblico a cui è possibile effettuare l'accesso.</span><span class="sxs-lookup"><span data-stu-id="c1889-166">If you need to log into the VMs behind the load balancer, consider adding a single VM as a bastion host/jumpbox with a public IP address you can log into.</span></span> <span data-ttu-id="c1889-167">Accedere quindi alle macchine virtuali dietro al servizio di bilanciamento del carico dal jumpbox.</span><span class="sxs-lookup"><span data-stu-id="c1889-167">And then log into the VMs behind the load balancer from the jumpbox.</span></span> <span data-ttu-id="c1889-168">In alternativa, è possibile configurare le regole NAT in ingresso nel servizio di bilanciamento del carico per lo stesso scopo.</span><span class="sxs-lookup"><span data-stu-id="c1889-168">Alternatively, configure inbound NAT rules in the load balancer for the same purpose.</span></span> <span data-ttu-id="c1889-169">Tuttavia, un jumpbox è la soluzione migliore quando si ospitano carichi di lavoro a più livelli o più carichi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="c1889-169">However, having a jumpbox is a better solution when you are hosting n-tier workloads, or multiple workloads.</span></span>

### <a name="load-balancer-recommendations"></a><span data-ttu-id="c1889-170">Raccomandazioni per il servizio di bilanciamento del carico</span><span class="sxs-lookup"><span data-stu-id="c1889-170">Load balancer recommendations</span></span>

<span data-ttu-id="c1889-171">Aggiungere tutte le macchine virtuali nel set di disponibilità al pool di indirizzi back-end del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c1889-171">Add all VMs in the availability set to the back-end address pool of the load balancer.</span></span>

<span data-ttu-id="c1889-172">Definire regole di bilanciamento del carico per indirizzare il traffico di rete alle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-172">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="c1889-173">Ad esempio, per consentire il traffico HTTP, creare una regola che esegua il mapping della porta 80 dalla configurazione front-end alla porta 80 sul pool di indirizzi back-end.</span><span class="sxs-lookup"><span data-stu-id="c1889-173">For example, to enable HTTP traffic, create a rule that maps port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="c1889-174">Quando un client invia una richiesta HTTP alla porta 80, il servizio di bilanciamento del carico consente di selezionare un indirizzo IP back-end usando un [algoritmo di hash][load balancer hashing] che include l'indirizzo IP di origine.</span><span class="sxs-lookup"><span data-stu-id="c1889-174">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load balancer hashing] that includes the source IP address.</span></span> <span data-ttu-id="c1889-175">In tal modo, le richieste client vengono distribuite tra tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-175">In that way, client requests are distributed across all the VMs.</span></span>

<span data-ttu-id="c1889-176">Per indirizzare il traffico a una macchina virtuale specifica, usare le regole NAT.</span><span class="sxs-lookup"><span data-stu-id="c1889-176">To route traffic to a specific VM, use NAT rules.</span></span> <span data-ttu-id="c1889-177">Ad esempio, per abilitare RDP per le macchine virtuali, creare una regola NAT distinta per ogni macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c1889-177">For example, to enable RDP to the VMs, create a separate NAT rule for each VM.</span></span> <span data-ttu-id="c1889-178">Ogni regola dovrebbe eseguire il mapping di un numero di porta distinto alla porta 3389, la porta predefinita per RDP.</span><span class="sxs-lookup"><span data-stu-id="c1889-178">Each rule should map a distinct port number to port 3389, the default port for RDP.</span></span> <span data-ttu-id="c1889-179">Ad esempio, usare la porta 50001 per "VM1", la porta 50002 per "VM2" e così via.</span><span class="sxs-lookup"><span data-stu-id="c1889-179">For example, use port 50001 for "VM1," port 50002 for "VM2," and so on.</span></span> <span data-ttu-id="c1889-180">Assegnare le regole NAT alle schede di interfaccia di rete nelle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-180">Assign the NAT rules to the NICs on the VMs.</span></span>

### <a name="storage-account-recommendations"></a><span data-ttu-id="c1889-181">Raccomandazioni per gli account di archiviazione</span><span class="sxs-lookup"><span data-stu-id="c1889-181">Storage account recommendations</span></span>

<span data-ttu-id="c1889-182">Creare account di archiviazione di Azure distinti per ogni macchina virtuale per contenere i dischi rigidi virtuali, in modo da evitare di raggiungere i [limiti di operazioni di input/output al secondo][vm-disk-limits] per gli account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1889-182">Create separate Azure storage accounts for each VM to hold the virtual hard disks (VHDs), in order to avoid hitting the input/output operations per second [(IOPS) limits][vm-disk-limits] for storage accounts.</span></span>

<span data-ttu-id="c1889-183">Si consiglia l'uso di [dischi gestiti](/azure/storage/storage-managed-disks-overview) con [archiviazione Premium][premium].</span><span class="sxs-lookup"><span data-stu-id="c1889-183">We recommend the use of [managed disks](/azure/storage/storage-managed-disks-overview) with [premium storage][premium].</span></span> <span data-ttu-id="c1889-184">I dischi gestiti non richiedono un account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="c1889-184">Managed disks do not require a storage account.</span></span> <span data-ttu-id="c1889-185">Basta specificare le dimensioni e il tipo di disco per distribuirlo in modalità a disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="c1889-185">You simply specify the size and type of disk and it is deployed in a highly available way.</span></span>

<span data-ttu-id="c1889-186">Creare un account di archiviazione per i log di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="c1889-186">Create one storage account for diagnostic logs.</span></span> <span data-ttu-id="c1889-187">Questo account di archiviazione può essere condiviso da tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-187">This storage account can be shared by all the VMs.</span></span> <span data-ttu-id="c1889-188">Può trattarsi di un account di archiviazione non gestito basato sull'uso di dischi standard.</span><span class="sxs-lookup"><span data-stu-id="c1889-188">This can be an unmanaged storage account using standard disks.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="c1889-189">Considerazioni sulla disponibilità</span><span class="sxs-lookup"><span data-stu-id="c1889-189">Availability considerations</span></span>

<span data-ttu-id="c1889-190">Il set di disponibilità rende l'applicazione più resiliente agli eventi di manutenzione pianificata e non pianificata.</span><span class="sxs-lookup"><span data-stu-id="c1889-190">The availability set makes your application more resilient to both planned and unplanned maintenance events.</span></span>

* <span data-ttu-id="c1889-191">La *manutenzione pianificata* si verifica quando Microsoft aggiorna la piattaforma sottostante, causando talvolta il riavvio delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-191">*Planned maintenance* occurs when Microsoft updates the underlying platform, sometimes causing VMs to be restarted.</span></span> <span data-ttu-id="c1889-192">Azure garantisce che le macchine virtuali in un set di disponibilità non siano tutte riavviate nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="c1889-192">Azure makes sure the VMs in an availability set are not all restarted at the same time.</span></span> <span data-ttu-id="c1889-193">Almeno una viene mantenuta in esecuzione mentre le altre si riavviano.</span><span class="sxs-lookup"><span data-stu-id="c1889-193">At least one is kept running while others are restarting.</span></span>
* <span data-ttu-id="c1889-194">La *manutenzione non pianificata* ha luogo se si verifica un errore hardware.</span><span class="sxs-lookup"><span data-stu-id="c1889-194">*Unplanned maintenance* happens if there is a hardware failure.</span></span> <span data-ttu-id="c1889-195">Azure garantisce che sia eseguito il provisioning delle macchine virtuali in un set di disponibilità tra più rack di server.</span><span class="sxs-lookup"><span data-stu-id="c1889-195">Azure makes sure that VMs in an availability set are provisioned across more than one server rack.</span></span> <span data-ttu-id="c1889-196">Ciò consente di ridurre l'impatto di errori hardware, interruzioni di rete, interruzioni di alimentazione e così via.</span><span class="sxs-lookup"><span data-stu-id="c1889-196">This helps to reduce the impact of hardware failures, network outages, power interruptions, and so on.</span></span>

<span data-ttu-id="c1889-197">Per altre informazioni, vedere [Gestire la disponibilità delle macchine virtuali][availability set].</span><span class="sxs-lookup"><span data-stu-id="c1889-197">For more information, see [Manage the availability of virtual machines][availability set].</span></span> <span data-ttu-id="c1889-198">Il video seguente offre inoltre una valida panoramica dei set di disponibilità: [How Do I Configure an Availability Set to Scale VMs][availability set ch9] (Come configurare un set di disponibilità per ridimensionare le macchine virtuali).</span><span class="sxs-lookup"><span data-stu-id="c1889-198">The following video also has a good overview of availability sets: [How Do I Configure an Availability Set to Scale VMs][availability set ch9].</span></span>

> [!WARNING]
> <span data-ttu-id="c1889-199">Assicurarsi di configurare il set di disponibilità quando si esegue il provisioning della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c1889-199">Make sure to configure the availability set when you provision the VM.</span></span> <span data-ttu-id="c1889-200">Attualmente, non è possibile aggiungere una macchina virtuale di Gestione risorse a un set di disponibilità dopo che è stato eseguito il provisioning della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c1889-200">Currently, there is no way to add a Resource Manager VM to an availability set after the VM is provisioned.</span></span>

<span data-ttu-id="c1889-201">Il servizio di bilanciamento del carico usa i [probe di integrità] per monitorare la disponibilità delle istanze delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-201">The load balancer uses [health probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="c1889-202">Se un probe non riesce a raggiungere un'istanza entro il periodo di timeout, il bilanciamento del carico interrompe l'invio di traffico a quella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c1889-202">If a probe cannot reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="c1889-203">Tuttavia, il servizio di bilanciamento del carico continuerà a eseguire la verifica e, se la macchina virtuale diventa nuovamente disponibile, il servizio di bilanciamento del carico riprenderà a inviare il traffico a quella macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="c1889-203">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="c1889-204">Ecco alcune raccomandazioni per i probe di integrità del servizio di bilanciamento del carico:</span><span class="sxs-lookup"><span data-stu-id="c1889-204">Here are some recommendations on load balancer health probes:</span></span>

* <span data-ttu-id="c1889-205">I probe possono testare protocolli HTTP o TCP.</span><span class="sxs-lookup"><span data-stu-id="c1889-205">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="c1889-206">Se le macchine virtuali eseguono un server HTTP, creare un probe HTTP.</span><span class="sxs-lookup"><span data-stu-id="c1889-206">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="c1889-207">In caso contrario, creare un probe TCP.</span><span class="sxs-lookup"><span data-stu-id="c1889-207">Otherwise create a TCP probe.</span></span>
* <span data-ttu-id="c1889-208">Per un probe HTTP, specificare il percorso di un endpoint HTTP.</span><span class="sxs-lookup"><span data-stu-id="c1889-208">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="c1889-209">Il probe controlla una risposta HTTP 200 da questo percorso.</span><span class="sxs-lookup"><span data-stu-id="c1889-209">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="c1889-210">Può trattarsi del percorso radice ("/") o di un endpoint di monitoraggio dell'integrità che implementa una logica personalizzata per controllare l'integrità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c1889-210">This can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="c1889-211">L'endpoint deve consentire richieste HTTP anonime.</span><span class="sxs-lookup"><span data-stu-id="c1889-211">The endpoint must allow anonymous HTTP requests.</span></span>
* <span data-ttu-id="c1889-212">Il probe viene inviato da un indirizzo IP [noto][health-probe-ip], 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="c1889-212">The probe is sent from a [known][health-probe-ip] IP address, 168.63.129.16.</span></span> <span data-ttu-id="c1889-213">Assicurarsi di non bloccare il traffico da o verso questo indirizzo IP in eventuali criteri del firewall o regole del gruppo di sicurezza di rete.</span><span class="sxs-lookup"><span data-stu-id="c1889-213">Make sure you don't block traffic to or from this IP in any firewall policies or network security group (NSG) rules.</span></span>
* <span data-ttu-id="c1889-214">Usare i [log dei probe di integrità][health probe log] per visualizzare lo stato dei probe di integrità.</span><span class="sxs-lookup"><span data-stu-id="c1889-214">Use [health probe logs][health probe log] to view the status of the health probes.</span></span> <span data-ttu-id="c1889-215">Abilitare la registrazione nel portale di Azure per ogni servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="c1889-215">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="c1889-216">I log vengono scritti in Archiviazione BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="c1889-216">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="c1889-217">Il log mostra il numero di macchine virtuali sul back-end che non ricevono traffico di rete a causa di risposte del probe non riuscite.</span><span class="sxs-lookup"><span data-stu-id="c1889-217">The logs show how many VMs on the back end are not receiving network traffic due to failed probe responses.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="c1889-218">Considerazioni sulla gestibilità</span><span class="sxs-lookup"><span data-stu-id="c1889-218">Manageability considerations</span></span>

<span data-ttu-id="c1889-219">Con più macchine virtuali, è importante automatizzare i processi in modo che siano ripetibili e affidabili.</span><span class="sxs-lookup"><span data-stu-id="c1889-219">With multiple VMs, it is important to automate processes so they are reliable and repeatable.</span></span> <span data-ttu-id="c1889-220">È possibile usare [Automazione di Azure][azure-automation] per automatizzare la distribuzione, l'applicazione di patch del sistema operativo e altre attività.</span><span class="sxs-lookup"><span data-stu-id="c1889-220">You can use [Azure Automation][azure-automation] to automate deployment, OS patching, and other tasks.</span></span> <span data-ttu-id="c1889-221">[Automazione di Azure][azure-automation] è un servizio di automazione basato su Windows PowerShell che può essere usato a questo scopo.</span><span class="sxs-lookup"><span data-stu-id="c1889-221">[Azure Automation][azure-automation] is an automation service based on Windows Powershell that can be used for this.</span></span> <span data-ttu-id="c1889-222">Script di automazione di esempio sono disponibili nella [raccolta di Runbook] su TechNet.</span><span class="sxs-lookup"><span data-stu-id="c1889-222">Example automation scripts are available from the [Runbook Gallery] on TechNet.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="c1889-223">Considerazioni relative alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="c1889-223">Security considerations</span></span>

<span data-ttu-id="c1889-224">Le reti virtuali sono un limite di isolamento del traffico in Azure.</span><span class="sxs-lookup"><span data-stu-id="c1889-224">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="c1889-225">Le macchine virtuali in una rete virtuale possono comunicare direttamente con quelle in una rete virtuale diversa.</span><span class="sxs-lookup"><span data-stu-id="c1889-225">VMs in one VNet cannot communicate directly to VMs in a different VNet.</span></span> <span data-ttu-id="c1889-226">Le macchine virtuali all'interno della stessa rete virtuale possono comunicare, a meno che non si creino [gruppi di sicurezza di rete][nsg] per limitare il traffico.</span><span class="sxs-lookup"><span data-stu-id="c1889-226">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="c1889-227">Per altre informazioni, vedere [Servizi cloud Microsoft e sicurezza di rete][network-security].</span><span class="sxs-lookup"><span data-stu-id="c1889-227">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="c1889-228">Per il traffico Internet in ingresso, le regole di bilanciamento del carico definiscono il tipo di traffico che può raggiungere il back-end.</span><span class="sxs-lookup"><span data-stu-id="c1889-228">For incoming Internet traffic, the load balancer rules define which traffic can reach the back end.</span></span> <span data-ttu-id="c1889-229">Tuttavia, le regole di bilanciamento del carico non supportano gli elenchi di indirizzi IP attendibili, pertanto se si vogliono aggiungere determinati indirizzi IP pubblici a un elenco di indirizzi attendibili, aggiungere un gruppo di sicurezza di rete alla subnet.</span><span class="sxs-lookup"><span data-stu-id="c1889-229">However, load balancer rules don't support IP safe lists, so if you want to add certain public IP addresses to a safe list, add an NSG to the subnet.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="c1889-230">Distribuire la soluzione</span><span class="sxs-lookup"><span data-stu-id="c1889-230">Deploy the solution</span></span>

<span data-ttu-id="c1889-231">Una distribuzione di questa architettura è disponibile in [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="c1889-231">A deployment for this architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="c1889-232">Ecco cosa viene distribuito:</span><span class="sxs-lookup"><span data-stu-id="c1889-232">It deploys the following:</span></span>

  * <span data-ttu-id="c1889-233">Una rete virtuale con una sola subnet denominata **Web** e usata come host delle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-233">A virtual network with a single subnet named **web** used to host the VMs.</span></span>
  * <span data-ttu-id="c1889-234">Un set di scalabilità di macchine virtuali contenenti macchine virtuali che eseguono la versione più recente di Windows Server 2016 Datacenter Edition.</span><span class="sxs-lookup"><span data-stu-id="c1889-234">A VM scale set that contains VMs running the latest version of Windows Server 2016 Datacenter Edition.</span></span> <span data-ttu-id="c1889-235">Il ridimensionamento automatico è abilitato.</span><span class="sxs-lookup"><span data-stu-id="c1889-235">Autoscale is enabled.</span></span>
  * <span data-ttu-id="c1889-236">Un servizio di bilanciamento del carico posizionato davanti al set di scalabilità di macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-236">A load balancer that sits in front of the VM scale set.</span></span>
  * <span data-ttu-id="c1889-237">Un gruppo di sicurezza di rete con regole in ingresso per consentire il traffico HTTP al set di scalabilità di macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="c1889-237">An NSG with incoming rules to allow HTTP traffic to the VM scale set.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="c1889-238">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="c1889-238">Prerequisites</span></span>

<span data-ttu-id="c1889-239">Prima di poter distribuire l'architettura di riferimento nella propria sottoscrizione, è necessario eseguire i passaggi seguenti.</span><span class="sxs-lookup"><span data-stu-id="c1889-239">Before you can deploy the reference architecture to your own subscription, you must perform the following steps.</span></span>

1. <span data-ttu-id="c1889-240">Clonare, creare una copia tramite fork o scaricare il file ZIP per il repository GitHub delle [architetture di riferimento AzureCAT][ref-arch-repo].</span><span class="sxs-lookup"><span data-stu-id="c1889-240">Clone, fork, or download the zip file for the [AzureCAT reference architectures][ref-arch-repo] GitHub repository.</span></span>

2. <span data-ttu-id="c1889-241">Verificare che nel computer sia installata l'interfaccia della riga di comando di Azure 2.0.</span><span class="sxs-lookup"><span data-stu-id="c1889-241">Make sure you have the Azure CLI 2.0 installed on your computer.</span></span> <span data-ttu-id="c1889-242">Per installare l'interfaccia della riga di comando, seguire le istruzioni in [Installare l'interfaccia della riga di comando di Azure 2.0][azure-cli-2].</span><span class="sxs-lookup"><span data-stu-id="c1889-242">To install the CLI, follow the instructions in [Install Azure CLI 2.0][azure-cli-2].</span></span>

3. <span data-ttu-id="c1889-243">Installare il pacchetto npm dei [blocchi predefiniti di Azure][azbb].</span><span class="sxs-lookup"><span data-stu-id="c1889-243">Install the [Azure building blocks][azbb] npm package.</span></span>

4. <span data-ttu-id="c1889-244">Da un prompt dei comandi, di Bash o di PowerShell accedere al proprio account di Azure usando uno dei comandi riportati di seguito e seguire le istruzioni.</span><span class="sxs-lookup"><span data-stu-id="c1889-244">From a command prompt, bash prompt, or PowerShell prompt, login to your Azure account by using one of the commands below, and follow the prompts.</span></span>

  ```bash
  az login
  ```

### <a name="deploy-the-solution-using-azbb"></a><span data-ttu-id="c1889-245">Distribuire la soluzione mediante azbb</span><span class="sxs-lookup"><span data-stu-id="c1889-245">Deploy the solution using azbb</span></span>

<span data-ttu-id="c1889-246">Per distribuire il carico di lavoro della singola macchina virtuale di esempio, eseguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="c1889-246">To deploy the sample single VM workload, follow these steps:</span></span>

1. <span data-ttu-id="c1889-247">Passare alla cartella `virtual-machines\multi-vm\parameters\windows` per il repository scaricato nel passaggio dei prerequisiti precedente.</span><span class="sxs-lookup"><span data-stu-id="c1889-247">Navigate to the `virtual-machines\multi-vm\parameters\windows` folder for the repository you downloaded in the pre-requisites step above.</span></span>

2. <span data-ttu-id="c1889-248">Aprire il file `multi-vm-v2.json` e immettere un nome utente e una password tra virgolette, come illustrato di seguito, quindi salvare il file.</span><span class="sxs-lookup"><span data-stu-id="c1889-248">Open the `multi-vm-v2.json` file and enter a username and password between the quotes, as shown below, then save the file.</span></span>

  ```bash
  "adminUsername": "",
  "adminPassword": "",
  ```

3. <span data-ttu-id="c1889-249">Eseguire `azbb` per distribuire le macchine virtuali, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="c1889-249">Run `azbb` to deploy the VMs as shown below.</span></span>

  ```bash
  azbb -s <subscription_id> -g <resource_group_name> -l <location> -p multi-vm-v2.json --deploy
  ```

<span data-ttu-id="c1889-250">Per altre informazioni sulla distribuzione di questa architettura di riferimento di esempio, visitare il [repository GitHub][git].</span><span class="sxs-lookup"><span data-stu-id="c1889-250">For more information on deploying this sample reference architecture, visit our [GitHub repository][git].</span></span>

<!-- Links -->
[github-folder]: http://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[n-tier-linux]: ../virtual-machines-linux/n-tier.md
[n-tier-windows]: n-tier.md
[single vm]: single-vm.md
[premium]: /azure/storage/common/storage-premium-storage
[naming conventions]: /azure/guidance/guidance-naming-conventions
[vm-scaleset]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[availability set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[availability set ch9]: https://channel9.msdn.com/Series/Microsoft-Azure-Fundamentals-Virtual-Machines/08
[azure-automation]: https://azure.microsoft.com/documentation/services/automation/
[azure-cli]: /azure/virtual-machines-command-line-tools
[azure-automation]: /azure/automation/automation-intro
[bastion host]: https://en.wikipedia.org/wiki/Bastion_host
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm
[health probe log]: /azure/load-balancer/load-balancer-monitor-log
[probe di integrità]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[servizio di bilanciamento del carico]: /azure/load-balancer/load-balancer-get-started-internet-arm-cli
[load balancer hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[network-security]: /azure/best-practices-network-security
[nsg]: /azure/virtual-network/virtual-networks-nsg
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview 
[raccolta di Runbook]: /azure/automation/automation-runbook-gallery#runbooks-in-runbook-gallery
[subscription-limits]: /azure/azure-subscription-service-limits
[visio-download]: https://archcenter.azureedge.net/cdn/vm-reference-architectures.vsdx
[vm-disk-limits]: /azure/azure-subscription-service-limits#virtual-machine-disk-limits
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_2/
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[vmss-quickstart]: https://azure.microsoft.com/documentation/templates/?term=scale+set
[VM-sizes]: https://azure.microsoft.com/documentation/articles/virtual-machines-windows-sizes/
[0]: ./images/multi-vm-diagram.png "Architettura di una soluzione di più macchine virtuali in Azure che comprende un set di disponibilità con due macchine virtuali e un servizio di bilanciamento del carico"
[azure-cli-2]: /azure/install-azure-cli?view=azure-cli-latest
[azbb]: https://github.com/mspnp/template-building-blocks/wiki/Install-Template-Building-Blocks-Version-2-(Windows)
[git]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm