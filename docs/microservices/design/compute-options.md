# <a name="choosing-a-compute-option-for-microservices"></a><span data-ttu-id="739e1-101">Scegliendo un'opzione di calcolo per i microservizi</span><span class="sxs-lookup"><span data-stu-id="739e1-101">Choosing a compute option for microservices</span></span>

<span data-ttu-id="739e1-102">Il termine *calcolo* fa riferimento al modello di hosting per le risorse di calcolo in cui viene eseguita l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="739e1-102">The term *compute* refers to the hosting model for the computing resources that your application runs on.</span></span> <span data-ttu-id="739e1-103">Per un'architettura di microservizi sono particolarmente diffusi due approcci:</span><span class="sxs-lookup"><span data-stu-id="739e1-103">For a microservices architecture, two approaches are especially popular:</span></span>

- <span data-ttu-id="739e1-104">Un agente di orchestrazione dei servizi che gestisce i servizi in esecuzione in nodi dedicati (VM).</span><span class="sxs-lookup"><span data-stu-id="739e1-104">A service orchestrator that manages services running on dedicated nodes (VMs).</span></span>
- <span data-ttu-id="739e1-105">Un'architettura senza server che usa le funzioni come servizio (FaaS).</span><span class="sxs-lookup"><span data-stu-id="739e1-105">A serverless architecture using functions as a service (FaaS).</span></span>

<span data-ttu-id="739e1-106">Anche se queste non sono le uniche opzioni disponibili, si tratta di approcci comprovati alla creazione di microservizi.</span><span class="sxs-lookup"><span data-stu-id="739e1-106">While these aren't the only options, they are both proven approaches to building microservices.</span></span> <span data-ttu-id="739e1-107">Un'applicazione può includere entrambi gli approcci.</span><span class="sxs-lookup"><span data-stu-id="739e1-107">An application might include both approaches.</span></span>

## <a name="service-orchestrators"></a><span data-ttu-id="739e1-108">Agenti di orchestrazione dei servizi</span><span class="sxs-lookup"><span data-stu-id="739e1-108">Service orchestrators</span></span>

<span data-ttu-id="739e1-109">Un agente di orchestrazione gestisce attività correlate alla distribuzione e alla gestione di un set di servizi.</span><span class="sxs-lookup"><span data-stu-id="739e1-109">An orchestrator handles tasks related to deploying and managing a set of services.</span></span> <span data-ttu-id="739e1-110">Queste attività includono il posizionamento dei servizi nei nodi, il monitoraggio dell'integrità dei servizi, il riavvio dei servizi non integri, il bilanciamento del carico del traffico di rete tra istanze dei servizi, l'individuazione dei servizi, il ridimensionamento del numero di istanze di un servizio e l'applicazione degli aggiornamenti della configurazione.</span><span class="sxs-lookup"><span data-stu-id="739e1-110">These tasks include placing services on nodes, monitoring the health of services, restarting unhealthy services, load balancing network traffic across service instances, service discovery, scaling the number of instances of a service, and applying configuration updates.</span></span> <span data-ttu-id="739e1-111">Gli agenti di orchestrazione più diffusi includono Kubernetes, Service Fabric, DC/OS, e Docker Swarm.</span><span class="sxs-lookup"><span data-stu-id="739e1-111">Popular orchestrators include Kubernetes, Service Fabric, DC/OS, and Docker Swarm.</span></span>

<span data-ttu-id="739e1-112">Nella piattaforma Azure prendere in considerazione le opzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="739e1-112">On the Azure platform, consider the following options:</span></span>

- <span data-ttu-id="739e1-113">Il [servizio Azure Kubernetes](/azure/aks/) è un ambiente Kubernetes gestito.</span><span class="sxs-lookup"><span data-stu-id="739e1-113">[Azure Kubernetes Service](/azure/aks/) (AKS) is a managed Kubernetes service.</span></span> <span data-ttu-id="739e1-114">Il servizio Azure Container effettua il provisioning di Kubernetes ed espone gli endpoint delle API Kubernetes, ma ospita e gestisce il pannello di controllo di Kubernetes, eseguendo aggiornamenti automatici, applicazione di patch automatica, ridimensionamento automatico e altre attività di gestione.</span><span class="sxs-lookup"><span data-stu-id="739e1-114">AKS provisions Kubernetes and exposes the Kubernetes API endpoints, but hosts and manages the Kubernetes control plane, performing automated upgrades, automated patching, autoscaling, and other management tasks.</span></span> <span data-ttu-id="739e1-115">Il servizio Azure Container può essere considerato "API Kubernetes come servizio".</span><span class="sxs-lookup"><span data-stu-id="739e1-115">You can think of AKS as being "Kubernetes APIs as a service."</span></span>

- <span data-ttu-id="739e1-116">[Service Fabric](/azure/service-fabric/) è una piattaforma di sistemi distribuiti per la creazione di pacchetti, la distribuzione e la gestione di microservizi.</span><span class="sxs-lookup"><span data-stu-id="739e1-116">[Service Fabric](/azure/service-fabric/) is a distributed systems platform for packaging, deploying, and managing microservices.</span></span> <span data-ttu-id="739e1-117">I microservizi possono essere distribuiti in Service Fabric come contenitori, file binari eseguibili oppure come [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span><span class="sxs-lookup"><span data-stu-id="739e1-117">Microservices can be deployed to Service Fabric as containers, as binary executables, or as [Reliable Services](/azure/service-fabric/service-fabric-reliable-services-introduction).</span></span> <span data-ttu-id="739e1-118">Con il modello di programmazione di Reliable Services, i servizi possono usare direttamente le API di programmazione di Service Fabric per eseguire query sul sistema, creare report di integrità, ricevere notifiche relative a modifiche di configurazione e codice e individuare altri servizi.</span><span class="sxs-lookup"><span data-stu-id="739e1-118">Using the Reliable Services programming model, services can directly use Service Fabric programming APIs to query the system, report health, receive notifications about configuration and code changes, and discover other services.</span></span> <span data-ttu-id="739e1-119">Un fattore essenziale per la differenziazione di Service Fabric è la creazione di servizi con stato tramite [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span><span class="sxs-lookup"><span data-stu-id="739e1-119">A key differentiation with Service Fabric is its strong focus on building stateful services using [Reliable Collections](/azure/service-fabric/service-fabric-reliable-services-reliable-collections).</span></span>

- <span data-ttu-id="739e1-120">Altre opzioni, ad esempio Mesosphere DC/OS e Docker Enterprise Edition è possono eseguire in un ambiente IaaS in Azure.</span><span class="sxs-lookup"><span data-stu-id="739e1-120">Other options such as Docker Enterprise Edition and Mesosphere DC/OS can run in an IaaS environment on Azure.</span></span> <span data-ttu-id="739e1-121">È possibile trovare i modelli di distribuzione sul [Azure Marketplace](https://azuremarketplace.microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="739e1-121">You can find deployment templates on [Azure Marketplace](https://azuremarketplace.microsoft.com).</span></span>

## <a name="containers"></a><span data-ttu-id="739e1-122">Contenitori</span><span class="sxs-lookup"><span data-stu-id="739e1-122">Containers</span></span>

<span data-ttu-id="739e1-123">Talvolta si parla di contenitori e microservizi come se fossero sinonimi.</span><span class="sxs-lookup"><span data-stu-id="739e1-123">Sometimes people talk about containers and microservices as if they were the same thing.</span></span> <span data-ttu-id="739e1-124">Anche se ciò non corrisponde al vero &mdash; non sono necessari contenitori per creare microservizi&mdash; i contenitori offrono effettivamente alcuni vantaggi particolarmente significativi per i microservizi, tra cui:</span><span class="sxs-lookup"><span data-stu-id="739e1-124">While that's not true &mdash; you don't need containers to build microservices &mdash; containers do have some benefits that are particularly relevant to microservices, such as:</span></span>

- <span data-ttu-id="739e1-125">**Portabilità**.</span><span class="sxs-lookup"><span data-stu-id="739e1-125">**Portability**.</span></span> <span data-ttu-id="739e1-126">Un'immagine del contenitore è un pacchetto autonomo che viene eseguito senza dover installare librerie o altre dipendenze.</span><span class="sxs-lookup"><span data-stu-id="739e1-126">A container image is a standalone package that runs without needing to install libraries or other dependencies.</span></span> <span data-ttu-id="739e1-127">Ciò ne semplifica la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="739e1-127">That makes them easy to deploy.</span></span> <span data-ttu-id="739e1-128">I contenitori possono essere avviati e arrestati rapidamente, quindi è possibile creare nuove istanze per gestire un carico maggiore o eseguire il ripristino dopo un errore di nodo.</span><span class="sxs-lookup"><span data-stu-id="739e1-128">Containers can be started and stopped quickly, so you can spin up new instances to handle more load or to recover from node failures.</span></span>

- <span data-ttu-id="739e1-129">**Densità**.</span><span class="sxs-lookup"><span data-stu-id="739e1-129">**Density**.</span></span> <span data-ttu-id="739e1-130">I contenitori sono leggeri rispetto all'esecuzione di una macchina virtuale, perché condividono risorse del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="739e1-130">Containers are lightweight compared with running a virtual machine, because they share OS resources.</span></span> <span data-ttu-id="739e1-131">È quindi possibile riunire più contenitori in un singolo nodo, operazione particolarmente utile quando l'applicazione è costituita da molti servizi di piccole dimensioni.</span><span class="sxs-lookup"><span data-stu-id="739e1-131">That makes it possible to pack multiple containers onto a single node, which is especially useful when the application consists of many small services.</span></span>

- <span data-ttu-id="739e1-132">**Isolamento delle risorse**.</span><span class="sxs-lookup"><span data-stu-id="739e1-132">**Resource isolation**.</span></span> <span data-ttu-id="739e1-133">È possibile limitare la quantità di memoria e CPU disponibile per un contenitore, assicurando così che un processo con eccessivo tempo di esecuzione non esaurisca le risorse dell'host.</span><span class="sxs-lookup"><span data-stu-id="739e1-133">You can limit the amount of memory and CPU that is available to a container, which can help to ensure that a runaway process doesn't exhaust the host resources.</span></span> <span data-ttu-id="739e1-134">Per altre informazioni, vedere [Modello A scomparti](../../patterns/bulkhead.md).</span><span class="sxs-lookup"><span data-stu-id="739e1-134">See the [Bulkhead pattern](../../patterns/bulkhead.md) for more information.</span></span>

## <a name="serverless-functions-as-a-service"></a><span data-ttu-id="739e1-135">Senza server (funzioni come servizio)</span><span class="sxs-lookup"><span data-stu-id="739e1-135">Serverless (Functions as a Service)</span></span>

<span data-ttu-id="739e1-136">Con un'architettura [serverless](https://azure.microsoft.com/solutions/serverless/) non si gestiscono le macchine virtuali o l'infrastruttura di rete virtuale,</span><span class="sxs-lookup"><span data-stu-id="739e1-136">With a [serverless](https://azure.microsoft.com/solutions/serverless/) architecture, you don't manage the VMs or the virtual network infrastructure.</span></span> <span data-ttu-id="739e1-137">ma si distribuisce il codice e il servizio di hosting gestisce l'inserimento di tale codice in una VM e la relativa esecuzione.</span><span class="sxs-lookup"><span data-stu-id="739e1-137">Instead, you deploy code and the hosting service handles putting that code onto a VM and executing it.</span></span> <span data-ttu-id="739e1-138">Questo approccio tende a preferire piccole funzioni granulari coordinate tramite trigger basati su eventi.</span><span class="sxs-lookup"><span data-stu-id="739e1-138">This approach tends to favor small granular functions that are coordinated using event-based triggers.</span></span> <span data-ttu-id="739e1-139">Ad esempio, un messaggio inserito in una coda può attivare una funzione che legge la coda ed elabora il messaggio.</span><span class="sxs-lookup"><span data-stu-id="739e1-139">For example, a message being placed onto a queue might trigger a function that reads from the queue and processes the message.</span></span>

<span data-ttu-id="739e1-140">[Funzioni di Azure](/azure/azure-functions/) è un servizio di calcolo senza server che supporta diversi trigger di funzione, inclusi le richieste HTTP, le code del Bus di servizio e gli eventi di hub eventi.</span><span class="sxs-lookup"><span data-stu-id="739e1-140">[Azure Functions](/azure/azure-functions/) is a serverless compute service that supports various function triggers, including HTTP requests, Service Bus queues, and Event Hubs events.</span></span> <span data-ttu-id="739e1-141">Per un elenco completo, vedere [funzioni di Azure concetti di trigger e associazioni](/azure/azure-functions/functions-triggers-bindings).</span><span class="sxs-lookup"><span data-stu-id="739e1-141">For a complete list, see [Azure Functions triggers and bindings concepts](/azure/azure-functions/functions-triggers-bindings).</span></span> <span data-ttu-id="739e1-142">È anche consigliabile [griglia di eventi di Azure](/azure/event-grid/), ovvero un servizio di routing dell'evento gestito in Azure.</span><span class="sxs-lookup"><span data-stu-id="739e1-142">Also consider [Azure Event Grid](/azure/event-grid/), which is a managed event routing service in Azure.</span></span>

<!-- markdownlint-disable MD026 -->

## <a name="orchestrator-or-serverless"></a><span data-ttu-id="739e1-143">Agente di orchestrazione o senza server?</span><span class="sxs-lookup"><span data-stu-id="739e1-143">Orchestrator or serverless?</span></span>

<!-- markdownlint-enable MD026 -->

<span data-ttu-id="739e1-144">Ecco alcuni fattori da considerare nella scelta tra un approccio con agente di orchestrazione e un approccio senza server.</span><span class="sxs-lookup"><span data-stu-id="739e1-144">Here are some factors to consider when choosing between an orchestrator approach and a serverless approach.</span></span>

<span data-ttu-id="739e1-145">**Gestibilità**. Un'applicazione senza server è semplice da gestire perché la piattaforma gestisce automaticamente tutte le risorse di calcolo.</span><span class="sxs-lookup"><span data-stu-id="739e1-145">**Manageability** A serverless application is easy to manage, because the platform manages all the of compute resources for you.</span></span> <span data-ttu-id="739e1-146">Anche se l'agente di orchestrazione estrae alcuni aspetti della gestione e configurazione di un cluster, non nasconde completamente le macchine virtuali di sottostanti.</span><span class="sxs-lookup"><span data-stu-id="739e1-146">While an orchestrator abstracts some aspects of managing and configuring a cluster, it does not completely hide the underlying VMs.</span></span> <span data-ttu-id="739e1-147">Con un agente di orchestrazione è necessario tener conto di aspetti quali il bilanciamento del carico, l'utilizzo della CPU e la rete.</span><span class="sxs-lookup"><span data-stu-id="739e1-147">With an orchestrator, you will need to think about issues such as load balancing, CPU and memory usage, and networking.</span></span>

<span data-ttu-id="739e1-148">**Flessibilità e controllo**.</span><span class="sxs-lookup"><span data-stu-id="739e1-148">**Flexibility and control**.</span></span> <span data-ttu-id="739e1-149">Un agente di orchestrazione offre un elevato livello di controllo sulla configurazione e la gestione dei servizi e del cluster.</span><span class="sxs-lookup"><span data-stu-id="739e1-149">An orchestrator gives you a great deal of control over configuring and managing your services and the cluster.</span></span> <span data-ttu-id="739e1-150">Il compromesso è la maggiore complessità.</span><span class="sxs-lookup"><span data-stu-id="739e1-150">The tradeoff is additional complexity.</span></span> <span data-ttu-id="739e1-151">Con un'architettura senza server si rinuncia a parte del controllo perché questi dettagli vengono estratti.</span><span class="sxs-lookup"><span data-stu-id="739e1-151">With a serverless architecture, you give up some degree of control because these details are abstracted.</span></span>

<span data-ttu-id="739e1-152">**Portabilità**.</span><span class="sxs-lookup"><span data-stu-id="739e1-152">**Portability**.</span></span> <span data-ttu-id="739e1-153">Tutti gli agenti di orchestrazione qui elencati (Kubernetes, DC/OS, Docker Swarm e Service Fabric) possono essere eseguiti in locale oppure in più cloud pubblici.</span><span class="sxs-lookup"><span data-stu-id="739e1-153">All of the orchestrators listed here (Kubernetes, DC/OS, Docker Swarm, and Service Fabric) can run on-premises or in multiple public clouds.</span></span>

<span data-ttu-id="739e1-154">**Integrazione delle applicazioni**.</span><span class="sxs-lookup"><span data-stu-id="739e1-154">**Application integration**.</span></span> <span data-ttu-id="739e1-155">Può essere complicato creare un'applicazione complessa usando un'architettura senza server.</span><span class="sxs-lookup"><span data-stu-id="739e1-155">It can be challenging to build a complex application using a serverless architecture.</span></span> <span data-ttu-id="739e1-156">In Azure è possibile usare le [app per la logica di Azure](/azure/logic-apps/) per coordinare un set di Funzioni di Azure.</span><span class="sxs-lookup"><span data-stu-id="739e1-156">One option in Azure is to use [Azure Logic Apps](/azure/logic-apps/) to coordinate a set of Azure Functions.</span></span> <span data-ttu-id="739e1-157">Per un esempio di questo approccio, vedere [Creare una funzione che si integra con le app per la logica di Azure](/azure/azure-functions/functions-twitter-email).</span><span class="sxs-lookup"><span data-stu-id="739e1-157">For an example of this approach, see [Create a function that integrates with Azure Logic Apps](/azure/azure-functions/functions-twitter-email).</span></span>

<span data-ttu-id="739e1-158">**Costo**.</span><span class="sxs-lookup"><span data-stu-id="739e1-158">**Cost**.</span></span> <span data-ttu-id="739e1-159">Con un agente di orchestrazione si pagano le macchine virtuali in esecuzione nel cluster.</span><span class="sxs-lookup"><span data-stu-id="739e1-159">With an orchestrator, you pay for the VMs that are running in the cluster.</span></span> <span data-ttu-id="739e1-160">Con un'applicazione senza server si pagano solo le risorse di calcolo effettivamente utilizzate.</span><span class="sxs-lookup"><span data-stu-id="739e1-160">With a serverless application, you pay only for the actual compute resources consumed.</span></span> <span data-ttu-id="739e1-161">In entrambi i casi è necessario tener conto del costo di servizi aggiuntivi, ad esempio archiviazione, database e servizi di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="739e1-161">In both cases, you need to factor in the cost of any additional services, such as storage, databases, and messaging services.</span></span>

<span data-ttu-id="739e1-162">**Scalabilità**.</span><span class="sxs-lookup"><span data-stu-id="739e1-162">**Scalability**.</span></span> <span data-ttu-id="739e1-163">Funzioni di Azure si ridimensiona automaticamente per soddisfare le richieste, in base al numero di eventi in ingresso.</span><span class="sxs-lookup"><span data-stu-id="739e1-163">Azure Functions scales automatically to meet demand, based on the number of incoming events.</span></span> <span data-ttu-id="739e1-164">Con un agente di orchestrazione è possibile aumentare il numero di istanze del servizio in esecuzione nel cluster.</span><span class="sxs-lookup"><span data-stu-id="739e1-164">With an orchestrator, you can scale out by increasing the number of service instances running in the cluster.</span></span> <span data-ttu-id="739e1-165">È anche possibile aumentare il numero di istanze aggiungendo macchine virtuali al cluster.</span><span class="sxs-lookup"><span data-stu-id="739e1-165">You can also scale by adding additional VMs to the cluster.</span></span>

<span data-ttu-id="739e1-166">L'implementazione di riferimento usa principalmente Kubernetes, ma è stato usato Funzioni di Azure per un servizio, ovvero il servizio cronologia di recapito.</span><span class="sxs-lookup"><span data-stu-id="739e1-166">Our reference implementation primarily uses Kubernetes, but we did use Azure Functions for one service, namely the Delivery History service.</span></span> <span data-ttu-id="739e1-167">Funzioni di Azure era un'ottima soluzione per questo particolare servizio, perché si tratta di un carico di lavoro basato su eventi.</span><span class="sxs-lookup"><span data-stu-id="739e1-167">Azure Functions was a good fit for this particular service, because it's is an event-driven workload.</span></span> <span data-ttu-id="739e1-168">Usando un trigger di Hub eventi per richiamare la funzione, per il servizio è stata necessaria una quantità di codice minima.</span><span class="sxs-lookup"><span data-stu-id="739e1-168">By using an Event Hubs trigger to invoke the function, the service needed a minimal amount of code.</span></span> <span data-ttu-id="739e1-169">Il servizio cronologia di recapito non fa parte del flusso di lavoro principale, quindi la sua esecuzione all'esterno del cluster Kubernetes non influisce sulla latenza end-to-end delle operazioni avviate dall'utente.</span><span class="sxs-lookup"><span data-stu-id="739e1-169">Also, the Delivery History service is not part of the main workflow, so running it outside of the Kubernetes cluster doesn't affect the end-to-end latency of user-initiated operations.</span></span>

## <a name="next-steps"></a><span data-ttu-id="739e1-170">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="739e1-170">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="739e1-171">Comunicazione tra i servizi</span><span class="sxs-lookup"><span data-stu-id="739e1-171">Interservice communication</span></span>](./interservice-communication.md)
