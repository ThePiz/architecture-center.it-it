---
title: Analisi del dominio per i microservizi
description: Analisi del dominio per i microservizi.
author: MikeWasson
ms.date: 10/23/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: cc265aabf401f56a1a81a630e143b2c59986a8e2
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/23/2019
ms.locfileid: "54482716"
---
# <a name="designing-microservices-domain-analysis"></a><span data-ttu-id="b0d74-103">Progettazione di microservizi: Analisi del dominio</span><span class="sxs-lookup"><span data-stu-id="b0d74-103">Designing microservices: Domain analysis</span></span>

<span data-ttu-id="b0d74-104">Una delle principali problematiche dei microservizi consiste nel definire i limiti dei singoli servizi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-104">One of the biggest challenges of microservices is to define the boundaries of individual services.</span></span> <span data-ttu-id="b0d74-105">La regola generale è che un servizio deve svolgere "un compito", ma mettere in pratica questa regola richiede particolare attenzione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-105">The general rule is that a service should do "one thing" &mdash; but putting that rule into practice requires careful thought.</span></span> <span data-ttu-id="b0d74-106">Non esistono processi meccanici in grado di generare la progettazione "corretta".</span><span class="sxs-lookup"><span data-stu-id="b0d74-106">There is no mechanical process that will produce the "right" design.</span></span> <span data-ttu-id="b0d74-107">È necessario valutare attentamente il dominio, i requisiti e gli obiettivi aziendali.</span><span class="sxs-lookup"><span data-stu-id="b0d74-107">You have to think deeply about your business domain, requirements, and goals.</span></span> <span data-ttu-id="b0d74-108">In caso contrario, si potrebbe ottenere una progettazione casuale con caratteristiche non desiderate, ad esempio dipendenze nascoste tra servizi, accoppiamento rigido o interfacce con una progettazione di bassa qualità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-108">Otherwise, you can end up with a haphazard design that exhibits some undesirable characteristics, such as hidden dependencies between services, tight coupling, or poorly designed interfaces.</span></span> <span data-ttu-id="b0d74-109">In questo capitolo verrà illustrato l'approccio basato su dominio alla progettazione di microservizi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-109">In this chapter, we take a domain-driven approach to designing microservices.</span></span>

<span data-ttu-id="b0d74-110">I microservizi devono essere progettati in base alle funzionalità aziendali e non in base a livelli orizzontali, come l'accesso ai dati o la messaggistica.</span><span class="sxs-lookup"><span data-stu-id="b0d74-110">Microservices should be designed around business capabilities, not horizontal layers such as data access or messaging.</span></span> <span data-ttu-id="b0d74-111">Devono inoltre prevedere un accoppiamento non rigido e un'elevata coesione funzionale.</span><span class="sxs-lookup"><span data-stu-id="b0d74-111">In addition, they should have loose coupling and high functional cohesion.</span></span> <span data-ttu-id="b0d74-112">I microservizi sono caratterizzati da un *accoppiamento non rigido* se è possibile apportare modifiche a un servizio senza dover contemporaneamente aggiornare gli altri servizi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-112">Microservices are *loosely coupled* if you can change one service without requiring other services to be updated at the same time.</span></span> <span data-ttu-id="b0d74-113">Un microservizio è *coeso* se ha un unico obiettivo ben definito, ad esempio la gestione degli account utente o la traccia della cronologia di recapito.</span><span class="sxs-lookup"><span data-stu-id="b0d74-113">A microservice is *cohesive* if it has a single, well-defined purpose, such as managing user accounts or tracking delivery history.</span></span> <span data-ttu-id="b0d74-114">Un servizio deve incapsulare le informazioni del dominio e gestire l'astrazione di tali informazioni dai client.</span><span class="sxs-lookup"><span data-stu-id="b0d74-114">A service should encapsulate domain knowledge and abstract that knowledge from clients.</span></span> <span data-ttu-id="b0d74-115">Un client deve ad esempio essere in grado di pianificare un drone senza conoscere i dettagli dell'algoritmo di pianificazione o la modalità di gestione della flotta di droni.</span><span class="sxs-lookup"><span data-stu-id="b0d74-115">For example, a client should be able to schedule a drone without knowing the details of the scheduling algorithm or how the drone fleet is managed.</span></span>

<span data-ttu-id="b0d74-116">La progettazione basata su dominio offre un framework che agevola la creazione di microservizi ben progettati.</span><span class="sxs-lookup"><span data-stu-id="b0d74-116">Domain-driven design (DDD) provides a framework that can get you most of the way to a set of well-designed microservices.</span></span> <span data-ttu-id="b0d74-117">La progettazione basata su dominio prevede due fasi distinte, quella strategica e quella tattica.</span><span class="sxs-lookup"><span data-stu-id="b0d74-117">DDD has two distinct phases, strategic and tactical.</span></span> <span data-ttu-id="b0d74-118">Nella progettazione basata su dominio strategica, si definisce la struttura su vasta scala del sistema.</span><span class="sxs-lookup"><span data-stu-id="b0d74-118">In strategic DDD, you are defining the large-scale structure of the system.</span></span> <span data-ttu-id="b0d74-119">La progettazione basata su dominio strategica garantisce che l'architettura rimanga incentrata sulle funzionalità aziendali.</span><span class="sxs-lookup"><span data-stu-id="b0d74-119">Strategic DDD helps to ensure that your architecture remains focused on business capabilities.</span></span> <span data-ttu-id="b0d74-120">La progettazione basata su dominio tattica fornisce un set di schemi progettuali da usare per creare il modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-120">Tactical DDD provides a set of design patterns that you can use to create the domain model.</span></span> <span data-ttu-id="b0d74-121">Questi schemi includono entità, aggregazioni e servizi di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-121">These patterns include entities, aggregates, and domain services.</span></span> <span data-ttu-id="b0d74-122">Gli schemi tattici consentono di progettare microservizi con accoppiamento poco rigido e coesione elevata.</span><span class="sxs-lookup"><span data-stu-id="b0d74-122">These tactical patterns will help you to design microservices that are both loosely coupled and cohesive.</span></span>

![Diagramma di un processo di progettazione basato su dominio](./images/ddd-process.png)

<span data-ttu-id="b0d74-124">Questo capitolo e quello successivo illustrano alcune procedure che verranno quindi applicate all'applicazione di recapito tramite drone:</span><span class="sxs-lookup"><span data-stu-id="b0d74-124">In this chapter and the next, we'll walk through the following steps, applying them to the Drone Delivery application:</span></span>

1. <span data-ttu-id="b0d74-125">Si inizierà dall'analisi del dominio aziendale per acquisire informazioni sui requisiti funzionali dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-125">Start by analyzing the business domain to understand the application's functional requirements.</span></span> <span data-ttu-id="b0d74-126">L'output di questo passaggio è una descrizione informale del dominio, che può essere successivamente perfezionata in un set più formale di modelli di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-126">The output of this step is an informal description of the domain, which can be refined into a more formal set of domain models.</span></span>

2. <span data-ttu-id="b0d74-127">In seguito, verranno definiti i *contesti delimitati* del dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-127">Next, define the *bounded contexts* of the domain.</span></span> <span data-ttu-id="b0d74-128">Ogni contesto delimitato contiene un modello di dominio che rappresenta un sottodominio specifico dell'applicazione principale.</span><span class="sxs-lookup"><span data-stu-id="b0d74-128">Each bounded context contains a domain model that represents a particular subdomain of the larger application.</span></span>

3. <span data-ttu-id="b0d74-129">All'interno di un contesto delimitato, verranno applicati gli schemi di progettazione basata su dominio tattica per definire entità, aggregazioni e servizi di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-129">Within a bounded context, apply tactical DDD patterns to define entities, aggregates, and domain services.</span></span>

4. <span data-ttu-id="b0d74-130">Usare i risultati del passaggio precedente per identificare i microservizi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-130">Use the results from the previous step to identify the microservices in your application.</span></span>

<span data-ttu-id="b0d74-131">In questo capitolo vengono illustrati i primi tre passaggi, più strettamente correlati alla progettazione basata su dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-131">In this chapter, we cover the first three steps, which are primarily concerned with DDD.</span></span> <span data-ttu-id="b0d74-132">Nel capitolo successivo verranno identificati i microservizi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-132">In the next chapter, we will identify the microservices.</span></span> <span data-ttu-id="b0d74-133">In ogni caso, è importante ricordare che la progettazione basata su dominio è un processo iterativo e continuo.</span><span class="sxs-lookup"><span data-stu-id="b0d74-133">However, it's important to remember that DDD is an iterative, ongoing process.</span></span> <span data-ttu-id="b0d74-134">I vincoli del servizio non sono scolpiti nella pietra.</span><span class="sxs-lookup"><span data-stu-id="b0d74-134">Service boundaries aren't fixed in stone.</span></span> <span data-ttu-id="b0d74-135">Con l'evolvere dell'applicazione, si potrebbe decidere di suddividere un servizio in vari servizi più piccoli.</span><span class="sxs-lookup"><span data-stu-id="b0d74-135">As an application evolves, you may decide to break apart a service into several smaller services.</span></span>

> [!NOTE]
> <span data-ttu-id="b0d74-136">Questo capitolo non mostra un'analisi del dominio completa ed esaustiva.</span><span class="sxs-lookup"><span data-stu-id="b0d74-136">This chapter is not meant to show a complete and comprehensive domain analysis.</span></span> <span data-ttu-id="b0d74-137">L'esempio è stato mantenuto breve per illustrare i punti principali.</span><span class="sxs-lookup"><span data-stu-id="b0d74-137">We deliberately kept the example brief, in order to illustrate the main points.</span></span> <span data-ttu-id="b0d74-138">Per informazioni dettagliate sulla progettazione basata su dominio, vedere *Domain-Driven Design* di Eric Evans, il libro che ha coniato per primo il termine.</span><span class="sxs-lookup"><span data-stu-id="b0d74-138">For more background on DDD, we recommend Eric Evans' *Domain-Driven Design*, the book that first introduced the term.</span></span> <span data-ttu-id="b0d74-139">Un altro riferimento consigliato è *Implementing Domain-Driven Design* di Vaughn Vernon.</span><span class="sxs-lookup"><span data-stu-id="b0d74-139">Another good reference is *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span>

## <a name="analyze-the-domain"></a><span data-ttu-id="b0d74-140">Analizzare il dominio</span><span class="sxs-lookup"><span data-stu-id="b0d74-140">Analyze the domain</span></span>

<span data-ttu-id="b0d74-141">La progettazione basata su dominio consente di progettare microservizi affinché ogni servizio si adatti naturalmente a un requisito aziendale funzionale.</span><span class="sxs-lookup"><span data-stu-id="b0d74-141">Using a DDD approach will help you to design microservices so that every service forms a natural fit to a functional business requirement.</span></span> <span data-ttu-id="b0d74-142">Permette di evitare che la progettazione sia determinata dai vincoli organizzativi o dalle scelte tecnologiche.</span><span class="sxs-lookup"><span data-stu-id="b0d74-142">It can help you to avoid the trap of letting organizational boundaries or technology choices dictate your design.</span></span>

<span data-ttu-id="b0d74-143">Prima di passare alla scrittura del codice, è necessaria una panoramica generale del sistema che verrà creato.</span><span class="sxs-lookup"><span data-stu-id="b0d74-143">Before writing any code, you need a bird's eye view of the system that you are creating.</span></span> <span data-ttu-id="b0d74-144">La progettazione basata su dominio inizia dalla modellazione del dominio aziendale e dalla creazione di un *modello di dominio*.</span><span class="sxs-lookup"><span data-stu-id="b0d74-144">DDD starts by modeling the business domain and creating a *domain model*.</span></span> <span data-ttu-id="b0d74-145">Il modello di dominio è un modello astratto del dominio aziendale.</span><span class="sxs-lookup"><span data-stu-id="b0d74-145">The domain model is an abstract model of the business domain.</span></span> <span data-ttu-id="b0d74-146">Estrae e organizza le informazioni sul dominio e fornisce un linguaggio comune per sviluppatori ed esperti di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-146">It distills and organizes domain knowledge, and provides a common language for developers and domain experts.</span></span>

<span data-ttu-id="b0d74-147">Per iniziare, eseguire un mapping di tutte le funzioni aziendali con le relative connessioni.</span><span class="sxs-lookup"><span data-stu-id="b0d74-147">Start by mapping all of the business functions and their connections.</span></span> <span data-ttu-id="b0d74-148">Si tratterà di un'attività collaborativa che coinvolge esperti di dominio, software architect e altri stakeholder.</span><span class="sxs-lookup"><span data-stu-id="b0d74-148">This will likely be a collaborative effort that involves domain experts, software architects, and other stakeholders.</span></span> <span data-ttu-id="b0d74-149">Non è necessario usare un formato specifico.</span><span class="sxs-lookup"><span data-stu-id="b0d74-149">You don't need to use any particular formalism.</span></span>  <span data-ttu-id="b0d74-150">Semplicemente tracciare un diagramma o un disegno su una lavagna.</span><span class="sxs-lookup"><span data-stu-id="b0d74-150">Sketch a diagram or draw on whiteboard.</span></span>

<span data-ttu-id="b0d74-151">Man mano che si compila il diagramma, si potranno identificare i sottodomini discreti.</span><span class="sxs-lookup"><span data-stu-id="b0d74-151">As you fill in the diagram, you may start to identify discrete subdomains.</span></span> <span data-ttu-id="b0d74-152">Quali funzioni sono strettamente correlate?</span><span class="sxs-lookup"><span data-stu-id="b0d74-152">Which functions are closely related?</span></span> <span data-ttu-id="b0d74-153">Quali sono le funzioni strategiche per l'azienda e quali forniscono solo servizi accessori?</span><span class="sxs-lookup"><span data-stu-id="b0d74-153">Which functions are core to the business, and which provide ancillary services?</span></span> <span data-ttu-id="b0d74-154">Qual è il grafico delle dipendenze?</span><span class="sxs-lookup"><span data-stu-id="b0d74-154">What is the dependency graph?</span></span> <span data-ttu-id="b0d74-155">Durante questa fase iniziale, non è necessario preoccuparsi delle tecnologie o dei dettagli di implementazione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-155">During this initial phase, you aren't concerned with technologies or implementation details.</span></span> <span data-ttu-id="b0d74-156">Ciò premesso, sarà necessario stabilire la posizione in cui l'applicazione dovrà integrarsi con i sistemi esterni, ad esempio i sistemi CRM, di elaborazione dei pagamenti o di fatturazione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-156">That said, you should note the place where the application will need to integrate with external systems, such as CRM, payment processing, or billing systems.</span></span>

## <a name="drone-delivery-analyzing-the-business-domain"></a><span data-ttu-id="b0d74-157">Recapito tramite drone: analisi del dominio aziendale</span><span class="sxs-lookup"><span data-stu-id="b0d74-157">Drone Delivery: Analyzing the business domain</span></span>

<span data-ttu-id="b0d74-158">Dopo alcune analisi iniziali, il team di Fabrikam ha creato uno schizzo approssimativo che descrive il dominio di recapito tramite drone.</span><span class="sxs-lookup"><span data-stu-id="b0d74-158">After some initial domain analysis, the Fabrikam team came up with a rough sketch that depicts the Drone Delivery domain.</span></span>

![Diagramma del dominio di recapito tramite drone](./images/ddd1.svg)

- <span data-ttu-id="b0d74-160">La **spedizione** è posizionata al centro del diagramma, perché è l'attività principale dell'azienda.</span><span class="sxs-lookup"><span data-stu-id="b0d74-160">**Shipping** is placed in the center of the diagram, because it's core to the business.</span></span> <span data-ttu-id="b0d74-161">Tutto gli altri elementi del diagramma esistono per abilitare questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-161">Everything else in the diagram exists to enable this functionality.</span></span>
- <span data-ttu-id="b0d74-162">Anche la **gestione dei droni** fa parte del core business.</span><span class="sxs-lookup"><span data-stu-id="b0d74-162">**Drone management** is also core to the business.</span></span> <span data-ttu-id="b0d74-163">Le funzionalità strettamente correlate alla gestione dei droni includono la **riparazione dei droni** e l'uso dell'**analisi predittiva** per prevedere quando sarà necessaria la manutenzione dei droni.</span><span class="sxs-lookup"><span data-stu-id="b0d74-163">Functionality that is closely related to drone management includes **drone repair** and using **predictive analysis** to predict when drones need servicing and maintenance.</span></span>
- <span data-ttu-id="b0d74-164">L'**analisi ETA** (tempo stimato per il completamento) fornisce la stima delle tempistiche per ritiro e consegna.</span><span class="sxs-lookup"><span data-stu-id="b0d74-164">**ETA analysis** provides time estimates for pickup and delivery.</span></span>
- <span data-ttu-id="b0d74-165">Il **trasporto di terze parti** consentirà all'applicazione di pianificare metodi di trasporto alternativi se il drone non può effettuare la consegna completa di un pacchetto.</span><span class="sxs-lookup"><span data-stu-id="b0d74-165">**Third-party transportation** will enable the application to schedule alternative transportation methods if a package cannot be shipped entirely by drone.</span></span>
- <span data-ttu-id="b0d74-166">La **condivisione dei droni** è una possibile estensione del core business.</span><span class="sxs-lookup"><span data-stu-id="b0d74-166">**Drone sharing** is a possible extension of the core business.</span></span> <span data-ttu-id="b0d74-167">L'azienda potrebbe avere una capacità in eccesso durante determinati orari e noleggiare quindi i droni che altrimenti rimarrebbero inattivi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-167">The company may have excess drone capacity during certain hours, and could rent out drones that would otherwise be idle.</span></span> <span data-ttu-id="b0d74-168">Questa funzionalità non sarà inclusa nella versione iniziale.</span><span class="sxs-lookup"><span data-stu-id="b0d74-168">This feature will not be in the initial release.</span></span>
- <span data-ttu-id="b0d74-169">La **videosorveglianza** è un'altra area in cui l'azienda potrebbe espandersi in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="b0d74-169">**Video surveillance** is another area that the company might expand into later.</span></span>
- <span data-ttu-id="b0d74-170">Gli **account utente**, la **fatturazione** e il **call center** sono sottodomini che supportano il core business.</span><span class="sxs-lookup"><span data-stu-id="b0d74-170">**User accounts**, **Invoicing**, and **Call center** are subdomains that support the core business.</span></span>

<span data-ttu-id="b0d74-171">Si noti che a questo punto del processo non è ancora stata presa alcuna decisione in merito all'implementazione o alle tecnologie.</span><span class="sxs-lookup"><span data-stu-id="b0d74-171">Notice that at this point in the process, we haven't made any decisions about implementation or technologies.</span></span> <span data-ttu-id="b0d74-172">Alcuni sottosistemi potrebbero prevedere l'uso di sistemi software esterni o di servizi di terze parti.</span><span class="sxs-lookup"><span data-stu-id="b0d74-172">Some of the subsystems may involve external software systems or third-party services.</span></span> <span data-ttu-id="b0d74-173">Anche in questo caso, l'applicazione deve interagire con tali sistemi e servizi, quindi è importante includerli nel modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-173">Even so, the application needs to interact with these systems and services, so it's important to include them in the domain model.</span></span>

> [!NOTE]
> <span data-ttu-id="b0d74-174">Quando un'applicazione dipende da un sistema esterno, esiste il rischio che l'API o lo schema dei dati del sistema esterno penetri nell'applicazione, compromettendone la progettazione dell'architettura.</span><span class="sxs-lookup"><span data-stu-id="b0d74-174">When an application depends on an external system, there is a risk that the external system's data schema or API will leak into your application, ultimately compromising the architectural design.</span></span> <span data-ttu-id="b0d74-175">Questo si verifica in particolare con i sistemi legacy che non seguono le procedure consigliate moderne e che usano API obsolete o schemi dei dati intricati.</span><span class="sxs-lookup"><span data-stu-id="b0d74-175">This is particularly true with legacy systems that may not follow modern best practices, and may use convoluted data schemas or obsolete APIs.</span></span> <span data-ttu-id="b0d74-176">In questo caso, è importante stabilire un limite ben definito tra i sistemi esterni e l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-176">In that case, it's important to have a well-defined boundary between these external systems and the application.</span></span> <span data-ttu-id="b0d74-177">A tale scopo, valutare la possibilità di usare il [modello Sostituzione](../patterns/strangler.md) o il [modello di livello anti-danneggiamento](../patterns/anti-corruption-layer.md).</span><span class="sxs-lookup"><span data-stu-id="b0d74-177">Consider using the [Strangler pattern](../patterns/strangler.md) or the [Anti-Corruption Layer pattern](../patterns/anti-corruption-layer.md) for this purpose.</span></span>

## <a name="define-bounded-contexts"></a><span data-ttu-id="b0d74-178">Definire i contesti delimitati</span><span class="sxs-lookup"><span data-stu-id="b0d74-178">Define bounded contexts</span></span>

<span data-ttu-id="b0d74-179">Il modello di dominio includerà rappresentazioni di elementi del mondo reale, ad esempio utenti, droni, pacchetti e così via.</span><span class="sxs-lookup"><span data-stu-id="b0d74-179">The domain model will include representations of real things in the world &mdash; users, drones, packages, and so forth.</span></span> <span data-ttu-id="b0d74-180">Questo non significa tuttavia che ogni parte del sistema debba usare le stesse rappresentazioni per gli stessi elementi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-180">But that doesn't mean that every part of the system needs to use the same representations for the same things.</span></span>

<span data-ttu-id="b0d74-181">Ad esempio, i sottosistemi che gestiscono la riparazione dei droni e l'analisi predittiva dovranno rappresentare numerose caratteristiche fisiche dei droni, ad esempio la cronologia di manutenzione, il chilometraggio, l'età, il numero di modello, le prestazioni e così via.</span><span class="sxs-lookup"><span data-stu-id="b0d74-181">For example, subsystems that handle drone repair and predictive analysis will need to represent many physical characteristics drones, such as their maintenance history, mileage, age, model number, performance characteristics, and so on.</span></span> <span data-ttu-id="b0d74-182">Quando si tratta di pianificare un recapito, questi elementi non sono importanti.</span><span class="sxs-lookup"><span data-stu-id="b0d74-182">But when it's time to schedule a delivery, we don't care about those things.</span></span> <span data-ttu-id="b0d74-183">Il sottosistema di pianificazione deve solo sapere se un drone è disponibile o meno e il tempo stimato per il ritiro e la consegna.</span><span class="sxs-lookup"><span data-stu-id="b0d74-183">The scheduling subsystem only needs to know whether a drone is available, and the ETA for pickup and delivery.</span></span>

<span data-ttu-id="b0d74-184">Se si tentasse di creare un unico modello per entrambi questi sottosistemi, risulterebbe inutilmente complesso</span><span class="sxs-lookup"><span data-stu-id="b0d74-184">If we tried to create a single model for both of these subsystems, it would be unnecessarily complex.</span></span> <span data-ttu-id="b0d74-185">e l'evoluzione del modello nel tempo potrebbe essere compromessa perché qualsiasi modifica dovrà soddisfare più team che lavorano su sottosistemi distinti.</span><span class="sxs-lookup"><span data-stu-id="b0d74-185">It would also become harder for the model to evolve over time, because any changes will need to satisfy multiple teams working on separate subsystems.</span></span> <span data-ttu-id="b0d74-186">Per questo motivo, è consigliabile progettare modelli separati che rappresentano la stessa entità del mondo reale, in questo caso un drone, in due contesti diversi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-186">Therefore, it's often better to design separate models that represent the same real-world entity (in this case, a drone) in two different contexts.</span></span> <span data-ttu-id="b0d74-187">Ogni modello contiene solo le funzionalità e gli attributi pertinenti per il contesto specifico.</span><span class="sxs-lookup"><span data-stu-id="b0d74-187">Each model contains only the features and attributes that are relevant within its particular context.</span></span>

<span data-ttu-id="b0d74-188">Ecco dove entra il gioco il concetto di *contesti delimitati* della progettazione basata su dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-188">This is where the DDD concept of *bounded contexts* comes into play.</span></span> <span data-ttu-id="b0d74-189">Un contesto delimitato è semplicemente un limite all'interno di un dominio a cui si applica un modello di dominio specifico.</span><span class="sxs-lookup"><span data-stu-id="b0d74-189">A bounded context is simply the boundary within a domain where a particular domain model applies.</span></span> <span data-ttu-id="b0d74-190">Osservando il diagramma precedente, è possibile raggruppare le funzionalità a seconda del fatto che le varie funzioni condividano o meno un singolo modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-190">Looking at the previous diagram, we can group functionality according to whether various functions will share a single domain model.</span></span>

![Diagramma dei contesti delimitati](./images/ddd2.svg)

<span data-ttu-id="b0d74-192">I contesti delimitati non sono necessariamente isolati l'uno dall'altro.</span><span class="sxs-lookup"><span data-stu-id="b0d74-192">Bounded contexts are not necessarily isolated from one another.</span></span> <span data-ttu-id="b0d74-193">In questo diagramma, le linee continue che connettono i contesti delimitati rappresentano la posizione di interazione di due contesti delimitati.</span><span class="sxs-lookup"><span data-stu-id="b0d74-193">In this diagram, the solid lines connecting the bounded contexts represent places where two bounded contexts interact.</span></span> <span data-ttu-id="b0d74-194">Ad esempio, la spedizione dipende dagli account utente per ottenere le informazioni relative ai clienti e dalla gestione dei droni per pianificare i droni della flotta.</span><span class="sxs-lookup"><span data-stu-id="b0d74-194">For example, Shipping depends on User Accounts to get information about customers, and on Drone Management to schedule drones from the fleet.</span></span>

<span data-ttu-id="b0d74-195">Nel libro *Domain-Drive Design* Eric Evans descrive vari schemi per mantenere l'integrità di un modello di dominio quando interagisce con un altro contesto delimitato.</span><span class="sxs-lookup"><span data-stu-id="b0d74-195">In the book *Domain Driven Design*, Eric Evans describes several patterns for maintaining the integrity of a domain model when it interacts with another bounded context.</span></span> <span data-ttu-id="b0d74-196">Uno dei principi fondamentali dei microservizi è che i servizi comunicano tramite API ben definite.</span><span class="sxs-lookup"><span data-stu-id="b0d74-196">One of the main principles of microservices is that services communicate through well-defined APIs.</span></span> <span data-ttu-id="b0d74-197">Questo approccio corrisponde a due schemi che Evans chiama Open Host Service (servizio host aperto) e Published Language (linguaggio pubblicato).</span><span class="sxs-lookup"><span data-stu-id="b0d74-197">This approach corresponds to two patterns that Evans calls Open Host Service and Published Language.</span></span> <span data-ttu-id="b0d74-198">Nello schema Open Host Service un sottosistema definisce un protocollo formale (API) per consentire la comunicazione con altri sottosistemi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-198">The idea of Open Host Service is that a subsystem defines a formal protocol (API) for other subsystems to communicate with it.</span></span> <span data-ttu-id="b0d74-199">Lo schema Published Language estende questo concetto pubblicando l'API in un formato che altri team possono usare per la scrittura dei client.</span><span class="sxs-lookup"><span data-stu-id="b0d74-199">Published Language extends this idea by publishing the API in a form that other teams can use to write clients.</span></span> <span data-ttu-id="b0d74-200">Nel capitolo relativo alla [progettazione dell'API](./api-design.md) verrà illustrato l'uso della [specifica OpenAPI](https://www.openapis.org/specification/repo) (precedentemente nota come Swagger) per definire descrizioni dell'interfaccia indipendenti dal linguaggio per le API REST, espresse nel formato JSON o YAML.</span><span class="sxs-lookup"><span data-stu-id="b0d74-200">In the chapter on [API Design](./api-design.md), we discuss using [OpenAPI Specification](https://www.openapis.org/specification/repo) (formerly known as Swagger) to define language-agnostic interface descriptions for REST APIs, expressed in JSON or YAML format.</span></span>

<span data-ttu-id="b0d74-201">Nella parte rimanente di questo articolo verrà illustrato il contesto delimitato per il recapito.</span><span class="sxs-lookup"><span data-stu-id="b0d74-201">For the rest of this journey, we will focus on the Shipping bounded context.</span></span>

## <a name="tactical-ddd"></a><span data-ttu-id="b0d74-202">Progettazione basata su dominio tattica</span><span class="sxs-lookup"><span data-stu-id="b0d74-202">Tactical DDD</span></span>

<span data-ttu-id="b0d74-203">Durante la fase strategica della progettazione basata su dominio, si esegue il mapping del dominio aziendale e si definiscono i contesti delimitati per i modelli di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-203">During the strategic phase of DDD, you are mapping out the business domain and defining bounded contexts for your domain models.</span></span> <span data-ttu-id="b0d74-204">La progettazione basata su dominio tattica consente di definire i modelli di dominio con maggiore precisione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-204">Tactical DDD is when you define your domain models with more precision.</span></span> <span data-ttu-id="b0d74-205">Gli schemi tattici vengono applicati all'interno di un singolo contesto delimitato.</span><span class="sxs-lookup"><span data-stu-id="b0d74-205">The tactical patterns are applied within a single bounded context.</span></span> <span data-ttu-id="b0d74-206">In un'architettura di microservizi gli elementi più interessanti sono costituiti dagli schemi di aggregazione ed entità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-206">In a microservices architecture, we are particularly interested in the entity and aggregate patterns.</span></span> <span data-ttu-id="b0d74-207">L'applicazione di questi schemi permette di identificare i limiti naturali dei servizi nell'applicazione (vedere il [capitolo successivo](./microservice-boundaries.md)).</span><span class="sxs-lookup"><span data-stu-id="b0d74-207">Applying these patterns will help us to identify natural boundaries for the services in our application (see [next chapter](./microservice-boundaries.md)).</span></span> <span data-ttu-id="b0d74-208">In linea generale, un microservizio non deve essere più piccolo di un'aggregazione e non deve essere più grande di un contesto delimitato.</span><span class="sxs-lookup"><span data-stu-id="b0d74-208">As a general principle, a microservice should be no smaller than an aggregate, and no larger than a bounded context.</span></span> <span data-ttu-id="b0d74-209">Verranno innanzitutto esaminati gli schemi tattici e</span><span class="sxs-lookup"><span data-stu-id="b0d74-209">First, we'll review the tactical patterns.</span></span> <span data-ttu-id="b0d74-210">quindi verranno applicati al contesto delimitato per il recapito nell'applicazione di recapito tramite drone.</span><span class="sxs-lookup"><span data-stu-id="b0d74-210">Then we'll apply them to the Shipping bounded context in the Drone Delivery application.</span></span>

### <a name="overview-of-the-tactical-patterns"></a><span data-ttu-id="b0d74-211">Panoramica degli schemi tattici</span><span class="sxs-lookup"><span data-stu-id="b0d74-211">Overview of the tactical patterns</span></span>

<span data-ttu-id="b0d74-212">Questa sezione fornisce un breve riepilogo degli schemi di progettazione basata su dominio tattica. Se si ha già familiarità con questo tipo di progettazione, è possibile ignorare questa sezione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-212">This section provides a brief summary of the tactical DDD patterns, so if you are already familiar with DDD, you can probably skip this section.</span></span> <span data-ttu-id="b0d74-213">Gli schemi sono descritti più in dettaglio nei capitoli 5 e 6 del libro di Eric Evans e nel libro *Implementing Domain-Driven Design* di Vaughn Vernon.</span><span class="sxs-lookup"><span data-stu-id="b0d74-213">The patterns are described in more detail in chapters 5 &ndash; 6 of Eric Evans' book, and in *Implementing Domain-Driven Design* by Vaughn Vernon.</span></span>

![Diagramma degli schemi tattici nella progettazione basata su dominio](./images/ddd-patterns.png)

<span data-ttu-id="b0d74-215">**Entità**.</span><span class="sxs-lookup"><span data-stu-id="b0d74-215">**Entities**.</span></span> <span data-ttu-id="b0d74-216">Un'entità è un oggetto con un'identità univoca che persiste nel tempo.</span><span class="sxs-lookup"><span data-stu-id="b0d74-216">An entity is an object with a unique identity that persists over time.</span></span> <span data-ttu-id="b0d74-217">Ad esempio, in un'applicazione bancaria i clienti e i conti sono entità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-217">For example, in a banking application, customers and accounts would be entities.</span></span>

- <span data-ttu-id="b0d74-218">Un'entità presenta un identificatore univoco nel sistema che può essere usato per cercare o recuperare l'entità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-218">An entity has a unique identifier in the system, which can be used to look up or retrieve the entity.</span></span> <span data-ttu-id="b0d74-219">Questo non significa che l'identificatore sia sempre esposto direttamente agli utenti.</span><span class="sxs-lookup"><span data-stu-id="b0d74-219">That doesn't mean the identifier is always exposed directly to users.</span></span> <span data-ttu-id="b0d74-220">Può essere un GUID o una chiave primaria in un database.</span><span class="sxs-lookup"><span data-stu-id="b0d74-220">It could be a GUID or a primary key in a database.</span></span>
- <span data-ttu-id="b0d74-221">Un'identità può estendersi su più contesti delimitati e può persistere oltre la durata dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-221">An identity may span multiple bounded contexts, and may endure beyond the lifetime of the application.</span></span> <span data-ttu-id="b0d74-222">Ad esempio, i numeri dei conti bancari o i documenti di identità rilasciati dal governo non sono legati alla durata di un'applicazione specifica.</span><span class="sxs-lookup"><span data-stu-id="b0d74-222">For example, bank account numbers or government-issued IDs are not tied to the lifetime of a particular application.</span></span>
- <span data-ttu-id="b0d74-223">Gli attributi di un'entità possono cambiare nel tempo.</span><span class="sxs-lookup"><span data-stu-id="b0d74-223">The attributes of an entity may change over time.</span></span> <span data-ttu-id="b0d74-224">Ad esempio, il nome o l'indirizzo di una persona possono cambiare, ma si tratta comunque dello stesso individuo.</span><span class="sxs-lookup"><span data-stu-id="b0d74-224">For example, a person's name or address might change, but they are still the same person.</span></span>
- <span data-ttu-id="b0d74-225">Un'entità può contenere riferimenti ad altre entità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-225">An entity can hold references to other entities.</span></span>

<span data-ttu-id="b0d74-226">**Oggetti valore**.</span><span class="sxs-lookup"><span data-stu-id="b0d74-226">**Value objects**.</span></span> <span data-ttu-id="b0d74-227">Un oggetto valore non ha identità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-227">A value object has no identity.</span></span> <span data-ttu-id="b0d74-228">È definito esclusivamente dai valori dei relativi attributi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-228">It is defined only by the values of its attributes.</span></span> <span data-ttu-id="b0d74-229">Gli oggetti valore non sono modificabili.</span><span class="sxs-lookup"><span data-stu-id="b0d74-229">Value objects are also immutable.</span></span> <span data-ttu-id="b0d74-230">Per aggiornare un oggetto valore, è sempre necessario creare una nuova istanza per sostituire quella precedente.</span><span class="sxs-lookup"><span data-stu-id="b0d74-230">To update a value object, you always create a new instance to replace the old one.</span></span> <span data-ttu-id="b0d74-231">Gli oggetti valore possono includere metodi che incapsulano la logica del dominio, ma tali metodi non devono avere effetti collaterali sullo stato dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="b0d74-231">Value objects can have methods that encapsulate domain logic, but those methods should have no side-effects on the object's state.</span></span> <span data-ttu-id="b0d74-232">Tra gli esempi tipici di oggetti valore sono inclusi colori, date e ore e valori di valuta.</span><span class="sxs-lookup"><span data-stu-id="b0d74-232">Typical examples of value objects include colors, dates and times, and currency values.</span></span>

<span data-ttu-id="b0d74-233">**Aggregazioni**.</span><span class="sxs-lookup"><span data-stu-id="b0d74-233">**Aggregates**.</span></span> <span data-ttu-id="b0d74-234">Un'aggregazione definisce un limite di coerenza per una o più entità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-234">An aggregate defines a consistency boundary around one or more entities.</span></span> <span data-ttu-id="b0d74-235">In un'aggregazione solo un'entità costituisce la radice.</span><span class="sxs-lookup"><span data-stu-id="b0d74-235">Exactly one entity in an aggregate is the root.</span></span> <span data-ttu-id="b0d74-236">La ricerca viene eseguita tramite l'identificatore dell'entità radice.</span><span class="sxs-lookup"><span data-stu-id="b0d74-236">Lookup is done using the root entity's identifier.</span></span> <span data-ttu-id="b0d74-237">Le altre entità nell'aggregazione sono elementi figlio della radice e vi fanno riferimento i puntatori seguenti dalla radice.</span><span class="sxs-lookup"><span data-stu-id="b0d74-237">Any other entities in the aggregate are children of the root, and are referenced by following pointers from the root.</span></span>

<span data-ttu-id="b0d74-238">Lo scopo di un'aggregazione è la modellazione di invarianti transazionali.</span><span class="sxs-lookup"><span data-stu-id="b0d74-238">The purpose of an aggregate is to model transactional invariants.</span></span> <span data-ttu-id="b0d74-239">Gli elementi nel mondo reale hanno ragnatele complesse di relazioni.</span><span class="sxs-lookup"><span data-stu-id="b0d74-239">Things in the real world have complex webs of relationships.</span></span> <span data-ttu-id="b0d74-240">I clienti creano gli ordini, gli ordini contengono prodotti, i prodotti hanno fornitori e così via.</span><span class="sxs-lookup"><span data-stu-id="b0d74-240">Customers create orders, orders contain products, products have suppliers, and so on.</span></span> <span data-ttu-id="b0d74-241">Se l'applicazione modifica più oggetti correlati, come può garantirne la coerenza?</span><span class="sxs-lookup"><span data-stu-id="b0d74-241">If the application modifies several related objects, how does it guarantee consistency?</span></span> <span data-ttu-id="b0d74-242">Come si tiene traccia delle invarianti e come vengono imposte?</span><span class="sxs-lookup"><span data-stu-id="b0d74-242">How do we keep track of invariants and enforce them?</span></span>  

<span data-ttu-id="b0d74-243">Le applicazioni tradizionali spesso usano le transazioni di database per imporre la coerenza.</span><span class="sxs-lookup"><span data-stu-id="b0d74-243">Traditional applications have often used database transactions to enforce consistency.</span></span> <span data-ttu-id="b0d74-244">In un'applicazione distribuita, tuttavia, spesso non è fattibile.</span><span class="sxs-lookup"><span data-stu-id="b0d74-244">In a distributed application, however, that's often not feasible.</span></span> <span data-ttu-id="b0d74-245">Una singola transazione aziendale può interessare più archivi dati, può essere caratterizzata da un'esecuzione prolungata o può coinvolgere servizi di terze parti.</span><span class="sxs-lookup"><span data-stu-id="b0d74-245">A single business transaction may span multiple data stores, or may be long running, or may involve third-party services.</span></span> <span data-ttu-id="b0d74-246">È compito dell'applicazione e non del livello dati imporre le invarianti necessarie per il dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-246">Ultimately it's up to the application, not the data layer, to enforce the invariants required for the domain.</span></span> <span data-ttu-id="b0d74-247">Ecco che cosa modellano le aggregazioni.</span><span class="sxs-lookup"><span data-stu-id="b0d74-247">That's what aggregates are meant to model.</span></span>

> [!NOTE]
> <span data-ttu-id="b0d74-248">Un'aggregazione può essere costituita da una singola entità, senza entità figlio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-248">An aggregate might consist of a single entity, without child entities.</span></span> <span data-ttu-id="b0d74-249">Ciò che la rende un'aggregazione sono i limiti transazionali.</span><span class="sxs-lookup"><span data-stu-id="b0d74-249">What makes it an aggregate is the transactional boundary.</span></span>

<span data-ttu-id="b0d74-250">**Servizi di dominio e servizi dell'applicazione**.</span><span class="sxs-lookup"><span data-stu-id="b0d74-250">**Domain and application services**.</span></span> <span data-ttu-id="b0d74-251">Nella terminologia della progettazione basata su dominio, un servizio è un oggetto che implementa una logica senza bloccare uno stato.</span><span class="sxs-lookup"><span data-stu-id="b0d74-251">In DDD terminology, a service is an object that implements some logic without holding any state.</span></span> <span data-ttu-id="b0d74-252">Evans distingue tra *servizi di dominio* che incapsulano la logica del dominio e *servizi dell'applicazione* che forniscono funzionalità tecniche, ad esempio l'autenticazione degli utenti o l'invio di messaggi SMS.</span><span class="sxs-lookup"><span data-stu-id="b0d74-252">Evans distinguishes between *domain services*, which encapsulate domain logic, and *application services*, which provide technical functionality, such as user authentication or sending an SMS message.</span></span> <span data-ttu-id="b0d74-253">I servizi di dominio vengono spesso usati per modellare il comportamento che si estende su più entità.</span><span class="sxs-lookup"><span data-stu-id="b0d74-253">Domain services are often used to model behavior that spans multiple entities.</span></span>

> [!NOTE]
> <span data-ttu-id="b0d74-254">Nel settore dello sviluppo software, il termine *servizio* ha molti significati.</span><span class="sxs-lookup"><span data-stu-id="b0d74-254">The term *service* is overloaded in software development.</span></span> <span data-ttu-id="b0d74-255">La definizione fornita qui non è direttamente correlata ai microservizi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-255">The definition here is not directly related to microservices.</span></span>

<span data-ttu-id="b0d74-256">**Eventi del dominio**.</span><span class="sxs-lookup"><span data-stu-id="b0d74-256">**Domain events**.</span></span> <span data-ttu-id="b0d74-257">Gli eventi del dominio consentono di comunicare ad altre parti del sistema quando si verifica un evento.</span><span class="sxs-lookup"><span data-stu-id="b0d74-257">Domain events can be used to notify other parts of the system when something happens.</span></span> <span data-ttu-id="b0d74-258">Come suggerito dal nome, gli eventi del dominio indicano qualcosa che accade all'interno del dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-258">As the name suggests, domain events should mean something within the domain.</span></span> <span data-ttu-id="b0d74-259">Ad esempio "un record è stato inserito in una tabella" non è un evento del dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-259">For example, "a record was inserted into a table" is not a domain event.</span></span> <span data-ttu-id="b0d74-260">"Un recapito è stato annullato" è invece un evento del dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-260">"A delivery was cancelled" is a domain event.</span></span> <span data-ttu-id="b0d74-261">Gli eventi del dominio sono particolarmente importanti in un'architettura di microservizi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-261">Domain events are especially relevant in a microservices architecture.</span></span> <span data-ttu-id="b0d74-262">Poiché i microservizi sono distribuiti e non condividono archivi dati, gli eventi del dominio consentono ai microservizi di coordinarsi tra loro.</span><span class="sxs-lookup"><span data-stu-id="b0d74-262">Because microservices are distributed and don't share data stores, domain events provide a way for microservices to coordinate with each other.</span></span> <span data-ttu-id="b0d74-263">Nel capitolo relativo alla [comunicazione tra servizi](./interservice-communication.md) viene illustrata in dettaglio la messaggistica asincrona.</span><span class="sxs-lookup"><span data-stu-id="b0d74-263">The chapter [Interservice communication](./interservice-communication.md) discusses asynchronous messaging in more detail.</span></span>

<span data-ttu-id="b0d74-264">Esistono alcuni altri schemi di progettazione basata su dominio non elencati in questo documento, ad esempio factory, repository e moduli.</span><span class="sxs-lookup"><span data-stu-id="b0d74-264">There are a few other DDD patterns not listed here, including factories, repositories, and modules.</span></span> <span data-ttu-id="b0d74-265">Questi schemi possono risultare utili per implementare un microservizio ma sono meno pertinenti nella fase di progettazione dei limiti tra microservizi.</span><span class="sxs-lookup"><span data-stu-id="b0d74-265">These can be useful patterns for when you are implementing a microservice, but they are less relevant when designing the boundaries between microservice.</span></span>

## <a name="drone-delivery-applying-the-patterns"></a><span data-ttu-id="b0d74-266">Recapito tramite drone: applicazione degli schemi</span><span class="sxs-lookup"><span data-stu-id="b0d74-266">Drone delivery: Applying the patterns</span></span>

<span data-ttu-id="b0d74-267">Si inizia con gli scenari che dovrà gestire il contesto delimitato per il recapito.</span><span class="sxs-lookup"><span data-stu-id="b0d74-267">We start with the scenarios that the Shipping bounded context must handle.</span></span>

- <span data-ttu-id="b0d74-268">Un cliente può richiedere che un drone ritiri la merce da un'azienda registrata presso il servizio di recapito tramite drone.</span><span class="sxs-lookup"><span data-stu-id="b0d74-268">A customer can request a drone to pick up goods from a business that is registered with the drone delivery service.</span></span>
- <span data-ttu-id="b0d74-269">Il mittente genera un'etichetta (codice a barre o RFID) da posizionare sul pacchetto.</span><span class="sxs-lookup"><span data-stu-id="b0d74-269">The sender generates a tag (barcode or RFID) to put on the package.</span></span>
- <span data-ttu-id="b0d74-270">Un drone ritirerà e consegnerà il pacchetto dall'indirizzo di origine all'indirizzo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="b0d74-270">A drone will pick up and deliver a package from the source location to the destination location.</span></span>
- <span data-ttu-id="b0d74-271">Quando un cliente pianifica un recapito, il sistema fornisce un tempo stimato di completamento in base alle informazioni sull'itinerario, alle condizioni meteo e ai dati storici.</span><span class="sxs-lookup"><span data-stu-id="b0d74-271">When a customer schedules a delivery, the system provides an ETA based on route information, weather conditions, and historical data.</span></span>
- <span data-ttu-id="b0d74-272">Quando il drone è in volo, un utente può monitorare la posizione corrente e il tempo stimato per il completamento più recente.</span><span class="sxs-lookup"><span data-stu-id="b0d74-272">When the drone is in flight, a user can track the current location and the latest ETA.</span></span>
- <span data-ttu-id="b0d74-273">Fintanto che un drone non ritira il pacchetto, il cliente può ancora annullare il recapito.</span><span class="sxs-lookup"><span data-stu-id="b0d74-273">Until a drone has picked up the package, the customer can cancel a delivery.</span></span>
- <span data-ttu-id="b0d74-274">Il cliente riceve una notifica relativa all'avvenuto recapito.</span><span class="sxs-lookup"><span data-stu-id="b0d74-274">The customer is notified when the delivery is completed.</span></span>
- <span data-ttu-id="b0d74-275">Il mittente può richiedere la conferma di recapito dal cliente, sotto forma di firma o impronta digitale.</span><span class="sxs-lookup"><span data-stu-id="b0d74-275">The sender can request delivery confirmation from the customer, in the form of a signature or finger print.</span></span>
- <span data-ttu-id="b0d74-276">Gli utenti possono visualizzare la cronologia di un recapito completato.</span><span class="sxs-lookup"><span data-stu-id="b0d74-276">Users can look up the history of a completed delivery.</span></span>

<span data-ttu-id="b0d74-277">Da questi scenari, il team di sviluppo ha identificato le **entità seguenti**.</span><span class="sxs-lookup"><span data-stu-id="b0d74-277">From these scenarios, the development team identified the following **entities**.</span></span>

- <span data-ttu-id="b0d74-278">Recapito</span><span class="sxs-lookup"><span data-stu-id="b0d74-278">Delivery</span></span>
- <span data-ttu-id="b0d74-279">Pacchetto</span><span class="sxs-lookup"><span data-stu-id="b0d74-279">Package</span></span>
- <span data-ttu-id="b0d74-280">Drone</span><span class="sxs-lookup"><span data-stu-id="b0d74-280">Drone</span></span>
- <span data-ttu-id="b0d74-281">Account</span><span class="sxs-lookup"><span data-stu-id="b0d74-281">Account</span></span>
- <span data-ttu-id="b0d74-282">Conferma</span><span class="sxs-lookup"><span data-stu-id="b0d74-282">Confirmation</span></span>
- <span data-ttu-id="b0d74-283">Notifica</span><span class="sxs-lookup"><span data-stu-id="b0d74-283">Notification</span></span>
- <span data-ttu-id="b0d74-284">Tag</span><span class="sxs-lookup"><span data-stu-id="b0d74-284">Tag</span></span>

<span data-ttu-id="b0d74-285">Le prime quattro, ovvero recapito, pacchetto, drone e account, sono tutte **aggregazioni** che rappresentano limiti di coerenza transazionali.</span><span class="sxs-lookup"><span data-stu-id="b0d74-285">The first four, Delivery, Package, Drone, and Account, are all **aggregates** that represent transactional consistency boundaries.</span></span> <span data-ttu-id="b0d74-286">Le conferme e le notifiche sono entità figlio dei recapiti e le etichette sono entità figlio dei pacchetti.</span><span class="sxs-lookup"><span data-stu-id="b0d74-286">Confirmations and Notifications are child entities of Deliveries, and Tags are child entities of Packages.</span></span>

<span data-ttu-id="b0d74-287">Gli **oggetti valore** in questa progettazione includono l'indirizzo, il tempo stimato per il completamento, il peso del pacchetto e le dimensioni del pacchetto.</span><span class="sxs-lookup"><span data-stu-id="b0d74-287">The **value objects** in this design include Location, ETA, PackageWeight, and PackageSize.</span></span>

<span data-ttu-id="b0d74-288">A titolo di esempio, ecco un diagramma UML dell'aggregazione relativa al recapito.</span><span class="sxs-lookup"><span data-stu-id="b0d74-288">To illustrate, here is a UML diagram of the Delivery aggregate.</span></span> <span data-ttu-id="b0d74-289">Si noti che include riferimenti ad altre aggregazioni, ovvero account, pacchetto e drone.</span><span class="sxs-lookup"><span data-stu-id="b0d74-289">Notice that it holds references to other aggregates, including Account, Package, and Drone.</span></span>

![Diagramma UML dell'aggregazione relativa al recapito](./images/delivery-entity.png)

<span data-ttu-id="b0d74-291">Sono presenti due eventi del dominio:</span><span class="sxs-lookup"><span data-stu-id="b0d74-291">There are two domain events:</span></span>

- <span data-ttu-id="b0d74-292">Mentre un drone è in volo, l'entità drone invia eventi DroneStatus che descrivono la posizione e lo stato (in volo, atterrato) del drone.</span><span class="sxs-lookup"><span data-stu-id="b0d74-292">While a drone is in flight, the Drone entity sends DroneStatus events that describe the drone's location and status (in-flight, landed).</span></span>

- <span data-ttu-id="b0d74-293">L'entità recapito invia eventi DeliveryTracking ogni volta che cambia la fase di una consegna.</span><span class="sxs-lookup"><span data-stu-id="b0d74-293">The Delivery entity sends DeliveryTracking events whenever the stage of a delivery changes.</span></span> <span data-ttu-id="b0d74-294">I valori sono DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff e DeliveryCompleted.</span><span class="sxs-lookup"><span data-stu-id="b0d74-294">These include DeliveryCreated, DeliveryRescheduled, DeliveryHeadedToDropoff, and DeliveryCompleted.</span></span>

<span data-ttu-id="b0d74-295">Si noti che questi eventi descrivono elementi che risultano significativi all'interno del modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="b0d74-295">Notice that these events describe things that are meaningful within the domain model.</span></span> <span data-ttu-id="b0d74-296">Forniscono informazioni sul dominio e non sono legati a un costrutto di linguaggio di programmazione specifico.</span><span class="sxs-lookup"><span data-stu-id="b0d74-296">They describe something about the domain, and aren't tied to a particular programming language construct.</span></span>

<span data-ttu-id="b0d74-297">Il team di sviluppo ha identificato un'altra area di funzionalità, che non rientra perfettamente nelle entità descritte finora.</span><span class="sxs-lookup"><span data-stu-id="b0d74-297">The development team identified one more area of functionality, which doesn't fit neatly into any of the entities described so far.</span></span> <span data-ttu-id="b0d74-298">Alcune parti del sistema devono coordinare tutte le fasi coinvolte nella pianificazione o nell'aggiornamento di un recapito.</span><span class="sxs-lookup"><span data-stu-id="b0d74-298">Some part of the system must coordinate all of the steps involved in scheduling or updating a delivery.</span></span> <span data-ttu-id="b0d74-299">Di conseguenza, il team di sviluppo ha aggiunto alla progettazione due **servizi del dominio**: un'*utilità di pianificazione* che coordina le fasi e un *supervisore* che monitora lo stato di ogni fase per individuare l'eventuale esito negativo o timeout di una fase. Questa è una variante del [modello di supervisione agente di pianificazione](../patterns/scheduler-agent-supervisor.md).</span><span class="sxs-lookup"><span data-stu-id="b0d74-299">Therefore, the development team added two **domain services** to the design: a *Scheduler* that coordinates the steps, and a *Supervisor* that monitors the status of each step, in order to detect whether any steps have failed or timed out. This is a variation of the [Scheduler Agent Supervisor pattern](../patterns/scheduler-agent-supervisor.md).</span></span>

![Diagramma del modello di dominio modificato](./images/drone-ddd.png)

> [!div class="nextstepaction"]
> [<span data-ttu-id="b0d74-301">Identificazione dei limiti dei microservizi</span><span class="sxs-lookup"><span data-stu-id="b0d74-301">Identifying microservice boundaries</span></span>](./microservice-boundaries.md)
