---
title: Gateway API
description: Gateway API nei microservizi
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: 6483d416363e24f4084d6b856847a740bf4054d9
ms.sourcegitcommit: a8453c4bc7c870fa1a12bb3c02e3b310db87530c
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 12/29/2017
ms.locfileid: "27549179"
---
# <a name="designing-microservices-api-gateways"></a><span data-ttu-id="82e82-103">Progettazione di microservizi: gateway API</span><span class="sxs-lookup"><span data-stu-id="82e82-103">Designing microservices: API gateways</span></span>

<span data-ttu-id="82e82-104">In un'architettura di microservizi, un client potrebbe interagire con più servizi front-end.</span><span class="sxs-lookup"><span data-stu-id="82e82-104">In a microservices architecture, a client might interact with more than one front-end service.</span></span> <span data-ttu-id="82e82-105">In questo caso, come determina gli endpoint da chiamare?</span><span class="sxs-lookup"><span data-stu-id="82e82-105">Given this fact, how does a client know what endpoints to call?</span></span> <span data-ttu-id="82e82-106">Che cosa accade in caso di introduzione di nuovi servizi o di refactoring dei servizi esistenti?</span><span class="sxs-lookup"><span data-stu-id="82e82-106">What happens when new services are introduced, or existing services are refactored?</span></span> <span data-ttu-id="82e82-107">Come vengono gestiti dai servizi la terminazione SSL, l'autenticazione e altri aspetti?</span><span class="sxs-lookup"><span data-stu-id="82e82-107">How do services handle SSL termination, authentication, and other concerns?</span></span> <span data-ttu-id="82e82-108">Un *gateway API* consente di risolvere queste problematiche.</span><span class="sxs-lookup"><span data-stu-id="82e82-108">An *API gateway* can help to address these challenges.</span></span> 

![](./images/gateway.png)

## <a name="what-is-an-api-gateway"></a><span data-ttu-id="82e82-109">Informazioni sui gateway API</span><span class="sxs-lookup"><span data-stu-id="82e82-109">What is an API gateway?</span></span>

<span data-ttu-id="82e82-110">Un gateway API si trova tra i client e i servizi</span><span class="sxs-lookup"><span data-stu-id="82e82-110">An API gateway sits between clients and services.</span></span> <span data-ttu-id="82e82-111">e funge da proxy inverso, indirizzando le richieste dai client ai servizi.</span><span class="sxs-lookup"><span data-stu-id="82e82-111">It acts as a reverse proxy, routing requests from clients to services.</span></span> <span data-ttu-id="82e82-112">Può anche eseguire varie attività trasversali come l'autenticazione, la terminazione SSL e la limitazione della frequenza.</span><span class="sxs-lookup"><span data-stu-id="82e82-112">It may also perform various cross-cutting tasks such as authentication, SSL termination, and rate limiting.</span></span> <span data-ttu-id="82e82-113">Se non si distribuisce un gateway, i client devono inviare le richieste direttamente ai servizi front-end.</span><span class="sxs-lookup"><span data-stu-id="82e82-113">If you don't deploy a gateway, clients must send requests directly to front-end services.</span></span> <span data-ttu-id="82e82-114">L'esposizione diretta dei servizi ai client, tuttavia, presenta alcuni potenziali problemi:</span><span class="sxs-lookup"><span data-stu-id="82e82-114">However, there are some potential problems with exposing services directly to clients:</span></span>

- <span data-ttu-id="82e82-115">Può determinare codice client complesso.</span><span class="sxs-lookup"><span data-stu-id="82e82-115">It can result in complex client code.</span></span> <span data-ttu-id="82e82-116">Il client deve tenere traccia di più endpoint e gestire gli errori in modo resiliente.</span><span class="sxs-lookup"><span data-stu-id="82e82-116">The client must keep track of multiple endpoints, and handle failures in a resilient way.</span></span> 
- <span data-ttu-id="82e82-117">Crea un accoppiamento tra client e back-end.</span><span class="sxs-lookup"><span data-stu-id="82e82-117">It creates coupling between the client and the backend.</span></span> <span data-ttu-id="82e82-118">Il client deve conoscere la scomposizione dei singoli servizi.</span><span class="sxs-lookup"><span data-stu-id="82e82-118">The client needs to know how the individual services are decomposed.</span></span> <span data-ttu-id="82e82-119">Questo rende più difficile gestire il client nonché effettuare il refactoring dei servizi.</span><span class="sxs-lookup"><span data-stu-id="82e82-119">That makes it harder to maintain the client and also harder to refactor services.</span></span>
- <span data-ttu-id="82e82-120">Per una singola operazione possono essere necessarie chiamate a più servizi.</span><span class="sxs-lookup"><span data-stu-id="82e82-120">A single operation might require calls to multiple services.</span></span> <span data-ttu-id="82e82-121">Questo può determinare più round trip in rete tra il client e il server e causare così una latenza significativa.</span><span class="sxs-lookup"><span data-stu-id="82e82-121">That can result in multiple network round trips between the client and the server, adding significant latency.</span></span> 
- <span data-ttu-id="82e82-122">Ogni servizio pubblico deve gestire aspetti come autenticazione, SSL e limitazione della frequenza dei client.</span><span class="sxs-lookup"><span data-stu-id="82e82-122">Each public-facing service must handle concerns such as authentication, SSL, and client rate limiting.</span></span> 
- <span data-ttu-id="82e82-123">I servizi devono esporre un protocollo adatto ai client come HTTP o WebSocket.</span><span class="sxs-lookup"><span data-stu-id="82e82-123">Services must expose a client-friendly protocol such as HTTP or WebSocket.</span></span> <span data-ttu-id="82e82-124">Questo limita la scelta dei [protocolli di comunicazione](./interservice-communication.md).</span><span class="sxs-lookup"><span data-stu-id="82e82-124">This limits the choice of [communication protocols](./interservice-communication.md).</span></span> 
- <span data-ttu-id="82e82-125">I servizi con endpoint pubblici sono una potenziale superficie di attacco e necessitano di protezione avanzata.</span><span class="sxs-lookup"><span data-stu-id="82e82-125">Services with public endpoints are a potential attack surface, and must be hardened.</span></span>

<span data-ttu-id="82e82-126">Un gateway consente di risolvere questi problemi separando i client dai servizi.</span><span class="sxs-lookup"><span data-stu-id="82e82-126">A gateway helps to address these issues by decoupling clients from services.</span></span> <span data-ttu-id="82e82-127">I gateway possono eseguire molte diverse funzioni e non tutte potrebbero essere necessarie.</span><span class="sxs-lookup"><span data-stu-id="82e82-127">Gateways can perform a number of different functions, and you may not need all of them.</span></span> <span data-ttu-id="82e82-128">Le funzioni possono essere raggruppate negli schemi progettuali seguenti:</span><span class="sxs-lookup"><span data-stu-id="82e82-128">The functions can be grouped into the following design patterns:</span></span>

<span data-ttu-id="82e82-129">[Routing del gateway](../patterns/gateway-routing.md).</span><span class="sxs-lookup"><span data-stu-id="82e82-129">[Gateway Routing](../patterns/gateway-routing.md).</span></span> <span data-ttu-id="82e82-130">Usare il gateway come proxy inverso per indirizzare le richieste a uno o più servizi back-end, con routing di livello 7.</span><span class="sxs-lookup"><span data-stu-id="82e82-130">Use the gateway as a reverse proxy to route requests to one or more backend services, using layer 7 routing.</span></span> <span data-ttu-id="82e82-131">Il gateway offre un singolo endpoint per i client e consente di separare i client dai servizi.</span><span class="sxs-lookup"><span data-stu-id="82e82-131">The gateway provides a single endpoint for clients, and helps to decouple clients from services.</span></span> 

<span data-ttu-id="82e82-132">[Aggregazione tramite il gateway](../patterns/gateway-aggregation.md).</span><span class="sxs-lookup"><span data-stu-id="82e82-132">[Gateway Aggregation](../patterns/gateway-aggregation.md).</span></span> <span data-ttu-id="82e82-133">Usare il gateway per aggregare più richieste singole in un'unica richiesta.</span><span class="sxs-lookup"><span data-stu-id="82e82-133">Use the gateway to aggregate multiple individual requests into a single request.</span></span> <span data-ttu-id="82e82-134">Questo schema si applica quando per una singola operazione sono necessarie chiamate a più servizi back-end.</span><span class="sxs-lookup"><span data-stu-id="82e82-134">This pattern applies when a single operation requires calls to multiple backend services.</span></span> <span data-ttu-id="82e82-135">Il client invia una richiesta al gateway,</span><span class="sxs-lookup"><span data-stu-id="82e82-135">The client sends one request to the gateway.</span></span> <span data-ttu-id="82e82-136">che recapita le richieste ai vari servizi back-end e quindi aggrega i risultati e li invia al client.</span><span class="sxs-lookup"><span data-stu-id="82e82-136">The gateway dispatches requests to the various backend services, and then aggregates the results and sends them back to the client.</span></span> <span data-ttu-id="82e82-137">Questo consente di ridurre la quantità di comunicazioni tra client e back-end.</span><span class="sxs-lookup"><span data-stu-id="82e82-137">This helps to reduce chattiness between the client and the backend.</span></span> 

<span data-ttu-id="82e82-138">[Offload al gateway](../patterns/gateway-offloading.md).</span><span class="sxs-lookup"><span data-stu-id="82e82-138">[Gateway Offloading](../patterns/gateway-offloading.md).</span></span> <span data-ttu-id="82e82-139">Usare il gateway per eseguire l'offload delle funzionalità dai singoli servizi al gateway, soprattutto per aspetti trasversali.</span><span class="sxs-lookup"><span data-stu-id="82e82-139">Use the gateway to offload functionality from individual services to the gateway, particularly cross-cutting concerns.</span></span> <span data-ttu-id="82e82-140">Può essere utile per consolidare tali funzioni in un'unica posizione anziché affidarne l'implementazione a ogni servizio,</span><span class="sxs-lookup"><span data-stu-id="82e82-140">It can be useful to consolidate these functions into one place, rather than making every service responsible for implementing them.</span></span> <span data-ttu-id="82e82-141">in particolare per le funzionalità la cui implementazione richiede competenze specializzate, come l'autenticazione e l'autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="82e82-141">This is particularly true for features that requires specialized skills to implement correctly, such as authentication and authorization.</span></span> 

<span data-ttu-id="82e82-142">Di seguito sono riportati alcuni esempi di funzionalità di cui è possibile eseguire l'offload a un gateway:</span><span class="sxs-lookup"><span data-stu-id="82e82-142">Here are some examples of functionality that could be offloaded to a gateway:</span></span>

- <span data-ttu-id="82e82-143">Terminazione SSL</span><span class="sxs-lookup"><span data-stu-id="82e82-143">SSL termination</span></span>
- <span data-ttu-id="82e82-144">Autenticazione</span><span class="sxs-lookup"><span data-stu-id="82e82-144">Authentication</span></span>
- <span data-ttu-id="82e82-145">Inserimento nell'elenco di IP consentiti</span><span class="sxs-lookup"><span data-stu-id="82e82-145">IP whitelisting</span></span>
- <span data-ttu-id="82e82-146">Limitazione della frequenza dei client (limitazione delle richieste)</span><span class="sxs-lookup"><span data-stu-id="82e82-146">Client rate limiting (throttling)</span></span>
- <span data-ttu-id="82e82-147">Registrazione e monitoraggio</span><span class="sxs-lookup"><span data-stu-id="82e82-147">Logging and monitoring</span></span>
- <span data-ttu-id="82e82-148">Memorizzazione delle risposte nella cache</span><span class="sxs-lookup"><span data-stu-id="82e82-148">Response caching</span></span>
- <span data-ttu-id="82e82-149">Web application firewall</span><span class="sxs-lookup"><span data-stu-id="82e82-149">Web application firewall</span></span>
- <span data-ttu-id="82e82-150">Compressione GZIP</span><span class="sxs-lookup"><span data-stu-id="82e82-150">GZIP compression</span></span>
- <span data-ttu-id="82e82-151">Gestione di contenuto statico</span><span class="sxs-lookup"><span data-stu-id="82e82-151">Servicing static content</span></span>

## <a name="choosing-a-gateway-technology"></a><span data-ttu-id="82e82-152">Scelta di una tecnologia gateway</span><span class="sxs-lookup"><span data-stu-id="82e82-152">Choosing a gateway technology</span></span>

<span data-ttu-id="82e82-153">Di seguito sono riportate alcune opzioni per l'implementazione di un gateway API nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="82e82-153">Here are some options for implementing an API gateway in your application.</span></span>

- <span data-ttu-id="82e82-154">**Server proxy inverso**.</span><span class="sxs-lookup"><span data-stu-id="82e82-154">**Reverse proxy server**.</span></span> <span data-ttu-id="82e82-155">Nginx e HAProxy sono server proxy inversi che supportano funzionalità come bilanciamento del carico, SSL e routing di livello 7.</span><span class="sxs-lookup"><span data-stu-id="82e82-155">Nginx and HAProxy are popular reverse proxy servers that support features such as load balancing, SSL, and layer 7 routing.</span></span> <span data-ttu-id="82e82-156">Entrambi sono prodotti open source gratuiti, con edizioni a pagamento che offrono funzionalità aggiuntive e opzioni di supporto.</span><span class="sxs-lookup"><span data-stu-id="82e82-156">They are both free, open-source products, with paid editions that provide additional features and support options.</span></span> <span data-ttu-id="82e82-157">Sia Nginx che HAProxy sono prodotti avanzati con ampi set di funzionalità e prestazioni elevate.</span><span class="sxs-lookup"><span data-stu-id="82e82-157">Nginx and HAProxy are both mature products with rich feature sets and high performance.</span></span> <span data-ttu-id="82e82-158">Possono essere estesi con moduli di terze parti o scrivendo script personalizzati in Lua.</span><span class="sxs-lookup"><span data-stu-id="82e82-158">You can extend them with third-party modules or by writing custom scripts in Lua.</span></span> <span data-ttu-id="82e82-159">Nginx supporta anche un modulo di scripting basato su JavaScript denominato NginScript.</span><span class="sxs-lookup"><span data-stu-id="82e82-159">Nginx also supports a JavaScript-based scripting module called NginScript.</span></span>

- <span data-ttu-id="82e82-160">**Controller di ingresso per rete mesh di servizi**.</span><span class="sxs-lookup"><span data-stu-id="82e82-160">**Service mesh ingress controller**.</span></span> <span data-ttu-id="82e82-161">Se si usa una rete mesh di servizi come Linkerd o Istio, considerare le funzionalità offerte dal controller di ingresso per tale rete mesh.</span><span class="sxs-lookup"><span data-stu-id="82e82-161">If you are using a service mesh such as linkerd or Istio, consider the features that are provided by the ingress controller for that service mesh.</span></span> <span data-ttu-id="82e82-162">Il controller di ingresso Istio, ad esempio, supporta il routing di livello 7, i reindirizzamenti HTTP, la ripetizione dei tentativi e altre funzionalità.</span><span class="sxs-lookup"><span data-stu-id="82e82-162">For example, the Istio ingress controller supports layer 7 routing, HTTP redirects, retries, and other features.</span></span> 

- <span data-ttu-id="82e82-163">[Gateway applicazione di Azure](/azure/application-gateway/).</span><span class="sxs-lookup"><span data-stu-id="82e82-163">[Azure Application Gateway](/azure/application-gateway/).</span></span> <span data-ttu-id="82e82-164">Il gateway applicazione è un servizio di bilanciamento del carico gestito che può eseguire il routing di livello 7 e la terminazione SSL.</span><span class="sxs-lookup"><span data-stu-id="82e82-164">Application Gateway is a managed load balancing service that can perform layer-7 routing and SSL termination.</span></span> <span data-ttu-id="82e82-165">Offre anche un Web application firewall (WAF).</span><span class="sxs-lookup"><span data-stu-id="82e82-165">It also provides a web application firewall (WAF).</span></span>

- <span data-ttu-id="82e82-166">[Gestione API di Azure](/azure/api-management/).</span><span class="sxs-lookup"><span data-stu-id="82e82-166">[Azure API Management](/azure/api-management/).</span></span> <span data-ttu-id="82e82-167">Gestione API è una soluzione chiavi in mano per la pubblicazione di API per clienti interni ed esterni.</span><span class="sxs-lookup"><span data-stu-id="82e82-167">API Management is a turnkey solution for publishing APIs to external and internal customers.</span></span> <span data-ttu-id="82e82-168">Offre funzionalità utili per la gestione di un'API pubblica, tra cui la limitazione della frequenza, l'inserimento nell'elenco di IP consentiti e l'autenticazione con Azure Active Directory o altri provider di identità.</span><span class="sxs-lookup"><span data-stu-id="82e82-168">It provides features that are useful for managing a public-facing API, including rate limiting, IP white listing, and authentication using Azure Active Directory or other identity providers.</span></span> <span data-ttu-id="82e82-169">Gestione API non esegue alcun bilanciamento del carico e dovrà quindi essere usato insieme a un servizio di bilanciamento del carico come il gateway applicazione o un proxy inverso.</span><span class="sxs-lookup"><span data-stu-id="82e82-169">API Management doesn't perform any load balancing, so it should be used in conjunction with a load balancer such as Application Gateway or a reverse proxy.</span></span>

<span data-ttu-id="82e82-170">Nella scelta di una tecnologia gateway, considerare quanto segue:</span><span class="sxs-lookup"><span data-stu-id="82e82-170">When choosing a gateway technology, consider the following:</span></span>

<span data-ttu-id="82e82-171">**Funzionalità**.</span><span class="sxs-lookup"><span data-stu-id="82e82-171">**Features**.</span></span> <span data-ttu-id="82e82-172">Tutte le opzioni elencate sopra supportano il routing di livello 7, ma il supporto per altre funzionalità può variare.</span><span class="sxs-lookup"><span data-stu-id="82e82-172">The options listed above all support layer 7 routing, but support for other features will vary.</span></span> <span data-ttu-id="82e82-173">È possibile distribuire più gateway in base alle funzionalità necessarie.</span><span class="sxs-lookup"><span data-stu-id="82e82-173">Depending on the features that you need, you might deploy more than one gateway.</span></span> 

<span data-ttu-id="82e82-174">**Distribuzione**.</span><span class="sxs-lookup"><span data-stu-id="82e82-174">**Deployment**.</span></span> <span data-ttu-id="82e82-175">Il gateway applicazione e Gestione API di Azure sono servizi gestiti.</span><span class="sxs-lookup"><span data-stu-id="82e82-175">Azure Application Gateway and API Management are managed services.</span></span> <span data-ttu-id="82e82-176">Nginx e HAProxy vengono in genere eseguiti in contenitori all'interno del cluster, ma possono essere anche distribuiti in VM dedicate all'esterno.</span><span class="sxs-lookup"><span data-stu-id="82e82-176">Nginx and HAProxy will typically run in containers inside the cluster, but can also be deployed to dedicated VMs outside of the cluster.</span></span> <span data-ttu-id="82e82-177">Questo consente di isolare il gateway dal resto del carico di lavoro, ma determina un maggiore sovraccarico di gestione.</span><span class="sxs-lookup"><span data-stu-id="82e82-177">This isolates the gateway from the rest of the workload, but incurs higher management overhead.</span></span>

<span data-ttu-id="82e82-178">**Gestione**.</span><span class="sxs-lookup"><span data-stu-id="82e82-178">**Management**.</span></span> <span data-ttu-id="82e82-179">Quando vengono aggiornati i servizi o ne vengono aggiunti di nuovi, potrebbe essere necessario aggiornare le regole di routing del gateway.</span><span class="sxs-lookup"><span data-stu-id="82e82-179">When services are updated or new services are added, the gateway routing rules may need to be updated.</span></span> <span data-ttu-id="82e82-180">Considerare come verrà gestito questo processo.</span><span class="sxs-lookup"><span data-stu-id="82e82-180">Consider how this process will be managed.</span></span> <span data-ttu-id="82e82-181">Considerazioni simili si applicano alla gestione dei certificati SSL, degli elenchi di IP consentiti e di altri aspetti della configurazione.</span><span class="sxs-lookup"><span data-stu-id="82e82-181">Similar considerations apply to managing SSL certificates, IP whitelists, and other aspects of configuration.</span></span>

## <a name="deployment-considerations"></a><span data-ttu-id="82e82-182">Considerazioni sulla distribuzione</span><span class="sxs-lookup"><span data-stu-id="82e82-182">Deployment considerations</span></span>

### <a name="deploying-nginx-or-haproxy-to-kubernetes"></a><span data-ttu-id="82e82-183">Distribuzione di Nginx o HAProxy in Kubernetes</span><span class="sxs-lookup"><span data-stu-id="82e82-183">Deploying Nginx or HAProxy to Kubernetes</span></span>

<span data-ttu-id="82e82-184">È possibile distribuire Nginx o HAProxy in Kubernetes come [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) o [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) che specifica l'immagine del contenitore di Nginx o HAProxy.</span><span class="sxs-lookup"><span data-stu-id="82e82-184">You can deploy Nginx or HAProxy to Kubernetes as a [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) or [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) that specifies the Nginx or HAProxy container image.</span></span> <span data-ttu-id="82e82-185">Usare un oggetto ConfigMap per archiviare il file di configurazione per il proxy e montare ConfigMap come volume.</span><span class="sxs-lookup"><span data-stu-id="82e82-185">Use a ConfigMap to store the configuration file for the proxy, and mount the ConfigMap as a volume.</span></span> <span data-ttu-id="82e82-186">Creare un servizio di tipo LoadBalancer per esporre il gateway tramite un'istanza di Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="82e82-186">Create a service of type LoadBalancer to expose the gateway through an Azure Load Balancer.</span></span> 

<!-- - Configure a readiness probe that serves a static file from the gateway (rather than routing to another service). -->

<span data-ttu-id="82e82-187">In alternativa, creare un controller di ingresso.</span><span class="sxs-lookup"><span data-stu-id="82e82-187">An alternative is to create an Ingress Controller.</span></span> <span data-ttu-id="82e82-188">Un controller di ingresso è una risorsa Kubernetes che distribuisce un servizio di bilanciamento del carico o un server proxy inverso.</span><span class="sxs-lookup"><span data-stu-id="82e82-188">An Ingress Controller is a Kubernetes resource that deploys a load balancer or reverse proxy server.</span></span> <span data-ttu-id="82e82-189">Sono disponibili diverse implementazioni, che includono Nginx e HAProxy.</span><span class="sxs-lookup"><span data-stu-id="82e82-189">Several implementations exist, including Nginx and HAProxy.</span></span> <span data-ttu-id="82e82-190">Una risorsa separata denominata ingresso definisce le impostazioni per il controller di ingresso, come le regole di routing e i certificati TLS.</span><span class="sxs-lookup"><span data-stu-id="82e82-190">A separate resource called an Ingress defines settings for the Ingress Controller, such as routing rules and TLS certificates.</span></span> <span data-ttu-id="82e82-191">In questo modo, non è necessario gestire file di configurazione complessi specifici di una determinata tecnologia server proxy.</span><span class="sxs-lookup"><span data-stu-id="82e82-191">That way, you don't need to manage complex configuration files that are specific to a particular proxy server technology.</span></span> <span data-ttu-id="82e82-192">Al momento della stesura di questo articolo, i controller di ingresso sono ancora una funzionalità beta di Kubernetes che continuerà a evolversi.</span><span class="sxs-lookup"><span data-stu-id="82e82-192">Ingress Controllers are still a beta feature of Kubernetes at the time of this writing, and the feature will continue to evolve.</span></span>

<span data-ttu-id="82e82-193">Dato che il gateway è un potenziale collo di bottiglia o singolo punto di guasto nel sistema, distribuire sempre almeno due repliche per garantire disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="82e82-193">The gateway is a potential bottleneck or single point of failure in the system, so always deploy at least two replicas for high availability.</span></span> <span data-ttu-id="82e82-194">A seconda del carico, potrebbe essere necessario aumentare il numero di istanze delle repliche.</span><span class="sxs-lookup"><span data-stu-id="82e82-194">You may need to scale out the replicas further, depending on the load.</span></span> 

<span data-ttu-id="82e82-195">Valutare anche la possibilità di eseguire il gateway in un set di nodi dedicato nel cluster.</span><span class="sxs-lookup"><span data-stu-id="82e82-195">Also consider running the gateway on a dedicated set of nodes in the cluster.</span></span> <span data-ttu-id="82e82-196">Questo approccio offre i vantaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="82e82-196">Benefits to this approach include:</span></span>

- <span data-ttu-id="82e82-197">Isolamento.</span><span class="sxs-lookup"><span data-stu-id="82e82-197">Isolation.</span></span> <span data-ttu-id="82e82-198">Tutto il traffico in ingresso è indirizzato a un set fisso di nodi, che può essere isolato dai servizi back-end.</span><span class="sxs-lookup"><span data-stu-id="82e82-198">All inbound traffic goes to a fixed set of nodes, which can be isolated from backend services.</span></span>

- <span data-ttu-id="82e82-199">Configurazione stabile.</span><span class="sxs-lookup"><span data-stu-id="82e82-199">Stable configuration.</span></span> <span data-ttu-id="82e82-200">Se il gateway non è configurato correttamente, l'intera applicazione non sarà disponibile.</span><span class="sxs-lookup"><span data-stu-id="82e82-200">If the gateway is misconfigured, the entire application may become unavailable.</span></span> 

- <span data-ttu-id="82e82-201">Prestazioni.</span><span class="sxs-lookup"><span data-stu-id="82e82-201">Performance.</span></span> <span data-ttu-id="82e82-202">Per motivi di prestazioni può essere opportuno usare una specifica configurazione di VM per il gateway.</span><span class="sxs-lookup"><span data-stu-id="82e82-202">You may want to use a specific VM configuration for the gateway for performance reasons.</span></span>

<!-- - Load balancing. You can configure the external load balancer so that requests always go to a gateway node. That can save a network hop, which would otherwise happen whenever a request lands on a node that isn't running a gateway pod. This consideration applies mainly to large clusters, where the gateway runs on a relatively small fraction of the total nodes. In Azure Container Service (ACS), this approach currently requires [ACS Engine](https://github.com/Azure/acs-engine)) which allows you to create multiple agent pools. Then you can deploy the gateway as a DaemonSet to the front-end pool. -->

### <a name="azure-application-gateway"></a><span data-ttu-id="82e82-203">Gateway applicazione di Azure</span><span class="sxs-lookup"><span data-stu-id="82e82-203">Azure Application Gateway</span></span>

<span data-ttu-id="82e82-204">Per connettere il gateway applicazione a un cluster Kubernetes in Azure:</span><span class="sxs-lookup"><span data-stu-id="82e82-204">To connect Application Gateway to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="82e82-205">Creare una subnet vuota nella rete virtuale del cluster.</span><span class="sxs-lookup"><span data-stu-id="82e82-205">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="82e82-206">Distribuire il gateway applicazione.</span><span class="sxs-lookup"><span data-stu-id="82e82-206">Deploy Application Gateway.</span></span>
3. <span data-ttu-id="82e82-207">Creare un servizio Kubernetes di tipo [NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span><span class="sxs-lookup"><span data-stu-id="82e82-207">Create a Kubernetes service with type=[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span></span> <span data-ttu-id="82e82-208">In questo modo, il servizio viene esposto in ogni nodo ed è quindi raggiungibile dall'esterno del cluster.</span><span class="sxs-lookup"><span data-stu-id="82e82-208">This exposes the service on each node so that it can be reached from outside the cluster.</span></span> <span data-ttu-id="82e82-209">Non viene creato un servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="82e82-209">It does not create a load balancer.</span></span>
5. <span data-ttu-id="82e82-210">Ottenere il numero di porta assegnato per il servizio.</span><span class="sxs-lookup"><span data-stu-id="82e82-210">Get the assigned port number for the service.</span></span>
6. <span data-ttu-id="82e82-211">Aggiungere una regola del gateway applicazione con le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="82e82-211">Add an Application Gateway rule where:</span></span>
    - <span data-ttu-id="82e82-212">Il pool back-end contiene le VM dell'agente.</span><span class="sxs-lookup"><span data-stu-id="82e82-212">The backend pool contains the agent VMs.</span></span>
    - <span data-ttu-id="82e82-213">L'impostazione HTTP specifica il numero di porta del servizio.</span><span class="sxs-lookup"><span data-stu-id="82e82-213">The HTTP setting specifies the service port number.</span></span>
    - <span data-ttu-id="82e82-214">Il listener del gateway è in ascolto sulle porte 80/443.</span><span class="sxs-lookup"><span data-stu-id="82e82-214">The gateway listener listens on ports 80/443</span></span>
    
<span data-ttu-id="82e82-215">Impostare il numero di istanze su almeno 2 per garantire disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="82e82-215">Set the instance count to 2 or more for high availability.</span></span>

### <a name="azure-api-management"></a><span data-ttu-id="82e82-216">Gestione API di Azure</span><span class="sxs-lookup"><span data-stu-id="82e82-216">Azure API Management</span></span> 

<span data-ttu-id="82e82-217">Per connettere Gestione API a un cluster Kubernetes in Azure:</span><span class="sxs-lookup"><span data-stu-id="82e82-217">To connect API Management to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="82e82-218">Creare una subnet vuota nella rete virtuale del cluster.</span><span class="sxs-lookup"><span data-stu-id="82e82-218">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="82e82-219">Distribuire Gestione API in tale subnet.</span><span class="sxs-lookup"><span data-stu-id="82e82-219">Deploy API Management to that subnet.</span></span>
3. <span data-ttu-id="82e82-220">Creare un servizio Kubernetes di tipo LoadBalancer.</span><span class="sxs-lookup"><span data-stu-id="82e82-220">Create a Kubernetes service of type LoadBalancer.</span></span> <span data-ttu-id="82e82-221">Usare l'annotazione di [servizio di bilanciamento del carico interno](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) per creare un servizio di bilanciamento del carico interno anziché Internet come da impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="82e82-221">Use the [internal load balancer](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) annotation to create an internal load balancer, instead of an Internet-facing load balancer, which is the default.</span></span>
4. <span data-ttu-id="82e82-222">Trovare l'indirizzo IP privato del servizio di bilanciamento del carico interno usando kubectl o l'interfaccia della riga di comando di Azure.</span><span class="sxs-lookup"><span data-stu-id="82e82-222">Find the private IP of the internal load balancer, using kubectl or the Azure CLI.</span></span>
5. <span data-ttu-id="82e82-223">Usare Gestione API per creare un'API che indirizzi all'IP privato del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="82e82-223">Use API Management to create an API that directs to the private IP address of the load balancer.</span></span>

<span data-ttu-id="82e82-224">Valutare la possibilità di combinare Gestione API con un proxy inverso, come Nginx, HAProxy o il gateway applicazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="82e82-224">Consider combining API Management with a reverse proxy, whether Nginx, HAProxy, or Azure Application Gateway.</span></span> <span data-ttu-id="82e82-225">Per informazioni sull'uso di Gestione API con il gateway applicazione, vedere [Integrare Gestione API in una rete virtuale interna con un gateway applicazione](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span><span class="sxs-lookup"><span data-stu-id="82e82-225">For information about using API Management with Application Gateway, see [Integrate API Management in an internal VNET with Application Gateway](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="82e82-226">Registrazione e monitoraggio</span><span class="sxs-lookup"><span data-stu-id="82e82-226">Logging and monitoring</span></span>](./logging-monitoring.md)
