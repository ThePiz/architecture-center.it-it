---
title: CI/CD per microservizi
description: Integrazione continua e recapito continuo per microservizi.
author: MikeWasson
ms.date: 03/27/2019
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: c52ff3d0a330f564e5f7e9b0b07f0ba84c328c8b
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2019
ms.locfileid: "59639785"
---
# <a name="cicd-for-microservices-architectures"></a><span data-ttu-id="24071-103">Integrazione continua/recapito Continuo per le architetture di microservizi</span><span class="sxs-lookup"><span data-stu-id="24071-103">CI/CD for microservices architectures</span></span>

<span data-ttu-id="24071-104">Velocizzare i cicli di rilascio sono uno dei principali vantaggi di architetture di microservizi.</span><span class="sxs-lookup"><span data-stu-id="24071-104">Faster release cycles are one of the major advantages of microservices architectures.</span></span> <span data-ttu-id="24071-105">Ma senza un valido processo CI/CD, per non ottenere la flessibilità offerta dai microservizi.</span><span class="sxs-lookup"><span data-stu-id="24071-105">But without a good CI/CD process, you won't achieve the agility that microservices promise.</span></span> <span data-ttu-id="24071-106">Questo articolo vengono descritte le problematiche e alcuni approcci consigliabili il problema.</span><span class="sxs-lookup"><span data-stu-id="24071-106">This article describes the challenges and recommends some approaches to the problem.</span></span>

## <a name="what-is-cicd"></a><span data-ttu-id="24071-107">Che cos'è l'integrazione continua/recapito Continuo?</span><span class="sxs-lookup"><span data-stu-id="24071-107">What is CI/CD?</span></span>

<span data-ttu-id="24071-108">Quando si parla di integrazione continua/recapito Continuo, stiamo davvero parlando di diversi processi correlati: integrazione continua, recapito continuo e distribuzione continua.</span><span class="sxs-lookup"><span data-stu-id="24071-108">When we talk about CI/CD, we're really talking about several related processes: Continuous integration, continuous delivery, and continuous deployment.</span></span>

- <span data-ttu-id="24071-109">**Integrazione continua**.</span><span class="sxs-lookup"><span data-stu-id="24071-109">**Continuous integration**.</span></span> <span data-ttu-id="24071-110">Le modifiche al codice vengono unite frequentemente nel ramo principale.</span><span class="sxs-lookup"><span data-stu-id="24071-110">Code changes are frequently merged into the main branch.</span></span> <span data-ttu-id="24071-111">Compilazione automatizzata e assicurarsi che i processi di test che codice nel branch principale è sempre produzione di qualità.</span><span class="sxs-lookup"><span data-stu-id="24071-111">Automated build and test processes ensure that code in the main branch is always production-quality.</span></span>

- <span data-ttu-id="24071-112">**Recapito continuo**.</span><span class="sxs-lookup"><span data-stu-id="24071-112">**Continuous delivery**.</span></span> <span data-ttu-id="24071-113">Modifiche al codice che superano il processo di integrazione continua vengono automaticamente pubblicate in un ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="24071-113">Any code changes that pass the CI process are automatically published to a production-like environment.</span></span> <span data-ttu-id="24071-114">La distribuzione nell'ambiente di produzione live può richiedere l'approvazione manuale, ma per il resto è automatizzata.</span><span class="sxs-lookup"><span data-stu-id="24071-114">Deployment into the live production environment may require manual approval, but is otherwise automated.</span></span> <span data-ttu-id="24071-115">L'obiettivo è fare in modo che il codice sia sempre *pronto* per la distribuzione in produzione.</span><span class="sxs-lookup"><span data-stu-id="24071-115">The goal is that your code should always be *ready* to deploy into production.</span></span>

- <span data-ttu-id="24071-116">**Distribuzione continua**.</span><span class="sxs-lookup"><span data-stu-id="24071-116">**Continuous deployment**.</span></span> <span data-ttu-id="24071-117">Modifica di codice che passano i due passaggi precedenti vengono distribuiti automaticamente *nell'ambiente di produzione*.</span><span class="sxs-lookup"><span data-stu-id="24071-117">Code changes that pass the previous two steps are automatically deployed *into production*.</span></span>

<span data-ttu-id="24071-118">Di seguito alcuni obiettivi relativi a un processo di CI/CD affidabile per un'architettura di microservizi:</span><span class="sxs-lookup"><span data-stu-id="24071-118">Here are some goals of a robust CI/CD process for a microservices architecture:</span></span>

- <span data-ttu-id="24071-119">Ogni team può creare e distribuire i servizi di sua proprietà in modo indipendente, senza influenzare o interrompere gli altri team.</span><span class="sxs-lookup"><span data-stu-id="24071-119">Each team can build and deploy the services that it owns independently, without affecting or disrupting other teams.</span></span>

- <span data-ttu-id="24071-120">Prima che una nuova versione di un servizio venga distribuita all'ambiente di produzione, viene distribuita agli ambienti di sviluppo/test/controllo qualità per la convalida.</span><span class="sxs-lookup"><span data-stu-id="24071-120">Before a new version of a service is deployed to production, it gets deployed to dev/test/QA environments for validation.</span></span> <span data-ttu-id="24071-121">I controlli di qualità vengono applicati in ogni fase.</span><span class="sxs-lookup"><span data-stu-id="24071-121">Quality gates are enforced at each stage.</span></span>

- <span data-ttu-id="24071-122">Una nuova versione di un servizio può essere distribuita side alla versione precedente.</span><span class="sxs-lookup"><span data-stu-id="24071-122">A new version of a service can be deployed side by side with the previous version.</span></span>

- <span data-ttu-id="24071-123">Vengono applicati sufficienti criteri di controllo di accesso.</span><span class="sxs-lookup"><span data-stu-id="24071-123">Sufficient access control policies are in place.</span></span>

- <span data-ttu-id="24071-124">Per i carichi di lavoro in contenitori, si possono considerare attendibili le immagini del contenitore che vengono distribuite nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="24071-124">For containerized workloads, you can trust the container images that are deployed to production.</span></span>

## <a name="why-a-robust-cicd-pipeline-matters"></a><span data-ttu-id="24071-125">Importanza di una solida pipeline CI/CD</span><span class="sxs-lookup"><span data-stu-id="24071-125">Why a robust CI/CD pipeline matters</span></span>

<span data-ttu-id="24071-126">In un'applicazione monolitica tradizionale, è presente un'unica pipeline di compilazione il cui output è l'eseguibile dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="24071-126">In a traditional monolithic application, there is a single build pipeline whose output is the application executable.</span></span> <span data-ttu-id="24071-127">Tutte le attività di sviluppo confluiscono in questa pipeline.</span><span class="sxs-lookup"><span data-stu-id="24071-127">All development work feeds into this pipeline.</span></span> <span data-ttu-id="24071-128">Se viene trovato un bug ad alta priorità, è necessario integrare, testare e pubblicare una correzione e questo può ritardare il rilascio di nuove funzionalità.</span><span class="sxs-lookup"><span data-stu-id="24071-128">If a high-priority bug is found, a fix must be integrated, tested, and published, which can delay the release of new features.</span></span> <span data-ttu-id="24071-129">È possibile attenuare questi problemi con i moduli con refactoring corretto e utilizzando i rami di funzionalità per ridurre al minimo l'impatto delle modifiche al codice.</span><span class="sxs-lookup"><span data-stu-id="24071-129">You can mitigate these problems by having well-factored modules and using feature branches to minimize the impact of code changes.</span></span> <span data-ttu-id="24071-130">Con l'aumento della complessità dell'applicazione e l'aggiunta di altre funzionalità, tuttavia, il processo di rilascio di un'applicazione monolitica tende a diventare più delicato e soggetto a errori.</span><span class="sxs-lookup"><span data-stu-id="24071-130">But as the application grows more complex, and more features are added, the release process for a monolith tends to become more brittle and likely to break.</span></span>

<span data-ttu-id="24071-131">Seguendo la filosofia dei microservizi, non è mai previsto un lungo processo di rilascio che richiede l'allineamento di ogni team.</span><span class="sxs-lookup"><span data-stu-id="24071-131">Following the microservices philosophy, there should never be a long release train where every team has to get in line.</span></span> <span data-ttu-id="24071-132">Il team che compila il servizio "A" può rilasciare un aggiornamento in qualsiasi momento, senza attendere che vengano unite, testate e distribuite modifiche nel servizio "B".</span><span class="sxs-lookup"><span data-stu-id="24071-132">The team that builds service "A" can release an update at any time, without waiting for changes in service "B" to be merged, tested, and deployed.</span></span>

![Diagramma di un'applicazione monolitica di CI/CD](./images/cicd-monolith.png)

<span data-ttu-id="24071-134">Per ottenere una velocità elevata, la pipeline di versione deve essere automatizzata e altamente affidabile, per ridurre al minimo i rischi.</span><span class="sxs-lookup"><span data-stu-id="24071-134">To achieve a high release velocity, your release pipeline must be automated and highly reliable, to minimize risk.</span></span> <span data-ttu-id="24071-135">Se si rilascia nell'ambiente di produzione ogni giorno o più volte al giorno, le regressioni o interruzioni del servizio devono essere molto rare.</span><span class="sxs-lookup"><span data-stu-id="24071-135">If you release to production daily or multiple times a day, regressions or service disruptions must be very rare.</span></span> <span data-ttu-id="24071-136">Al tempo stesso, in caso di distribuzione di un aggiornamento non valido è necessario poter eseguire in modo rapido e affidabile il rollback o il rollforward a una versione precedente di un servizio.</span><span class="sxs-lookup"><span data-stu-id="24071-136">At the same time, if a bad update does get deployed, you must have a reliable way to quickly roll back or roll forward to a previous version of a service.</span></span>

## <a name="challenges"></a><span data-ttu-id="24071-137">Problematiche</span><span class="sxs-lookup"><span data-stu-id="24071-137">Challenges</span></span>

- <span data-ttu-id="24071-138">**Molte basi di codice indipendenti di piccole dimensioni**.</span><span class="sxs-lookup"><span data-stu-id="24071-138">**Many small independent code bases**.</span></span> <span data-ttu-id="24071-139">Ogni team è responsabile della compilazione del proprio servizio, con una propria pipeline di compilazione.</span><span class="sxs-lookup"><span data-stu-id="24071-139">Each team is responsible for building its own service, with its own build pipeline.</span></span> <span data-ttu-id="24071-140">In alcune organizzazioni, i team possono usare repository di codice separati.</span><span class="sxs-lookup"><span data-stu-id="24071-140">In some organizations, teams may use separate code repositories.</span></span> <span data-ttu-id="24071-141">Repository separati può causare una situazione in cui la conoscenza di come compilare il sistema viene distribuita tra i team e nessuno nell'organizzazione sappia come distribuire l'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="24071-141">Separate repositories can lead to a situation where the knowledge of how to build the system is spread across teams, and nobody in the organization knows how to deploy the entire application.</span></span> <span data-ttu-id="24071-142">Che cosa accade ad esempio in uno scenario di ripristino di emergenza, se è necessario eseguire rapidamente la distribuzione in un nuovo cluster?</span><span class="sxs-lookup"><span data-stu-id="24071-142">For example, what happens in a disaster recovery scenario, if you need to quickly deploy to a new cluster?</span></span>

    <span data-ttu-id="24071-143">**Mitigazione**: Dispone di una pipeline unificata e automatizzata per compilare e distribuire servizi, in modo che queste informazioni non sono "nascosta" all'interno di ogni team.</span><span class="sxs-lookup"><span data-stu-id="24071-143">**Mitigation**: Have a unified and automated pipeline to build and deploy services, so that this knowledge is not "hidden" within each team.</span></span>

- <span data-ttu-id="24071-144">**Più linguaggi e framework**.</span><span class="sxs-lookup"><span data-stu-id="24071-144">**Multiple languages and frameworks**.</span></span> <span data-ttu-id="24071-145">Se ogni team usa una propria combinazione di tecnologie, può essere difficile creare un unico processo di compilazione che possa essere usato nell'intera organizzazione.</span><span class="sxs-lookup"><span data-stu-id="24071-145">With each team using its own mix of technologies, it can be difficult to create a single build process that works across the organization.</span></span> <span data-ttu-id="24071-146">Il processo di compilazione deve essere sufficientemente flessibile da poter essere adattato da ogni team al linguaggio o al framework scelto.</span><span class="sxs-lookup"><span data-stu-id="24071-146">The build process must be flexible enough that every team can adapt it for their choice of language or framework.</span></span>

    <span data-ttu-id="24071-147">**Mitigazione**: Distribuire in un contenitore il processo di compilazione per ogni servizio.</span><span class="sxs-lookup"><span data-stu-id="24071-147">**Mitigation**: Containerize the build process for each service.</span></span> <span data-ttu-id="24071-148">In questo modo, il sistema di compilazione deve solo essere in grado di eseguire i contenitori.</span><span class="sxs-lookup"><span data-stu-id="24071-148">That way, the build system just needs to be able to run the containers.</span></span>

- <span data-ttu-id="24071-149">**Integrazione e test di carico**.</span><span class="sxs-lookup"><span data-stu-id="24071-149">**Integration and load testing**.</span></span> <span data-ttu-id="24071-150">Se i team rilasciano aggiornamenti al proprio ritmo, può essere difficile progettare test end-to-end affidabili, soprattutto quando i servizi includono dipendenze da altri servizi.</span><span class="sxs-lookup"><span data-stu-id="24071-150">With teams releasing updates at their own pace, it can be challenging to design robust end-to-end testing, especially when services have dependencies on other services.</span></span> <span data-ttu-id="24071-151">Inoltre, l'esecuzione di un cluster di produzione completo possono risultare costosi, è improbabile che ogni team eseguirà il proprio cluster completo a livello di produzione, solo per i test.</span><span class="sxs-lookup"><span data-stu-id="24071-151">Moreover, running a full production cluster can be expensive, so it's unlikely that every team will run its own full cluster at production scales, just for testing.</span></span>

- <span data-ttu-id="24071-152">**Gestione del rilascio**.</span><span class="sxs-lookup"><span data-stu-id="24071-152">**Release management**.</span></span> <span data-ttu-id="24071-153">Ogni team deve essere in grado di distribuire un aggiornamento nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="24071-153">Every team should be able to deploy an update to production.</span></span> <span data-ttu-id="24071-154">Ciò non significa assegnare a ogni membro del team le autorizzazioni necessarie a tale scopo.</span><span class="sxs-lookup"><span data-stu-id="24071-154">That doesn't mean that every team member has permissions to do so.</span></span> <span data-ttu-id="24071-155">Un ruolo di responsabile del rilascio centralizzato, tuttavia, può ridurre la velocità delle distribuzioni.</span><span class="sxs-lookup"><span data-stu-id="24071-155">But having a centralized Release Manager role can reduce the velocity of deployments.</span></span>

    <span data-ttu-id="24071-156">**Mitigazione**: Maggiore è il livello di automazione e affidabilità del processo CI/CD, minore sarà l'esigenza di un'autorità centrale.</span><span class="sxs-lookup"><span data-stu-id="24071-156">**Mitigation**: The more that your CI/CD process is automated and reliable, the less there should be a need for a central authority.</span></span> <span data-ttu-id="24071-157">È tuttavia possibile usare criteri diversi per il rilascio degli aggiornamenti di funzionalità principali e delle correzioni di bug secondarie.</span><span class="sxs-lookup"><span data-stu-id="24071-157">That said, you might have different policies for releasing major feature updates versus minor bug fixes.</span></span> <span data-ttu-id="24071-158">In corso decentralizzato non significa che zero governance.</span><span class="sxs-lookup"><span data-stu-id="24071-158">Being decentralized doesn't mean zero governance.</span></span>

- <span data-ttu-id="24071-159">**Aggiornamenti dei servizi**.</span><span class="sxs-lookup"><span data-stu-id="24071-159">**Service updates**.</span></span> <span data-ttu-id="24071-160">L'aggiornamento di un servizio a una nuova versione non dovrà comportare interruzioni per gli altri servizi che dipendono da esso.</span><span class="sxs-lookup"><span data-stu-id="24071-160">When you update a service to a new version, it shouldn't break other services that depend on it.</span></span>

    <span data-ttu-id="24071-161">**Mitigazione**: Usare le tecniche di distribuzione, ad esempio blue-green o canary versione per le modifiche non di rilievo.</span><span class="sxs-lookup"><span data-stu-id="24071-161">**Mitigation**: Use deployment techniques such as blue-green or canary release for non-breaking changes.</span></span> <span data-ttu-id="24071-162">Modifiche di rilievo API, distribuire la nuova versione affiancata alla versione precedente.</span><span class="sxs-lookup"><span data-stu-id="24071-162">For breaking API changes, deploy the new version side by side with the previous version.</span></span> <span data-ttu-id="24071-163">In questo modo, i servizi che usano l'API precedente possono essere aggiornati e testati per la nuova API.</span><span class="sxs-lookup"><span data-stu-id="24071-163">That way, services that consume the previous API can be updated and tested for the new API.</span></span> <span data-ttu-id="24071-164">Visualizzare [l'aggiornamento di servizi](#updating-services)riportato di seguito.</span><span class="sxs-lookup"><span data-stu-id="24071-164">See [Updating services](#updating-services), below.</span></span>

## <a name="monorepo-vs-multi-repo"></a><span data-ttu-id="24071-165">Monorepo vs multi-repo</span><span class="sxs-lookup"><span data-stu-id="24071-165">Monorepo vs multi-repo</span></span>

<span data-ttu-id="24071-166">Prima di creare un flusso di lavoro CI/CD, è necessario sapere come verrà strutturata e gestita la base di codice.</span><span class="sxs-lookup"><span data-stu-id="24071-166">Before creating a CI/CD workflow, you must know how the code base will be structured and managed.</span></span>

- <span data-ttu-id="24071-167">I team lavorano in archivi separati o in un monorepo (unico repository)?</span><span class="sxs-lookup"><span data-stu-id="24071-167">Do teams work in separate repositories or in a monorepo (single repository)?</span></span>
- <span data-ttu-id="24071-168">Qual è la strategia per la creazione dei rami?</span><span class="sxs-lookup"><span data-stu-id="24071-168">What is your branching strategy?</span></span>
- <span data-ttu-id="24071-169">Chi può eseguire il push del codice nell'ambiente di produzione?</span><span class="sxs-lookup"><span data-stu-id="24071-169">Who can push code to production?</span></span> <span data-ttu-id="24071-170">Esiste un ruolo di responsabile del rilascio?</span><span class="sxs-lookup"><span data-stu-id="24071-170">Is there a release manager role?</span></span>

<span data-ttu-id="24071-171">L'approccio con singolo repository sta diventando popolare, ma esistono vantaggi e svantaggi per entrambi.</span><span class="sxs-lookup"><span data-stu-id="24071-171">The monorepo approach has been gaining favor but there are advantages and disadvantages to both.</span></span>

| &nbsp; | <span data-ttu-id="24071-172">Singolo repository</span><span class="sxs-lookup"><span data-stu-id="24071-172">Monorepo</span></span> | <span data-ttu-id="24071-173">Più repository</span><span class="sxs-lookup"><span data-stu-id="24071-173">Multiple repos</span></span> |
|--------|----------|----------------|
| <span data-ttu-id="24071-174">**Vantaggi**</span><span class="sxs-lookup"><span data-stu-id="24071-174">**Advantages**</span></span> | <span data-ttu-id="24071-175">Condivisione del codice</span><span class="sxs-lookup"><span data-stu-id="24071-175">Code sharing</span></span><br/><span data-ttu-id="24071-176">Più facile standardizzare codice e strumenti</span><span class="sxs-lookup"><span data-stu-id="24071-176">Easier to standardize code and tooling</span></span><br/><span data-ttu-id="24071-177">Più semplice effettuare il refactoring del codice</span><span class="sxs-lookup"><span data-stu-id="24071-177">Easier to refactor code</span></span><br/><span data-ttu-id="24071-178">Individuabilità - singola visualizzazione del codice</span><span class="sxs-lookup"><span data-stu-id="24071-178">Discoverability - single view of the code</span></span><br/> | <span data-ttu-id="24071-179">Proprietà chiara per ogni team</span><span class="sxs-lookup"><span data-stu-id="24071-179">Clear ownership per team</span></span><br/><span data-ttu-id="24071-180">Potenzialmente meno conflitti di merge</span><span class="sxs-lookup"><span data-stu-id="24071-180">Potentially fewer merge conflicts</span></span><br/><span data-ttu-id="24071-181">Favorire la separazione dei microservizi</span><span class="sxs-lookup"><span data-stu-id="24071-181">Helps to enforce decoupling of microservices</span></span> |
| <span data-ttu-id="24071-182">**Problematiche**</span><span class="sxs-lookup"><span data-stu-id="24071-182">**Challenges**</span></span> | <span data-ttu-id="24071-183">Le modifiche al codice condiviso possono influire su più microservizi</span><span class="sxs-lookup"><span data-stu-id="24071-183">Changes to shared code can affect multiple microservices</span></span><br/><span data-ttu-id="24071-184">Maggiore rischio di conflitti di merge</span><span class="sxs-lookup"><span data-stu-id="24071-184">Greater potential for merge conflicts</span></span><br/><span data-ttu-id="24071-185">Gli strumenti devono supportare una base di codice di grandi dimensioni</span><span class="sxs-lookup"><span data-stu-id="24071-185">Tooling must scale to a large code base</span></span><br/><span data-ttu-id="24071-186">Controllo di accesso</span><span class="sxs-lookup"><span data-stu-id="24071-186">Access control</span></span><br/><span data-ttu-id="24071-187">Processo di distribuzione più complesso</span><span class="sxs-lookup"><span data-stu-id="24071-187">More complex deployment process</span></span> | <span data-ttu-id="24071-188">Più difficile la condivisione del codice</span><span class="sxs-lookup"><span data-stu-id="24071-188">Harder to share code</span></span><br/><span data-ttu-id="24071-189">Più difficile applicare standard di codifica</span><span class="sxs-lookup"><span data-stu-id="24071-189">Harder to enforce coding standards</span></span><br/><span data-ttu-id="24071-190">Gestione delle dipendenze</span><span class="sxs-lookup"><span data-stu-id="24071-190">Dependency management</span></span><br/><span data-ttu-id="24071-191">Base di codice diffusa, scarsa individuabilità</span><span class="sxs-lookup"><span data-stu-id="24071-191">Diffuse code base, poor discoverability</span></span><br/><span data-ttu-id="24071-192">Mancanza di un'infrastruttura condivisa</span><span class="sxs-lookup"><span data-stu-id="24071-192">Lack of shared infrastructure</span></span>

## <a name="updating-services"></a><span data-ttu-id="24071-193">Aggiornamento dei servizi</span><span class="sxs-lookup"><span data-stu-id="24071-193">Updating services</span></span>

<span data-ttu-id="24071-194">Esistono varie strategie per aggiornare un servizio già in produzione.</span><span class="sxs-lookup"><span data-stu-id="24071-194">There are various strategies for updating a service that's already in production.</span></span> <span data-ttu-id="24071-195">Di seguito vengono illustrate tre opzioni comuni: aggiornamento in sequenza, distribuzione di tipo blu-verde e versione canary.</span><span class="sxs-lookup"><span data-stu-id="24071-195">Here we discuss three common options: Rolling update, blue-green deployment, and canary release.</span></span>

### <a name="rolling-updates"></a><span data-ttu-id="24071-196">Aggiornamenti in sequenza</span><span class="sxs-lookup"><span data-stu-id="24071-196">Rolling updates</span></span>

<span data-ttu-id="24071-197">In un aggiornamento in sequenza, si distribuiscono nuove istanze di un servizio e queste iniziano subito a ricevere richieste.</span><span class="sxs-lookup"><span data-stu-id="24071-197">In a rolling update, you deploy new instances of a service, and the new instances start receiving requests right away.</span></span> <span data-ttu-id="24071-198">Quando le nuove istanze diventano disponibili, quelle precedenti vengono rimosse.</span><span class="sxs-lookup"><span data-stu-id="24071-198">As the new instances come up, the previous instances are removed.</span></span>

<span data-ttu-id="24071-199">**Esempio.**</span><span class="sxs-lookup"><span data-stu-id="24071-199">**Example.**</span></span> <span data-ttu-id="24071-200">In Kubernetes, gli aggiornamenti in sequenza sono il comportamento predefinito quando si aggiorna la specifica del pod per una distribuzione.</span><span class="sxs-lookup"><span data-stu-id="24071-200">In Kubernetes, rolling updates are the default behavior when you update the pod spec for a Deployment.</span></span> <span data-ttu-id="24071-201">Il controller di distribuzione crea un nuovo ReplicaSet per i pod aggiornati.</span><span class="sxs-lookup"><span data-stu-id="24071-201">The Deployment controller creates a new ReplicaSet for the updated pods.</span></span> <span data-ttu-id="24071-202">Aumenta quindi le prestazioni del nuovo ReplicaSet riducendo al tempo stesso le prestazioni di quello precedente per gestire il numero di repliche desiderato.</span><span class="sxs-lookup"><span data-stu-id="24071-202">Then it scales up the new ReplicaSet while scaling down the old one, to maintain the desired replica count.</span></span> <span data-ttu-id="24071-203">I pod precedenti non vengono eliminati finché non sono pronti quelli nuovi.</span><span class="sxs-lookup"><span data-stu-id="24071-203">It doesn't delete old pods until the new ones are ready.</span></span> <span data-ttu-id="24071-204">Kubernetes mantiene una cronologia dell'aggiornamento, pertanto sarà possibile ripristinare un aggiornamento se necessario.</span><span class="sxs-lookup"><span data-stu-id="24071-204">Kubernetes keeps a history of the update, so you can roll back an update if needed.</span></span>

<span data-ttu-id="24071-205">Una problematica degli aggiornamenti in sequenza è rappresentata dal fatto che durante il processo di aggiornamento è in esecuzione e riceve traffico una combinazione di versioni nuove e precedenti.</span><span class="sxs-lookup"><span data-stu-id="24071-205">One challenge of rolling updates is that during the update process, a mix of old and new versions are running and receiving traffic.</span></span> <span data-ttu-id="24071-206">Durante tale periodo, qualsiasi richiesta potrebbe essere indirizzata a una delle due delle versioni.</span><span class="sxs-lookup"><span data-stu-id="24071-206">During this period, any request could get routed to either of the two versions.</span></span>

<span data-ttu-id="24071-207">Modifiche di rilievo API, è consigliabile supportare entrambe le versioni affiancate, fino a quando non vengono aggiornati tutti i client della versione precedente.</span><span class="sxs-lookup"><span data-stu-id="24071-207">For breaking API changes, a good practice is to support both versions side by side, until all clients of the previous version are updated.</span></span> <span data-ttu-id="24071-208">Visualizzare [controllo delle versioni API](./design/api-design.md#api-versioning).</span><span class="sxs-lookup"><span data-stu-id="24071-208">See [API versioning](./design/api-design.md#api-versioning).</span></span>

### <a name="blue-green-deployment"></a><span data-ttu-id="24071-209">Distribuzione di tipo blu-verde</span><span class="sxs-lookup"><span data-stu-id="24071-209">Blue-green deployment</span></span>

<span data-ttu-id="24071-210">In una distribuzione di tipo blu-verde, si distribuisce la nuova versione insieme alla precedente.</span><span class="sxs-lookup"><span data-stu-id="24071-210">In a blue-green deployment, you deploy the new version alongside the previous version.</span></span> <span data-ttu-id="24071-211">Dopo aver convalidato la nuova versione, si trasferisce tutto il traffico contemporaneamente dalla versione precedente alla nuova.</span><span class="sxs-lookup"><span data-stu-id="24071-211">After you validate the new version, you switch all traffic at once from the previous version to the new version.</span></span> <span data-ttu-id="24071-212">Dopo il trasferimento, si monitora l'applicazione per rilevare eventuali problemi.</span><span class="sxs-lookup"><span data-stu-id="24071-212">After the switch, you monitor the application for any problems.</span></span> <span data-ttu-id="24071-213">Se si verificano errori, è possibile tornare alla versione precedente.</span><span class="sxs-lookup"><span data-stu-id="24071-213">If something goes wrong, you can swap back to the old version.</span></span> <span data-ttu-id="24071-214">Supponendo che non sussistano problemi, è possibile eliminare la versione precedente.</span><span class="sxs-lookup"><span data-stu-id="24071-214">Assuming there are no problems, you can delete the old version.</span></span>

<span data-ttu-id="24071-215">Con un'applicazione monolitica o a più livelli più tradizionale, la distribuzione di tipo blu-verde comporta in genere il provisioning di due ambienti identici.</span><span class="sxs-lookup"><span data-stu-id="24071-215">With a more traditional monolithic or N-tier application, blue-green deployment generally meant provisioning two identical environments.</span></span> <span data-ttu-id="24071-216">Si distribuisce la nuova versione in un ambiente di staging, quindi si reindirizza il traffico client all'ambiente di staging, ad esempio scambiando gli indirizzi VIP.</span><span class="sxs-lookup"><span data-stu-id="24071-216">You would deploy the new version to a staging environment, then redirect client traffic to the staging environment &mdash; for example, by swapping VIP addresses.</span></span> <span data-ttu-id="24071-217">In un'architettura di microservizi, gli aggiornamenti vengono eseguiti a livello di microservizi, in modo che si sarebbe in genere distribuire l'aggiornamento nello stesso ambiente e utilizzano un meccanismo di individuazione servizio di scambio.</span><span class="sxs-lookup"><span data-stu-id="24071-217">In a microservices architecture, updates happen at the microservice level, so you would typically deploy the update into the same environment and use a service discovery mechanism to swap.</span></span>

<span data-ttu-id="24071-218">**Esempio**.</span><span class="sxs-lookup"><span data-stu-id="24071-218">**Example**.</span></span> <span data-ttu-id="24071-219">In Kubernetes, non è necessario effettuare il provisioning di un cluster separato per eseguire distribuzioni di tipo blu-verde.</span><span class="sxs-lookup"><span data-stu-id="24071-219">In Kubernetes, you don't need to provision a separate cluster to do blue-green deployments.</span></span> <span data-ttu-id="24071-220">È invece possibile sfruttare i selettori.</span><span class="sxs-lookup"><span data-stu-id="24071-220">Instead, you can take advantage of selectors.</span></span> <span data-ttu-id="24071-221">Creare una nuova risorsa di distribuzione con una nuova specifica di pod e un diverso set di etichette.</span><span class="sxs-lookup"><span data-stu-id="24071-221">Create a new Deployment resource with a new pod spec and a different set of labels.</span></span> <span data-ttu-id="24071-222">Creare questa distribuzione senza eliminare la precedente o modificare il servizio che vi fa riferimento.</span><span class="sxs-lookup"><span data-stu-id="24071-222">Create this deployment, without deleting the previous deployment or modifying the service that points to it.</span></span> <span data-ttu-id="24071-223">Quando i nuovi pod sono in esecuzione, è possibile aggiornare il selettore del servizio in base alla nuova distribuzione.</span><span class="sxs-lookup"><span data-stu-id="24071-223">Once the new pods are running, you can update the service's selector to match the new deployment.</span></span>

<span data-ttu-id="24071-224">Uno svantaggio della distribuzione di tipo blu-verde è che durante l'aggiornamento, si eseguono due volte come molte POD per il servizio (corrente e la successiva).</span><span class="sxs-lookup"><span data-stu-id="24071-224">One drawback of blue-green deployment is that during the update, you are running twice as many pods for the service (current and next).</span></span> <span data-ttu-id="24071-225">Se i pod richiedono una grande quantità di risorse di memoria o CPU, potrebbe essere necessario aumentare temporaneamente il numero di istanze del cluster per gestire l'utilizzo delle risorse.</span><span class="sxs-lookup"><span data-stu-id="24071-225">If the pods require a lot of CPU or memory resources, you may need to scale out the cluster temporarily to handle the resource consumption.</span></span>

### <a name="canary-release"></a><span data-ttu-id="24071-226">Versione canary</span><span class="sxs-lookup"><span data-stu-id="24071-226">Canary release</span></span>

<span data-ttu-id="24071-227">Con una versione canary, si implementa una versione aggiornata in un numero ridotto di client.</span><span class="sxs-lookup"><span data-stu-id="24071-227">In a canary release, you roll out an updated version to a small number of clients.</span></span> <span data-ttu-id="24071-228">Si monitora quindi il comportamento del nuovo servizio prima di procedere all'implementazione in tutti i client.</span><span class="sxs-lookup"><span data-stu-id="24071-228">Then you monitor the behavior of the new service before rolling it out to all clients.</span></span> <span data-ttu-id="24071-229">In questo modo è possibile eseguire un'implementazione lenta in modo controllato, osservare i dati reali e individuare i problemi prima che abbiano un impatto su tutti i clienti.</span><span class="sxs-lookup"><span data-stu-id="24071-229">This lets you do a slow rollout in a controlled fashion, observe real data, and spot problems before all customers are affected.</span></span>

<span data-ttu-id="24071-230">Una versione canary è più complessa da gestire rispetto a un aggiornamento in sequenza o di tipo blu-verde, perché è necessario indirizzare dinamicamente le richieste a versioni diverse del servizio.</span><span class="sxs-lookup"><span data-stu-id="24071-230">A canary release is more complex to manage than either blue-green or rolling update, because you must dynamically route requests to different versions of the service.</span></span>

<span data-ttu-id="24071-231">**Esempio**.</span><span class="sxs-lookup"><span data-stu-id="24071-231">**Example**.</span></span> <span data-ttu-id="24071-232">In Kubernetes, è possibile configurare un servizio in modo da includere due set di replica (uno per ogni versione) e modificare manualmente i numeri di repliche.</span><span class="sxs-lookup"><span data-stu-id="24071-232">In Kubernetes, you can configure a Service to span two replica sets (one for each version) and adjust the replica counts manually.</span></span> <span data-ttu-id="24071-233">Questo approccio presenta tuttavia una granularità piuttosto grossolana a causa del modo in cui Kubernetes bilancia il carico tra i pod.</span><span class="sxs-lookup"><span data-stu-id="24071-233">However, this approach is rather coarse-grained, because of the way Kubernetes load balances across pods.</span></span> <span data-ttu-id="24071-234">Ad esempio, se si dispone di un totale di 10 repliche, è possibile spostare il traffico solo in incrementi del 10%.</span><span class="sxs-lookup"><span data-stu-id="24071-234">For example, if you have a total of 10 replicas, you can only shift traffic in 10% increments.</span></span> <span data-ttu-id="24071-235">Se si usa una rete mesh di servizi, è possibile usare le relative regole di routing per implementare una strategia di versione canary più sofisticata.</span><span class="sxs-lookup"><span data-stu-id="24071-235">If you are using a service mesh, you can use the service mesh routing rules to implement a more sophisticated canary release strategy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="24071-236">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="24071-236">Next steps</span></span>

<span data-ttu-id="24071-237">Informazioni specifiche procedure consigliate di integrazione continua/recapito Continuo per microservizi in esecuzione in Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="24071-237">Learn specific CI/CD practices for microservices running on Kubernetes.</span></span>

- [<span data-ttu-id="24071-238">Integrazione continua/recapito Continuo per microservizi in Kubernetes</span><span class="sxs-lookup"><span data-stu-id="24071-238">CI/CD for microservices on Kubernetes</span></span>](./ci-cd-kubernetes.md)