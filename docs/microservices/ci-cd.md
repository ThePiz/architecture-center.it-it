---
title: CI/CD per microservizi
description: Integrazione continua e recapito continuo per microservizi.
author: MikeWasson
ms.date: 10/23/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: 1a927beb23a2e45b509b2648a6bccce4c2ad242d
ms.sourcegitcommit: 0a8a60d782facc294f7f78ec0e9033e3ee16bf4a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/08/2019
ms.locfileid: "59068974"
---
# <a name="designing-microservices-continuous-integration"></a><span data-ttu-id="39629-103">Progettazione di microservizi: Integrazione continua</span><span class="sxs-lookup"><span data-stu-id="39629-103">Designing microservices: Continuous integration</span></span>

<span data-ttu-id="39629-104">Integrazione continua e recapito continuo (CI/CD) sono un requisito chiave per la riuscita dei microservizi.</span><span class="sxs-lookup"><span data-stu-id="39629-104">Continuous integration and continuous delivery (CI/CD) are a key requirement for achieving success with microservices.</span></span> <span data-ttu-id="39629-105">Senza un processo CI/CD, non si otterrà la flessibilità offerta dai microservizi.</span><span class="sxs-lookup"><span data-stu-id="39629-105">Without a good CI/CD process, you will not achieve the agility that microservices promise.</span></span> <span data-ttu-id="39629-106">Alcune problematiche di CI/CD per i microservizi derivano dalla presenza di più basi di codice e ambienti di compilazione eterogenei per i vari servizi.</span><span class="sxs-lookup"><span data-stu-id="39629-106">Some of the CI/CD challenges for microservices arise from having multiple code bases and heterogenous build environments for the various services.</span></span> <span data-ttu-id="39629-107">Questo articolo vengono descritte le problematiche e alcuni approcci consigliabili il problema.</span><span class="sxs-lookup"><span data-stu-id="39629-107">This article describes the challenges and recommends some approaches to the problem.</span></span>

![Diagramma di CI/CD per microservizi](./images/ci-cd.png)

<span data-ttu-id="39629-109">La maggiore rapidità dei cicli di rilascio è uno dei principali motivi per adottare un'architettura di microservizi.</span><span class="sxs-lookup"><span data-stu-id="39629-109">Faster release cycles are one of the biggest reasons to adopt a microservices architecture.</span></span>

<span data-ttu-id="39629-110">In un'applicazione puramente monolitica esiste un'unica pipeline di compilazione il cui output è l'eseguibile dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39629-110">In a purely monolithic application, there is a single build pipeline whose output is the application executable.</span></span> <span data-ttu-id="39629-111">Tutte le attività di sviluppo confluiscono in questa pipeline.</span><span class="sxs-lookup"><span data-stu-id="39629-111">All development work feeds into this pipeline.</span></span> <span data-ttu-id="39629-112">Se viene trovato un bug ad alta priorità, è necessario integrare, testare e pubblicare una correzione e questo può ritardare il rilascio di nuove funzionalità.</span><span class="sxs-lookup"><span data-stu-id="39629-112">If a high-priority bug is found, a fix must be integrated, tested, and published, which can delay the release of new features.</span></span> <span data-ttu-id="39629-113">Questi problemi possono essere attenuati con un factoring efficiente dei moduli e l'uso di rami di funzionalità per ridurre al minimo l'impatto delle modifiche al codice.</span><span class="sxs-lookup"><span data-stu-id="39629-113">It's true that you can mitigate these problems by having well-factored modules and using feature branches to minimize the impact of code changes.</span></span> <span data-ttu-id="39629-114">Con l'aumento della complessità dell'applicazione e l'aggiunta di altre funzionalità, tuttavia, il processo di rilascio di un'applicazione monolitica tende a diventare più delicato e soggetto a errori.</span><span class="sxs-lookup"><span data-stu-id="39629-114">But as the application grows more complex, and more features are added, the release process for a monolith tends to become more brittle and likely to break.</span></span>

<span data-ttu-id="39629-115">Seguendo la filosofia dei microservizi, non è mai previsto un lungo processo di rilascio che richiede l'allineamento di ogni team.</span><span class="sxs-lookup"><span data-stu-id="39629-115">Following the microservices philosophy, there should never be a long release train where every team has to get in line.</span></span> <span data-ttu-id="39629-116">Il team che compila il servizio "A" può rilasciare un aggiornamento in qualsiasi momento, senza attendere che vengano unite, testate e distribuite modifiche nel servizio "B".</span><span class="sxs-lookup"><span data-stu-id="39629-116">The team that builds service "A" can release an update at any time, without waiting for changes in service "B" to be merged, tested, and deployed.</span></span> <span data-ttu-id="39629-117">Il processo CI/CD è essenziale per consentire tutto questo.</span><span class="sxs-lookup"><span data-stu-id="39629-117">The CI/CD process is critical to making this possible.</span></span> <span data-ttu-id="39629-118">La pipeline di versione deve essere automatizzata e altamente affidabile, in modo da ridurre al minimo i rischi associati alla distribuzione di aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="39629-118">Your release pipeline must be automated and highly reliable, so that the risks of deploying updates are minimized.</span></span> <span data-ttu-id="39629-119">Se il rilascio in produzione viene eseguito ogni giorno o più volte al giorno, le regressioni o le interruzioni dei servizi devono essere molto rare.</span><span class="sxs-lookup"><span data-stu-id="39629-119">If you are releasing to production daily or multiple times a day, regressions or service disruptions must be very rare.</span></span> <span data-ttu-id="39629-120">Al tempo stesso, in caso di distribuzione di un aggiornamento non valido è necessario poter eseguire in modo rapido e affidabile il rollback o il rollforward a una versione precedente di un servizio.</span><span class="sxs-lookup"><span data-stu-id="39629-120">At the same time, if a bad update does get deployed, you must have a reliable way to quickly roll back or roll forward to a previous version of a service.</span></span>

![Diagramma di un'applicazione monolitica di CI/CD](./images/cicd-monolith.png)

<span data-ttu-id="39629-122">L'espressione "CI/CD" viene usata per fare riferimento a diversi processi correlati: integrazione continua, recapito continuo e distribuzione continua.</span><span class="sxs-lookup"><span data-stu-id="39629-122">When we talk about CI/CD, we are really talking about several related processes: Continuous integration, continuous delivery, and continuous deployment.</span></span>

- <span data-ttu-id="39629-123">Con l'integrazione continua, le modifiche al codice vengono unite frequentemente nel ramo principale usando processi di compilazione e test automatizzati in modo da garantire che il codice del ramo principale sia sempre di qualità idonea ad ambienti di produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-123">Continuous integration means that code changes are frequently merged into the main branch, using automated build and test processes to ensure that code in the main branch is always production-quality.</span></span>

- <span data-ttu-id="39629-124">Con il recapito continuo, le modifiche al codice che superano il processo di integrazione continua vengono pubblicate automaticamente in un ambiente di simil-produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-124">Continuous delivery means that code changes that pass the CI process are automatically published to a production-like environment.</span></span> <span data-ttu-id="39629-125">La distribuzione nell'ambiente di produzione live può richiedere l'approvazione manuale, ma per il resto è automatizzata.</span><span class="sxs-lookup"><span data-stu-id="39629-125">Deployment into the live production environment may require manual approval, but is otherwise automated.</span></span> <span data-ttu-id="39629-126">L'obiettivo è fare in modo che il codice sia sempre *pronto* per la distribuzione in produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-126">The goal is that your code should always be *ready* to deploy into production.</span></span>

- <span data-ttu-id="39629-127">Con la distribuzione continua, le modifiche al codice che superano il processo CI/CD vengono distribuite automaticamente in produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-127">Continuous deployment means that code changes that pass the CI/CD process are automatically deployed into production.</span></span>

<span data-ttu-id="39629-128">Nel contesto di Kubernetes e dei microservizi, la fase dell'integrazione continua riguarda la compilazione e il test di immagini di contenitori e il push di tali immagini in un registro contenitori.</span><span class="sxs-lookup"><span data-stu-id="39629-128">In the context of Kubernetes and microservices, the CI stage is concerned with building and testing container images, and pushing those images to a container registry.</span></span> <span data-ttu-id="39629-129">Nella fase della distribuzione, le specifiche dei pod vengono aggiornate in modo da usare l'immagine di produzione più recente.</span><span class="sxs-lookup"><span data-stu-id="39629-129">In the deployment stage, pod specs are updated to pick up the latest production image.</span></span>

## <a name="challenges"></a><span data-ttu-id="39629-130">Problematiche</span><span class="sxs-lookup"><span data-stu-id="39629-130">Challenges</span></span>

- <span data-ttu-id="39629-131">**Molte basi di codice indipendenti di piccole dimensioni**.</span><span class="sxs-lookup"><span data-stu-id="39629-131">**Many small independent code bases**.</span></span> <span data-ttu-id="39629-132">Ogni team è responsabile della compilazione del proprio servizio, con una propria pipeline di compilazione.</span><span class="sxs-lookup"><span data-stu-id="39629-132">Each team is responsible for building its own service, with its own build pipeline.</span></span> <span data-ttu-id="39629-133">In alcune organizzazioni, i team possono usare repository di codice separati.</span><span class="sxs-lookup"><span data-stu-id="39629-133">In some organizations, teams may use separate code repositories.</span></span> <span data-ttu-id="39629-134">È quindi possibile che le conoscenze per la compilazione del sistema siano distribuite tra i vari team e nessuno nell'organizzazione sappia come distribuire l'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="39629-134">This could lead to a situation where the knowledge of how to build the system is spread across teams, and nobody in the organization knows how to deploy the entire application.</span></span> <span data-ttu-id="39629-135">Che cosa accade ad esempio in uno scenario di ripristino di emergenza, se è necessario eseguire rapidamente la distribuzione in un nuovo cluster?</span><span class="sxs-lookup"><span data-stu-id="39629-135">For example, what happens in a disaster recovery scenario, if you need to quickly deploy to a new cluster?</span></span>

- <span data-ttu-id="39629-136">**Più linguaggi e framework**.</span><span class="sxs-lookup"><span data-stu-id="39629-136">**Multiple languages and frameworks**.</span></span> <span data-ttu-id="39629-137">Se ogni team usa una propria combinazione di tecnologie, può essere difficile creare un unico processo di compilazione che possa essere usato nell'intera organizzazione.</span><span class="sxs-lookup"><span data-stu-id="39629-137">With each team using its own mix of technologies, it can be difficult to create a single build process that works across the organization.</span></span> <span data-ttu-id="39629-138">Il processo di compilazione deve essere sufficientemente flessibile da poter essere adattato da ogni team al linguaggio o al framework scelto.</span><span class="sxs-lookup"><span data-stu-id="39629-138">The build process must be flexible enough that every team can adapt it for their choice of language or framework.</span></span>

- <span data-ttu-id="39629-139">**Integrazione e test di carico**.</span><span class="sxs-lookup"><span data-stu-id="39629-139">**Integration and load testing**.</span></span> <span data-ttu-id="39629-140">Se i team rilasciano aggiornamenti al proprio ritmo, può essere difficile progettare test end-to-end affidabili, soprattutto quando i servizi includono dipendenze da altri servizi.</span><span class="sxs-lookup"><span data-stu-id="39629-140">With teams releasing updates at their own pace, it can be challenging to design robust end-to-end testing, especially when services have dependencies on other services.</span></span> <span data-ttu-id="39629-141">Dato che l'esecuzione di un cluster di produzione completo può essere costosa, inoltre, è improbabile che ogni team possa eseguire il proprio cluster completo a livello di produzione solo a scopo di test.</span><span class="sxs-lookup"><span data-stu-id="39629-141">Moreover, running a full production cluster can be expensive, so it's unlikely that every team will be able to run its own full cluster at production scales, just for testing.</span></span>

- <span data-ttu-id="39629-142">**Gestione del rilascio**.</span><span class="sxs-lookup"><span data-stu-id="39629-142">**Release management**.</span></span> <span data-ttu-id="39629-143">Ogni team dovrebbe avere la possibilità di distribuire un aggiornamento in produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-143">Every team should have the ability to deploy an update to production.</span></span> <span data-ttu-id="39629-144">Ciò non significa assegnare a ogni membro del team le autorizzazioni necessarie a tale scopo.</span><span class="sxs-lookup"><span data-stu-id="39629-144">That doesn't mean that every team member has permissions to do so.</span></span> <span data-ttu-id="39629-145">Un ruolo di responsabile del rilascio centralizzato, tuttavia, può ridurre la velocità delle distribuzioni.</span><span class="sxs-lookup"><span data-stu-id="39629-145">But having a centralized Release Manager role can reduce the velocity of deployments.</span></span> <span data-ttu-id="39629-146">Maggiore è il livello di automazione e affidabilità del processo CI/CD, minore sarà l'esigenza di un'autorità centrale.</span><span class="sxs-lookup"><span data-stu-id="39629-146">The more that your CI/CD process is automated and reliable, the less there should be a need for a central authority.</span></span> <span data-ttu-id="39629-147">È tuttavia possibile usare criteri diversi per il rilascio degli aggiornamenti di funzionalità principali e delle correzioni di bug secondarie.</span><span class="sxs-lookup"><span data-stu-id="39629-147">That said, you might have different policies for releasing major feature updates versus minor bug fixes.</span></span> <span data-ttu-id="39629-148">La decentralizzazione non è sinonimo di zero governance.</span><span class="sxs-lookup"><span data-stu-id="39629-148">Being decentralized does not mean there should be zero governance.</span></span>

- <span data-ttu-id="39629-149">**Controllo delle versioni delle immagini di contenitori**.</span><span class="sxs-lookup"><span data-stu-id="39629-149">**Container image versioning**.</span></span> <span data-ttu-id="39629-150">Durante il ciclo di sviluppo e di test, il processo CI/CD compilerà molte immagini di contenitori.</span><span class="sxs-lookup"><span data-stu-id="39629-150">During the development and test cycle, the CI/CD process will build many container images.</span></span> <span data-ttu-id="39629-151">Solo alcune di queste sono candidati validi per il rilascio e successivamente il push in produzione verrà eseguito solo per alcuni di questi candidati al rilascio.</span><span class="sxs-lookup"><span data-stu-id="39629-151">Only some of those are candidates for release, and then only some of those release candidates will get pushed into production.</span></span> <span data-ttu-id="39629-152">È consigliabile avere una strategia di controllo delle versioni ben definita, in modo da sapere quali immagini sono attualmente distribuite in produzione e poter eseguire il rollback a una versione precedente, se necessario.</span><span class="sxs-lookup"><span data-stu-id="39629-152">You should have a clear versioning strategy, so that you know which images are currently deployed to production, and can roll back to a previous version if necessary.</span></span>

- <span data-ttu-id="39629-153">**Aggiornamenti dei servizi**.</span><span class="sxs-lookup"><span data-stu-id="39629-153">**Service updates**.</span></span> <span data-ttu-id="39629-154">L'aggiornamento di un servizio a una nuova versione non dovrà comportare interruzioni per gli altri servizi che dipendono da esso.</span><span class="sxs-lookup"><span data-stu-id="39629-154">When you update a service to a new version, it shouldn't break other services that depend on it.</span></span> <span data-ttu-id="39629-155">In caso di aggiornamento in sequenza, per un periodo di tempo verrà eseguita una combinazione di versioni.</span><span class="sxs-lookup"><span data-stu-id="39629-155">If you do a rolling update, there will be a period of time when a mix of versions is running.</span></span>

<span data-ttu-id="39629-156">Queste problematiche rispecchiano una tensione di fondo.</span><span class="sxs-lookup"><span data-stu-id="39629-156">These challenges reflect a fundamental tension.</span></span> <span data-ttu-id="39629-157">Da un lato, i team devono lavorare con la massima indipendenza possibile.</span><span class="sxs-lookup"><span data-stu-id="39629-157">On the one hand, teams need to work as independently as possible.</span></span> <span data-ttu-id="39629-158">Dall'altro, un certo coordinamento è necessario per consentire a una singola persona di eseguire attività come un test di integrazione, la ridistribuzione dell'intera soluzione in un nuovo cluster o il rollback di un aggiornamento non valido.</span><span class="sxs-lookup"><span data-stu-id="39629-158">On the other hand, some coordination is needed so that a single person can do tasks like running an integration test, redeploying the entire solution to a new cluster, or rolling back a bad update.</span></span>

## <a name="cicd-approaches-for-microservices"></a><span data-ttu-id="39629-159">Approcci CI/CD per i microservizi</span><span class="sxs-lookup"><span data-stu-id="39629-159">CI/CD approaches for microservices</span></span>

<span data-ttu-id="39629-160">È consigliabile che il team di ogni servizio includa il proprio ambiente di compilazione in un contenitore</span><span class="sxs-lookup"><span data-stu-id="39629-160">It's a good practice for every service team to containerize their build environment.</span></span> <span data-ttu-id="39629-161">e che in tale contenitore siano presenti tutti gli strumenti di compilazione necessari per compilare gli elementi di codice per il servizio.</span><span class="sxs-lookup"><span data-stu-id="39629-161">This container should have all of the build tools necessary to build the code artifacts for their service.</span></span> <span data-ttu-id="39629-162">Spesso è disponibile un'immagine Docker ufficiale per il linguaggio e il framework.</span><span class="sxs-lookup"><span data-stu-id="39629-162">Often you can find an official Docker image for your language and framework.</span></span> <span data-ttu-id="39629-163">È quindi possibile usare `docker run` o Docker Compose per eseguire la compilazione.</span><span class="sxs-lookup"><span data-stu-id="39629-163">Then you can use `docker run` or Docker Compose to run the build.</span></span>

<span data-ttu-id="39629-164">Con questo approccio, configurare un nuovo ambiente di compilazione è semplice.</span><span class="sxs-lookup"><span data-stu-id="39629-164">With this approach, it's trivial to set up a new build environment.</span></span> <span data-ttu-id="39629-165">Uno sviluppatore che vuole compilare il proprio codice non deve necessariamente installare un set di strumenti di compilazione, ma esegue semplicemente l'immagine del contenitore.</span><span class="sxs-lookup"><span data-stu-id="39629-165">A developer who wants to build your code doesn't need to install a set of build tools, but simply runs the container image.</span></span> <span data-ttu-id="39629-166">Un aspetto forse ancora più importante è che il server di compilazione può essere configurato per eseguire la stessa operazione.</span><span class="sxs-lookup"><span data-stu-id="39629-166">Perhaps more importantly, your build server can be configured to do the same thing.</span></span> <span data-ttu-id="39629-167">In questo modo, non è necessario installare tali strumenti nel server di compilazione o gestire versioni degli strumenti in conflitto.</span><span class="sxs-lookup"><span data-stu-id="39629-167">That way, you don't need to install those tools onto the build server, or manage conflicting versions of tools.</span></span>

<span data-ttu-id="39629-168">Per lo sviluppo e il test in locale, usare Docker per eseguire il servizio all'interno di un contenitore.</span><span class="sxs-lookup"><span data-stu-id="39629-168">For local development and testing, use Docker to run the service inside a container.</span></span> <span data-ttu-id="39629-169">Nell'ambito di questo processo, potrebbe essere necessario eseguire altri contenitori che includono servizi fittizi o database di test necessari per il test in locale.</span><span class="sxs-lookup"><span data-stu-id="39629-169">As part of this process, you may need to run other containers that have mock services or test databases needed for local testing.</span></span> <span data-ttu-id="39629-170">È possibile usare Docker Compose per coordinare questi contenitori oppure Minikube per eseguire Kubernetes in locale.</span><span class="sxs-lookup"><span data-stu-id="39629-170">You could use Docker Compose to coordinate these containers, or use Minikube to run Kubernetes locally.</span></span>

<span data-ttu-id="39629-171">Quando il codice è pronto, aprire una richiesta pull ed eseguire l'unione nel master.</span><span class="sxs-lookup"><span data-stu-id="39629-171">When the code is ready, open a pull request and merge into master.</span></span> <span data-ttu-id="39629-172">In questo modo verrà avviato un processo nel server di compilazione:</span><span class="sxs-lookup"><span data-stu-id="39629-172">This will start a job on the build server:</span></span>

1. <span data-ttu-id="39629-173">Compilare gli asset di codice.</span><span class="sxs-lookup"><span data-stu-id="39629-173">Build the code assets.</span></span>
2. <span data-ttu-id="39629-174">Eseguire unit test sul codice.</span><span class="sxs-lookup"><span data-stu-id="39629-174">Run unit tests against the code.</span></span>
3. <span data-ttu-id="39629-175">Compilare l'immagine del contenitore.</span><span class="sxs-lookup"><span data-stu-id="39629-175">Build the container image.</span></span>
4. <span data-ttu-id="39629-176">Testare l'immagine del contenitore eseguendo test funzionali su un contenitore in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="39629-176">Test the container image by running functional tests on a running container.</span></span> <span data-ttu-id="39629-177">Questo passaggio consente di rilevare errori nel file Docker, ad esempio un punto di ingresso non valido.</span><span class="sxs-lookup"><span data-stu-id="39629-177">This step can catch errors in the Docker file, such as a bad entry point.</span></span>
5. <span data-ttu-id="39629-178">Eseguire il push dell'immagine in un registro contenitori.</span><span class="sxs-lookup"><span data-stu-id="39629-178">Push the image to a container registry.</span></span>
6. <span data-ttu-id="39629-179">Aggiornare il cluster di test con la nuova immagine per eseguire test di integrazione.</span><span class="sxs-lookup"><span data-stu-id="39629-179">Update the test cluster with the new image to run integration tests.</span></span>

<span data-ttu-id="39629-180">Quando l'immagine è pronta per l'implementazione in produzione, aggiornare i file di distribuzione in base alle esigenze per specificare l'immagine più recente, includendo gli eventuali file di configurazione di Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="39629-180">When the image is ready to go into production, update the deployment files as needed to specify the latest image, including any Kubernetes configuration files.</span></span> <span data-ttu-id="39629-181">Applicare quindi l'aggiornamento al cluster di produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-181">Then apply the update to the production cluster.</span></span>

<span data-ttu-id="39629-182">Di seguito sono riportate alcune raccomandazioni per una maggiore affidabilità delle distribuzioni:</span><span class="sxs-lookup"><span data-stu-id="39629-182">Here are some recommendations for making deployments more reliable:</span></span>

- <span data-ttu-id="39629-183">Definire convenzioni a livello di organizzazione per i tag dei contenitori, il controllo delle versioni e la denominazione delle risorse distribuite nel cluster (pod, servizi e così via).</span><span class="sxs-lookup"><span data-stu-id="39629-183">Define organization-wide conventions for container tags, versioning, and naming conventions for resources deployed to the cluster (pods, services, and so on).</span></span> <span data-ttu-id="39629-184">Questo può facilitare la diagnosi dei problemi di distribuzione.</span><span class="sxs-lookup"><span data-stu-id="39629-184">That can make it easier to diagnose deployment issues.</span></span>

- <span data-ttu-id="39629-185">Creare due registri contenitori separati, uno per sviluppo e test e uno per la produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-185">Create two separate container registries, one for development/testing and one for production.</span></span> <span data-ttu-id="39629-186">Non eseguire il push di un'immagine nel registro per la produzione finché non si è pronti a distribuire l'immagine in produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-186">Don't push an image to the production registry until you're ready to deploy it into production.</span></span> <span data-ttu-id="39629-187">Combinando questa procedura con il versionamento semantico delle immagini di contenitori è possibile ridurre le probabilità di distribuire accidentalmente una versione il cui rilascio non è stato approvato.</span><span class="sxs-lookup"><span data-stu-id="39629-187">If you combine this practice with semantic versioning of container images, it can reduce the chance of accidentally deploying a version that wasn't approved for release.</span></span>

## <a name="updating-services"></a><span data-ttu-id="39629-188">Aggiornamento dei servizi</span><span class="sxs-lookup"><span data-stu-id="39629-188">Updating services</span></span>

<span data-ttu-id="39629-189">Esistono varie strategie per aggiornare un servizio già in produzione.</span><span class="sxs-lookup"><span data-stu-id="39629-189">There are various strategies for updating a service that's already in production.</span></span> <span data-ttu-id="39629-190">Di seguito vengono illustrate tre opzioni comuni: aggiornamento in sequenza, distribuzione di tipo blu-verde e versione canary.</span><span class="sxs-lookup"><span data-stu-id="39629-190">Here we discuss three common options: Rolling update, blue-green deployment, and canary release.</span></span>

### <a name="rolling-update"></a><span data-ttu-id="39629-191">Aggiornamento in sequenza</span><span class="sxs-lookup"><span data-stu-id="39629-191">Rolling update</span></span>

<span data-ttu-id="39629-192">In un aggiornamento in sequenza, si distribuiscono nuove istanze di un servizio e queste iniziano subito a ricevere richieste.</span><span class="sxs-lookup"><span data-stu-id="39629-192">In a rolling update, you deploy new instances of a service, and the new instances start receiving requests right away.</span></span> <span data-ttu-id="39629-193">Quando le nuove istanze diventano disponibili, quelle precedenti vengono rimosse.</span><span class="sxs-lookup"><span data-stu-id="39629-193">As the new instances come up, the previous instances are removed.</span></span>

<span data-ttu-id="39629-194">Gli aggiornamenti in sequenza sono il comportamento predefinito in Kubernetes quando si aggiorna la specifica del pod per una distribuzione.</span><span class="sxs-lookup"><span data-stu-id="39629-194">Rolling updates are the default behavior in Kubernetes when you update the pod spec for a Deployment.</span></span> <span data-ttu-id="39629-195">Il controller di distribuzione crea un nuovo ReplicaSet per i pod aggiornati.</span><span class="sxs-lookup"><span data-stu-id="39629-195">The Deployment controller creates a new ReplicaSet for the updated pods.</span></span> <span data-ttu-id="39629-196">Aumenta quindi le prestazioni del nuovo ReplicaSet riducendo al tempo stesso le prestazioni di quello precedente per gestire il numero di repliche desiderato.</span><span class="sxs-lookup"><span data-stu-id="39629-196">Then it scales up the new ReplicaSet while scaling down the old one, to maintain the desired replica count.</span></span> <span data-ttu-id="39629-197">I pod precedenti non vengono eliminati finché non sono pronti quelli nuovi.</span><span class="sxs-lookup"><span data-stu-id="39629-197">It doesn't delete old pods until the new ones are ready.</span></span> <span data-ttu-id="39629-198">Kubernetes mantiene una cronologia dell'aggiornamento ed è quindi possibile usare kubectl per eseguire il rollback di un aggiornamento, se necessario.</span><span class="sxs-lookup"><span data-stu-id="39629-198">Kubernetes keeps a history of the update, so you can use kubectl to roll back an update if needed.</span></span>

<span data-ttu-id="39629-199">Se il servizio esegue un'attività di avvio di lunga durata, è possibile definire un probe di idoneità,</span><span class="sxs-lookup"><span data-stu-id="39629-199">If your service performs a long startup task, you can define a readiness probe.</span></span> <span data-ttu-id="39629-200">che segnala quando il contenitore è pronto per iniziare a ricevere traffico.</span><span class="sxs-lookup"><span data-stu-id="39629-200">The readiness probe reports when the container is ready to start receiving traffic.</span></span> <span data-ttu-id="39629-201">Kubernetes non invierà traffico al pod finché il probe non segnala un esito positivo.</span><span class="sxs-lookup"><span data-stu-id="39629-201">Kubernetes won't send traffic to the pod until the probe reports success.</span></span>

<span data-ttu-id="39629-202">Una problematica degli aggiornamenti in sequenza è rappresentata dal fatto che durante il processo di aggiornamento è in esecuzione e riceve traffico una combinazione di versioni nuove e precedenti.</span><span class="sxs-lookup"><span data-stu-id="39629-202">One challenge of rolling updates is that during the update process, a mix of old and new versions are running and receiving traffic.</span></span> <span data-ttu-id="39629-203">Durante tale periodo, qualsiasi richiesta potrebbe essere indirizzata a una delle due delle versioni.</span><span class="sxs-lookup"><span data-stu-id="39629-203">During this period, any request could get routed to either of the two versions.</span></span> <span data-ttu-id="39629-204">Questo potrebbe causare o meno problemi a seconda dell'ambito delle modifiche tra le due versioni.</span><span class="sxs-lookup"><span data-stu-id="39629-204">That may or may not cause problems, depending on the scope of the changes between the two versions.</span></span>

### <a name="blue-green-deployment"></a><span data-ttu-id="39629-205">Distribuzione di tipo blu-verde</span><span class="sxs-lookup"><span data-stu-id="39629-205">Blue-green deployment</span></span>

<span data-ttu-id="39629-206">In una distribuzione di tipo blu-verde, si distribuisce la nuova versione insieme alla precedente.</span><span class="sxs-lookup"><span data-stu-id="39629-206">In a blue-green deployment, you deploy the new version alongside the previous version.</span></span> <span data-ttu-id="39629-207">Dopo aver convalidato la nuova versione, si trasferisce tutto il traffico contemporaneamente dalla versione precedente alla nuova.</span><span class="sxs-lookup"><span data-stu-id="39629-207">After you validate the new version, you switch all traffic at once from the previous version to the new version.</span></span> <span data-ttu-id="39629-208">Dopo il trasferimento, si monitora l'applicazione per rilevare eventuali problemi.</span><span class="sxs-lookup"><span data-stu-id="39629-208">After the switch, you monitor the application for any problems.</span></span> <span data-ttu-id="39629-209">Se si verificano errori, è possibile tornare alla versione precedente.</span><span class="sxs-lookup"><span data-stu-id="39629-209">If something goes wrong, you can swap back to the old version.</span></span> <span data-ttu-id="39629-210">Supponendo che non sussistano problemi, è possibile eliminare la versione precedente.</span><span class="sxs-lookup"><span data-stu-id="39629-210">Assuming there are no problems, you can delete the old version.</span></span>

<span data-ttu-id="39629-211">Con un'applicazione monolitica o a più livelli più tradizionale, la distribuzione di tipo blu-verde comporta in genere il provisioning di due ambienti identici.</span><span class="sxs-lookup"><span data-stu-id="39629-211">With a more traditional monolithic or N-tier application, blue-green deployment generally meant provisioning two identical environments.</span></span> <span data-ttu-id="39629-212">Si distribuisce la nuova versione in un ambiente di staging, quindi si reindirizza il traffico client all'ambiente di staging, ad esempio scambiando gli indirizzi VIP.</span><span class="sxs-lookup"><span data-stu-id="39629-212">You would deploy the new version to a staging environment, then redirect client traffic to the staging environment &mdash; for example, by swapping VIP addresses.</span></span>

<span data-ttu-id="39629-213">In Kubernetes, non è necessario effettuare il provisioning di un cluster separato per eseguire distribuzioni di tipo blu-verde.</span><span class="sxs-lookup"><span data-stu-id="39629-213">In Kubernetes, you don't need to provision a separate cluster to do blue-green deployments.</span></span> <span data-ttu-id="39629-214">È invece possibile sfruttare i selettori.</span><span class="sxs-lookup"><span data-stu-id="39629-214">Instead, you can take advantage of selectors.</span></span> <span data-ttu-id="39629-215">Creare una nuova risorsa di distribuzione con una nuova specifica di pod e un diverso set di etichette.</span><span class="sxs-lookup"><span data-stu-id="39629-215">Create a new Deployment resource with a new pod spec and a different set of labels.</span></span> <span data-ttu-id="39629-216">Creare questa distribuzione senza eliminare la precedente o modificare il servizio che vi fa riferimento.</span><span class="sxs-lookup"><span data-stu-id="39629-216">Create this deployment, without deleting the previous deployment or modifying the service that points to it.</span></span> <span data-ttu-id="39629-217">Quando i nuovi pod sono in esecuzione, è possibile aggiornare il selettore del servizio in base alla nuova distribuzione.</span><span class="sxs-lookup"><span data-stu-id="39629-217">Once the new pods are running, you can update the service's selector to match the new deployment.</span></span>

<span data-ttu-id="39629-218">Un vantaggio delle distribuzioni di tipo blu-verde è che il servizio esegue il trasferimento di tutti i pod contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="39629-218">An advantage of blue-green deployments is that the service switches all the pods at the same time.</span></span> <span data-ttu-id="39629-219">Dopo l'aggiornamento del servizio, tutte le nuove richieste vengono indirizzate alla nuova versione.</span><span class="sxs-lookup"><span data-stu-id="39629-219">After the service is updated, all new requests get routed to the new version.</span></span> <span data-ttu-id="39629-220">Uno svantaggio è che durante l'aggiornamento viene eseguito il doppio dei pod per il servizio, per la versione corrente e la successiva.</span><span class="sxs-lookup"><span data-stu-id="39629-220">One drawback is that during the update, you are running twice as many pods for the service (current and next).</span></span> <span data-ttu-id="39629-221">Se i pod richiedono una grande quantità di risorse di memoria o CPU, potrebbe essere necessario aumentare temporaneamente il numero di istanze del cluster per gestire l'utilizzo delle risorse.</span><span class="sxs-lookup"><span data-stu-id="39629-221">If the pods require a lot of CPU or memory resources, you may need to scale out the cluster temporarily to handle the resource consumption.</span></span>

### <a name="canary-release"></a><span data-ttu-id="39629-222">Versione canary</span><span class="sxs-lookup"><span data-stu-id="39629-222">Canary release</span></span>

<span data-ttu-id="39629-223">Con una versione canary, si implementa una versione aggiornata in un numero ridotto di client.</span><span class="sxs-lookup"><span data-stu-id="39629-223">In a canary release, you roll out an updated version to a small number of clients.</span></span> <span data-ttu-id="39629-224">Si monitora quindi il comportamento del nuovo servizio prima di procedere all'implementazione in tutti i client.</span><span class="sxs-lookup"><span data-stu-id="39629-224">Then you monitor the behavior of the new service before rolling it out to all clients.</span></span> <span data-ttu-id="39629-225">In questo modo è possibile eseguire un'implementazione lenta in modo controllato, osservare i dati reali e individuare i problemi prima che abbiano un impatto su tutti i clienti.</span><span class="sxs-lookup"><span data-stu-id="39629-225">This lets you do a slow rollout in a controlled fashion, observe real data, and spot problems before all customers are affected.</span></span>

<span data-ttu-id="39629-226">Una versione canary è più complessa da gestire rispetto a un aggiornamento in sequenza o di tipo blu-verde, perché è necessario indirizzare dinamicamente le richieste a versioni diverse del servizio.</span><span class="sxs-lookup"><span data-stu-id="39629-226">A canary release is more complex to manage than either blue-green or rolling update, because you must dynamically route requests to different versions of the service.</span></span> <span data-ttu-id="39629-227">In Kubernetes, è possibile configurare un servizio in modo da includere due set di replica (uno per ogni versione) e modificare manualmente i numeri di repliche.</span><span class="sxs-lookup"><span data-stu-id="39629-227">In Kubernetes, you can configure a Service to span two replica sets (one for each version) and adjust the replica counts manually.</span></span> <span data-ttu-id="39629-228">Questo approccio presenta tuttavia una granularità piuttosto grossolana a causa del modo in cui Kubernetes bilancia il carico tra i pod.</span><span class="sxs-lookup"><span data-stu-id="39629-228">However, this approach is rather coarse-grained, because of the way Kubernetes load balances across pods.</span></span> <span data-ttu-id="39629-229">In presenza di un totale di dieci repliche, ad esempio, è possibile spostare il traffico solo in incrementi del 10%.</span><span class="sxs-lookup"><span data-stu-id="39629-229">For example, if you have a total of ten replicas, you can only shift traffic in 10% increments.</span></span> <span data-ttu-id="39629-230">Se si usa una rete mesh di servizi, è possibile usare le relative regole di routing per implementare una strategia di versione canary più sofisticata.</span><span class="sxs-lookup"><span data-stu-id="39629-230">If you are using a service mesh, you can use the service mesh routing rules to implement a more sophisticated canary release strategy.</span></span> <span data-ttu-id="39629-231">Di seguito sono riportate alcune risorse che potrebbero rivelarsi utili.</span><span class="sxs-lookup"><span data-stu-id="39629-231">Here are some resources that may be helpful:</span></span>

- <span data-ttu-id="39629-232">Kubernetes senza rete mesh di servizi: [Canary deployments](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments) (Distribuzioni canary)</span><span class="sxs-lookup"><span data-stu-id="39629-232">Kubernetes without service mesh: [Canary deployments](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span></span>
- <span data-ttu-id="39629-233">Linkerd: [Dynamic request routing](https://linkerd.io/features/routing/) (Routing dinamico delle richieste)</span><span class="sxs-lookup"><span data-stu-id="39629-233">Linkerd: [Dynamic request routing](https://linkerd.io/features/routing/)</span></span>
- <span data-ttu-id="39629-234">Istio: [Canary Deployments using Istio](https://istio.io/blog/canary-deployments-using-istio.html) (Distribuzioni canary con Istio)</span><span class="sxs-lookup"><span data-stu-id="39629-234">Istio: [Canary Deployments using Istio](https://istio.io/blog/canary-deployments-using-istio.html)</span></span>

## <a name="conclusion"></a><span data-ttu-id="39629-235">Conclusioni</span><span class="sxs-lookup"><span data-stu-id="39629-235">Conclusion</span></span>

<span data-ttu-id="39629-236">Negli ultimi anni, nel settore si è verificato un cambiamento radicale, ossia il passaggio dalla creazione di *sistemi di registrazione* alla creazione di *sistemi di engagement*.</span><span class="sxs-lookup"><span data-stu-id="39629-236">In recent years, there has been a sea change in the industry, a movement from building *systems of record* to building *systems of engagement*.</span></span>

<span data-ttu-id="39629-237">I sistemi di registrazione sono applicazioni di gestione dati back office tradizionali.</span><span class="sxs-lookup"><span data-stu-id="39629-237">Systems of record are traditional back-office data management applications.</span></span> <span data-ttu-id="39629-238">Questi sistemi sono spesso basati su un sistema di gestione di database relazionali che costituisce l'unica origine di dati reali.</span><span class="sxs-lookup"><span data-stu-id="39629-238">At the heart of these systems there often sits an RDBMS that is the single source of truth.</span></span> <span data-ttu-id="39629-239">Il termine "sistema di engagement" è attribuito a Geoffrey Moore, che lo ha adottato nel suo documento del 2011 *Systems of Engagement and the Future of Enterprise IT* (Sistemi di engagement e futuro dell'IT aziendale).</span><span class="sxs-lookup"><span data-stu-id="39629-239">The term "system of engagement" is credited to Geoffrey Moore, in his 2011 paper *Systems of Engagement and the Future of Enterprise IT*.</span></span> <span data-ttu-id="39629-240">I sistemi di engagement sono applicazioni incentrate sulla comunicazione e la collaborazione.</span><span class="sxs-lookup"><span data-stu-id="39629-240">Systems of engagement are applications focused on communication and collaboration.</span></span> <span data-ttu-id="39629-241">Connettono le persone in tempo reale</span><span class="sxs-lookup"><span data-stu-id="39629-241">They connect people in real time.</span></span> <span data-ttu-id="39629-242">e devono essere disponibili 24 ore su 24, 7 giorni su 7.</span><span class="sxs-lookup"><span data-stu-id="39629-242">They must be available 24/7.</span></span> <span data-ttu-id="39629-243">Le nuove funzionalità vengono introdotte regolarmente senza portare l'applicazione offline.</span><span class="sxs-lookup"><span data-stu-id="39629-243">New features are introduced regularly without taking the application offline.</span></span> <span data-ttu-id="39629-244">Gli utenti hanno aspettative maggiori e minore pazienza nei confronti di tempi di inattività o ritardi imprevisti.</span><span class="sxs-lookup"><span data-stu-id="39629-244">Users expect more and are less patient of unexpected delays or downtime.</span></span>

<span data-ttu-id="39629-245">A livello di consumatori, un'esperienza utente migliore può avere un valore aziendale quantificabile.</span><span class="sxs-lookup"><span data-stu-id="39629-245">In the consumer space, a better user experience can have measurable business value.</span></span> <span data-ttu-id="39629-246">La quantità di tempo durante la quale un utente interagisce con un'applicazione può tradursi direttamente in ricavi.</span><span class="sxs-lookup"><span data-stu-id="39629-246">The amount of time that a user engages with an application may translate directly into revenue.</span></span> <span data-ttu-id="39629-247">Nell'ambito dei sistemi aziendali, le aspettative degli utenti sono cambiate.</span><span class="sxs-lookup"><span data-stu-id="39629-247">And in the realm of business systems, users' expectations have changed.</span></span> <span data-ttu-id="39629-248">Se l'obiettivo di questi sistemi è facilitare la comunicazione e la collaborazione, è necessario prendere spunto dalle applicazioni rivolte ai consumatori.</span><span class="sxs-lookup"><span data-stu-id="39629-248">If these systems aim to foster communication and collaboration, they must take their cue from consumer-facing applications.</span></span>

<span data-ttu-id="39629-249">I microservizi sono una risposta a questo cambiamento del panorama.</span><span class="sxs-lookup"><span data-stu-id="39629-249">Microservices are a response to this changing landscape.</span></span> <span data-ttu-id="39629-250">Scomponendo un'applicazione monolitica in un gruppo di servizi a regime di controllo libero, è possibile controllare il ciclo di rilascio di ogni servizio e consentire aggiornamenti frequenti senza tempi di inattività o modifiche di rilievo.</span><span class="sxs-lookup"><span data-stu-id="39629-250">By decomposing a monolithic application into a group of loosely coupled services, we can control the release cycle of each service, and enable frequent updates without downtime or breaking changes.</span></span> <span data-ttu-id="39629-251">I microservizi sono utili anche ai fini della scalabilità, dell'isolamento degli errori e della resilienza.</span><span class="sxs-lookup"><span data-stu-id="39629-251">Microservices also help with scalability, failure isolation, and resiliency.</span></span> <span data-ttu-id="39629-252">Nel frattempo, le piattaforme cloud facilitano la compilazione e l'esecuzione di microservizi con il provisioning automatizzato delle risorse di calcolo, agenti di orchestrazione dei contenitori distribuiti come servizio e ambienti senza server guidati dagli eventi.</span><span class="sxs-lookup"><span data-stu-id="39629-252">Meanwhile, cloud platforms are making it easier to build and run microservices, with automated provisioning of compute resources, container orchestrators as a service, and event-driven serverless environments.</span></span>

<span data-ttu-id="39629-253">Come è stato illustrato, tuttavia, le architetture di microservizi presentano anche molte problematiche.</span><span class="sxs-lookup"><span data-stu-id="39629-253">But as we've seen, microservices architectures also being a lot of challenges.</span></span> <span data-ttu-id="39629-254">Per la riuscita, è necessario partire da una progettazione valida</span><span class="sxs-lookup"><span data-stu-id="39629-254">To succeed, you must start from a solid design.</span></span> <span data-ttu-id="39629-255">e prestare attenzione nell'analisi del dominio, nella scelta delle tecnologie, nella modellazione dei dati, nella progettazione delle API e nella creazione di una cultura DevOps avanzata.</span><span class="sxs-lookup"><span data-stu-id="39629-255">You must put careful thought into analyzing the domain, choosing technologies, modeling data, designing APIs, and building a mature DevOps culture.</span></span> <span data-ttu-id="39629-256">Microsoft si augura che questa guida e l'[implementazione di riferimento](https://github.com/mspnp/microservices-reference-implementation/tree/v0.1.0-orig) associata agevolino questo percorso.</span><span class="sxs-lookup"><span data-stu-id="39629-256">We hope that this guide, and the accompanying [reference implementation](https://github.com/mspnp/microservices-reference-implementation/tree/v0.1.0-orig), has helped to illuminate the journey.</span></span>
