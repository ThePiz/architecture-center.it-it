---
title: Considerazioni sui dati per i microservizi
description: Considerazioni sui dati per i microservizi.
author: MikeWasson
ms.date: 10/23/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: c2090ec2cbb37db87e87c0e91e6e6ee8314c14a4
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/23/2019
ms.locfileid: "54488376"
---
# <a name="designing-microservices-data-considerations"></a><span data-ttu-id="2ebb1-103">Progettazione di microservizi: Considerazioni sui dati</span><span class="sxs-lookup"><span data-stu-id="2ebb1-103">Designing microservices: Data considerations</span></span>

<span data-ttu-id="2ebb1-104">Questo capitolo illustra le considerazioni sulla gestione dei dati in un'architettura di microservizi.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-104">This chapter describes considerations for managing data in a microservices architecture.</span></span> <span data-ttu-id="2ebb1-105">Poiché ogni microservizio gestisce i propri dati, l'integrità e la coerenza dei dati sono problematiche critiche.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-105">Because every microservice manages its own data, data integrity and data consistency are critical challenges.</span></span>

![Diagramma delle considerazioni sui dati](./images/data-considerations.png)

<span data-ttu-id="2ebb1-107">Un principio alla base dei microservizi è che ogni servizio gestisce i propri dati.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-107">A basic principle of microservices is that each service manages its own data.</span></span> <span data-ttu-id="2ebb1-108">Due servizi non devono condividere un archivio dati.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-108">Two services should not share a data store.</span></span> <span data-ttu-id="2ebb1-109">Ogni servizio è invece responsabile del proprio archivio dati privato, a cui gli altri servizi non possono accedere direttamente.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-109">Instead, each service is responsible for its own private data store, which other services cannot access directly.</span></span>

<span data-ttu-id="2ebb1-110">Il motivo di questa regola è di evitare l'accoppiamento accidentale tra i servizi, come può accadere se i servizi condividono gli stessi schemi di dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-110">The reason for this rule is to avoid unintentional coupling between services, which can result if services share the same underlying data schemas.</span></span> <span data-ttu-id="2ebb1-111">Se viene apportata una modifica allo schema dei dati, la modifica deve essere coordinata tra ogni servizio basato su tale database.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-111">If there is a change to the data schema, the change must be coordinated across every service that relies on that database.</span></span> <span data-ttu-id="2ebb1-112">Isolando l'archivio dati di ogni servizio, è possibile limitare l'ambito della modifica e conservare la flessibilità offerta dalle distribuzioni effettivamente indipendenti.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-112">By isolating each service's data store, we can limit the scope of change, and preserve the agility of truly independent deployments.</span></span> <span data-ttu-id="2ebb1-113">Un altro motivo è che ogni microservizio può avere i propri modelli di dati, query o modelli di lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-113">Another reason is that each microservice may have its own data models, queries, or read/write patterns.</span></span> <span data-ttu-id="2ebb1-114">L'uso di un archivio dati condiviso limita la possibilità di ogni team di ottimizzare l'archiviazione dati per il proprio servizio specifico.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-114">Using a shared data store limits each team's ability to optimize data storage for their particular service.</span></span>

![Diagramma di un approccio errato a CQRS](../guide/architecture-styles/images/cqrs-microservices-wrong.png)

<span data-ttu-id="2ebb1-116">Questo approccio ha come naturale conseguenza la [programmazione poliglotta persistente](https://martinfowler.com/bliki/PolyglotPersistence.html), ovvero all'uso di più tecnologie di archiviazione dati in una singola applicazione.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-116">This approach naturally leads to [polyglot persistence](https://martinfowler.com/bliki/PolyglotPersistence.html) &mdash; the use of multiple data storage technologies within a single application.</span></span> <span data-ttu-id="2ebb1-117">Un servizio potrebbe richiedere le funzionalità dello schema in lettura di un database di documenti.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-117">One service might require the schema-on-read capabilities of a document database.</span></span> <span data-ttu-id="2ebb1-118">Per un altro potrebbe essere necessaria l'integrità referenziale fornita da un sistema di gestione di database relazionali.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-118">Another might need the referential integrity provided by an RDBMS.</span></span> <span data-ttu-id="2ebb1-119">Ogni team può scegliere liberamente l'opzione migliore per il proprio servizio.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-119">Each team is free to make the best choice for their service.</span></span> <span data-ttu-id="2ebb1-120">Per altre informazioni sul principio generale della programmazione poliglotta persistente, vedere [Usare il migliore archivio dati per il processo](../guide/design-principles/use-the-best-data-store.md).</span><span class="sxs-lookup"><span data-stu-id="2ebb1-120">For more about the general principle of polyglot persistence, see [Use the best data store for the job](../guide/design-principles/use-the-best-data-store.md).</span></span>

> [!NOTE]
> <span data-ttu-id="2ebb1-121">La condivisione dello stesso server di database fisico è appropriata per i servizi.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-121">It's fine for services to share the same physical database server.</span></span> <span data-ttu-id="2ebb1-122">Il problema si verifica quando i servizi condividono lo stesso schema o leggono e scrivono nello stesso set di tabelle di database.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-122">The problem occurs when services share the same schema, or read and write to the same set of database tables.</span></span>

## <a name="challenges"></a><span data-ttu-id="2ebb1-123">Problematiche</span><span class="sxs-lookup"><span data-stu-id="2ebb1-123">Challenges</span></span>

<span data-ttu-id="2ebb1-124">Alcune problematiche sorgono da questo approccio distribuito alle gestione dei dati.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-124">Some challenges arise from this distributed approach to managing data.</span></span> <span data-ttu-id="2ebb1-125">In primo luogo potrebbe verificarsi una ridondanza tra gli archivi dati, con lo stesso elemento di dati visualizzato in più punti.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-125">First, there may be redundancy across the data stores, with the same item of data appearing in multiple places.</span></span> <span data-ttu-id="2ebb1-126">I dati, ad esempio, potrebbero venire memorizzati nell'ambito di una transazione, quindi memorizzati altrove per l'analisi, la creazione di report o l'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-126">For example, data might be stored as part of a transaction, then stored elsewhere for analytics, reporting, or archiving.</span></span> <span data-ttu-id="2ebb1-127">I dati duplicati o partizionati possono causare problemi di integrità e coerenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-127">Duplicated or partitioned data can lead to issues of data integrity and consistency.</span></span> <span data-ttu-id="2ebb1-128">Quando le relazioni tra i dati si estendono su più servizi, non è possibile usare le tecniche tradizionali di gestione dati per applicare le relazioni.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-128">When data relationships span multiple services, you can't use traditional data management techniques to enforce the relationships.</span></span>

<span data-ttu-id="2ebb1-129">La modellazione dei dati tradizionale usa la regola "un'operazione in una posizione".</span><span class="sxs-lookup"><span data-stu-id="2ebb1-129">Traditional data modeling uses the rule of "one fact in one place."</span></span> <span data-ttu-id="2ebb1-130">Ogni entità viene visualizzata un sola volta nello schema.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-130">Every entity appears exactly once in the schema.</span></span> <span data-ttu-id="2ebb1-131">Le altre entità possono contenere riferimenti a essa, ma non duplicarla.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-131">Other entities may hold references to it but not duplicate it.</span></span> <span data-ttu-id="2ebb1-132">L'evidente vantaggio dell'approccio tradizionale è che gli aggiornamenti vengono eseguiti in una singola posizione, evitando così problemi di coerenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-132">The obvious advantage to the traditional approach is that updates are made in a single place, which avoids problems with data consistency.</span></span> <span data-ttu-id="2ebb1-133">In un'architettura di microservizi è necessario considerare come gli aggiornamenti vengono propagati nei servizi e come gestire la coerenza finale quando i dati vengono visualizzati in più posizioni senza coerenza assoluta.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-133">In a microservices architecture, you have to consider how updates are propagated across services, and how to manage eventual consistency when data appears in multiple places without strong consistency.</span></span>

## <a name="approaches-to-managing-data"></a><span data-ttu-id="2ebb1-134">Approcci alla gestione dei dati</span><span class="sxs-lookup"><span data-stu-id="2ebb1-134">Approaches to managing data</span></span>

<span data-ttu-id="2ebb1-135">Anche se non esiste un singolo approccio valido sempre, di seguito sono elencate alcune linee guida generali per la gestione dei dati in un'architettura di microservizi.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-135">There is no single approach that's correct in all cases, but here are some general guidelines for managing data in a microservices architecture.</span></span>

- <span data-ttu-id="2ebb1-136">Implementare la coerenza finale dove possibile.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-136">Embrace eventual consistency where possible.</span></span> <span data-ttu-id="2ebb1-137">Conoscere le posizioni del sistema in cui è necessaria la coerenza assoluta o le transazioni ACID e le posizioni in cui la coerenza finale è accettabile.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-137">Understand the places in the system where you need strong consistency or ACID transactions, and the places where eventual consistency is acceptable.</span></span>

- <span data-ttu-id="2ebb1-138">Quando sono necessarie garanzie di coerenza assoluta, un servizio può rappresentare l'origine di dati reali per una determinata entità, esposta tramite un'API.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-138">When you need strong consistency guarantees, one service may represent the source of truth for a given entity, which is exposed through an API.</span></span> <span data-ttu-id="2ebb1-139">Gli altri servizi potrebbero contenere la propria copia dei dati o un subset dei dati, che presentano la coerenza finale con i dati master, ma non sono considerati l'origine di dati reali.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-139">Other services might hold their own copy of the data, or a subset of the data, that is eventually consistent with the master data but not considered the source of truth.</span></span> <span data-ttu-id="2ebb1-140">Si prenda ad esempio un sistema di e-commerce con un servizio ordini cliente e un servizio elementi consigliati.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-140">For example, imagine an e-commerce system with a customer order service and a recommendation service.</span></span> <span data-ttu-id="2ebb1-141">Il servizio elementi consigliati potrebbe essere in ascolto degli eventi dal servizio ordini, ma se un cliente richiede un rimborso, è il servizio ordini e non il servizio elementi consigliati ad avere la cronologia completa delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-141">The recommendation service might listen to events from the order service, but if a customer requests a refund, it is the order service, not the recommendation service, that has the complete transaction history.</span></span>

- <span data-ttu-id="2ebb1-142">Per le transazioni, usare modelli come [Supervisione agente di pianificazione](../patterns/scheduler-agent-supervisor.md) e [Transazione di compensazione](../patterns/compensating-transaction.md) per mantenere i dati coerenti in più servizi.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-142">For transactions, use patterns such as [Scheduler Agent Supervisor](../patterns/scheduler-agent-supervisor.md) and [Compensating Transaction](../patterns/compensating-transaction.md) to keep data consistent across several services.</span></span>  <span data-ttu-id="2ebb1-143">Potrebbe essere necessario archiviare dati aggiuntivi che acquisiscono lo stato di un'unità di lavoro che si estende su più servizi, per evitare un errore parziale in più servizi,</span><span class="sxs-lookup"><span data-stu-id="2ebb1-143">You may need to store an additional piece of data that captures the state of a unit of work that spans multiple services, to avoid partial failure among multiple services.</span></span> <span data-ttu-id="2ebb1-144">ad esempio, mantenere un elemento di lavoro in una coda durevole mentre è in corso una transazione in più passi.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-144">For example, keep a work item on a durable queue while a multi-step transaction is in progress.</span></span>

- <span data-ttu-id="2ebb1-145">Archiviare solo i dati necessari per un servizio.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-145">Store only the data that a service needs.</span></span> <span data-ttu-id="2ebb1-146">A un servizio potrebbe essere necessario solo un subset di informazioni su un'entità di dominio.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-146">A service might only need a subset of information about a domain entity.</span></span> <span data-ttu-id="2ebb1-147">Nel contesto delimitato per il recapito, ad esempio, è necessario conoscere il cliente associato a una determinata consegna,</span><span class="sxs-lookup"><span data-stu-id="2ebb1-147">For example, in the Shipping bounded context, we need to know which customer is associated to a particular delivery.</span></span> <span data-ttu-id="2ebb1-148">ma non l'indirizzo di fatturazione del cliente, gestito dal contesto delimitato per gli account.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-148">But we don't need the customer's billing address &mdash; that's managed by the Accounts bounded context.</span></span> <span data-ttu-id="2ebb1-149">In questo caso, possono essere utili un'attenta valutazione del dominio e l'uso della progettazione basata su dominio.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-149">Thinking carefully about the domain, and using a DDD approach, can help here.</span></span>

- <span data-ttu-id="2ebb1-150">Valutare se i servizi sono coerenti e a regime di controllo libero.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-150">Consider whether your services are coherent and loosely coupled.</span></span> <span data-ttu-id="2ebb1-151">Se due servizi si scambiano continuamente informazioni e le API risultano di conseguenza frammentate, potrebbe essere necessario ridisegnare i limiti tra i servizi, unendo i due servizi o effettuando il refactoring delle funzionalità.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-151">If two services are continually exchanging information with each other, resulting in chatty APIs, you may need to redraw your service boundaries, by merging two services or refactoring their functionality.</span></span>

- <span data-ttu-id="2ebb1-152">Usare uno [stile di architettura basato sugli eventi](../guide/architecture-styles/event-driven.md).</span><span class="sxs-lookup"><span data-stu-id="2ebb1-152">Use an [event driven architecture style](../guide/architecture-styles/event-driven.md).</span></span> <span data-ttu-id="2ebb1-153">In questo stile di architettura un servizio pubblica un evento quando vengono apportate modifiche alle entità o ai modelli pubblici.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-153">In this architecture style, a service publishes an event when there are changes to its public models or entities.</span></span> <span data-ttu-id="2ebb1-154">I servizi interessati possono sottoscrivere questi eventi.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-154">Interested services can subscribe to these events.</span></span> <span data-ttu-id="2ebb1-155">Un altro servizio, ad esempio, potrebbe usare gli eventi per creare una vista materializzata dei dati più adatta alle query.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-155">For example, another service could use the events to construct a materialized view of the data that is more suitable for querying.</span></span>

- <span data-ttu-id="2ebb1-156">Un servizio proprietario di eventi deve pubblicare uno schema che può essere usato per automatizzare la serializzazione e la deserializzazione degli eventi, per evitare un accoppiamento rigido tra server di pubblicazione e sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-156">A service that owns events should publish a schema that can be used to automate serializing and deserializing the events, to avoid tight coupling between publishers and subscribers.</span></span> <span data-ttu-id="2ebb1-157">Si consideri lo schema JSON o un framework come [Microsoft Bond](https://github.com/Microsoft/bond), Protobuf o Avro.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-157">Consider JSON schema or a framework like [Microsoft Bond](https://github.com/Microsoft/bond), Protobuf, or Avro.</span></span>

- <span data-ttu-id="2ebb1-158">Poiché in generale gli eventi possono diventare un collo di bottiglia nel sistema, prendere in considerazione la possibilità di usare l'aggregazione o l'invio in batch per ridurre il carico totale.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-158">At high scale, events can become a bottleneck on the system, so consider using aggregation or batching to reduce the total load.</span></span>

## <a name="drone-delivery-choosing-the-data-stores"></a><span data-ttu-id="2ebb1-159">Recapito tramite drone: scelta degli archivi dati</span><span class="sxs-lookup"><span data-stu-id="2ebb1-159">Drone Delivery: Choosing the data stores</span></span>

<span data-ttu-id="2ebb1-160">Anche con solo pochi servizi, il contesto delimitato per il recapito illustra diversi punti discussi in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-160">Even with only a few services, the Shipping bounded context illustrates several of the points discussed in this section.</span></span>

<span data-ttu-id="2ebb1-161">Quando un utente pianifica una nuova consegna, la richiesta client include le informazioni sia sul recapito, ad esempio le località di ritiro e di consegna, che sul pacchetto, ad esempio le dimensioni e il peso.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-161">When a user schedules a new delivery, the client request includes information about the both the delivery, such as the pickup and dropoff locations, and about the package, such as the size and weight.</span></span> <span data-ttu-id="2ebb1-162">Queste informazioni definiscono un'unità di lavoro, che il servizio di inserimento invia a Hub eventi.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-162">This information defines a unit of work, which the Ingestion service sends to Event Hubs.</span></span> <span data-ttu-id="2ebb1-163">È importante che l'unità di lavoro rimanga in una risorsa di archiviazione permanente mentre il servizio utilità di pianificazione esegue il flusso di lavoro, in modo che nessuna richiesta di recapito vada persa.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-163">It's important that the unit of work stays in persistent storage while the Scheduler service is executing the workflow, so that no delivery requests are lost.</span></span> <span data-ttu-id="2ebb1-164">Per altre informazioni sul flusso di lavoro, vedere [Inserimento e flusso di lavoro](./ingestion-workflow.md).</span><span class="sxs-lookup"><span data-stu-id="2ebb1-164">For more discussion of the workflow, see [Ingestion and workflow](./ingestion-workflow.md).</span></span>

<span data-ttu-id="2ebb1-165">I diversi servizi back-end gestiscono parti differenti delle informazioni nella richiesta e hanno anche profili di lettura e scrittura differenti.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-165">The various backend services care about different portions of the information in the request, and also have different read and write profiles.</span></span>

### <a name="delivery-service"></a><span data-ttu-id="2ebb1-166">Servizio di recapito</span><span class="sxs-lookup"><span data-stu-id="2ebb1-166">Delivery service</span></span>

<span data-ttu-id="2ebb1-167">Il servizio di recapito archivia le informazioni su ogni consegna attualmente pianificata o in corso.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-167">The Delivery service stores information about every delivery that is currently scheduled or in progress.</span></span> <span data-ttu-id="2ebb1-168">È in ascolto degli eventi provenienti dai droni e tiene traccia dello stato delle consegne in corso.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-168">It listens for events from the drones, and tracks the status of deliveries that are in progress.</span></span> <span data-ttu-id="2ebb1-169">Con gli aggiornamenti dello stato della consegna invia anche gli eventi di dominio.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-169">It also sends domain events with delivery status updates.</span></span>

<span data-ttu-id="2ebb1-170">È previsto che gli utenti controllino spesso lo stato di una consegna mentre sono in attesa del pacchetto.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-170">It's expected that users will frequently check the status of a delivery while they are waiting for their package.</span></span> <span data-ttu-id="2ebb1-171">Il servizio di recapito richiede quindi un archivio dati che evidenzi la velocità effettiva (lettura e scrittura) nell'archiviazione a lungo termine.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-171">Therefore, the Delivery service requires a data store that emphasizes throughput (read and write) over long-term storage.</span></span> <span data-ttu-id="2ebb1-172">Il servizio di recapito non esegue nemmeno query o analisi complesse, ma si limita a recuperare lo stato più recente di una determinata consegna.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-172">Also, the Delivery service does not perform any complex queries or analysis, it simply fetches the latest status for a given delivery.</span></span> <span data-ttu-id="2ebb1-173">Il team del servizio di recapito ha scelto Cache Redis di Azure per le prestazioni elevate delle operazioni di lettura e scrittura.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-173">The Delivery service team chose Azure Redis Cache for its high read-write performance.</span></span> <span data-ttu-id="2ebb1-174">Il ciclo di vita delle informazioni archiviate in Redis è relativamente breve.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-174">The information stored in Redis is relatively short-lived.</span></span> <span data-ttu-id="2ebb1-175">Dopo che una consegna viene portata a termine, il relativo record viene archiviato nel servizio cronologia di recapito.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-175">Once a delivery is complete, the Delivery History service is the system of record.</span></span>

### <a name="delivery-history-service"></a><span data-ttu-id="2ebb1-176">Servizio cronologia di recapito</span><span class="sxs-lookup"><span data-stu-id="2ebb1-176">Delivery History service</span></span>

<span data-ttu-id="2ebb1-177">Il servizio cronologia di recapito è in ascolto degli eventi relativi allo stato di una consegna dal servizio di recapito.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-177">The Delivery History service listens for delivery status events from the Delivery service.</span></span> <span data-ttu-id="2ebb1-178">Memorizza questi dati in una risorsa di archiviazione a lungo termine.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-178">It stores this data in long-term storage.</span></span> <span data-ttu-id="2ebb1-179">Per questi dati cronologici esistono due diversi casi d'uso con requisiti di archiviazione dati diversi.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-179">There are two different use-cases for this historical data, which have different data storage requirements.</span></span>

<span data-ttu-id="2ebb1-180">Il primo scenario consiste nell'aggregazione dei dati a scopo di analisi, per ottimizzare il business o migliorare la qualità del servizio.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-180">The first scenario is aggregating the data for the purpose of data analytics, in order to optimize the business or improve the quality of the service.</span></span> <span data-ttu-id="2ebb1-181">Si noti che il servizio cronologia di recapito non esegue l'analisi effettiva dei dati,</span><span class="sxs-lookup"><span data-stu-id="2ebb1-181">Note that the Delivery History service doesn't perform the actual analysis of the data.</span></span> <span data-ttu-id="2ebb1-182">ma è responsabile solo dell'inserimento e dell'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-182">It's only responsible for the ingestion and storage.</span></span> <span data-ttu-id="2ebb1-183">Per questo scenario, la risorsa di archiviazione deve essere ottimizzata per l'analisi dei dati in un set di dati di grandi dimensioni, con un approccio basato sullo schema in lettura per gestire svariate origini dati.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-183">For this scenario, the storage must be optimized for data analysis over a large set of data, using a schema-on-read approach to accommodate a variety of data sources.</span></span> <span data-ttu-id="2ebb1-184">[Azure Data Lake Store](/azure/data-lake-store/) è l'ideale per questo scenario.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-184">[Azure Data Lake Store](/azure/data-lake-store/) is a good fit for this scenario.</span></span> <span data-ttu-id="2ebb1-185">Data Lake Store è un file system Apache Hadoop compatibile con HDFS (Hadoop Distributed File System) le cui prestazioni sono ottimizzate per gli scenari di analisi dei dati.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-185">Data Lake Store is an Apache Hadoop file system compatible with Hadoop Distributed File System (HDFS), and is tuned for performance for data analytics scenarios.</span></span>

<span data-ttu-id="2ebb1-186">Nell'altro scenario si consente agli utenti di cercare la cronologia di un recapito che è stato completato.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-186">The other scenario is enabling users to look up the history of a delivery after the delivery is completed.</span></span> <span data-ttu-id="2ebb1-187">Azure Data Lake non è particolarmente adatto a questo scenario.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-187">Azure Data Lake is not particularly optimized for this scenario.</span></span> <span data-ttu-id="2ebb1-188">Per prestazioni ottimali, Microsoft consiglia di archiviare i dati relativi alle serie temporali in Data Lake in cartelle partizionate per data.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-188">For optimal performance, Microsoft recommends storing time-series data in Data Lake in folders partitioned by date.</span></span> <span data-ttu-id="2ebb1-189">Vedere [Ottimizzazione delle prestazioni di Azure Data Lake Store](/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="2ebb1-189">(See [Tuning Azure Data Lake Store for performance](/azure/data-lake-store/data-lake-store-performance-tuning-guidance)).</span></span> <span data-ttu-id="2ebb1-190">Tale struttura non è tuttavia l'ideale per la ricerca dei singoli record per ID.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-190">However, that structure is not optimal for looking up individual records by ID.</span></span> <span data-ttu-id="2ebb1-191">A meno di non conoscere anche il timestamp, una ricerca per ID richiede l'analisi dell'intera raccolta.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-191">Unless you also know the timestamp, a lookup by ID requires scanning the entire collection.</span></span> <span data-ttu-id="2ebb1-192">Il servizio cronologia di recapito quindi archivia anche un subset di dati cronologici in Cosmos DB per ricerche più veloci.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-192">Therefore, the Delivery History service also stores a subset of the historical data in Cosmos DB for quicker lookup.</span></span> <span data-ttu-id="2ebb1-193">Non è necessario che i record rimangano in Cosmos DB a tempo indeterminato.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-193">The records don't need to stay in Cosmos DB indefinitely.</span></span> <span data-ttu-id="2ebb1-194">I recapiti meno recenti possono essere archiviati, ad esempio dopo un mese,</span><span class="sxs-lookup"><span data-stu-id="2ebb1-194">Older deliveries can be archived &mdash; say, after a month.</span></span> <span data-ttu-id="2ebb1-195">eseguendo un processo batch occasionale.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-195">This could be done by running an occasional batch process.</span></span>

### <a name="package-service"></a><span data-ttu-id="2ebb1-196">Servizio pacchetto</span><span class="sxs-lookup"><span data-stu-id="2ebb1-196">Package service</span></span>

<span data-ttu-id="2ebb1-197">Il servizio pacchetto archivia le informazioni su tutti i pacchetti.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-197">The Package service stores information about all of the packages.</span></span> <span data-ttu-id="2ebb1-198">I requisiti di archiviazione per il pacchetto sono:</span><span class="sxs-lookup"><span data-stu-id="2ebb1-198">The storage requirements for the Package are:</span></span>

- <span data-ttu-id="2ebb1-199">Archiviazione a lungo termine.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-199">Long-term storage.</span></span>
- <span data-ttu-id="2ebb1-200">Possibilità di gestire un volume elevato di pacchetti, che richiede un velocità effettiva di scrittura elevata.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-200">Able to handle a high volume of packages, requiring high write throughput.</span></span>
- <span data-ttu-id="2ebb1-201">Supporto di query semplici per ID pacchetto.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-201">Support simple queries by package ID.</span></span> <span data-ttu-id="2ebb1-202">Nessun join o requisito complesso per l'integrità referenziale.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-202">No complex joins or requirements for referential integrity.</span></span>

<span data-ttu-id="2ebb1-203">Poiché i dati del pacchetto non sono relazionali, l'ideale è un database orientato ai documenti e Cosmos DB può raggiungere una velocità effettiva molto elevata usando raccolte partizionate.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-203">Because the package data is not relational, a document oriented database is appropriate, and Cosmos DB can achieve very high throughput by using sharded collections.</span></span> <span data-ttu-id="2ebb1-204">Poiché il team che usa il servizio pacchetto ha familiarità con lo stack MEAN (MongoDB, Express.js, AngularJS e Node.js), seleziona l'[API MongoDB](/azure/cosmos-db/mongodb-introduction) per Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-204">The team that works on the Package service is familiar with the MEAN stack (MongoDB, Express.js, AngularJS, and Node.js), so they select the [MongoDB API](/azure/cosmos-db/mongodb-introduction) for Cosmos DB.</span></span> <span data-ttu-id="2ebb1-205">In questo modo può sfruttare l'esperienza acquisita con MongoDB, mentre usufruisce dei vantaggi di Cosmos DB, che è un servizio gestito di Azure.</span><span class="sxs-lookup"><span data-stu-id="2ebb1-205">That lets them leverage their existing experience with MongoDB, while getting the benefits of Cosmos DB, which is a managed Azure service.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="2ebb1-206">Comunicazione tra i servizi</span><span class="sxs-lookup"><span data-stu-id="2ebb1-206">Interservice communication</span></span>](./interservice-communication.md)