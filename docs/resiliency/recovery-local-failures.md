---
title: 'Indicazioni tecniche: ripristino da errori locali in Azure'
description: "Articolo incentrato sugli errori locali in Azure per comprendere e progettare applicazioni resilienti a disponibilità elevata e tolleranza di errore e pianificare il ripristino di emergenza."
author: adamglick
ms.date: 08/18/2016
ms.openlocfilehash: 180eb465e5f82406bb03924a29d5b06d43bbaa24
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 11/14/2017
---
[!INCLUDE [header](../_includes/header.md)]
# <a name="azure-resiliency-technical-guidance-recovery-from-local-failures-in-azure"></a><span data-ttu-id="a2adf-103">Informazioni tecniche sulla resilienza di Azure - Ripristino da errori locali in Azure</span><span class="sxs-lookup"><span data-stu-id="a2adf-103">Azure resiliency technical guidance: Recovery from local failures in Azure</span></span>

<span data-ttu-id="a2adf-104">Esistono due principali minacce alla disponibilità delle applicazioni:</span><span class="sxs-lookup"><span data-stu-id="a2adf-104">There are two primary threats to application availability:</span></span>

* <span data-ttu-id="a2adf-105">l'errore a livello di dispositivi, come unità e server</span><span class="sxs-lookup"><span data-stu-id="a2adf-105">The failure of devices, such as drives and servers</span></span>
* <span data-ttu-id="a2adf-106">l'esaurimento di risorse critiche, come in caso di calcolo in condizioni di picco di carico</span><span class="sxs-lookup"><span data-stu-id="a2adf-106">The exhaustion of critical resources, such as compute under peak load conditions</span></span>

<span data-ttu-id="a2adf-107">Azure offre una combinazione di gestione delle risorse, elasticità, bilanciamento del carico e partizionamento per garantire disponibilità elevata in tali circostanze.</span><span class="sxs-lookup"><span data-stu-id="a2adf-107">Azure provides a combination of resource management, elasticity, load balancing, and partitioning to enable high availability under these circumstances.</span></span> <span data-ttu-id="a2adf-108">Alcune di queste funzionalità vengono eseguite automaticamente per tutti i servizi di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-108">Some of these features are performed automatically for all Azure services.</span></span> <span data-ttu-id="a2adf-109">In altri casi lo sviluppatore di applicazioni deve completare alcune operazioni aggiuntive per usufruirne.</span><span class="sxs-lookup"><span data-stu-id="a2adf-109">However, in some cases, the application developer must do some additional work to benefit from them.</span></span>

## <a name="cloud-services"></a><span data-ttu-id="a2adf-110">Servizi cloud</span><span class="sxs-lookup"><span data-stu-id="a2adf-110">Cloud Services</span></span>
<span data-ttu-id="a2adf-111">Tutti i servizi cloud di Azure sono raccolte di uno o più ruoli Web o di lavoro.</span><span class="sxs-lookup"><span data-stu-id="a2adf-111">Azure Cloud Services consists of collections of one or more web or worker roles.</span></span> <span data-ttu-id="a2adf-112">Una o più istanze di un ruolo possono essere eseguite contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="a2adf-112">One or more instances of a role can run concurrently.</span></span> <span data-ttu-id="a2adf-113">Il numero di istanze è determinato dalla configurazione.</span><span class="sxs-lookup"><span data-stu-id="a2adf-113">The configuration determines the number of instances.</span></span> <span data-ttu-id="a2adf-114">Le istanze del ruolo vengono monitorate e gestite con un componente denominato controller di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="a2adf-114">Role instances are monitored and managed through a component called the fabric controller.</span></span> <span data-ttu-id="a2adf-115">Il controller di infrastruttura rileva gli errori software e hardware e risponde a tali errori automaticamente.</span><span class="sxs-lookup"><span data-stu-id="a2adf-115">The fabric controller detects and responds to both software and hardware failures automatically.</span></span>

<span data-ttu-id="a2adf-116">Ogni istanza del ruolo viene eseguita in una macchina virtuale (VM) specifica e comunica con il controller di infrastruttura tramite un agente guest.</span><span class="sxs-lookup"><span data-stu-id="a2adf-116">Every role instance runs in its own virtual machine (VM) and communicates with its fabric controller through a guest agent.</span></span> <span data-ttu-id="a2adf-117">L'agente guest raccoglie le metriche delle risorse e dei nodi, che includono l'uso della VM, lo stato, i log, l'uso delle risorse, le eccezioni e le condizioni di errore.</span><span class="sxs-lookup"><span data-stu-id="a2adf-117">The guest agent collects resource and node metrics, including VM usage, status, logs, resource usage, exceptions, and failure conditions.</span></span> <span data-ttu-id="a2adf-118">Il controller di infrastruttura interroga l'agente guest a intervalli configurabili e riavvia la VM se l'agente guest non risponde.</span><span class="sxs-lookup"><span data-stu-id="a2adf-118">The fabric controller queries the guest agent at configurable intervals, and it restarts the VM if the guest agent fails to respond.</span></span> <span data-ttu-id="a2adf-119">In caso di errore hardware, il controller di infrastruttura associato sposta tutte le istanze del ruolo interessate in un nuovo nodo hardware e riconfigura la rete per indirizzare il traffico a tale nodo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-119">In the event of hardware failure, the associated fabric controller moves all affected role instances to a new hardware node and reconfigures the network to route traffic there.</span></span>

<span data-ttu-id="a2adf-120">Per usufruire di queste funzionalità, gli sviluppatori devono assicurarsi che tutti i ruoli del servizio evitino di archiviare lo stato nelle istanze del ruolo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-120">To benefit from these features, developers should ensure that all service roles avoid storing state on the role instances.</span></span> <span data-ttu-id="a2adf-121">Tutti i dati persistenti devono essere invece accessibili da una risorsa di archiviazione durevole, come i servizi di archiviazione di Azure o il database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-121">Instead, all persistent data should be accessed from durable storage, such as Azure Storage or Azure SQL Database.</span></span> <span data-ttu-id="a2adf-122">In questo modo, qualsiasi ruolo può gestire le richieste.</span><span class="sxs-lookup"><span data-stu-id="a2adf-122">This allows any roles to handle requests.</span></span> <span data-ttu-id="a2adf-123">Le istanze del ruolo possono anche diventare inattive in qualsiasi momento senza che si creino incoerenze nello stato temporaneo o permanente del servizio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-123">It also means that role instances can go down at any time without creating inconsistencies in the transient or persistent state of the service.</span></span>

<span data-ttu-id="a2adf-124">Il requisito dell'archiviazione dello stato all'esterno dei ruoli ha diverse implicazioni.</span><span class="sxs-lookup"><span data-stu-id="a2adf-124">The requirement to store state externally to the roles has several implications.</span></span> <span data-ttu-id="a2adf-125">Implica, ad esempio, che tutte le modifiche correlate in una tabella di archiviazione di Azure dovrebbero essere eseguite, se possibile, in una singola transazione del gruppo di entità.</span><span class="sxs-lookup"><span data-stu-id="a2adf-125">It implies, for example, that all related changes to an Azure Storage table should be changed in a single entity-group transaction, if possible.</span></span> <span data-ttu-id="a2adf-126">Naturalmente, non sempre è possibile apportare tutte le modifiche in una singola transazione.</span><span class="sxs-lookup"><span data-stu-id="a2adf-126">Of course, it isn't always possible to make all changes in a single transaction.</span></span> <span data-ttu-id="a2adf-127">È necessario prestare particolare attenzione per assicurare che gli errori delle istanze del ruolo non causino problemi quando determinano l'interruzione di operazioni con esecuzione prolungata che coprono due o più aggiornamenti dello stato permanente del servizio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-127">You must take special care to ensure that role instance failures do not cause problems when they interrupt long-running operations that span two or more updates to the persistent state of the service.</span></span> <span data-ttu-id="a2adf-128">Se un altro ruolo ritenta un'operazione di questo tipo, deve prevedere e gestire l'eventualità che sia stata parzialmente completata.</span><span class="sxs-lookup"><span data-stu-id="a2adf-128">If another role attempts to retry such an operation, it should anticipate and handle the case where the work was partially completed.</span></span>

<span data-ttu-id="a2adf-129">In un servizio che partiziona i dati in più archivi, ad esempio,</span><span class="sxs-lookup"><span data-stu-id="a2adf-129">For example, consider a service that partitions data across multiple stores.</span></span> <span data-ttu-id="a2adf-130">se un ruolo di lavoro diventa inattivo durante la rilocazione di una partizione, la rilocazione potrebbe non essere completa</span><span class="sxs-lookup"><span data-stu-id="a2adf-130">If a worker role goes down while it's relocating a shard, the relocation of the shard might not finish.</span></span> <span data-ttu-id="a2adf-131">oppure potrebbe essere ripetuta dall'inizio da un diverso ruolo di lavoro causando potenzialmente dati orfani o un danneggiamento dei dati.</span><span class="sxs-lookup"><span data-stu-id="a2adf-131">Or the relocation might be repeated from its inception by a different worker role, potentially causing orphaned data or data corruption.</span></span> <span data-ttu-id="a2adf-132">Per prevenire problemi, è necessario che le operazioni con esecuzione prolungata siano di una o di entrambe le tipologie:</span><span class="sxs-lookup"><span data-stu-id="a2adf-132">To prevent problems, long-running operations must be one or both of the following:</span></span>

* <span data-ttu-id="a2adf-133">*Idempotenti*: ripetibili senza effetti collaterali.</span><span class="sxs-lookup"><span data-stu-id="a2adf-133">*Idempotent*: Repeatable without side effects.</span></span> <span data-ttu-id="a2adf-134">Per essere idempotente, un'operazione con esecuzione prolungata deve avere lo stesso effetto a prescindere da quante volte viene eseguita, anche in caso di interruzione durante l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a2adf-134">To be idempotent, a long-running operation should have the same effect no matter how many times it's executed, even when it's interrupted during execution.</span></span>
* <span data-ttu-id="a2adf-135">*Riavviabili in modalità incrementale*: in grado di continuare dal punto di errore più recente.</span><span class="sxs-lookup"><span data-stu-id="a2adf-135">*Incrementally restartable*: Able to continue from the most recent point of failure.</span></span> <span data-ttu-id="a2adf-136">Per essere riavviabile in modo incrementale, un'operazione con esecuzione prolungata deve essere costituita da una sequenza di operazioni atomiche più piccole.</span><span class="sxs-lookup"><span data-stu-id="a2adf-136">To be incrementally restartable, a long-running operation should consist of a sequence of smaller atomic operations.</span></span> <span data-ttu-id="a2adf-137">Deve inoltre registrare il proprio stato di avanzamento in una risorsa di archiviazione durevole, in modo che ogni successiva chiamata riprenda dal punto in cui è stata interrotta la precedente.</span><span class="sxs-lookup"><span data-stu-id="a2adf-137">It should also record its progress in durable storage, so that each subsequent invocation picks up where its predecessor stopped.</span></span>

<span data-ttu-id="a2adf-138">Tutte le operazioni con esecuzione prolungata, infine, devono essere richiamate ripetutamente fino a quando non vengono completate.</span><span class="sxs-lookup"><span data-stu-id="a2adf-138">Finally, all long-running operations should be invoked repeatedly until they succeed.</span></span> <span data-ttu-id="a2adf-139">Un'operazione di provisioning, ad esempio, potrebbe essere inserita in una coda di Azure ed essere rimossa dalla coda da un ruolo di lavoro solo quando viene completata.</span><span class="sxs-lookup"><span data-stu-id="a2adf-139">For example, a provisioning operation might be placed in an Azure queue, and then removed from the queue by a worker role only when it succeeds.</span></span> <span data-ttu-id="a2adf-140">Per pulire i dati creati dalle operazioni interrotte potrebbe essere necessaria un'operazione di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="a2adf-140">Garbage collection might be necessary to clean up data that interrupted operations create.</span></span>

### <a name="elasticity"></a><span data-ttu-id="a2adf-141">Elasticità</span><span class="sxs-lookup"><span data-stu-id="a2adf-141">Elasticity</span></span>
<span data-ttu-id="a2adf-142">Il numero iniziale di istanze eseguite per ogni ruolo è determinato nella configurazione del ruolo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-142">The initial number of instances running for each role is determined in each role’s configuration.</span></span> <span data-ttu-id="a2adf-143">Gli amministratori devono configurare inizialmente i singoli ruoli per l'esecuzione con due o più istanze in base al carico previsto.</span><span class="sxs-lookup"><span data-stu-id="a2adf-143">Administrators should initially configure each role to run with two or more instances based on expected load.</span></span> <span data-ttu-id="a2adf-144">Le istanze del ruolo, tuttavia, possono essere facilmente aumentate o ridotte in caso di variazione dei modelli d'uso.</span><span class="sxs-lookup"><span data-stu-id="a2adf-144">But you can easily scale role instances up or down as usage patterns change.</span></span> <span data-ttu-id="a2adf-145">Questa operazione può essere eseguita manualmente nel portale di Azure oppure essere automatizzata con Windows PowerShell, l'API Gestione dei servizi o strumenti di terze parti.</span><span class="sxs-lookup"><span data-stu-id="a2adf-145">You can do this manually in the Azure portal, or you can automate the process by using Windows PowerShell, the Service Management API, or third-party tools.</span></span> <span data-ttu-id="a2adf-146">Per altre informazioni, vedere [Come ridimensionare automaticamente un'applicazione](/azure/cloud-services/cloud-services-how-to-scale/).</span><span class="sxs-lookup"><span data-stu-id="a2adf-146">For more information, see [How to autoscale an application](/azure/cloud-services/cloud-services-how-to-scale/).</span></span>

### <a name="partitioning"></a><span data-ttu-id="a2adf-147">Partizionamento</span><span class="sxs-lookup"><span data-stu-id="a2adf-147">Partitioning</span></span>
<span data-ttu-id="a2adf-148">Il controller di infrastruttura di Azure usa due tipi di partizioni:</span><span class="sxs-lookup"><span data-stu-id="a2adf-148">The Azure fabric controller uses two types of partitions:</span></span>

* <span data-ttu-id="a2adf-149">Un *dominio di aggiornamento* viene usato per aggiornare le istanze del ruolo di un servizio in gruppi.</span><span class="sxs-lookup"><span data-stu-id="a2adf-149">An *update domain* is used to upgrade a service’s role instances in groups.</span></span> <span data-ttu-id="a2adf-150">Azure distribuisce le istanze del servizio in più domini di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-150">Azure deploys service instances into multiple update domains.</span></span> <span data-ttu-id="a2adf-151">Per un aggiornamento sul posto, il controller di infrastruttura arresta tutte le istanze in un dominio di aggiornamento, le aggiorna e quindi le riavvia prima di passare al dominio di aggiornamento successivo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-151">For an in-place update, the fabric controller brings down all the instances in one update domain, updates them, and then restarts them before moving to the next update domain.</span></span> <span data-ttu-id="a2adf-152">Questo approccio impedisce che l'intero servizio risulti non disponibile durante il processo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-152">This approach prevents the entire service from being unavailable during the update process.</span></span>
* <span data-ttu-id="a2adf-153">Un *dominio di errore* definisce i potenziali punti di errore hardware o di rete.</span><span class="sxs-lookup"><span data-stu-id="a2adf-153">A *fault domain* defines potential points of hardware or network failure.</span></span> <span data-ttu-id="a2adf-154">Per qualsiasi ruolo con più istanze, il controller di infrastruttura assicura che le istanze vengano distribuite in più domini di errore, in modo da impedire che errori hardware isolati interrompano il servizio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-154">For any role that has more than one instance, the fabric controller ensures that the instances are distributed across multiple fault domains, to prevent isolated hardware failures from disrupting service.</span></span> <span data-ttu-id="a2adf-155">I domini di errore controllano interamente l'esposizione a errori del server o del cluster.</span><span class="sxs-lookup"><span data-stu-id="a2adf-155">Fault domains govern all exposure to server and cluster failures.</span></span>

<span data-ttu-id="a2adf-156">In base al [contratto di servizio di Azure](https://azure.microsoft.com/support/legal/sla/), Microsoft garantisce che in caso di distribuzione di due o più istanze di ruoli Web in domini di errore e di aggiornamento diversi sarà disponibile la connessione esterna per almeno il 99,95% del tempo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-156">The [Azure service-level agreement (SLA)](https://azure.microsoft.com/support/legal/sla/) guarantees that when two or more web role instances are deployed to different fault and upgrade domains, they'll have external connectivity at least 99.95 percent of the time.</span></span> <span data-ttu-id="a2adf-157">A differenza dei domini di aggiornamento, non è possibile controllare il numero di domini di errore.</span><span class="sxs-lookup"><span data-stu-id="a2adf-157">Unlike update domains, there's no way to control the number of fault domains.</span></span> <span data-ttu-id="a2adf-158">Azure esegue automaticamente l'allocazione dei domini di errore e la distribuzione negli stessi delle istanze del ruolo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-158">Azure automatically allocates fault domains and distributes role instances across them.</span></span> <span data-ttu-id="a2adf-159">Per garantire che qualsiasi ruolo con almeno due istanze soddisfi i requisiti del contratto di servizio, almeno le prime due istanze di ogni ruolo vengono inserite in domini di errore e di aggiornamento diversi,</span><span class="sxs-lookup"><span data-stu-id="a2adf-159">At least the first two instances of every role are placed in different fault and upgrade domains to ensure that any role with at least two instances will satisfy the SLA.</span></span> <span data-ttu-id="a2adf-160">come illustrato nella figura seguente:</span><span class="sxs-lookup"><span data-stu-id="a2adf-160">This is represented in the following diagram.</span></span>

![Vista semplificata dell'isolamento dei domini di errore](./images/technical-guidance-recovery-local-failures/partitioning-1.png)

### <a name="load-balancing"></a><span data-ttu-id="a2adf-162">Bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="a2adf-162">Load balancing</span></span>
<span data-ttu-id="a2adf-163">Tutto il traffico in ingresso verso un ruolo Web passa attraverso un servizio di bilanciamento del carico senza stato che distribuisce le richieste client tra le istanze del ruolo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-163">All inbound traffic to a web role passes through a stateless load balancer, which distributes client requests among the role instances.</span></span> <span data-ttu-id="a2adf-164">Le singole istanze di ruoli non dispongono di indirizzi IP pubblici e non sono indirizzabili direttamente da Internet.</span><span class="sxs-lookup"><span data-stu-id="a2adf-164">Individual role instances do not have public IP addresses, and they are not directly addressable from the Internet.</span></span> <span data-ttu-id="a2adf-165">Poiché i ruoli Web sono senza stato, qualsiasi richiesta client può essere indirizzata a qualsiasi istanza del ruolo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-165">Web roles are stateless so that any client request can be routed to any role instance.</span></span> <span data-ttu-id="a2adf-166">Ogni 15 secondi viene generato un evento [StatusCheck](https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleenvironment.statuscheck.aspx),</span><span class="sxs-lookup"><span data-stu-id="a2adf-166">A [StatusCheck](https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleenvironment.statuscheck.aspx) event is raised every 15 seconds.</span></span> <span data-ttu-id="a2adf-167">che può essere usato per indicare se il ruolo è pronto per ricevere traffico oppure è occupato e deve essere escluso dalla rotazione del servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="a2adf-167">You can use this to indicate whether the role is ready to receive traffic, or whether it's busy and should be taken out of the load-balancer rotation.</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="a2adf-168">Macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="a2adf-168">Virtual Machines</span></span>
<span data-ttu-id="a2adf-169">In relazione alla disponibilità elevata, Macchine virtuali di Azure si differenzia dai ruoli di calcolo della piattaforma distribuita come servizio (PaaS) sotto diversi aspetti.</span><span class="sxs-lookup"><span data-stu-id="a2adf-169">Azure Virtual Machines differs from platform as a service (PaaS) compute roles in several respects in relation to high availability.</span></span> <span data-ttu-id="a2adf-170">In alcuni casi, per garantire disponibilità elevata sono necessarie operazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="a2adf-170">In some instances, you must do additional work to ensure high availability.</span></span>

### <a name="disk-durability"></a><span data-ttu-id="a2adf-171">Durabilità dei dischi</span><span class="sxs-lookup"><span data-stu-id="a2adf-171">Disk durability</span></span>
<span data-ttu-id="a2adf-172">A differenza delle istanze del ruolo PaaS, i dati archiviati in unità di macchine virtuali sono persistenti anche in caso di rilocazione della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="a2adf-172">Unlike PaaS role instances, data stored on virtual machine drives is persistent even when the virtual machine is relocated.</span></span> <span data-ttu-id="a2adf-173">Le macchine virtuali di Azure usano dischi di VM esistenti come BLOB in Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-173">Azure virtual machines use VM disks that exist as blobs in Azure Storage.</span></span> <span data-ttu-id="a2adf-174">Grazie alle caratteristiche di disponibilità di Archiviazione di Azure, anche i dati archiviati nelle unità di una macchina virtuale sono a disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="a2adf-174">Because of the availability characteristics of Azure Storage, the data stored on a virtual machine’s drives is also highly available.</span></span>

<span data-ttu-id="a2adf-175">Si noti che l'unità D: nelle macchine virtuali Windows rappresenta un'eccezione a questa regola.</span><span class="sxs-lookup"><span data-stu-id="a2adf-175">Note that drive D (in Windows VMs) is the exception to this rule.</span></span> <span data-ttu-id="a2adf-176">L'unità D: è di fatto la risorsa di archiviazione fisica del server del rack che ospita la VM e i relativi dati andranno persi in caso di riciclo della VM.</span><span class="sxs-lookup"><span data-stu-id="a2adf-176">Drive D is actually physical storage on the rack server that hosts the VM, and its data will be lost if the VM is recycled.</span></span> <span data-ttu-id="a2adf-177">L'unità D: è destinata esclusivamente all'archiviazione temporanea.</span><span class="sxs-lookup"><span data-stu-id="a2adf-177">Drive D is intended for temporary storage only.</span></span> <span data-ttu-id="a2adf-178">In Linux Azure espone "solitamente", ma non sempre, il disco temporaneo locale dome dispositivo di blocco /dev/sdb.</span><span class="sxs-lookup"><span data-stu-id="a2adf-178">In Linux, Azure “usually” (but not always) exposes the local temporary disk as /dev/sdb block device.</span></span> <span data-ttu-id="a2adf-179">Viene spesso montato dall'agente Linux di Azure come punti di montaggio /mnt/resource o /mnt. Questo elemento può essere configurato tramite /etc/waagent.conf.</span><span class="sxs-lookup"><span data-stu-id="a2adf-179">It is often mounted by the Azure Linux Agent as /mnt/resource or /mnt mount points (configurable via /etc/waagent.conf).</span></span>

### <a name="partitioning"></a><span data-ttu-id="a2adf-180">Partizionamento</span><span class="sxs-lookup"><span data-stu-id="a2adf-180">Partitioning</span></span>
<span data-ttu-id="a2adf-181">Azure riconosce in modo nativo i livelli in un'applicazione PaaS (ruolo Web e ruolo di lavoro) e può quindi distribuirli correttamente nei domini di errore e di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-181">Azure natively understands the tiers in a PaaS application (web role and worker role) and thus can properly distribute them across fault and update domains.</span></span> <span data-ttu-id="a2adf-182">Al contrario, i livelli in un'applicazione di infrastruttura distribuita come servizio (IaaS) devono essere definiti manualmente tramite set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="a2adf-182">In contrast, the tiers in an infrastructure as a service (IaaS) application must be manually defined through availability sets.</span></span> <span data-ttu-id="a2adf-183">I set di disponibilità sono necessari per un contratto di servizio correlato a IaaS.</span><span class="sxs-lookup"><span data-stu-id="a2adf-183">Availability sets are required for an SLA under IaaS.</span></span>

![Set di disponibilità per le macchine virtuali di Azure](./images/technical-guidance-recovery-local-failures/partitioning-2.png)

<span data-ttu-id="a2adf-185">Nella figura precedente, il livello IIS (Internet Information Services), che funge da livello app Web, e il livello SQL, che funge da livello dati, sono assegnati a set di disponibilità diversi.</span><span class="sxs-lookup"><span data-stu-id="a2adf-185">In the preceding diagram, the Internet Information Services (IIS) tier (which works as a web app tier) and the SQL tier (which works as a data tier) are assigned to different availability sets.</span></span> <span data-ttu-id="a2adf-186">Ciò garantisce la ridondanza hardware di tutte le istanze di ogni livello, grazie alla distribuzione delle macchine virtuali nei domini di errore, e assicura che tutti i livelli non vengano disattivati durante un aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-186">This ensures that all instances of each tier have hardware redundancy by distributing virtual machines across fault domains, and that entire tiers are not taken down during an update.</span></span>

### <a name="load-balancing"></a><span data-ttu-id="a2adf-187">Bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="a2adf-187">Load balancing</span></span>
<span data-ttu-id="a2adf-188">Se il traffico deve essere distribuito tra le VM, è necessario raggruppare le VM di un'applicazione e bilanciare il carico in uno specifico endpoint TCP o UDP.</span><span class="sxs-lookup"><span data-stu-id="a2adf-188">If the VMs should have traffic distributed across them, you must group the VMs in an application and load balance across a specific TCP or UDP endpoint.</span></span> <span data-ttu-id="a2adf-189">Per altre informazioni, vedere [Bilanciamento del carico delle macchine virtuali](/azure/virtual-machines/virtual-machines-linux-load-balance/?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="a2adf-189">For more information, see [Load balancing virtual machines](/azure/virtual-machines/virtual-machines-linux-load-balance/?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="a2adf-190">Se le VM ricevono input da un'altra origine (ad esempio, un meccanismo di accodamento), non è necessario un servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="a2adf-190">If the VMs receive input from another source (for example, a queuing mechanism), a load balancer is not required.</span></span> <span data-ttu-id="a2adf-191">Il servizio di bilanciamento del carico usa un controllo dell'integrità di base per determinare se il traffico deve essere inviato al nodo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-191">The load balancer uses a basic health check to determine whether traffic should be sent to the node.</span></span> <span data-ttu-id="a2adf-192">È anche possibile creare probe personalizzati per implementare metriche sull'integrità specifiche dell'applicazione che determinano se la VM deve ricevere traffico.</span><span class="sxs-lookup"><span data-stu-id="a2adf-192">It's also possible to create your own probes to implement application-specific health metrics that determine whether the VM should receive traffic.</span></span>

## <a name="storage"></a><span data-ttu-id="a2adf-193">Archiviazione</span><span class="sxs-lookup"><span data-stu-id="a2adf-193">Storage</span></span>
<span data-ttu-id="a2adf-194">Archiviazione di Azure è il servizio dati durevoli di base per Azure,</span><span class="sxs-lookup"><span data-stu-id="a2adf-194">Azure Storage is the baseline durable data service for Azure.</span></span> <span data-ttu-id="a2adf-195">che offre archiviazione BLOB, tabelle, code e per dischi di VM.</span><span class="sxs-lookup"><span data-stu-id="a2adf-195">It provides blob, table, queue, and VM disk storage.</span></span> <span data-ttu-id="a2adf-196">Per garantire disponibilità elevata in un singolo data center, usa una combinazione di replica e gestione delle risorse.</span><span class="sxs-lookup"><span data-stu-id="a2adf-196">It uses a combination of replication and resource management to provide high availability within a single datacenter.</span></span> <span data-ttu-id="a2adf-197">Il contratto di servizio relativo alla disponibilità di Archiviazione di Azure garantisce una disponibilità di almeno il 99,9%:</span><span class="sxs-lookup"><span data-stu-id="a2adf-197">The Azure Storage availability SLA guarantees that at least 99.9 percent of the time:</span></span>

* <span data-ttu-id="a2adf-198">Le richieste con formato corretto di aggiungere, aggiornare ed eliminare i dati verranno elaborate correttamente.</span><span class="sxs-lookup"><span data-stu-id="a2adf-198">Correctly formatted requests to add, update, read, and delete data will be successfully and correctly processed.</span></span>
* <span data-ttu-id="a2adf-199">Gli account di archiviazione disporranno della connettività al gateway Internet.</span><span class="sxs-lookup"><span data-stu-id="a2adf-199">Storage accounts will have connectivity to the Internet gateway.</span></span>

### <a name="replication"></a><span data-ttu-id="a2adf-200">Replica</span><span class="sxs-lookup"><span data-stu-id="a2adf-200">Replication</span></span>
<span data-ttu-id="a2adf-201">Archiviazione di Azure agevola la durabilità dei dati eseguendo la manutenzione di più copie di tutti i dati in diverse unità che risiedono in sottosistemi di archiviazione fisica completamente indipendenti all'interno dell'area.</span><span class="sxs-lookup"><span data-stu-id="a2adf-201">Azure Storage facilitates data durability by maintaining multiple copies of all data on different drives across fully independent physical storage subsystems within the region.</span></span> <span data-ttu-id="a2adf-202">I dati vengono replicati in modo sincrono e prima che la scrittura venga confermata viene eseguito il commit di tutte le copie.</span><span class="sxs-lookup"><span data-stu-id="a2adf-202">Data is replicated synchronously, and all copies are committed before the write is acknowledged.</span></span> <span data-ttu-id="a2adf-203">L'elevato livello di coerenza di Archiviazione di Azure garantisce che le letture riflettano le scritture più recenti.</span><span class="sxs-lookup"><span data-stu-id="a2adf-203">Azure Storage is strongly consistent, meaning that reads are guaranteed to reflect the most recent writes.</span></span> <span data-ttu-id="a2adf-204">Le copie dei dati, inoltre, vengono continuamente analizzate per rilevare e riparare il decadimento dei bit, che costituisce una minaccia spesso trascurata all'integrità dei dati archiviati.</span><span class="sxs-lookup"><span data-stu-id="a2adf-204">In addition, copies of data are continually scanned to detect and repair bit rot, an often overlooked threat to the integrity of stored data.</span></span>

<span data-ttu-id="a2adf-205">I servizi usufruiscono della replica semplicemente usando Archiviazione di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-205">Services benefit from replication just by using Azure Storage.</span></span> <span data-ttu-id="a2adf-206">Lo sviluppatore di servizi non deve eseguire operazioni aggiuntive per il ripristino da un errore locale.</span><span class="sxs-lookup"><span data-stu-id="a2adf-206">The service developer doesn't need to do additional work to recover from a local failure.</span></span>

### <a name="resource-management"></a><span data-ttu-id="a2adf-207">Resource management</span><span class="sxs-lookup"><span data-stu-id="a2adf-207">Resource management</span></span>
<span data-ttu-id="a2adf-208">Le dimensioni degli account di archiviazione creati dopo il maggio 2014 possono aumentare fino a 500 TB (in precedenza, il massimo era 200 TB).</span><span class="sxs-lookup"><span data-stu-id="a2adf-208">Storage accounts created after May 2014, can grow to up to 500 TB (the previous maximum was 200 TB).</span></span> <span data-ttu-id="a2adf-209">Se è necessario spazio aggiuntivo, le applicazioni devono essere progettate in modo da sfruttare più account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="a2adf-209">If additional space is required, applications must be designed to use multiple storage accounts.</span></span>

### <a name="virtual-machine-disks"></a><span data-ttu-id="a2adf-210">Dischi delle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="a2adf-210">Virtual machine disks</span></span>
<span data-ttu-id="a2adf-211">Un disco di una macchina virtuale viene archiviato in Archiviazione di Azure come BLOB di pagine, con le stesse caratteristiche di durabilità e scalabilità dell'archiviazione BLOB.</span><span class="sxs-lookup"><span data-stu-id="a2adf-211">A virtual machine’s disk is stored as a page blob in Azure Storage, giving it all the same durability and scalability properties as Blob storage.</span></span> <span data-ttu-id="a2adf-212">Questa progettazione assicura la persistenza dei dati in un disco di una macchina virtuale anche se si verifica un errore nel server che esegue la VM e la VM deve essere riavviata in un altro server.</span><span class="sxs-lookup"><span data-stu-id="a2adf-212">This design makes the data on a virtual machine’s disk persistent, even if the server running the VM fails and the VM must be restarted on another server.</span></span>

## <a name="database"></a><span data-ttu-id="a2adf-213">Database</span><span class="sxs-lookup"><span data-stu-id="a2adf-213">Database</span></span>
### <a name="sql-database"></a><span data-ttu-id="a2adf-214">Database SQL</span><span class="sxs-lookup"><span data-stu-id="a2adf-214">SQL Database</span></span>
<span data-ttu-id="a2adf-215">Il database SQL di Azure offre un database come servizio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-215">Azure SQL Database provides database as a service.</span></span> <span data-ttu-id="a2adf-216">Consente alle applicazioni di eseguire il provisioning di database relazionali, inserirvi dati ed eseguire query con rapidità.</span><span class="sxs-lookup"><span data-stu-id="a2adf-216">It allows applications to quickly provision, insert data into, and query relational databases.</span></span> <span data-ttu-id="a2adf-217">Fornisce molte delle familiari funzioni e funzionalità di SQL Server eliminando l'impegno in termini di hardware, configurazione, applicazione di patch e resilienza.</span><span class="sxs-lookup"><span data-stu-id="a2adf-217">It provides many of the familiar SQL Server features and functionality, while abstracting the burden of hardware, configuration, patching, and resiliency.</span></span>

> [!NOTE]
> <span data-ttu-id="a2adf-218">Il database di SQL Azure non offre parità di funzionalità 1 a 1 con SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a2adf-218">Azure SQL Database does not provide one-to-one feature parity with SQL Server.</span></span> <span data-ttu-id="a2adf-219">È destinato a soddisfare un diverso set di requisiti adatto specificamente alle applicazioni cloud: scalabilità elastica, database distribuito come servizio per ridurre i costi di manutenzione e così via.</span><span class="sxs-lookup"><span data-stu-id="a2adf-219">It's intended to fulfill a different set of requirements--one that's uniquely suited to cloud applications (elastic scale, database as a service to reduce maintenance costs, and so on).</span></span> <span data-ttu-id="a2adf-220">Per altre informazioni, vedere [Scegliere un'opzione di SQL Server cloud: database SQL di Azure (PaaS) o SQL Server in VM di Azure (IaaS)](/azure/sql-database/sql-database-paas-vs-sql-server-iaas/).</span><span class="sxs-lookup"><span data-stu-id="a2adf-220">For more information, see [Choose a cloud SQL Server option: Azure SQL (PaaS) Database or SQL Server on Azure VMs (IaaS)](/azure/sql-database/sql-database-paas-vs-sql-server-iaas/).</span></span>
> 
> 

#### <a name="replication"></a><span data-ttu-id="a2adf-221">Replica</span><span class="sxs-lookup"><span data-stu-id="a2adf-221">Replication</span></span>
<span data-ttu-id="a2adf-222">Il database SQL di Azure offre resilienza predefinita agli errori a livello di nodo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-222">Azure SQL Database provides built-in resiliency to node-level failure.</span></span> <span data-ttu-id="a2adf-223">Tutte le scritture in un database vengono replicate automaticamente in due o più nodi in background tramite una tecnica di commit del quorum.</span><span class="sxs-lookup"><span data-stu-id="a2adf-223">All writes into a database are automatically replicated to two or more background nodes through a quorum commit technique.</span></span> <span data-ttu-id="a2adf-224">Il nodo primario e almeno un nodo secondario devono confermare la scrittura dell'attività nel log delle transazioni prima che la transazione venga considerata riuscita e completata. In caso di errore del nodo, viene eseguito automaticamente il failover del database in una delle due repliche secondarie.</span><span class="sxs-lookup"><span data-stu-id="a2adf-224">(The primary and at least one secondary must confirm that the activity is written to the transaction log before the transaction is deemed successful and returns.) In the case of node failure, the database automatically fails over to one of the secondary replicas.</span></span> <span data-ttu-id="a2adf-225">Questo causa un'interruzione temporanea della connessione per le applicazioni client.</span><span class="sxs-lookup"><span data-stu-id="a2adf-225">This causes a transient connection interruption for client applications.</span></span> <span data-ttu-id="a2adf-226">Per questo motivo, tutti i client del database SQL di Microsoft Azure devono implementare qualche forma di gestione temporanea della connessione.</span><span class="sxs-lookup"><span data-stu-id="a2adf-226">For this reason, all Azure SQL Database clients must implement some form of transient connection handling.</span></span> <span data-ttu-id="a2adf-227">Per ulteriori informazioni, vedere [Linee guida specifiche del servizio di ripetizione dei tentativi](/azure/best-practices-retry-service-specific/).</span><span class="sxs-lookup"><span data-stu-id="a2adf-227">For more information, see [Retry service specific guidance](/azure/best-practices-retry-service-specific/).</span></span>

#### <a name="resource-management"></a><span data-ttu-id="a2adf-228">Resource management</span><span class="sxs-lookup"><span data-stu-id="a2adf-228">Resource management</span></span>
<span data-ttu-id="a2adf-229">Ogni database, al momento della creazione, viene configurato con un limite massimo di dimensioni.</span><span class="sxs-lookup"><span data-stu-id="a2adf-229">Each database, when created, is configured with an upper size limit.</span></span> <span data-ttu-id="a2adf-230">Le dimensioni massime attualmente disponibili sono pari a 1 TB. I limiti per le dimensioni dipendono dal livello di servizio specifico. Vedere [Livelli di servizio e livelli di prestazioni dei database SQL di Azure](/azure/sql-database/sql-database-resource-limits/#service-tiers-and-performance-levels).</span><span class="sxs-lookup"><span data-stu-id="a2adf-230">The currently available maximum size is 1 TB (size limits vary based on your service tier, see [service tiers and performance levels of Azure SQL Databases](/azure/sql-database/sql-database-resource-limits/#service-tiers-and-performance-levels).</span></span> <span data-ttu-id="a2adf-231">Quando raggiunge il proprio limite massimo di dimensioni, il database rifiuta i comandi INSERT o UPDATE aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="a2adf-231">When a database hits its upper size limit, it rejects additional INSERT or UPDATE commands.</span></span> <span data-ttu-id="a2adf-232">È ancora possibile eseguire query ed eliminare dati.</span><span class="sxs-lookup"><span data-stu-id="a2adf-232">(Querying and deleting data is still possible.)</span></span>

<span data-ttu-id="a2adf-233">All'interno di un database, il database SQL di Microsoft Azure usa un'infrastruttura per gestire le risorse.</span><span class="sxs-lookup"><span data-stu-id="a2adf-233">Within a database, Azure SQL Database uses a fabric to manage resources.</span></span> <span data-ttu-id="a2adf-234">Per rilevare gli errori, tuttavia, usa una topologia ad anello anziché un controller di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="a2adf-234">However, instead of a fabric controller, it uses a ring topology to detect failures.</span></span> <span data-ttu-id="a2adf-235">Ogni replica in un cluster ha due vicini e la responsabilità di rilevare quando sono inattivi.</span><span class="sxs-lookup"><span data-stu-id="a2adf-235">Every replica in a cluster has two neighbors and is responsible for detecting when they go down.</span></span> <span data-ttu-id="a2adf-236">Quando una replica diventa inattiva, i vicini attivano un agente di riconfigurazione per ricrearla in un'altra macchina.</span><span class="sxs-lookup"><span data-stu-id="a2adf-236">When a replica goes down, its neighbors trigger a reconfiguration agent to re-create it on another machine.</span></span> <span data-ttu-id="a2adf-237">La limitazione del motore viene fornita per garantire che un server logico non usi troppe risorse in una macchina o ne superi i limiti fisici.</span><span class="sxs-lookup"><span data-stu-id="a2adf-237">Engine throttling is provided to ensure that a logical server doesn't use too many resources on a machine or exceed the machine’s physical limits.</span></span>

### <a name="elasticity"></a><span data-ttu-id="a2adf-238">Elasticità</span><span class="sxs-lookup"><span data-stu-id="a2adf-238">Elasticity</span></span>
<span data-ttu-id="a2adf-239">Se le esigenze dell'applicazione superano il limite di 1 TB del database, deve essere implementato un approccio di aumento delle istanze.</span><span class="sxs-lookup"><span data-stu-id="a2adf-239">If the application requires more than the 1 TB database limit, it must implement a scale-out approach.</span></span> <span data-ttu-id="a2adf-240">Con il database SQL di Azure, la scalabilità orizzontale viene eseguita con il partizionamento manuale dei dati, noto anche come partizionamento orizzontale, in più database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-240">You scale out with Azure SQL Database by manually partitioning, also known as sharding, data across multiple SQL databases.</span></span> <span data-ttu-id="a2adf-241">Questo approccio di aumento delle istanze offre l'opportunità di ottenere una crescita proporzionale quasi lineare dei costi.</span><span class="sxs-lookup"><span data-stu-id="a2adf-241">This scale-out approach provides the opportunity to achieve nearly linear cost growth with scale.</span></span> <span data-ttu-id="a2adf-242">La crescita elastica consente di aumentare la capacità su richiesta con costi incrementali in base alle esigenze, perché i database vengono fatturati in base alle dimensioni effettive medie usate al giorno, non in base alle dimensioni massime possibili.</span><span class="sxs-lookup"><span data-stu-id="a2adf-242">Elastic growth or capacity on demand can grow with incremental costs as needed because databases are billed based on the average actual size used per day, not based on maximum possible size.</span></span>

## <a name="sql-server-on-virtual-machines"></a><span data-ttu-id="a2adf-243">SQL Server nelle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="a2adf-243">SQL Server on Virtual Machines</span></span>
<span data-ttu-id="a2adf-244">Installando SQL Server (versione 2014 o successiva) in Macchine virtuali di Azure, è possibile sfruttare le funzionalità di disponibilità tradizionali di SQL Server,</span><span class="sxs-lookup"><span data-stu-id="a2adf-244">By installing SQL Server (version 2014 or later) on Azure Virtual Machines, you can take advantage of the traditional availability features of SQL Server.</span></span> <span data-ttu-id="a2adf-245">come Gruppi di disponibilità AlwaysOn o il mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="a2adf-245">These features include AlwaysOn Availability Groups and database mirroring.</span></span> <span data-ttu-id="a2adf-246">Si noti che le VM, l'archiviazione e la rete di Azure hanno caratteristiche operative diverse rispetto a un'infrastruttura IT locale non virtualizzata.</span><span class="sxs-lookup"><span data-stu-id="a2adf-246">Note that Azure VMs, storage, and networking have different operational characteristics than an on-premises, non-virtualized IT infrastructure.</span></span> <span data-ttu-id="a2adf-247">Per la corretta implementazione di una soluzione di disponibilità elevata/ripristino di emergenza (HADR) di SQL Server in Azure è necessario conoscere queste differenze e progettare una soluzione adeguata.</span><span class="sxs-lookup"><span data-stu-id="a2adf-247">A successful implementation of a high availability/disaster recovery (HA/DR) SQL Server solution in Azure requires that you understand these differences and design your solution to accommodate them.</span></span>

### <a name="high-availability-nodes-in-an-availability-set"></a><span data-ttu-id="a2adf-248">Nodi a disponibilità elevata in un set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="a2adf-248">High-availability nodes in an availability set</span></span>
<span data-ttu-id="a2adf-249">Quando si implementa una soluzione a disponibilità elevata in Azure, è possibile usare il set di disponibilità in Azure per inserire i nodi a disponibilità elevata in domini di errore e di aggiornamento separati.</span><span class="sxs-lookup"><span data-stu-id="a2adf-249">When you implement a high-availability solution in Azure, you can use the availability set in Azure to place the high-availability nodes into separate fault domains and upgrade domains.</span></span> <span data-ttu-id="a2adf-250">Per maggiore chiarezza, il set di disponibilità è un concetto di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-250">To be clear, the availability set is an Azure concept.</span></span> <span data-ttu-id="a2adf-251">È una procedura consigliata da seguire per assicurarsi che i database siano effettivamente a disponibilità elevata, indipendentemente dal fatto che si usino Gruppi di disponibilità AlwaysOn, il mirroring del database o altro.</span><span class="sxs-lookup"><span data-stu-id="a2adf-251">It's a best practice that you should follow to make sure that your databases are indeed highly available, whether you're using AlwaysOn Availability Groups, database mirroring, or something else.</span></span> <span data-ttu-id="a2adf-252">Se non si segue questa procedura consigliata, si potrebbe erroneamente presumere che il sistema sia a disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="a2adf-252">If you don't follow this best practice, you might be under the false assumption that your system is highly available.</span></span> <span data-ttu-id="a2adf-253">In realtà si possono verificare errori in tutti i nodi simultaneamente perché i nodi sono inseriti nello stesso dominio di errore nell'area di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-253">But in reality, your nodes can all fail simultaneously because they happen to be placed in the same fault domain in the Azure region.</span></span>

<span data-ttu-id="a2adf-254">Questa raccomandazione non si applica con il log shipping.</span><span class="sxs-lookup"><span data-stu-id="a2adf-254">This recommendation is not as applicable with log shipping.</span></span> <span data-ttu-id="a2adf-255">Con questa funzionalità di ripristino di emergenza è consigliabile assicurarsi che i server siano in esecuzione in aree di Azure separate.</span><span class="sxs-lookup"><span data-stu-id="a2adf-255">As a disaster recovery feature, you should ensure that the servers are running in separate Azure regions.</span></span> <span data-ttu-id="a2adf-256">Per definizione, queste aree sono domini di errore separati.</span><span class="sxs-lookup"><span data-stu-id="a2adf-256">By definition, these regions are separate fault domains.</span></span>

<span data-ttu-id="a2adf-257">Per fare in modo che le macchine virtuali dei servizi cloud di Azure distribuite tramite il portale classico si trovino nello stesso set di disponibilità, è necessario distribuirle nello stesso servizio cloud.</span><span class="sxs-lookup"><span data-stu-id="a2adf-257">For Azure Cloud Services VMs deployed through the classic portal to be in the same availability set, you must deploy them in the same Cloud Service.</span></span> <span data-ttu-id="a2adf-258">Le macchine virtuale distribuite tramite Azure Resource Manager (portale corrente) non presentano questa limitazione.</span><span class="sxs-lookup"><span data-stu-id="a2adf-258">VMs deployed through Azure Resource Manager (the current portal) do not have this limitation.</span></span> <span data-ttu-id="a2adf-259">Per le macchine virtuali distribuite tramite il portale classico nel servizio cloud di Azure solo i nodi che si trovano nello stesso servizio cloud possono partecipare allo stesso set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="a2adf-259">For classic portal deployed VMs in Azure Cloud Service, only nodes in the same Cloud Service can participate in the same availability set.</span></span> <span data-ttu-id="a2adf-260">Le VM dei servizi cloud, inoltre, devono far parte della stessa rete virtuale in modo da mantenere i propri IP anche dopo la correzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-260">In addition, the Cloud Services VMs should be in the same virtual network to ensure that they maintain their IPs even after service healing.</span></span> <span data-ttu-id="a2adf-261">Ciò consente di evitare interruzioni all'aggiornamento DNS.</span><span class="sxs-lookup"><span data-stu-id="a2adf-261">This avoids DNS update disruptions.</span></span>

### <a name="azure-only-high-availability-solutions"></a><span data-ttu-id="a2adf-262">Solo Azure: soluzioni a disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="a2adf-262">Azure-only: High-availability solutions</span></span>
<span data-ttu-id="a2adf-263">È possibile disporre di una soluzione a disponibilità elevata per i database di SQL Server in Azure tramite i gruppi di disponibilità AlwaysOn o il mirroring del database.</span><span class="sxs-lookup"><span data-stu-id="a2adf-263">You can have a high-availability solution for your SQL Server databases in Azure by using AlwaysOn Availability Groups or database mirroring.</span></span>

<span data-ttu-id="a2adf-264">La figura seguente illustra l'architettura di Gruppi di disponibilità AlwaysOn in esecuzione in macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-264">The following diagram demonstrates the architecture of AlwaysOn Availability Groups running on Azure Virtual Machines.</span></span> <span data-ttu-id="a2adf-265">Questa figura è tratta dall'articolo di approfondimento sull'argomento [Disponibilità elevata e ripristino di emergenza per SQL Server nelle macchine virtuali di Azure](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="a2adf-265">This diagram was taken from the in-depth article on this subject, [High availability and disaster recovery for SQL Server on Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

![Gruppi di disponibilità AlwaysOn in Microsoft Azure](./images/technical-guidance-recovery-local-failures/high_availability_solutions-1.png)

<span data-ttu-id="a2adf-267">È anche possibile effettuare automaticamente il provisioning della distribuzione di un gruppo di disponibilità AlwaysOn end-to-end in VM di Azure usando il modello AlwaysOn nel portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-267">You can also automatically provision an AlwaysOn Availability Groups deployment end-to-end on Azure VMs by using the AlwaysOn template in the Azure portal.</span></span> <span data-ttu-id="a2adf-268">Per altre informazioni, vedere l' [offerta di SQL Server AlwaysOn nella raccolta del portale di Microsoft Azure](https://blogs.technet.microsoft.com/dataplatforminsider/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery/).</span><span class="sxs-lookup"><span data-stu-id="a2adf-268">For more information, see [SQL Server AlwaysOn Offering in Microsoft Azure Portal Gallery](https://blogs.technet.microsoft.com/dataplatforminsider/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery/).</span></span>

<span data-ttu-id="a2adf-269">La figura seguente illustra l'uso del mirroring del database nelle macchine virtuali di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-269">The following diagram demonstrates the use of database mirroring on Azure Virtual Machines.</span></span> <span data-ttu-id="a2adf-270">Anche questa figura è tratta dall'argomento di approfondimento [Disponibilità elevata e ripristino di emergenza per SQL Server nelle macchine virtuali di Azure](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="a2adf-270">It was also taken from the in-depth topic [High availability and disaster recovery for SQL Server on Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

![Mirroring del database in Microsoft Azure](./images/technical-guidance-recovery-local-failures/high_availability_solutions-2.png)

> [!NOTE]
> <span data-ttu-id="a2adf-272">In entrambe le architetture è necessario un controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-272">Both architectures require a domain controller.</span></span> <span data-ttu-id="a2adf-273">Con il mirroring del database, tuttavia, è possibile usare certificati del server per eliminare la necessità di un controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-273">However, with database mirroring, it's possible to use server certificates to eliminate the need for a domain controller.</span></span>
> 
> 

## <a name="other-azure-platform-services"></a><span data-ttu-id="a2adf-274">Altri servizi della piattaforma Azure</span><span class="sxs-lookup"><span data-stu-id="a2adf-274">Other Azure platform services</span></span>
<span data-ttu-id="a2adf-275">Le applicazioni basate su Azure usufruiscono delle funzionalità della piattaforma per il ripristino da errori locali.</span><span class="sxs-lookup"><span data-stu-id="a2adf-275">Applications that are built on Azure benefit from platform capabilities to recover from local failures.</span></span> <span data-ttu-id="a2adf-276">In alcuni casi, è possibile eseguire azioni specifiche per aumentare la disponibilità per un determinato scenario.</span><span class="sxs-lookup"><span data-stu-id="a2adf-276">In some cases, you can take specific actions to increase availability for your specific scenario.</span></span>

### <a name="service-bus"></a><span data-ttu-id="a2adf-277">Bus di servizio</span><span class="sxs-lookup"><span data-stu-id="a2adf-277">Service Bus</span></span>
<span data-ttu-id="a2adf-278">Per attenuare gli effetti di un'interruzione temporanea del bus di servizio di Azure, può essere opportuno creare una coda durevole sul lato client.</span><span class="sxs-lookup"><span data-stu-id="a2adf-278">To mitigate against a temporary outage of Azure Service Bus, consider creating a durable client-side queue.</span></span> <span data-ttu-id="a2adf-279">In questo modo viene usato temporaneamente un meccanismo di archiviazione locale alternativo per archiviare i messaggi che non possono essere aggiunti alla coda del bus di servizio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-279">This temporarily uses an alternate, local storage mechanism to store messages that cannot be added to the Service Bus queue.</span></span> <span data-ttu-id="a2adf-280">L'applicazione può decidere come gestire i messaggi archiviati temporaneamente dopo che è stato ripristinato il servizio.</span><span class="sxs-lookup"><span data-stu-id="a2adf-280">The application can decide how to handle the temporarily stored messages after the service is restored.</span></span> <span data-ttu-id="a2adf-281">Per altre informazioni, vedere [Procedure consigliate per il miglioramento delle prestazioni tramite la messaggistica negoziata del bus di servizio](/azure/service-bus-messaging/service-bus-performance-improvements/) e [Bus di servizio (ripristino di emergenza)](recovery-loss-azure-region.md#other-azure-platform-services).</span><span class="sxs-lookup"><span data-stu-id="a2adf-281">For more information, see [Best practices for performance improvements using Service Bus brokered messaging](/azure/service-bus-messaging/service-bus-performance-improvements/) and [Service Bus (disaster recovery)](recovery-loss-azure-region.md#other-azure-platform-services).</span></span>

### <a name="hdinsight"></a><span data-ttu-id="a2adf-282">HDInsight</span><span class="sxs-lookup"><span data-stu-id="a2adf-282">HDInsight</span></span>
<span data-ttu-id="a2adf-283">I dati associati ad AzureHDInsight vengono archiviati per impostazione predefinita nell'archivio BLOB di Azure.</span><span class="sxs-lookup"><span data-stu-id="a2adf-283">The data that's associated with Azure HDInsight is stored by default in Azure Blob storage.</span></span> <span data-ttu-id="a2adf-284">Archiviazione di Azure specifica le proprietà di durabilità e disponibilità elevata per l'archiviazione Blob.</span><span class="sxs-lookup"><span data-stu-id="a2adf-284">Azure Storage specifies high-availability and durability properties for Blob storage.</span></span> <span data-ttu-id="a2adf-285">L'elaborazione multinodo associata ai processi Hadoop MapReduce viene eseguita in Hadoop Distributed File System (HDFS), di cui HDInsight effettua il provisioning quando necessario.</span><span class="sxs-lookup"><span data-stu-id="a2adf-285">The multiple-node processing that's associated with Hadoop MapReduce jobs occurs on a transient Hadoop Distributed File System (HDFS) that is provisioned when HDInsight needs it.</span></span> <span data-ttu-id="a2adf-286">Anche i risultati di un processo MapReduce vengono archiviati per impostazione predefinita nell'archivio BLOB di Azure, quindi i dati elaborati sono durevoli e mantengono la disponibilità elevata dopo il deprovisioning del cluster Hadoop.</span><span class="sxs-lookup"><span data-stu-id="a2adf-286">Results from a MapReduce job are also stored by default in Azure Blob storage, so that the processed data is durable and remains highly available after the Hadoop cluster is deprovisioned.</span></span> <span data-ttu-id="a2adf-287">Per altre informazioni, vedere la sezione relativa a [HDInsight (in relazione al ripristino di emergenza)](recovery-loss-azure-region.md#other-azure-platform-services).</span><span class="sxs-lookup"><span data-stu-id="a2adf-287">For more information, see [HDInsight (disaster recovery)](recovery-loss-azure-region.md#other-azure-platform-services).</span></span>

## <a name="checklists-for-local-failures"></a><span data-ttu-id="a2adf-288">Elenchi di controllo: errori locali</span><span class="sxs-lookup"><span data-stu-id="a2adf-288">Checklists for local failures</span></span>
### <a name="cloud-services"></a><span data-ttu-id="a2adf-289">Servizi cloud</span><span class="sxs-lookup"><span data-stu-id="a2adf-289">Cloud Services</span></span>
1. <span data-ttu-id="a2adf-290">Vedere la sezione Servizi cloud di questo documento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-290">Review the Cloud Services section of this document.</span></span>
2. <span data-ttu-id="a2adf-291">Configurare almeno due istanze per ogni ruolo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-291">Configure at least two instances for each role.</span></span>
3. <span data-ttu-id="a2adf-292">Rendere persistente lo stato nella risorsa di archiviazione durevole, non nelle istanze del ruolo.</span><span class="sxs-lookup"><span data-stu-id="a2adf-292">Persist state in durable storage, not on role instances.</span></span>
4. <span data-ttu-id="a2adf-293">Gestire correttamente l'evento StatusCheck.</span><span class="sxs-lookup"><span data-stu-id="a2adf-293">Correctly handle the StatusCheck event.</span></span>
5. <span data-ttu-id="a2adf-294">Eseguire il wrapping in transazioni delle modifiche correlate, quando possibile.</span><span class="sxs-lookup"><span data-stu-id="a2adf-294">Wrap related changes in transactions when possible.</span></span>
6. <span data-ttu-id="a2adf-295">Verificare che le attività dei ruoli di lavoro siano idempotenti e riavviabili.</span><span class="sxs-lookup"><span data-stu-id="a2adf-295">Verify that worker role tasks are idempotent and restartable.</span></span>
7. <span data-ttu-id="a2adf-296">Continuare a richiamare le operazioni finché non vengono completate.</span><span class="sxs-lookup"><span data-stu-id="a2adf-296">Continue to invoke operations until they succeed.</span></span>
8. <span data-ttu-id="a2adf-297">Prendere in considerazione strategie di scalabilità automatica.</span><span class="sxs-lookup"><span data-stu-id="a2adf-297">Consider autoscaling strategies.</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="a2adf-298">Macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="a2adf-298">Virtual Machines</span></span>
1. <span data-ttu-id="a2adf-299">Vedere la sezione Macchine virtuali di questo documento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-299">Review the Virtual Machines section of this document.</span></span>
2. <span data-ttu-id="a2adf-300">Non usare l'unità D: per l'archiviazione persistente.</span><span class="sxs-lookup"><span data-stu-id="a2adf-300">Do not use drive D for persistent storage.</span></span>
3. <span data-ttu-id="a2adf-301">Raggruppare le macchine di un livello del servizio in un set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="a2adf-301">Group machines in a service tier into an availability set.</span></span>
4. <span data-ttu-id="a2adf-302">Configurare il bilanciamento del carico e probe facoltativi.</span><span class="sxs-lookup"><span data-stu-id="a2adf-302">Configure load balancing and optional probes.</span></span>

### <a name="storage"></a><span data-ttu-id="a2adf-303">Archiviazione</span><span class="sxs-lookup"><span data-stu-id="a2adf-303">Storage</span></span>
1. <span data-ttu-id="a2adf-304">Vedere la sezione Archiviazione di questo documento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-304">Review the Storage section of this document.</span></span>
2. <span data-ttu-id="a2adf-305">Quando la larghezza di banda o i dati superano le quote, usare più account di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="a2adf-305">Use multiple storage accounts when data or bandwidth exceeds quotas.</span></span>

### <a name="sql-database"></a><span data-ttu-id="a2adf-306">Database SQL</span><span class="sxs-lookup"><span data-stu-id="a2adf-306">SQL Database</span></span>
1. <span data-ttu-id="a2adf-307">Vedere la sezione Database SQL di questo documento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-307">Review the SQL Database section of this document.</span></span>
2. <span data-ttu-id="a2adf-308">Implementare un criterio di ripetizione dei tentativi per gestire gli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="a2adf-308">Implement a retry policy to handle transient errors.</span></span>
3. <span data-ttu-id="a2adf-309">Usare il partizionamento orizzontale come strategia di aumento delle istanze.</span><span class="sxs-lookup"><span data-stu-id="a2adf-309">Use partitioning/sharding as a scale-out strategy.</span></span>

### <a name="sql-server-on-virtual-machines"></a><span data-ttu-id="a2adf-310">SQL Server nelle macchine virtuali</span><span class="sxs-lookup"><span data-stu-id="a2adf-310">SQL Server on Virtual Machines</span></span>
1. <span data-ttu-id="a2adf-311">Vedere la sezione SQL Server nelle macchine virtuali di questo documento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-311">Review the SQL Server on Virtual Machines section of this document.</span></span>
2. <span data-ttu-id="a2adf-312">Seguire le raccomandazioni precedenti per le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="a2adf-312">Follow the previous recommendations for Virtual Machines.</span></span>
3. <span data-ttu-id="a2adf-313">Usare le funzionalità di disponibilità elevata di SQL Server, come AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="a2adf-313">Use SQL Server high availability features, such as AlwaysOn.</span></span>

### <a name="service-bus"></a><span data-ttu-id="a2adf-314">Bus di servizio</span><span class="sxs-lookup"><span data-stu-id="a2adf-314">Service Bus</span></span>
1. <span data-ttu-id="a2adf-315">Vedere la sezione Bus di servizio di questo documento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-315">Review the Service Bus section of this document.</span></span>
2. <span data-ttu-id="a2adf-316">Prendere in considerazione la creazione di una coda durevole sul lato client come backup.</span><span class="sxs-lookup"><span data-stu-id="a2adf-316">Consider creating a durable client-side queue as a backup.</span></span>

### <a name="hdinsight"></a><span data-ttu-id="a2adf-317">HDInsight</span><span class="sxs-lookup"><span data-stu-id="a2adf-317">HDInsight</span></span>
1. <span data-ttu-id="a2adf-318">Vedere la sezione HDInsight di questo documento.</span><span class="sxs-lookup"><span data-stu-id="a2adf-318">Review the HDInsight section of this document.</span></span>
2. <span data-ttu-id="a2adf-319">Per gli errori locali non sono necessari passi aggiuntivi relativi alla disponibilità.</span><span class="sxs-lookup"><span data-stu-id="a2adf-319">No additional availability steps are required for local failures.</span></span>

