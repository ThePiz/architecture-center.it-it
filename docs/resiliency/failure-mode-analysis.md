---
title: Analisi della modalità di errore
description: Linee guida per l'esecuzione di un'analisi della modalità di errore per soluzioni cloud basate su Azure.
author: MikeWasson
ms.date: 05/07/2018
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.custom: resiliency
ms.openlocfilehash: 0d89570ca42aa087a9c18148b5a4019b6f348e6b
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/17/2019
ms.locfileid: "59640975"
---
# <a name="failure-mode-analysis-for-azure-applications"></a><span data-ttu-id="9767c-103">Analisi della modalità di errore per le applicazioni Azure</span><span class="sxs-lookup"><span data-stu-id="9767c-103">Failure mode analysis for Azure applications</span></span>

<span data-ttu-id="9767c-104">L'analisi della modalità di errore (FMA) è un processo che consente di ottenere la resilienza in un sistema, identificando possibili punti di errore in esso presenti.</span><span class="sxs-lookup"><span data-stu-id="9767c-104">Failure mode analysis (FMA) is a process for building resiliency into a system, by identifying possible failure points in the system.</span></span> <span data-ttu-id="9767c-105">La FMA deve essere eseguita durante le fasi di progettazione e architettura, in modo che sia possibile integrare il ripristino dagli errori nel sistema dall'inizio.</span><span class="sxs-lookup"><span data-stu-id="9767c-105">The FMA should be part of the architecture and design phases, so that you can build failure recovery into the system from the beginning.</span></span>

<span data-ttu-id="9767c-106">Ecco il processo generale per eseguire una FMA:</span><span class="sxs-lookup"><span data-stu-id="9767c-106">Here is the general process to conduct an FMA:</span></span>

1. <span data-ttu-id="9767c-107">Identificare tutti i componenti nel sistema.</span><span class="sxs-lookup"><span data-stu-id="9767c-107">Identify all of the components in the system.</span></span> <span data-ttu-id="9767c-108">Includere le dipendenze esterne, ad esempio i provider di identità, servizi di terze parti e così via.</span><span class="sxs-lookup"><span data-stu-id="9767c-108">Include external dependencies, such as identity providers, third-party services, and so on.</span></span>
2. <span data-ttu-id="9767c-109">Per ogni componente, identificare potenziali errori che potrebbero verificarsi.</span><span class="sxs-lookup"><span data-stu-id="9767c-109">For each component, identify potential failures that could occur.</span></span> <span data-ttu-id="9767c-110">Un singolo componente può avere più di una modalità di errore.</span><span class="sxs-lookup"><span data-stu-id="9767c-110">A single component may have more than one failure mode.</span></span> <span data-ttu-id="9767c-111">Ad esempio gli errori di lettura e gli errori di scrittura devono essere valutati separatamente, in quanto l'impatto e le misure di attenuazione sono diversi.</span><span class="sxs-lookup"><span data-stu-id="9767c-111">For example, you should consider read failures and write failures separately, because the impact and possible mitigations will be different.</span></span>
3. <span data-ttu-id="9767c-112">Classificare ogni modalità di errore in base al relativo rischio complessivo.</span><span class="sxs-lookup"><span data-stu-id="9767c-112">Rate each failure mode according to its overall risk.</span></span> <span data-ttu-id="9767c-113">Tenere presente questi fattori:</span><span class="sxs-lookup"><span data-stu-id="9767c-113">Consider these factors:</span></span>

   - <span data-ttu-id="9767c-114">Che cos'è la probabilità di errore.</span><span class="sxs-lookup"><span data-stu-id="9767c-114">What is the likelihood of the failure.</span></span> <span data-ttu-id="9767c-115">È abbastanza comune?</span><span class="sxs-lookup"><span data-stu-id="9767c-115">Is it relatively common?</span></span> <span data-ttu-id="9767c-116">Estremamente rara?</span><span class="sxs-lookup"><span data-stu-id="9767c-116">Extrememly rare?</span></span> <span data-ttu-id="9767c-117">Non è necessario ragionare su numeri esatti, in quanto lo scopo è stabilire una classificazione della priorità.</span><span class="sxs-lookup"><span data-stu-id="9767c-117">You don't need exact numbers; the purpose is to help rank the priority.</span></span>
   - <span data-ttu-id="9767c-118">Qual è l'impatto sull'applicazione in termini di disponibilità, perdita dei dati, costo monetario e interruzione dell'operatività?</span><span class="sxs-lookup"><span data-stu-id="9767c-118">What is the impact on the application, in terms of availability, data loss, monetary cost, and business disruption?</span></span>

4. <span data-ttu-id="9767c-119">Per ogni modalità di errore, determinare il modo in cui l'applicazione risponde ed esegue il ripristino.</span><span class="sxs-lookup"><span data-stu-id="9767c-119">For each failure mode, determine how the application will respond and recover.</span></span> <span data-ttu-id="9767c-120">Prendere in considerazione eventuali compromessi relativi ai costi e alla complessità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-120">Consider tradeoffs in cost and application complexity.</span></span>

<span data-ttu-id="9767c-121">Come punto di partenza per il processo di analisi della modalità di errore, questo articolo include un catalogo di potenziali modalità di errore e delle relative attenuazioni.</span><span class="sxs-lookup"><span data-stu-id="9767c-121">As a starting point for your FMA process, this article contains a catalog of potential failure modes and their mitigations.</span></span> <span data-ttu-id="9767c-122">Il catalogo è organizzato in base alla tecnologia o al servizio di Azure, oltre a una categoria generale per la progettazione a livello di applicazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-122">The catalog is organized by technology or Azure service, plus a general category for application-level design.</span></span> <span data-ttu-id="9767c-123">Il catalogo non è esaustivo, ma tiene conto di molti dei servizi di base di Azure.</span><span class="sxs-lookup"><span data-stu-id="9767c-123">The catalog is not exhaustive, but covers many of the core Azure services.</span></span>

## <a name="app-service"></a><span data-ttu-id="9767c-124">Servizio app</span><span class="sxs-lookup"><span data-stu-id="9767c-124">App Service</span></span>

<!-- markdownlint-disable MD026 -->

### <a name="app-service-app-shuts-down"></a><span data-ttu-id="9767c-125">L'app Servizio app di Azure si arresta.</span><span class="sxs-lookup"><span data-stu-id="9767c-125">App Service app shuts down.</span></span>

<span data-ttu-id="9767c-126">**Rilevamento**.</span><span class="sxs-lookup"><span data-stu-id="9767c-126">**Detection**.</span></span> <span data-ttu-id="9767c-127">Possibili cause:</span><span class="sxs-lookup"><span data-stu-id="9767c-127">Possible causes:</span></span>

- <span data-ttu-id="9767c-128">Arresto previsto</span><span class="sxs-lookup"><span data-stu-id="9767c-128">Expected shutdown</span></span>

  - <span data-ttu-id="9767c-129">Un operatore arresta l'applicazione, ad esempio tramite il portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="9767c-129">An operator shuts down the application; for example, using the Azure portal.</span></span>
  - <span data-ttu-id="9767c-130">L'app è stata scaricata perché era inattiva</span><span class="sxs-lookup"><span data-stu-id="9767c-130">The app was unloaded because it was idle.</span></span> <span data-ttu-id="9767c-131">(solo se l'impostazione `Always On` è disabilitata).</span><span class="sxs-lookup"><span data-stu-id="9767c-131">(Only if the `Always On` setting is disabled.)</span></span>

- <span data-ttu-id="9767c-132">Arresto imprevisto</span><span class="sxs-lookup"><span data-stu-id="9767c-132">Unexpected shutdown</span></span>

  - <span data-ttu-id="9767c-133">L'app si arresta in modo anomalo.</span><span class="sxs-lookup"><span data-stu-id="9767c-133">The app crashes.</span></span>
  - <span data-ttu-id="9767c-134">Un'istanza VM del Servizio app di Azure non è più disponibile.</span><span class="sxs-lookup"><span data-stu-id="9767c-134">An App Service VM instance becomes unavailable.</span></span>

<span data-ttu-id="9767c-135">La registrazione Application_End è l'unico modo per individuare gli arresti di dominio dell'app (arresto anomalo del processo software).</span><span class="sxs-lookup"><span data-stu-id="9767c-135">Application_End logging will catch the app domain shutdown (soft process crash) and is the only way to catch the application domain shutdowns.</span></span>

<span data-ttu-id="9767c-136">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-136">**Recovery:**</span></span>

- <span data-ttu-id="9767c-137">Se l'arresto era previsto, usare l'evento di arresto dell'applicazione per spegnere normalmente il sistema.</span><span class="sxs-lookup"><span data-stu-id="9767c-137">If the shutdown was expected, use the application's shutdown event to shut down gracefully.</span></span> <span data-ttu-id="9767c-138">Ad esempio, in ASP.NET usare il metodo `Application_End`.</span><span class="sxs-lookup"><span data-stu-id="9767c-138">For example, in ASP.NET, use the `Application_End` method.</span></span>
- <span data-ttu-id="9767c-139">Se l'applicazione è stata scaricata durante l'inattività, viene riavviata automaticamente alla richiesta successiva.</span><span class="sxs-lookup"><span data-stu-id="9767c-139">If the application was unloaded while idle, it is automatically restarted on the next request.</span></span> <span data-ttu-id="9767c-140">Tuttavia, si incorrerà nei costi dell'"avvio a freddo".</span><span class="sxs-lookup"><span data-stu-id="9767c-140">However, you will incur the "cold start" cost.</span></span>
- <span data-ttu-id="9767c-141">Per evitare che l'applicazione venga scaricata durante l'inattività, abilitare l'impostazione `Always On` nell'app Web.</span><span class="sxs-lookup"><span data-stu-id="9767c-141">To prevent the application from being unloaded while idle, enable the `Always On` setting in the web app.</span></span> <span data-ttu-id="9767c-142">Vedere [Configurazione delle app Web in Servizio app di Azure][app-service-configure].</span><span class="sxs-lookup"><span data-stu-id="9767c-142">See [Configure web apps in Azure App Service][app-service-configure].</span></span>
- <span data-ttu-id="9767c-143">Per impedire che un operatore arresti l'app, impostare un blocco di risorsa con livello `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="9767c-143">To prevent an operator from shutting down the app, set a resource lock with `ReadOnly` level.</span></span> <span data-ttu-id="9767c-144">Vedere [Bloccare le risorse per impedire modifiche impreviste][rm-locks].</span><span class="sxs-lookup"><span data-stu-id="9767c-144">See [Lock resources with Azure Resource Manager][rm-locks].</span></span>
- <span data-ttu-id="9767c-145">In caso di arresto anomalo dell'app o se un'istanza VM del Servizio app di Azure non è più disponibile, il Servizio app riavvia automaticamente l'app.</span><span class="sxs-lookup"><span data-stu-id="9767c-145">If the app crashes or an App Service VM becomes unavailable, App Service automatically restarts the app.</span></span>

<span data-ttu-id="9767c-146">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-146">**Diagnostics**.</span></span> <span data-ttu-id="9767c-147">Log dell'applicazione e del server Web.</span><span class="sxs-lookup"><span data-stu-id="9767c-147">Application logs and web server logs.</span></span> <span data-ttu-id="9767c-148">Vedere [Abilitare la registrazione diagnostica per le app Web nel servizio app di Azure][app-service-logging].</span><span class="sxs-lookup"><span data-stu-id="9767c-148">See [Enable diagnostics logging for web apps in Azure App Service][app-service-logging].</span></span>

### <a name="a-particular-user-repeatedly-makes-bad-requests-or-overloads-the-system"></a><span data-ttu-id="9767c-149">Un utente specifico esegue ripetutamente richieste non valide o sovraccarica il sistema.</span><span class="sxs-lookup"><span data-stu-id="9767c-149">A particular user repeatedly makes bad requests or overloads the system.</span></span>

<span data-ttu-id="9767c-150">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-150">**Detection**.</span></span> <span data-ttu-id="9767c-151">Autenticare gli utenti e includere l'ID utente nei log dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-151">Authenticate users and include user ID in application logs.</span></span>

<span data-ttu-id="9767c-152">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-152">**Recovery:**</span></span>

- <span data-ttu-id="9767c-153">Usare la [Documentazione di Gestione API] [ api-management] per limitare le richieste da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="9767c-153">Use [Azure API Management][api-management] to throttle requests from the user.</span></span> <span data-ttu-id="9767c-154">Vedere [Limitazione avanzata delle richieste con Gestione API di Azure][api-management-throttling]</span><span class="sxs-lookup"><span data-stu-id="9767c-154">See [Advanced request throttling with Azure API Management][api-management-throttling]</span></span>
- <span data-ttu-id="9767c-155">Bloccare l'utente.</span><span class="sxs-lookup"><span data-stu-id="9767c-155">Block the user.</span></span>

<span data-ttu-id="9767c-156">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-156">**Diagnostics**.</span></span> <span data-ttu-id="9767c-157">Registrare tutte le richieste di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-157">Log all authentication requests.</span></span>

### <a name="a-bad-update-was-deployed"></a><span data-ttu-id="9767c-158">È stato distribuito un aggiornamento non valido.</span><span class="sxs-lookup"><span data-stu-id="9767c-158">A bad update was deployed.</span></span>

<span data-ttu-id="9767c-159">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-159">**Detection**.</span></span> <span data-ttu-id="9767c-160">Monitorare l'integrità dell'applicazione tramite il portale di Azure (vedere [Monitoraggio delle prestazioni dell'applicazione Web di Azure][app-insights-web-apps]) o implementare il [modello di monitoraggio degli endpoint per l'integrità] [health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="9767c-160">Monitor the application health through the Azure Portal (see [Monitor Azure web app performance][app-insights-web-apps]) or implement the [health endpoint monitoring pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="9767c-161">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="9767c-161">**Recovery:**.</span></span> <span data-ttu-id="9767c-162">Usare più [slot di distribuzione] [ app-service-slots] ed eseguire il rollback all'ultima distribuzione valida.</span><span class="sxs-lookup"><span data-stu-id="9767c-162">Use multiple [deployment slots][app-service-slots] and roll back to the last-known-good deployment.</span></span> <span data-ttu-id="9767c-163">Per altre informazioni, vedere [Applicazione Web di base][ra-web-apps-basic].</span><span class="sxs-lookup"><span data-stu-id="9767c-163">For more information, see [Basic web application][ra-web-apps-basic].</span></span>

## <a name="azure-active-directory"></a><span data-ttu-id="9767c-164">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="9767c-164">Azure Active Directory</span></span>

### <a name="openid-connect-oidc-authentication-fails"></a><span data-ttu-id="9767c-165">L'autenticazione di OpenID Connect (OIDC) non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-165">OpenID Connect (OIDC) authentication fails.</span></span>

<span data-ttu-id="9767c-166">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-166">**Detection**.</span></span> <span data-ttu-id="9767c-167">Le modalità di errore possibili includono:</span><span class="sxs-lookup"><span data-stu-id="9767c-167">Possible failure modes include:</span></span>

1. <span data-ttu-id="9767c-168">Azure Active Directory non è disponibile o non è raggiungibile a causa di un problema di rete.</span><span class="sxs-lookup"><span data-stu-id="9767c-168">Azure AD is not available, or cannot be reached due to a network problem.</span></span> <span data-ttu-id="9767c-169">Il reindirizzamento all'endpoint di autenticazione non riesce e il middleware OIDC genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="9767c-169">Redirection to the authentication endpoint fails, and the OIDC middleware throws an exception.</span></span>
2. <span data-ttu-id="9767c-170">Il tenant di Azure Active Directory non esiste.</span><span class="sxs-lookup"><span data-stu-id="9767c-170">Azure AD tenant does not exist.</span></span> <span data-ttu-id="9767c-171">Il reindirizzamento all'endpoint di autenticazione restituisce un codice di errore HTTP e il middleware OIDC genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="9767c-171">Redirection to the authentication endpoint returns an HTTP error code, and the OIDC middleware throws an exception.</span></span>
3. <span data-ttu-id="9767c-172">L'utente non riesce a eseguire l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-172">User cannot authenticate.</span></span> <span data-ttu-id="9767c-173">Non è necessaria alcuna strategia di rilevamento; Azure AD gestisce gli errori di accesso.</span><span class="sxs-lookup"><span data-stu-id="9767c-173">No detection strategy is necessary; Azure AD handles login failures.</span></span>

<span data-ttu-id="9767c-174">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-174">**Recovery:**</span></span>

1. <span data-ttu-id="9767c-175">Individuare le eccezioni non gestite dal middleware.</span><span class="sxs-lookup"><span data-stu-id="9767c-175">Catch unhandled exceptions from the middleware.</span></span>
2. <span data-ttu-id="9767c-176">Gestire gli eventi `AuthenticationFailed`.</span><span class="sxs-lookup"><span data-stu-id="9767c-176">Handle `AuthenticationFailed` events.</span></span>
3. <span data-ttu-id="9767c-177">Reindirizzare l'utente a una pagina di errore.</span><span class="sxs-lookup"><span data-stu-id="9767c-177">Redirect the user to an error page.</span></span>
4. <span data-ttu-id="9767c-178">Tentativi utente.</span><span class="sxs-lookup"><span data-stu-id="9767c-178">User retries.</span></span>

## <a name="azure-search"></a><span data-ttu-id="9767c-179">Ricerca di Azure</span><span class="sxs-lookup"><span data-stu-id="9767c-179">Azure Search</span></span>

### <a name="writing-data-to-azure-search-fails"></a><span data-ttu-id="9767c-180">La scrittura dei dati in Ricerca di Azure non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-180">Writing data to Azure Search fails.</span></span>

<span data-ttu-id="9767c-181">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-181">**Detection**.</span></span> <span data-ttu-id="9767c-182">Individuare gli errori `Microsoft.Rest.Azure.CloudException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-182">Catch `Microsoft.Rest.Azure.CloudException` errors.</span></span>

<span data-ttu-id="9767c-183">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-183">**Recovery:**</span></span>

<span data-ttu-id="9767c-184">L'[SDK Search .NET] [ search-sdk] esegue automaticamente nuovi tentativi dopo gli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-184">The [Search .NET SDK][search-sdk] automatically retries after transient failures.</span></span> <span data-ttu-id="9767c-185">Tutte le eccezioni generate dall'SDK client devono essere considerate come errori non temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-185">Any exceptions thrown by the client SDK should be treated as non-transient errors.</span></span>

<span data-ttu-id="9767c-186">Il criterio di ripetizione dei tentativi predefinito usa il backoff esponenziale.</span><span class="sxs-lookup"><span data-stu-id="9767c-186">The default retry policy uses exponential back-off.</span></span> <span data-ttu-id="9767c-187">Per usare un criterio di ripetizione dei tentativi diverso, chiamare `SetRetryPolicy` sulla classe `SearchIndexClient` o `SearchServiceClient`.</span><span class="sxs-lookup"><span data-stu-id="9767c-187">To use a different retry policy, call `SetRetryPolicy` on the `SearchIndexClient` or `SearchServiceClient` class.</span></span> <span data-ttu-id="9767c-188">Per altre informazioni, vedere [Tentativi automatici][auto-rest-client-retry].</span><span class="sxs-lookup"><span data-stu-id="9767c-188">For more information, see [Automatic Retries][auto-rest-client-retry].</span></span>

<span data-ttu-id="9767c-189">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-189">**Diagnostics**.</span></span> <span data-ttu-id="9767c-190">Usare [Analisi del traffico di ricerca][search-analytics].</span><span class="sxs-lookup"><span data-stu-id="9767c-190">Use [Search Traffic Analytics][search-analytics].</span></span>

### <a name="reading-data-from-azure-search-fails"></a><span data-ttu-id="9767c-191">La lettura dei dati da Ricerca di Azure non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-191">Reading data from Azure Search fails.</span></span>

<span data-ttu-id="9767c-192">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-192">**Detection**.</span></span> <span data-ttu-id="9767c-193">Individuare gli errori `Microsoft.Rest.Azure.CloudException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-193">Catch `Microsoft.Rest.Azure.CloudException` errors.</span></span>

<span data-ttu-id="9767c-194">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-194">**Recovery:**</span></span>

<span data-ttu-id="9767c-195">L'[SDK Search .NET][search-sdk] esegue automaticamente nuovi tentativi dopo gli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-195">The [Search .NET SDK][search-sdk]  automatically retries after transient failures.</span></span> <span data-ttu-id="9767c-196">Tutte le eccezioni generate dall'SDK client devono essere considerate come errori non temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-196">Any exceptions thrown by the client SDK should be treated as non-transient errors.</span></span>

<span data-ttu-id="9767c-197">Il criterio di ripetizione dei tentativi predefinito usa il backoff esponenziale.</span><span class="sxs-lookup"><span data-stu-id="9767c-197">The default retry policy uses exponential back-off.</span></span> <span data-ttu-id="9767c-198">Per usare un criterio di ripetizione dei tentativi diverso, chiamare `SetRetryPolicy` sulla classe `SearchIndexClient` o `SearchServiceClient`.</span><span class="sxs-lookup"><span data-stu-id="9767c-198">To use a different retry policy, call `SetRetryPolicy` on the `SearchIndexClient` or `SearchServiceClient` class.</span></span> <span data-ttu-id="9767c-199">Per altre informazioni, vedere [Tentativi automatici][auto-rest-client-retry].</span><span class="sxs-lookup"><span data-stu-id="9767c-199">For more information, see [Automatic Retries][auto-rest-client-retry].</span></span>

<span data-ttu-id="9767c-200">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-200">**Diagnostics**.</span></span> <span data-ttu-id="9767c-201">Usare [Analisi del traffico di ricerca][search-analytics].</span><span class="sxs-lookup"><span data-stu-id="9767c-201">Use [Search Traffic Analytics][search-analytics].</span></span>

## <a name="cassandra"></a><span data-ttu-id="9767c-202">Cassandra</span><span class="sxs-lookup"><span data-stu-id="9767c-202">Cassandra</span></span>

### <a name="reading-or-writing-to-a-node-fails"></a><span data-ttu-id="9767c-203">La lettura o la scrittura in un nodo non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-203">Reading or writing to a node fails.</span></span>

<span data-ttu-id="9767c-204">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-204">**Detection**.</span></span> <span data-ttu-id="9767c-205">Individuare l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="9767c-205">Catch the exception.</span></span> <span data-ttu-id="9767c-206">Per i client .NET, in genere è `System.Web.HttpException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-206">For .NET clients, this will typically be `System.Web.HttpException`.</span></span> <span data-ttu-id="9767c-207">Altri client potrebbero avere altri tipi di eccezione.</span><span class="sxs-lookup"><span data-stu-id="9767c-207">Other client may have other exception types.</span></span>  <span data-ttu-id="9767c-208">Per altre informazioni, vedere la pagina relativa alla [gestione degli errori Cassandra eseguita correttamente](https://www.datastax.com/dev/blog/cassandra-error-handling-done-right).</span><span class="sxs-lookup"><span data-stu-id="9767c-208">For more information, see [Cassandra error handling done right](https://www.datastax.com/dev/blog/cassandra-error-handling-done-right).</span></span>

<span data-ttu-id="9767c-209">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-209">**Recovery:**</span></span>

- <span data-ttu-id="9767c-210">Ogni [client Cassandra](https://wiki.apache.org/cassandra/ClientOptions) presenta capacità e criteri specifici di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="9767c-210">Each [Cassandra client](https://wiki.apache.org/cassandra/ClientOptions) has its own retry policies and capabilities.</span></span> <span data-ttu-id="9767c-211">Per altre informazioni, vedere la pagina relativa alla [gestione degli errori Cassandra eseguita correttamente][cassandra-error-handling].</span><span class="sxs-lookup"><span data-stu-id="9767c-211">For more information, see [Cassandra error handling done right][cassandra-error-handling].</span></span>
- <span data-ttu-id="9767c-212">Usare una distribuzione con riconoscimento del rack e i nodi di dati distribuiti nei domini di errore.</span><span class="sxs-lookup"><span data-stu-id="9767c-212">Use a rack-aware deployment, with data nodes distributed across the fault domains.</span></span>
- <span data-ttu-id="9767c-213">Distribuire in più aree con coerenza del quorum locale.</span><span class="sxs-lookup"><span data-stu-id="9767c-213">Deploy to multiple regions with local quorum consistency.</span></span> <span data-ttu-id="9767c-214">Se si verifica un errore non temporaneo, eseguire il failover in un'altra area.</span><span class="sxs-lookup"><span data-stu-id="9767c-214">If a non-transient failure occurs, fail over to another region.</span></span>

<span data-ttu-id="9767c-215">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-215">**Diagnostics**.</span></span> <span data-ttu-id="9767c-216">Log applicazioni</span><span class="sxs-lookup"><span data-stu-id="9767c-216">Application logs</span></span>

## <a name="cloud-service"></a><span data-ttu-id="9767c-217">Servizio cloud</span><span class="sxs-lookup"><span data-stu-id="9767c-217">Cloud Service</span></span>

### <a name="web-or-worker-roles-are-unexpectedlybeing-shut-down"></a><span data-ttu-id="9767c-218">I ruoli di lavoro o Web vengono arrestati in modo imprevisto.</span><span class="sxs-lookup"><span data-stu-id="9767c-218">Web or worker roles are unexpectedly being shut down.</span></span>

<span data-ttu-id="9767c-219">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-219">**Detection**.</span></span> <span data-ttu-id="9767c-220">Viene generato l'evento [RoleEnvironment.Stopping][RoleEnvironment.Stopping].</span><span class="sxs-lookup"><span data-stu-id="9767c-220">The [RoleEnvironment.Stopping][RoleEnvironment.Stopping] event is fired.</span></span>

<span data-ttu-id="9767c-221">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="9767c-221">**Recovery**.</span></span> <span data-ttu-id="9767c-222">Eseguire l'override del metodo [RoleEntryPoint.OnStop][RoleEntryPoint.OnStop] per eseguire normalmente la pulizia.</span><span class="sxs-lookup"><span data-stu-id="9767c-222">Override the [RoleEntryPoint.OnStop][RoleEntryPoint.OnStop] method to gracefully clean up.</span></span> <span data-ttu-id="9767c-223">Per altre informazioni, vedere [Come gestire correttamente gli eventi OnStop d Azure][onstop-events] (blog).</span><span class="sxs-lookup"><span data-stu-id="9767c-223">For more information, see [The Right Way to Handle Azure OnStop Events][onstop-events] (blog).</span></span>

## <a name="cosmos-db"></a><span data-ttu-id="9767c-224">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="9767c-224">Cosmos DB</span></span>

### <a name="reading-data-fails"></a><span data-ttu-id="9767c-225">La lettura dei dati non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-225">Reading data fails.</span></span>

<span data-ttu-id="9767c-226">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-226">**Detection**.</span></span> <span data-ttu-id="9767c-227">Individuare `System.Net.Http.HttpRequestException` o `Microsoft.Azure.Documents.DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-227">Catch `System.Net.Http.HttpRequestException` or `Microsoft.Azure.Documents.DocumentClientException`.</span></span>

<span data-ttu-id="9767c-228">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-228">**Recovery:**</span></span>

- <span data-ttu-id="9767c-229">L'SDK esegue automaticamente nuovi tentativi.</span><span class="sxs-lookup"><span data-stu-id="9767c-229">The SDK automatically retries failed attempts.</span></span> <span data-ttu-id="9767c-230">Per impostare il numero di tentativi e il tempo di attesa massimo, configurare `ConnectionPolicy.RetryOptions`.</span><span class="sxs-lookup"><span data-stu-id="9767c-230">To set the number of retries and the maximum wait time, configure `ConnectionPolicy.RetryOptions`.</span></span> <span data-ttu-id="9767c-231">Le eccezioni generate dal client escludono il criterio di ripetizione oppure non sono errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-231">Exceptions that the client raises are either beyond the retry policy or are not transient errors.</span></span>
- <span data-ttu-id="9767c-232">Se Cosmos DB limita il client, viene restituito un errore HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="9767c-232">If Cosmos DB throttles the client, it returns an HTTP 429 error.</span></span> <span data-ttu-id="9767c-233">Verificare il codice di stato in `DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-233">Check the status code in the `DocumentClientException`.</span></span> <span data-ttu-id="9767c-234">Se l'errore 429 si verifica in modo coerente, è consigliabile aumentare il valore di throughput della raccolta.</span><span class="sxs-lookup"><span data-stu-id="9767c-234">If you are getting error 429 consistently, consider increasing the throughput value of the collection.</span></span>
  - <span data-ttu-id="9767c-235">Se si usa l'API di MongoDB, il servizio restituisce il codice di errore 16500 in caso di limitazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-235">If you are using the MongoDB API, the service returns error code 16500 when throttling.</span></span>
- <span data-ttu-id="9767c-236">Replicare il database Cosmos DB tra due o più aree.</span><span class="sxs-lookup"><span data-stu-id="9767c-236">Replicate the Cosmos DB database across two or more regions.</span></span> <span data-ttu-id="9767c-237">Tutte le repliche sono leggibili.</span><span class="sxs-lookup"><span data-stu-id="9767c-237">All replicas are readable.</span></span> <span data-ttu-id="9767c-238">Specificare il parametro `PreferredLocations` mediante gli SDK client.</span><span class="sxs-lookup"><span data-stu-id="9767c-238">Using the client SDKs, specify the `PreferredLocations` parameter.</span></span> <span data-ttu-id="9767c-239">Si tratta di un elenco ordinato di aree di Azure.</span><span class="sxs-lookup"><span data-stu-id="9767c-239">This is an ordered list of Azure regions.</span></span> <span data-ttu-id="9767c-240">Tutte le letture verranno inviate alla prima area disponibile nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="9767c-240">All reads will be sent to the first available region in the list.</span></span> <span data-ttu-id="9767c-241">Se la richiesta non riesce, il client proverà con altre aree nell'elenco seguendo l'ordine.</span><span class="sxs-lookup"><span data-stu-id="9767c-241">If the request fails, the client will try the other regions in the list, in order.</span></span> <span data-ttu-id="9767c-242">Per altre informazioni, vedere [Procedura di configurazione della distribuzione globale in Azure Cosmos DB mediante l'API SQL][cosmosdb-multi-region].</span><span class="sxs-lookup"><span data-stu-id="9767c-242">For more information, see [How to setup Azure Cosmos DB global distribution using the SQL API][cosmosdb-multi-region].</span></span>

<span data-ttu-id="9767c-243">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-243">**Diagnostics**.</span></span> <span data-ttu-id="9767c-244">Registrare tutti gli errori sul lato client.</span><span class="sxs-lookup"><span data-stu-id="9767c-244">Log all errors on the client side.</span></span>

### <a name="writing-data-fails"></a><span data-ttu-id="9767c-245">La scrittura dei dati non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-245">Writing data fails.</span></span>

<span data-ttu-id="9767c-246">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-246">**Detection**.</span></span> <span data-ttu-id="9767c-247">Individuare `System.Net.Http.HttpRequestException` o `Microsoft.Azure.Documents.DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-247">Catch `System.Net.Http.HttpRequestException` or `Microsoft.Azure.Documents.DocumentClientException`.</span></span>

<span data-ttu-id="9767c-248">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-248">**Recovery:**</span></span>

- <span data-ttu-id="9767c-249">L'SDK esegue automaticamente nuovi tentativi.</span><span class="sxs-lookup"><span data-stu-id="9767c-249">The SDK automatically retries failed attempts.</span></span> <span data-ttu-id="9767c-250">Per impostare il numero di tentativi e il tempo di attesa massimo, configurare `ConnectionPolicy.RetryOptions`.</span><span class="sxs-lookup"><span data-stu-id="9767c-250">To set the number of retries and the maximum wait time, configure `ConnectionPolicy.RetryOptions`.</span></span> <span data-ttu-id="9767c-251">Le eccezioni generate dal client escludono il criterio di ripetizione oppure non sono errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-251">Exceptions that the client raises are either beyond the retry policy or are not transient errors.</span></span>
- <span data-ttu-id="9767c-252">Se Cosmos DB limita il client, viene restituito un errore HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="9767c-252">If Cosmos DB throttles the client, it returns an HTTP 429 error.</span></span> <span data-ttu-id="9767c-253">Verificare il codice di stato in `DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-253">Check the status code in the `DocumentClientException`.</span></span> <span data-ttu-id="9767c-254">Se l'errore 429 si verifica in modo coerente, è consigliabile aumentare il valore di throughput della raccolta.</span><span class="sxs-lookup"><span data-stu-id="9767c-254">If you are getting error 429 consistently, consider increasing the throughput value of the collection.</span></span>
- <span data-ttu-id="9767c-255">Replicare il database Cosmos DB tra due o più aree.</span><span class="sxs-lookup"><span data-stu-id="9767c-255">Replicate the Cosmos DB database across two or more regions.</span></span> <span data-ttu-id="9767c-256">Se l'area primaria non riesce, verrà alzata di livello per la scrittura un'area diversa.</span><span class="sxs-lookup"><span data-stu-id="9767c-256">If the primary region fails, another region will be promoted to write.</span></span> <span data-ttu-id="9767c-257">È inoltre possibile attivare manualmente un failover.</span><span class="sxs-lookup"><span data-stu-id="9767c-257">You can also trigger a failover manually.</span></span> <span data-ttu-id="9767c-258">L'SDK esegue l'individuazione e il routing automatici, pertanto dopo un failover il codice di applicazione continua a funzionare.</span><span class="sxs-lookup"><span data-stu-id="9767c-258">The SDK does automatic discovery and routing, so application code continues to work after a failover.</span></span> <span data-ttu-id="9767c-259">Durante il periodo di failover (in genere minuti), le operazioni di scrittura avranno una latenza maggiore, in quanto l'SDK deve individuare la nuova area di scrittura.</span><span class="sxs-lookup"><span data-stu-id="9767c-259">During the failover period (typically minutes), write operations will have higher latency, as the SDK finds the new write region.</span></span> <span data-ttu-id="9767c-260">Per altre informazioni, vedere [Procedura di configurazione della distribuzione globale in Azure Cosmos DB mediante l'API SQL][cosmosdb-multi-region].</span><span class="sxs-lookup"><span data-stu-id="9767c-260">For more information, see [How to setup Azure Cosmos DB global distribution using the SQL API][cosmosdb-multi-region].</span></span>
- <span data-ttu-id="9767c-261">Come fallback, rendere persistente il documento in una coda di backup ed elaborare la coda in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="9767c-261">As a fallback, persist the document to a backup queue, and process the queue later.</span></span>

<span data-ttu-id="9767c-262">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-262">**Diagnostics**.</span></span> <span data-ttu-id="9767c-263">Registrare tutti gli errori sul lato client.</span><span class="sxs-lookup"><span data-stu-id="9767c-263">Log all errors on the client side.</span></span>

## <a name="elasticsearch"></a><span data-ttu-id="9767c-264">Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="9767c-264">Elasticsearch</span></span>

### <a name="reading-data-from-elasticsearch-fails"></a><span data-ttu-id="9767c-265">La lettura dei dati da Elasticsearch non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-265">Reading data from Elasticsearch fails.</span></span>

<span data-ttu-id="9767c-266">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-266">**Detection**.</span></span> <span data-ttu-id="9767c-267">Individuare l'eccezione appropriata per il [client Elasticsearch] [ elasticsearch-client] specifico in uso.</span><span class="sxs-lookup"><span data-stu-id="9767c-267">Catch the appropriate exception for the particular [Elasticsearch client][elasticsearch-client] being used.</span></span>

<span data-ttu-id="9767c-268">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-268">**Recovery:**</span></span>

- <span data-ttu-id="9767c-269">Usare un meccanismo di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="9767c-269">Use a retry mechanism.</span></span> <span data-ttu-id="9767c-270">Ogni client presenta criteri specifici di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="9767c-270">Each client has its own retry policies.</span></span>
- <span data-ttu-id="9767c-271">Distribuire più nodi Elasticsearch e usare la replica per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="9767c-271">Deploy multiple Elasticsearch nodes and use replication for high availability.</span></span>

<span data-ttu-id="9767c-272">Per altre informazioni, vedere [Esecuzione di Elasticsearch su Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="9767c-272">For more information, see [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

<span data-ttu-id="9767c-273">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-273">**Diagnostics**.</span></span> <span data-ttu-id="9767c-274">È possibile usare gli strumenti di monitoraggio per Elasticsearch o registrare tutti gli errori sul lato client con il payload.</span><span class="sxs-lookup"><span data-stu-id="9767c-274">You can use monitoring tools for Elasticsearch, or log all errors on the client side with the payload.</span></span> <span data-ttu-id="9767c-275">Vedere la sezione "Monitoraggio" in [Esecuzione di Elasticsearch su Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="9767c-275">See the 'Monitoring' section in [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

### <a name="writing-data-to-elasticsearch-fails"></a><span data-ttu-id="9767c-276">La scrittura dei dati in Elasticsearch non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-276">Writing data to Elasticsearch fails.</span></span>

<span data-ttu-id="9767c-277">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-277">**Detection**.</span></span> <span data-ttu-id="9767c-278">Individuare l'eccezione appropriata per il [client Elasticsearch] [ elasticsearch-client] specifico in uso.</span><span class="sxs-lookup"><span data-stu-id="9767c-278">Catch the appropriate exception for the particular [Elasticsearch client][elasticsearch-client] being used.</span></span>

<span data-ttu-id="9767c-279">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-279">**Recovery:**</span></span>

- <span data-ttu-id="9767c-280">Usare un meccanismo di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="9767c-280">Use a retry mechanism.</span></span> <span data-ttu-id="9767c-281">Ogni client presenta criteri specifici di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="9767c-281">Each client has its own retry policies.</span></span>
- <span data-ttu-id="9767c-282">Se l'applicazione è in grado di tollerare un livello di coerenza ridotto, è consigliabile scrivere con l'impostazione `write_consistency` per `quorum`.</span><span class="sxs-lookup"><span data-stu-id="9767c-282">If the application can tolerate a reduced consistency level, consider writing with `write_consistency` setting of `quorum`.</span></span>

<span data-ttu-id="9767c-283">Per altre informazioni, vedere [Esecuzione di Elasticsearch su Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="9767c-283">For more information, see [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

<span data-ttu-id="9767c-284">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-284">**Diagnostics**.</span></span> <span data-ttu-id="9767c-285">È possibile usare gli strumenti di monitoraggio per Elasticsearch o registrare tutti gli errori sul lato client con il payload.</span><span class="sxs-lookup"><span data-stu-id="9767c-285">You can use monitoring tools for Elasticsearch, or log all errors on the client side with the payload.</span></span> <span data-ttu-id="9767c-286">Vedere la sezione "Monitoraggio" in [Esecuzione di Elasticsearch su Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="9767c-286">See the 'Monitoring' section in [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

## <a name="queue-storage"></a><span data-ttu-id="9767c-287">Archiviazione code</span><span class="sxs-lookup"><span data-stu-id="9767c-287">Queue storage</span></span>

### <a name="writing-a-message-to-azure-queue-storage-fails-consistently"></a><span data-ttu-id="9767c-288">La scrittura di un messaggio in Archiviazione code di Azure non riesce sistematicamente.</span><span class="sxs-lookup"><span data-stu-id="9767c-288">Writing a message to Azure Queue storage fails consistently.</span></span>

<span data-ttu-id="9767c-289">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-289">**Detection**.</span></span> <span data-ttu-id="9767c-290">Dopo *N* tentativi l'operazione di scrittura continua a non riuscire.</span><span class="sxs-lookup"><span data-stu-id="9767c-290">After *N* retry attempts, the write operation still fails.</span></span>

<span data-ttu-id="9767c-291">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-291">**Recovery:**</span></span>

- <span data-ttu-id="9767c-292">Archiviare i dati in una cache locale e inoltrare le operazioni di scrittura per l'archiviazione in un secondo momento, quando il servizio diventa disponibile.</span><span class="sxs-lookup"><span data-stu-id="9767c-292">Store the data in a local cache, and forward the writes to storage later, when the service becomes available.</span></span>
- <span data-ttu-id="9767c-293">Creare una coda secondaria e scrivere in tale coda se quella primaria non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="9767c-293">Create a secondary queue, and write to that queue if the primary queue is unavailable.</span></span>

<span data-ttu-id="9767c-294">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-294">**Diagnostics**.</span></span> <span data-ttu-id="9767c-295">Usare le [metriche di archiviazione][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="9767c-295">Use [storage metrics][storage-metrics].</span></span>

### <a name="the-application-cannot-process-a-particular-message-from-the-queue"></a><span data-ttu-id="9767c-296">L'applicazione non è in grado di elaborare un determinato messaggio dalla coda.</span><span class="sxs-lookup"><span data-stu-id="9767c-296">The application cannot process a particular message from the queue.</span></span>

<span data-ttu-id="9767c-297">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-297">**Detection**.</span></span> <span data-ttu-id="9767c-298">(specifico dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="9767c-298">Application specific.</span></span> <span data-ttu-id="9767c-299">Ad esempio il messaggio contiene dati non validi o la logica di business non riesce per qualche motivo.</span><span class="sxs-lookup"><span data-stu-id="9767c-299">For example, the message contains invalid data, or the business logic fails for some reason.</span></span>

<span data-ttu-id="9767c-300">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-300">**Recovery:**</span></span>

<span data-ttu-id="9767c-301">Spostare il messaggio in una coda separata.</span><span class="sxs-lookup"><span data-stu-id="9767c-301">Move the message to a separate queue.</span></span> <span data-ttu-id="9767c-302">Eseguire un processo separato per esaminare i messaggi in quella coda.</span><span class="sxs-lookup"><span data-stu-id="9767c-302">Run a separate process to examine the messages in that queue.</span></span>

<span data-ttu-id="9767c-303">Usare le code di messaggistica del Bus di servizio di Microsoft Azure, che fornisce una funzionalità [coda di messaggi non recapitabili] [ sb-dead-letter-queue] a questo scopo.</span><span class="sxs-lookup"><span data-stu-id="9767c-303">Consider using Azure Service Bus Messaging queues, which provides a [dead-letter queue][sb-dead-letter-queue] functionality for this purpose.</span></span>

> [!NOTE]
> <span data-ttu-id="9767c-304">Se si usano le code di archiviazione con Processi Web, WebJobs SDK fornisce la funzionalità incorporata di gestione di messaggi non elaborabili.</span><span class="sxs-lookup"><span data-stu-id="9767c-304">If you are using Storage queues with WebJobs, the WebJobs SDK provides built-in poison message handling.</span></span> <span data-ttu-id="9767c-305">Vedere [Come usare il servizio di archiviazione di accodamento di Azure con WebJobs SDK][sb-poison-message].</span><span class="sxs-lookup"><span data-stu-id="9767c-305">See [How to use Azure queue storage with the WebJobs SDK][sb-poison-message].</span></span>

<span data-ttu-id="9767c-306">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-306">**Diagnostics**.</span></span> <span data-ttu-id="9767c-307">Usare la registrazione delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="9767c-307">Use application logging.</span></span>

## <a name="redis-cache"></a><span data-ttu-id="9767c-308">Cache Redis</span><span class="sxs-lookup"><span data-stu-id="9767c-308">Redis Cache</span></span>

### <a name="reading-from-the-cache-fails"></a><span data-ttu-id="9767c-309">La lettura dalla cache non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-309">Reading from the cache fails.</span></span>

<span data-ttu-id="9767c-310">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-310">**Detection**.</span></span> <span data-ttu-id="9767c-311">Individuare `StackExchange.Redis.RedisConnectionException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-311">Catch `StackExchange.Redis.RedisConnectionException`.</span></span>

<span data-ttu-id="9767c-312">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-312">**Recovery:**</span></span>

1. <span data-ttu-id="9767c-313">Riprovare in caso di errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-313">Retry on transient failures.</span></span> <span data-ttu-id="9767c-314">Cache Redis di Azure supporta la ripetizione integrata dei tentativi. Vedere [Linee guida per la ripetizione di tentativi di Cache Redis di Azure][redis-retry].</span><span class="sxs-lookup"><span data-stu-id="9767c-314">Azure Redis cache supports built-in retry through See [Redis Cache retry guidelines][redis-retry].</span></span>
2. <span data-ttu-id="9767c-315">Considerare gli errori non temporanei come un mancato riscontro nella cache e usare l'origine dati originale.</span><span class="sxs-lookup"><span data-stu-id="9767c-315">Treat non-transient failures as a cache miss, and fall back to the original data source.</span></span>

<span data-ttu-id="9767c-316">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-316">**Diagnostics**.</span></span> <span data-ttu-id="9767c-317">Usare [Come monitorare Cache Redis di Azure][redis-monitor].</span><span class="sxs-lookup"><span data-stu-id="9767c-317">Use [Redis Cache diagnostics][redis-monitor].</span></span>

### <a name="writing-to-the-cache-fails"></a><span data-ttu-id="9767c-318">La scrittura nella cache non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-318">Writing to the cache fails.</span></span>

<span data-ttu-id="9767c-319">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-319">**Detection**.</span></span> <span data-ttu-id="9767c-320">Individuare `StackExchange.Redis.RedisConnectionException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-320">Catch `StackExchange.Redis.RedisConnectionException`.</span></span>

<span data-ttu-id="9767c-321">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-321">**Recovery:**</span></span>

1. <span data-ttu-id="9767c-322">Riprovare in caso di errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-322">Retry on transient failures.</span></span> <span data-ttu-id="9767c-323">Cache Redis di Azure supporta la ripetizione integrata dei tentativi. Vedere [Linee guida per la ripetizione di tentativi di Cache Redis di Azure][redis-retry].</span><span class="sxs-lookup"><span data-stu-id="9767c-323">Azure Redis cache supports built-in retry through See [Redis Cache retry guidelines][redis-retry].</span></span>
2. <span data-ttu-id="9767c-324">Se l'errore è non temporaneo, ignorarlo e consentire alle altre transazioni di scrivere nella cache in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="9767c-324">If the error is non-transient, ignore it and let other transactions write to the cache later.</span></span>

<span data-ttu-id="9767c-325">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-325">**Diagnostics**.</span></span> <span data-ttu-id="9767c-326">Usare [Come monitorare Cache Redis di Azure][redis-monitor].</span><span class="sxs-lookup"><span data-stu-id="9767c-326">Use [Redis Cache diagnostics][redis-monitor].</span></span>

## <a name="sql-database"></a><span data-ttu-id="9767c-327">Database SQL</span><span class="sxs-lookup"><span data-stu-id="9767c-327">SQL Database</span></span>

### <a name="cannot-connect-to-the-database-in-the-primary-region"></a><span data-ttu-id="9767c-328">Non è possibile connettersi al database nell'area primaria.</span><span class="sxs-lookup"><span data-stu-id="9767c-328">Cannot connect to the database in the primary region.</span></span>

<span data-ttu-id="9767c-329">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-329">**Detection**.</span></span> <span data-ttu-id="9767c-330">La connessione non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-330">Connection fails.</span></span>

<span data-ttu-id="9767c-331">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-331">**Recovery:**</span></span>

<span data-ttu-id="9767c-332">Prerequisiti: il database deve essere configurato per la replica geografica attiva.</span><span class="sxs-lookup"><span data-stu-id="9767c-332">Prerequisite: The database must be configured for active geo-replication.</span></span> <span data-ttu-id="9767c-333">Vedere [Panoramica: gruppi di failover e replica geografica attiva][sql-db-replication].</span><span class="sxs-lookup"><span data-stu-id="9767c-333">See [SQL Database Active Geo-Replication][sql-db-replication].</span></span>

- <span data-ttu-id="9767c-334">Per le query, leggere da una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="9767c-334">For queries, read from a secondary replica.</span></span>
- <span data-ttu-id="9767c-335">Per inserimenti e aggiornamenti, eseguire manualmente il failover in una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="9767c-335">For inserts and updates, manually fail over to a secondary replica.</span></span> <span data-ttu-id="9767c-336">Vedere [Configurare la replica geografica attiva per il database SQL di Azure nel portale di Azure e avviare il failover][sql-db-failover].</span><span class="sxs-lookup"><span data-stu-id="9767c-336">See [Initiate a planned or unplanned failover for Azure SQL Database][sql-db-failover].</span></span>

<span data-ttu-id="9767c-337">La replica usa una stringa di connessione diversa, pertanto sarà necessario aggiornare la stringa di connessione nella propria applicazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-337">The replica uses a different connection string, so you will need to update the connection string in your application.</span></span>

### <a name="client-runs-out-of-connections-in-the-connection-pool"></a><span data-ttu-id="9767c-338">Il client esaurisce le connessioni nel pool di connessioni.</span><span class="sxs-lookup"><span data-stu-id="9767c-338">Client runs out of connections in the connection pool.</span></span>

<span data-ttu-id="9767c-339">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-339">**Detection**.</span></span> <span data-ttu-id="9767c-340">Individuare gli errori `System.InvalidOperationException`.</span><span class="sxs-lookup"><span data-stu-id="9767c-340">Catch `System.InvalidOperationException` errors.</span></span>

<span data-ttu-id="9767c-341">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-341">**Recovery:**</span></span>

- <span data-ttu-id="9767c-342">Ripetere l'operazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-342">Retry the operation.</span></span>
- <span data-ttu-id="9767c-343">Come piano di mitigazione, isolare il pool di connessioni per ciascun caso d'uso, in modo che un solo caso d'uso non possa dominare tutte le connessioni.</span><span class="sxs-lookup"><span data-stu-id="9767c-343">As a mitigation plan, isolate the connection pools for each use case, so that one use case can't dominate all the connections.</span></span>
- <span data-ttu-id="9767c-344">Aumentare il pool di connessioni massimo.</span><span class="sxs-lookup"><span data-stu-id="9767c-344">Increase the maximum connection pools.</span></span>

<span data-ttu-id="9767c-345">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-345">**Diagnostics**.</span></span> <span data-ttu-id="9767c-346">Log applicazioni.</span><span class="sxs-lookup"><span data-stu-id="9767c-346">Application logs.</span></span>

### <a name="database-connection-limit-is-reached"></a><span data-ttu-id="9767c-347">È stato raggiunto il limite di connessioni di database.</span><span class="sxs-lookup"><span data-stu-id="9767c-347">Database connection limit is reached.</span></span>

<span data-ttu-id="9767c-348">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-348">**Detection**.</span></span> <span data-ttu-id="9767c-349">Il database SQL di Azure limita il numero di accessi, sessioni e ruoli di lavoro simultanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-349">Azure SQL Database limits the number of concurrent workers, logins, and sessions.</span></span> <span data-ttu-id="9767c-350">I limiti dipendono dal livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="9767c-350">The limits depend on the service tier.</span></span> <span data-ttu-id="9767c-351">Per altre informazioni, vedere [Limiti delle risorse del database SQL di Azure][sql-db-limits].</span><span class="sxs-lookup"><span data-stu-id="9767c-351">For more information, see [Azure SQL Database resource limits][sql-db-limits].</span></span>

<span data-ttu-id="9767c-352">Per rilevare questi errori, individuare `System.Data.SqlClient.SqlException` e controllare il valore di `SqlException.Number` per il codice di errore SQL.</span><span class="sxs-lookup"><span data-stu-id="9767c-352">To detect these errors, catch `System.Data.SqlClient.SqlException` and check the value of `SqlException.Number` for the SQL error code.</span></span> <span data-ttu-id="9767c-353">Per un elenco dei codici di errore pertinenti, vedere [Codici di errore SQL per le applicazioni client del database SQL: errori di connessione di database e altri problemi][sql-db-errors].</span><span class="sxs-lookup"><span data-stu-id="9767c-353">For a list of relevant error codes, see [SQL error codes for SQL Database client applications: Database connection error and other issues][sql-db-errors].</span></span>

<span data-ttu-id="9767c-354">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="9767c-354">**Recovery**.</span></span> <span data-ttu-id="9767c-355">Questi errori sono considerati temporanei, pertanto il problema si può risolvere con altri tentativi.</span><span class="sxs-lookup"><span data-stu-id="9767c-355">These errors are considered transient, so retrying may resolve the issue.</span></span> <span data-ttu-id="9767c-356">Se si riscontrano questi errori in modo sistematico, valutare se non sia opportuno un ridimensionamento del database.</span><span class="sxs-lookup"><span data-stu-id="9767c-356">If you consistently hit these errors, consider scaling the database.</span></span>

<span data-ttu-id="9767c-357">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-357">**Diagnostics**.</span></span> <span data-ttu-id="9767c-358">- La query [sys.event_log][sys.event_log] restituisce connessioni di database riuscite, non riuscite e deadlock.</span><span class="sxs-lookup"><span data-stu-id="9767c-358">- The [sys.event_log][sys.event_log] query returns successful database connections, connection failures, and deadlocks.</span></span>

- <span data-ttu-id="9767c-359">Creare una [regola di avviso][azure-alerts] per le connessioni non riuscite.</span><span class="sxs-lookup"><span data-stu-id="9767c-359">Create an [alert rule][azure-alerts] for failed connections.</span></span>
- <span data-ttu-id="9767c-360">Abilitare il [controllo del database SQL di Microsoft Azure][sql-db-audit] e verificare la presenza di accessi non riusciti.</span><span class="sxs-lookup"><span data-stu-id="9767c-360">Enable [SQL Database auditing][sql-db-audit] and check for failed logins.</span></span>

## <a name="service-bus-messaging"></a><span data-ttu-id="9767c-361">Messaggistica del bus di servizio</span><span class="sxs-lookup"><span data-stu-id="9767c-361">Service Bus Messaging</span></span>

### <a name="reading-a-message-from-a-service-bus-queue-fails"></a><span data-ttu-id="9767c-362">La lettura di un messaggio da una coda del bus di servizio non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-362">Reading a message from a Service Bus queue fails.</span></span>

<span data-ttu-id="9767c-363">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-363">**Detection**.</span></span> <span data-ttu-id="9767c-364">Individuare le eccezioni dal client SDK.</span><span class="sxs-lookup"><span data-stu-id="9767c-364">Catch exceptions from the client SDK.</span></span> <span data-ttu-id="9767c-365">La classe base per le eccezioni del bus di servizio è [MessagingException][sb-messagingexception-class].</span><span class="sxs-lookup"><span data-stu-id="9767c-365">The base class for Service Bus exceptions is [MessagingException][sb-messagingexception-class].</span></span> <span data-ttu-id="9767c-366">Se l'errore è temporaneo, a proprietà `IsTransient` è true.</span><span class="sxs-lookup"><span data-stu-id="9767c-366">If the error is transient, the `IsTransient` property is true.</span></span>

<span data-ttu-id="9767c-367">Per altre informazioni, vedere [Eccezioni di messaggistica del bus di servizio][sb-messaging-exceptions].</span><span class="sxs-lookup"><span data-stu-id="9767c-367">For more information, see [Service Bus messaging exceptions][sb-messaging-exceptions].</span></span>

<span data-ttu-id="9767c-368">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-368">**Recovery:**</span></span>

1. <span data-ttu-id="9767c-369">Riprovare in caso di errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-369">Retry on transient failures.</span></span> <span data-ttu-id="9767c-370">Vedere [Bus di servizio - Linee guida per la ripetizione di tentativi][sb-retry].</span><span class="sxs-lookup"><span data-stu-id="9767c-370">See [Service Bus retry guidelines][sb-retry].</span></span>
2. <span data-ttu-id="9767c-371">I messaggi che non si riesce a recapitare a nessun ricevitore vengono inseriti nella *coda di messaggi non recapitabili*.</span><span class="sxs-lookup"><span data-stu-id="9767c-371">Messages that cannot be delivered to any receiver are placed in a *dead-letter queue*.</span></span> <span data-ttu-id="9767c-372">Usare questa cosa per vedere i messaggi che non sono stati ricevuti.</span><span class="sxs-lookup"><span data-stu-id="9767c-372">Use this queue to see which messages could not be received.</span></span> <span data-ttu-id="9767c-373">Non è prevista alcuna pulizia automatica della coda di messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="9767c-373">There is no automatic cleanup of the dead-letter queue.</span></span> <span data-ttu-id="9767c-374">I messaggi rimangono nella coda fino a quando non vengono recuperati in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="9767c-374">Messages remain there until you explicitly retrieve them.</span></span> <span data-ttu-id="9767c-375">Vedere [Panoramica delle code dei messaggi non recapitabili del bus di servizio][sb-dead-letter-queue].</span><span class="sxs-lookup"><span data-stu-id="9767c-375">See [Overview of Service Bus dead-letter queues][sb-dead-letter-queue].</span></span>

### <a name="writing-a-message-to-a-service-bus-queue-fails"></a><span data-ttu-id="9767c-376">La scrittura di un messaggio in una coda del bus di servizio non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-376">Writing a message to a Service Bus queue fails.</span></span>

<span data-ttu-id="9767c-377">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-377">**Detection**.</span></span> <span data-ttu-id="9767c-378">Individuare le eccezioni dal client SDK.</span><span class="sxs-lookup"><span data-stu-id="9767c-378">Catch exceptions from the client SDK.</span></span> <span data-ttu-id="9767c-379">La classe base per le eccezioni del bus di servizio è [MessagingException][sb-messagingexception-class].</span><span class="sxs-lookup"><span data-stu-id="9767c-379">The base class for Service Bus exceptions is [MessagingException][sb-messagingexception-class].</span></span> <span data-ttu-id="9767c-380">Se l'errore è temporaneo, a proprietà `IsTransient` è true.</span><span class="sxs-lookup"><span data-stu-id="9767c-380">If the error is transient, the `IsTransient` property is true.</span></span>

<span data-ttu-id="9767c-381">Per altre informazioni, vedere [Eccezioni di messaggistica del bus di servizio][sb-messaging-exceptions].</span><span class="sxs-lookup"><span data-stu-id="9767c-381">For more information, see [Service Bus messaging exceptions][sb-messaging-exceptions].</span></span>

<span data-ttu-id="9767c-382">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-382">**Recovery:**</span></span>

1. <span data-ttu-id="9767c-383">Il client del bus di servizio esegue automaticamente nuovi tentativi dopo gli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-383">The Service Bus client automatically retries after transient errors.</span></span> <span data-ttu-id="9767c-384">Per impostazione predefinita, usa il backoff esponenziale.</span><span class="sxs-lookup"><span data-stu-id="9767c-384">By default, it uses exponential back-off.</span></span> <span data-ttu-id="9767c-385">Superato il numero massimo di tentativi o trascorso il periodo di timeout massimo, il client genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="9767c-385">After the maximum retry count or maximum timeout period, the client throws an exception.</span></span> <span data-ttu-id="9767c-386">Per altre informazioni, vedere [Bus di servizio - Linee guida per la ripetizione di tentativi][sb-retry].</span><span class="sxs-lookup"><span data-stu-id="9767c-386">For more information, see [Service Bus retry guidelines][sb-retry].</span></span>
2. <span data-ttu-id="9767c-387">Se viene superata la quota della coda, il client genera [QuotaExceededException][QuotaExceededException].</span><span class="sxs-lookup"><span data-stu-id="9767c-387">If the queue quota is exceeded, the client throws [QuotaExceededException][QuotaExceededException].</span></span> <span data-ttu-id="9767c-388">Per informazioni dettagliate, vedere il messaggio di eccezione.</span><span class="sxs-lookup"><span data-stu-id="9767c-388">The exception message gives more details.</span></span> <span data-ttu-id="9767c-389">Eliminare alcuni messaggi dalla coda prima di fare un nuovo tentativo e provare a usare il modello Interruttore per evitare che vengano fatti tentativi continuativi superando la quota.</span><span class="sxs-lookup"><span data-stu-id="9767c-389">Drain some messages from the queue before retrying, and consider using the Circuit Breaker pattern to avoid continued retries while the quota is exceeded.</span></span> <span data-ttu-id="9767c-390">Assicurasi inoltre che la proprietà [BrokeredMessage.TimeToLive] non sia impostata su un valore troppo elevato.</span><span class="sxs-lookup"><span data-stu-id="9767c-390">Also, make sure the [BrokeredMessage.TimeToLive] property is not set too high.</span></span>
3. <span data-ttu-id="9767c-391">All'interno di un'area è possibile migliorare la resilienza tramite [code o argomenti partizionati][sb-partition].</span><span class="sxs-lookup"><span data-stu-id="9767c-391">Within a region, resiliency can be improved by using [partitioned queues or topics][sb-partition].</span></span> <span data-ttu-id="9767c-392">Una coda o un argomento non partizionato viene assegnato a un archivio di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="9767c-392">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="9767c-393">Se l'archivio di messaggistica in questione non è disponibile, tutte le operazioni eseguite sulla coda o sull'argomento avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="9767c-393">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="9767c-394">Una coda o un argomento partizionati sono suddivisi in più archivi di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="9767c-394">A partitioned queue or topic is partitioned across multiple messaging stores.</span></span>
4. <span data-ttu-id="9767c-395">Per aumentare la resilienza, creare due spazi dei nomi del bus di servizio in aree diverse e replicare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="9767c-395">For additional resiliency, create two Service Bus namespaces in different regions, and replicate the messages.</span></span> <span data-ttu-id="9767c-396">È possibile usare sia la replica attiva sia quella passiva.</span><span class="sxs-lookup"><span data-stu-id="9767c-396">You can use either active replication or passive replication.</span></span>

    - <span data-ttu-id="9767c-397">Replica attiva: il client invia tutti i messaggi a entrambe le code.</span><span class="sxs-lookup"><span data-stu-id="9767c-397">Active replication: The client sends every message to both queues.</span></span> <span data-ttu-id="9767c-398">Il ricevitore è in ascolto su entrambe le code.</span><span class="sxs-lookup"><span data-stu-id="9767c-398">The receiver listens on both queues.</span></span> <span data-ttu-id="9767c-399">Contrassegnare i messaggi con un identificatore univoco, in modo che il client possa eliminare i messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="9767c-399">Tag messages with a unique identifier, so the client can discard duplicate messages.</span></span>
    - <span data-ttu-id="9767c-400">Replica passiva: il client invia il messaggio a una sola coda.</span><span class="sxs-lookup"><span data-stu-id="9767c-400">Passive replication: The client sends the message to one queue.</span></span> <span data-ttu-id="9767c-401">Se si verifica un errore, il client esegue il fallback alla coda di altri.</span><span class="sxs-lookup"><span data-stu-id="9767c-401">If there is an error, the client falls back to the other queue.</span></span> <span data-ttu-id="9767c-402">Il ricevitore è in ascolto su entrambe le code.</span><span class="sxs-lookup"><span data-stu-id="9767c-402">The receiver listens on both queues.</span></span> <span data-ttu-id="9767c-403">Questo approccio riduce il numero di messaggi duplicati inviati.</span><span class="sxs-lookup"><span data-stu-id="9767c-403">This approach reduces the number of duplicate messages that are sent.</span></span> <span data-ttu-id="9767c-404">Tuttavia, il ricevitore deve comunque gestire i messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="9767c-404">However, the receiver must still handle duplicate messages.</span></span>

    <span data-ttu-id="9767c-405">Per altre informazioni, vedere l'[esempio di replica geografica][sb-georeplication-sample] e [Procedure consigliate per isolare le applicazioni del bus di servizio da interruzioni ed emergenze del servizio](/azure/service-bus-messaging/service-bus-outages-disasters/).</span><span class="sxs-lookup"><span data-stu-id="9767c-405">For more information, see [GeoReplication sample][sb-georeplication-sample] and [Best practices for insulating applications against Service Bus outages and disasters](/azure/service-bus-messaging/service-bus-outages-disasters/).</span></span>

### <a name="duplicate-message"></a><span data-ttu-id="9767c-406">Messaggio duplicato.</span><span class="sxs-lookup"><span data-stu-id="9767c-406">Duplicate message.</span></span>

<span data-ttu-id="9767c-407">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-407">**Detection**.</span></span> <span data-ttu-id="9767c-408">Esaminare le proprietà `MessageId` e `DeliveryCount` del messaggio.</span><span class="sxs-lookup"><span data-stu-id="9767c-408">Examine the `MessageId` and `DeliveryCount` properties of the message.</span></span>

<span data-ttu-id="9767c-409">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-409">**Recovery:**</span></span>

- <span data-ttu-id="9767c-410">Se possibile, concepire le operazioni di elaborazione dei messaggi in modo che siano idempotenti.</span><span class="sxs-lookup"><span data-stu-id="9767c-410">If possible, design your message processing operations to be idempotent.</span></span> <span data-ttu-id="9767c-411">In caso contrario, archiviare gli ID dei messaggio che sono già stati elaborati e verificare l'ID prima di elaborare un messaggio.</span><span class="sxs-lookup"><span data-stu-id="9767c-411">Otherwise, store message IDs of messages that are already processed, and check the ID before processing a message.</span></span>
- <span data-ttu-id="9767c-412">Abilitare il rilevamento dei duplicati creando la coda con `RequiresDuplicateDetection` impostato su true.</span><span class="sxs-lookup"><span data-stu-id="9767c-412">Enable duplicate detection, by creating the queue with `RequiresDuplicateDetection` set to true.</span></span> <span data-ttu-id="9767c-413">Con questa impostazione, il bus di servizio elimina automaticamente qualsiasi messaggio inviato con lo stesso `MessageId` di un messaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="9767c-413">With this setting, Service Bus automatically deletes any message that is sent with the same `MessageId` as a previous message.</span></span>  <span data-ttu-id="9767c-414">Tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="9767c-414">Note the following:</span></span>

  - <span data-ttu-id="9767c-415">Questa impostazione impedisce di inserire nella coda messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="9767c-415">This setting prevents duplicate messages from being put into the queue.</span></span> <span data-ttu-id="9767c-416">Non impedisce tuttavia a un ricevitore di elaborare più volte lo stesso messaggio.</span><span class="sxs-lookup"><span data-stu-id="9767c-416">It doesn't prevent a receiver from processing the same message more than once.</span></span>
  - <span data-ttu-id="9767c-417">Il rilevamento di duplicati prevede una finestra temporale.</span><span class="sxs-lookup"><span data-stu-id="9767c-417">Duplicate detection has a time window.</span></span> <span data-ttu-id="9767c-418">Se un duplicato viene inviato al di là di questa finestra, non verrà rilevato.</span><span class="sxs-lookup"><span data-stu-id="9767c-418">If a duplicate is sent beyond this window, it won't be detected.</span></span>

<span data-ttu-id="9767c-419">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-419">**Diagnostics**.</span></span> <span data-ttu-id="9767c-420">Registrare messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="9767c-420">Log duplicated messages.</span></span>

### <a name="the-application-cant-process-a-particular-message-from-the-queue"></a><span data-ttu-id="9767c-421">L'applicazione non può elaborare un determinato messaggio dalla coda.</span><span class="sxs-lookup"><span data-stu-id="9767c-421">The application can't process a particular message from the queue.</span></span>

<span data-ttu-id="9767c-422">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-422">**Detection**.</span></span> <span data-ttu-id="9767c-423">(specifico dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="9767c-423">Application specific.</span></span> <span data-ttu-id="9767c-424">Ad esempio il messaggio contiene dati non validi o la logica di business non riesce per qualche motivo.</span><span class="sxs-lookup"><span data-stu-id="9767c-424">For example, the message contains invalid data, or the business logic fails for some reason.</span></span>

<span data-ttu-id="9767c-425">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-425">**Recovery:**</span></span>

<span data-ttu-id="9767c-426">Esistono due modalità di errore da considerare.</span><span class="sxs-lookup"><span data-stu-id="9767c-426">There are two failure modes to consider.</span></span>

- <span data-ttu-id="9767c-427">Il ricevitore rileva l'errore.</span><span class="sxs-lookup"><span data-stu-id="9767c-427">The receiver detects the failure.</span></span> <span data-ttu-id="9767c-428">In questo caso spostare il messaggio nella coda di messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="9767c-428">In this case, move the message to the dead-letter queue.</span></span> <span data-ttu-id="9767c-429">Successivamente eseguire un processo separato per esaminare i messaggi in quella coda.</span><span class="sxs-lookup"><span data-stu-id="9767c-429">Later, run a separate process to examine the messages in the dead-letter queue.</span></span>
- <span data-ttu-id="9767c-430">Si verifica un errore del ricevitore durante l'elaborazione del messaggio &mdash;, ad esempio, a causa di un'eccezione non gestita.</span><span class="sxs-lookup"><span data-stu-id="9767c-430">The receiver fails in the middle of processing the message &mdash; for example, due to an unhandled exception.</span></span> <span data-ttu-id="9767c-431">Per gestire questo caso, usare la modalità `PeekLock`.</span><span class="sxs-lookup"><span data-stu-id="9767c-431">To handle this case, use `PeekLock` mode.</span></span> <span data-ttu-id="9767c-432">In questa modalità, se il blocco scade, il messaggio diventa disponibile per altri ricevitori.</span><span class="sxs-lookup"><span data-stu-id="9767c-432">In this mode, if the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="9767c-433">Se il messaggio supera il numero massimo di recapiti o la durata, il messaggio viene spostato automaticamente nella coda di messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="9767c-433">If the message exceeds the maximum delivery count or the time-to-live, the message is automatically moved to the dead-letter queue.</span></span>

<span data-ttu-id="9767c-434">Per altre informazioni, vedere [Panoramica delle code dei messaggi non recapitabili del bus di servizio][sb-dead-letter-queue].</span><span class="sxs-lookup"><span data-stu-id="9767c-434">For more information, see [Overview of Service Bus dead-letter queues][sb-dead-letter-queue].</span></span>

<span data-ttu-id="9767c-435">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-435">**Diagnostics**.</span></span> <span data-ttu-id="9767c-436">Ogni volta che l'applicazione sposta un messaggio alla coda di messaggi non recapitabili, scrivere un evento nel log applicazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-436">Whenever the application moves a message to the dead-letter queue, write an event to the application logs.</span></span>

## <a name="service-fabric"></a><span data-ttu-id="9767c-437">Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9767c-437">Service Fabric</span></span>

### <a name="a-request-to-a-service-fails"></a><span data-ttu-id="9767c-438">Una richiesta a un servizio non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-438">A request to a service fails.</span></span>

<span data-ttu-id="9767c-439">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-439">**Detection**.</span></span> <span data-ttu-id="9767c-440">Il servizio restituisce un errore.</span><span class="sxs-lookup"><span data-stu-id="9767c-440">The service returns an error.</span></span>

<span data-ttu-id="9767c-441">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-441">**Recovery:**</span></span>

- <span data-ttu-id="9767c-442">Individuare di nuovo un proxy (`ServiceProxy` o `ActorProxy`) e chiamare nuovamente il metodo di servizio/attore.</span><span class="sxs-lookup"><span data-stu-id="9767c-442">Locate a proxy again (`ServiceProxy` or `ActorProxy`) and call the service/actor method again.</span></span>
- <span data-ttu-id="9767c-443">**Servizio con stato**.</span><span class="sxs-lookup"><span data-stu-id="9767c-443">**Stateful service**.</span></span> <span data-ttu-id="9767c-444">Eseguire il wrapping delle operazioni sulle raccolte affidabili in una transazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-444">Wrap operations on reliable collections in a transaction.</span></span> <span data-ttu-id="9767c-445">Se si verifica un errore, verrà eseguito il rollback della transazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-445">If there is an error, the transaction will be rolled back.</span></span> <span data-ttu-id="9767c-446">Se viene eseguito il pull da un coda di una richiesta, questa verrà elaborata nuovamente.</span><span class="sxs-lookup"><span data-stu-id="9767c-446">The request, if pulled from a queue, will be processed again.</span></span>
- <span data-ttu-id="9767c-447">**Servizio senza stato**.</span><span class="sxs-lookup"><span data-stu-id="9767c-447">**Stateless service**.</span></span> <span data-ttu-id="9767c-448">Se il servizio mantiene i dati in un archivio esterno, è necessario che tutte le operazioni siano idempotenti.</span><span class="sxs-lookup"><span data-stu-id="9767c-448">If the service persists data to an external store, all operations need to be idempotent.</span></span>

<span data-ttu-id="9767c-449">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-449">**Diagnostics**.</span></span> <span data-ttu-id="9767c-450">Registro applicazioni</span><span class="sxs-lookup"><span data-stu-id="9767c-450">Application log</span></span>

### <a name="service-fabric-node-is-shut-down"></a><span data-ttu-id="9767c-451">Il nodo di Service Fabric è stato arrestato.</span><span class="sxs-lookup"><span data-stu-id="9767c-451">Service Fabric node is shut down.</span></span>

<span data-ttu-id="9767c-452">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-452">**Detection**.</span></span> <span data-ttu-id="9767c-453">Un token di annullamento viene passato al metodo `RunAsync` del servizio.</span><span class="sxs-lookup"><span data-stu-id="9767c-453">A cancellation token is passed to the service's `RunAsync` method.</span></span> <span data-ttu-id="9767c-454">Service Fabric annulla l'attività prima dell'arresto del nodo.</span><span class="sxs-lookup"><span data-stu-id="9767c-454">Service Fabric cancels the task before shutting down the node.</span></span>

<span data-ttu-id="9767c-455">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="9767c-455">**Recovery**.</span></span> <span data-ttu-id="9767c-456">Usare il token di annullamento per rilevare l'arresto.</span><span class="sxs-lookup"><span data-stu-id="9767c-456">Use the cancellation token to detect shutdown.</span></span> <span data-ttu-id="9767c-457">Quando Service Fabric richiede l'annullamento, completare tutte le operazioni e chiudere  `RunAsync` più rapidamente possibile.</span><span class="sxs-lookup"><span data-stu-id="9767c-457">When Service Fabric requests cancellation, finish any work and exit `RunAsync` as quickly as possible.</span></span>

<span data-ttu-id="9767c-458">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-458">**Diagnostics**.</span></span> <span data-ttu-id="9767c-459">Log applicazioni</span><span class="sxs-lookup"><span data-stu-id="9767c-459">Application logs</span></span>

## <a name="storage"></a><span data-ttu-id="9767c-460">Archiviazione</span><span class="sxs-lookup"><span data-stu-id="9767c-460">Storage</span></span>

### <a name="writing-data-to-azure-storage-fails"></a><span data-ttu-id="9767c-461">La scrittura dei dati in Archiviazione di Azure non riesce</span><span class="sxs-lookup"><span data-stu-id="9767c-461">Writing data to Azure Storage fails</span></span>

<span data-ttu-id="9767c-462">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-462">**Detection**.</span></span> <span data-ttu-id="9767c-463">Il client riceve errori durante la scrittura.</span><span class="sxs-lookup"><span data-stu-id="9767c-463">The client receives errors when writing.</span></span>

<span data-ttu-id="9767c-464">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-464">**Recovery:**</span></span>

1. <span data-ttu-id="9767c-465">Ritentare l'operazione per il ripristino da errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-465">Retry the operation, to recover from transient failures.</span></span> <span data-ttu-id="9767c-466">Il [criterio di ripetizione dei tentativi][Storage.RetryPolicies] nel client SDK viene gestito automaticamente.</span><span class="sxs-lookup"><span data-stu-id="9767c-466">The [retry policy][Storage.RetryPolicies] in the client SDK handles this automatically.</span></span>
2. <span data-ttu-id="9767c-467">Implementare il modello Interruttore per evitare di oltrepassare le limitazioni di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-467">Implement the Circuit Breaker pattern to avoid overwhelming storage.</span></span>
3. <span data-ttu-id="9767c-468">Se N tentativi non sono riusciti, eseguire un normale fallback.</span><span class="sxs-lookup"><span data-stu-id="9767c-468">If N retry attempts fail, perform a graceful fallback.</span></span> <span data-ttu-id="9767c-469">Ad esempio: </span><span class="sxs-lookup"><span data-stu-id="9767c-469">For example:</span></span>

   - <span data-ttu-id="9767c-470">Archiviare i dati in una cache locale e inoltrare le operazioni di scrittura per l'archiviazione in un secondo momento, quando il servizio diventa disponibile.</span><span class="sxs-lookup"><span data-stu-id="9767c-470">Store the data in a local cache, and forward the writes to storage later, when the service becomes available.</span></span>
   - <span data-ttu-id="9767c-471">Se l'azione di scrittura viene eseguita in un ambito transazionale, è possibile compensare la transazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-471">If the write action was in a transactional scope, compensate the transaction.</span></span>

<span data-ttu-id="9767c-472">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-472">**Diagnostics**.</span></span> <span data-ttu-id="9767c-473">Usare le [metriche di archiviazione][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="9767c-473">Use [storage metrics][storage-metrics].</span></span>

### <a name="reading-data-from-azure-storage-fails"></a><span data-ttu-id="9767c-474">La lettura dei dati da Archiviazione di Azure non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-474">Reading data from Azure Storage fails.</span></span>

<span data-ttu-id="9767c-475">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-475">**Detection**.</span></span> <span data-ttu-id="9767c-476">Il client riceve errori durante la lettura.</span><span class="sxs-lookup"><span data-stu-id="9767c-476">The client receives errors when reading.</span></span>

<span data-ttu-id="9767c-477">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-477">**Recovery:**</span></span>

1. <span data-ttu-id="9767c-478">Ritentare l'operazione per il ripristino da errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-478">Retry the operation, to recover from transient failures.</span></span> <span data-ttu-id="9767c-479">Il [criterio di ripetizione dei tentativi][Storage.RetryPolicies] nel client SDK viene gestito automaticamente.</span><span class="sxs-lookup"><span data-stu-id="9767c-479">The [retry policy][Storage.RetryPolicies] in the client SDK handles this automatically.</span></span>
2. <span data-ttu-id="9767c-480">Per l'archiviazione RA-GRS, se la lettura dall'endpoint primario non riesce, provare a leggere dall'endpoint secondario.</span><span class="sxs-lookup"><span data-stu-id="9767c-480">For RA-GRS storage, if reading from the primary endpoint fails, try reading from the secondary endpoint.</span></span> <span data-ttu-id="9767c-481">Il client SDK può gestire questa operazione automaticamente.</span><span class="sxs-lookup"><span data-stu-id="9767c-481">The client SDK can handle this automatically.</span></span> <span data-ttu-id="9767c-482">Vedere [Replica di Archiviazione di Azure][storage-replication].</span><span class="sxs-lookup"><span data-stu-id="9767c-482">See [Azure Storage replication][storage-replication].</span></span>
3. <span data-ttu-id="9767c-483">Se *N* tentativi hanno esito negativo, eseguire un'azione di fallback per ridurre le prestazioni in modo graduale.</span><span class="sxs-lookup"><span data-stu-id="9767c-483">If *N* retry attempts fail, take a fallback action to degrade gracefully.</span></span> <span data-ttu-id="9767c-484">Ad esempio, se non è possibile recuperare un'immagine del prodotto non può essere recuperata dall'archivio, mostrare un'immagine segnaposto generica.</span><span class="sxs-lookup"><span data-stu-id="9767c-484">For example, if a product image can't be retrieved from storage, show a generic placeholder image.</span></span>

<span data-ttu-id="9767c-485">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-485">**Diagnostics**.</span></span> <span data-ttu-id="9767c-486">Usare le [metriche di archiviazione][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="9767c-486">Use [storage metrics][storage-metrics].</span></span>

## <a name="virtual-machine"></a><span data-ttu-id="9767c-487">Macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="9767c-487">Virtual machine</span></span>

### <a name="connection-to-a-backend-vm-fails"></a><span data-ttu-id="9767c-488">La connessione a una macchina virtuale di back-end non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-488">Connection to a backend VM fails.</span></span>

<span data-ttu-id="9767c-489">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-489">**Detection**.</span></span> <span data-ttu-id="9767c-490">Errori delle connessioni di rete.</span><span class="sxs-lookup"><span data-stu-id="9767c-490">Network connection errors.</span></span>

<span data-ttu-id="9767c-491">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-491">**Recovery:**</span></span>

- <span data-ttu-id="9767c-492">Distribuire almeno du macchine virtuali di back-end in un set di disponibilità dietro un bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="9767c-492">Deploy at least two backend VMs in an availability set, behind a load balancer.</span></span>
- <span data-ttu-id="9767c-493">Quando l'errore di connessione è temporaneo, talvolta i protocollo TCP riesce a ritentare l'invio del messaggio.</span><span class="sxs-lookup"><span data-stu-id="9767c-493">If the connection error is transient, sometimes TCP will successfully retry sending the message.</span></span>
- <span data-ttu-id="9767c-494">Implementare un criterio di ripetizione dei tentativi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-494">Implement a retry policy in the application.</span></span>
- <span data-ttu-id="9767c-495">Per gli errori persistenti o non temporanei, implementare il modello [Interruttore][circuit-breaker].</span><span class="sxs-lookup"><span data-stu-id="9767c-495">For persistent or non-transient errors, implement the [Circuit Breaker][circuit-breaker] pattern.</span></span>
- <span data-ttu-id="9767c-496">Se la macchina virtuale chiamante supera il limite di rete in uscita, la coda in uscita si riempirà.</span><span class="sxs-lookup"><span data-stu-id="9767c-496">If the calling VM exceeds its network egress limit, the outbound queue will fill up.</span></span> <span data-ttu-id="9767c-497">Se la coda in uscita è completa in modo coerente, prendere in considerazione la scalabilità orizzontale.</span><span class="sxs-lookup"><span data-stu-id="9767c-497">If the outbound queue is consistently full, consider scaling out.</span></span>

<span data-ttu-id="9767c-498">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-498">**Diagnostics**.</span></span> <span data-ttu-id="9767c-499">Registrare gli eventi in base ai limiti del servizio.</span><span class="sxs-lookup"><span data-stu-id="9767c-499">Log events at service boundaries.</span></span>

### <a name="vm-instance-becomes-unavailable-or-unhealthy"></a><span data-ttu-id="9767c-500">Un'istanza VM non è più disponibile o non è più integra.</span><span class="sxs-lookup"><span data-stu-id="9767c-500">VM instance becomes unavailable or unhealthy.</span></span>

<span data-ttu-id="9767c-501">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-501">**Detection**.</span></span> <span data-ttu-id="9767c-502">Configurare il [probe di integrità][lb-probe] di Load Balancer che segnala se l'istanza di macchina virtuale è integra.</span><span class="sxs-lookup"><span data-stu-id="9767c-502">Configure a Load Balancer [health probe][lb-probe] that signals whether the VM instance is healthy.</span></span> <span data-ttu-id="9767c-503">Il probe deve verificare se le funzioni critiche rispondono correttamente.</span><span class="sxs-lookup"><span data-stu-id="9767c-503">The probe should check whether critical functions are responding correctly.</span></span>

<span data-ttu-id="9767c-504">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="9767c-504">**Recovery**.</span></span> <span data-ttu-id="9767c-505">Per ogni livello di applicazione, inserire più istanze di macchina virtuale nello stesso set di disponibilità e posizionare un bilanciamento del carico di fronte alle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="9767c-505">For each application tier, put multiple VM instances into the same availability set, and place a load balancer in front of the VMs.</span></span> <span data-ttu-id="9767c-506">Se il probe di integrità non riesce, Load Balancer interrompe l'invio di nuove connessioni all'istanza non integra.</span><span class="sxs-lookup"><span data-stu-id="9767c-506">If the health probe fails, the Load Balancer stops sending new connections to the unhealthy instance.</span></span>

<span data-ttu-id="9767c-507">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-507">**Diagnostics**.</span></span> <span data-ttu-id="9767c-508">- Usare l'[analisi dei log][lb-monitor] di Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="9767c-508">- Use Load Balancer [log analytics][lb-monitor].</span></span>

- <span data-ttu-id="9767c-509">Configurare il sistema di monitoraggio per monitorare tutti gli endpoint di monitoraggio dello stato.</span><span class="sxs-lookup"><span data-stu-id="9767c-509">Configure your monitoring system to monitor all of the health monitoring endpoints.</span></span>

### <a name="operator-accidentally-shuts-down-a-vm"></a><span data-ttu-id="9767c-510">L'operatore arrestato accidentalmente una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="9767c-510">Operator accidentally shuts down a VM.</span></span>

<span data-ttu-id="9767c-511">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-511">**Detection**.</span></span> <span data-ttu-id="9767c-512">N/D</span><span class="sxs-lookup"><span data-stu-id="9767c-512">N/A</span></span>

<span data-ttu-id="9767c-513">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="9767c-513">**Recovery**.</span></span> <span data-ttu-id="9767c-514">Impostare un blocco di risorsa con livello `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="9767c-514">Set a resource lock with `ReadOnly` level.</span></span> <span data-ttu-id="9767c-515">Vedere [Bloccare le risorse per impedire modifiche impreviste][rm-locks].</span><span class="sxs-lookup"><span data-stu-id="9767c-515">See [Lock resources with Azure Resource Manager][rm-locks].</span></span>

<span data-ttu-id="9767c-516">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-516">**Diagnostics**.</span></span> <span data-ttu-id="9767c-517">Usare i [Log attività di Azure][azure-activity-logs].</span><span class="sxs-lookup"><span data-stu-id="9767c-517">Use [Azure Activity Logs][azure-activity-logs].</span></span>

## <a name="webjobs"></a><span data-ttu-id="9767c-518">WebJobs</span><span class="sxs-lookup"><span data-stu-id="9767c-518">WebJobs</span></span>

### <a name="continuous-job-stops-running-when-the-scm-host-is-idle"></a><span data-ttu-id="9767c-519">L'esecuzione del processo continuo viene interrotta quando l'host SCM è inattivo.</span><span class="sxs-lookup"><span data-stu-id="9767c-519">Continuous job stops running when the SCM host is idle.</span></span>

<span data-ttu-id="9767c-520">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-520">**Detection**.</span></span> <span data-ttu-id="9767c-521">Passare un token di annullamento alla funzione WebJob.</span><span class="sxs-lookup"><span data-stu-id="9767c-521">Pass a cancellation token to the WebJob function.</span></span> <span data-ttu-id="9767c-522">Per altre informazioni, vedere l'articolo sull' [arresto normale dei processi][web-jobs-shutdown].</span><span class="sxs-lookup"><span data-stu-id="9767c-522">For more information, see [Graceful shutdown][web-jobs-shutdown].</span></span>

<span data-ttu-id="9767c-523">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="9767c-523">**Recovery**.</span></span> <span data-ttu-id="9767c-524">Abilitare l'impostazione `Always On` nell'app Web.</span><span class="sxs-lookup"><span data-stu-id="9767c-524">Enable the `Always On` setting in the web app.</span></span> <span data-ttu-id="9767c-525">Per altre informazioni, vedere [Eseguire attività in background con Processi Web in Servizio app di Azure][web-jobs].</span><span class="sxs-lookup"><span data-stu-id="9767c-525">For more information, see [Run Background tasks with WebJobs][web-jobs].</span></span>

## <a name="application-design"></a><span data-ttu-id="9767c-526">Progettazione di applicazioni</span><span class="sxs-lookup"><span data-stu-id="9767c-526">Application design</span></span>

### <a name="application-cant-handle-a-spike-in-incoming-requests"></a><span data-ttu-id="9767c-527">L'applicazione non riesce a gestire un picco nelle richieste in arrivo.</span><span class="sxs-lookup"><span data-stu-id="9767c-527">Application can't handle a spike in incoming requests.</span></span>

<span data-ttu-id="9767c-528">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-528">**Detection**.</span></span> <span data-ttu-id="9767c-529">Dipende dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-529">Depends on the application.</span></span> <span data-ttu-id="9767c-530">Sintomi tipici:</span><span class="sxs-lookup"><span data-stu-id="9767c-530">Typical symptoms:</span></span>

- <span data-ttu-id="9767c-531">Il sito Web inizia a restituire codici di errore HTTP 5xx.</span><span class="sxs-lookup"><span data-stu-id="9767c-531">The website starts returning HTTP 5xx error codes.</span></span>
- <span data-ttu-id="9767c-532">I servizi dipendenti, ad esempio di database o archiviazione, iniziano a limitare le richieste.</span><span class="sxs-lookup"><span data-stu-id="9767c-532">Dependent services, such as database or storage, start to throttle requests.</span></span> <span data-ttu-id="9767c-533">Cercare gli errori HTTP, ad esempio HTTP 429 (troppe richieste), a seconda del servizio.</span><span class="sxs-lookup"><span data-stu-id="9767c-533">Look for HTTP errors such as HTTP 429 (Too Many Requests), depending on the service.</span></span>
- <span data-ttu-id="9767c-534">La lunghezza della coda aumenta.</span><span class="sxs-lookup"><span data-stu-id="9767c-534">HTTP queue length grows.</span></span>

<span data-ttu-id="9767c-535">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-535">**Recovery:**</span></span>

- <span data-ttu-id="9767c-536">Scalare in orizzontale per gestire il carico maggiore.</span><span class="sxs-lookup"><span data-stu-id="9767c-536">Scale out to handle increased load.</span></span>
- <span data-ttu-id="9767c-537">Ridurre gli errori per evitare che errori a cascata interferiscano con l'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-537">Mitigate failures to avoid having cascading failures disrupt the entire application.</span></span> <span data-ttu-id="9767c-538">Le strategie di mitigazione includono:</span><span class="sxs-lookup"><span data-stu-id="9767c-538">Mitigation strategies include:</span></span>

  - <span data-ttu-id="9767c-539">Implementare il [modello di limitazione][throttling-pattern] per evitare il sovraccarico dei sistemi back-end.</span><span class="sxs-lookup"><span data-stu-id="9767c-539">Implement the [Throttling pattern][throttling-pattern] to avoid overwhelming backend systems.</span></span>
  - <span data-ttu-id="9767c-540">Usare lo [schema di livellamento del carico basato sulle code][queue-based-load-leveling] per memorizzare nel buffer le richieste ed elaborarle a un ritmo adeguato.</span><span class="sxs-lookup"><span data-stu-id="9767c-540">Use [queue-based load leveling][queue-based-load-leveling] to buffer requests and process them at an appropriate pace.</span></span>
  - <span data-ttu-id="9767c-541">Assegnare la priorità per alcuni client.</span><span class="sxs-lookup"><span data-stu-id="9767c-541">Prioritize certain clients.</span></span> <span data-ttu-id="9767c-542">Ad esempio, se l'applicazione prevede livelli gratuiti e a pagamento, limitare i clienti del livello gratuito, ma non quelli a pagamento.</span><span class="sxs-lookup"><span data-stu-id="9767c-542">For example, if the application has free and paid tiers, throttle customers on the free tier, but not paid customers.</span></span> <span data-ttu-id="9767c-543">Vedere [Modello di coda con priorità][priority-queue-pattern].</span><span class="sxs-lookup"><span data-stu-id="9767c-543">See [Priority queue pattern][priority-queue-pattern].</span></span>

<span data-ttu-id="9767c-544">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-544">**Diagnostics**.</span></span> <span data-ttu-id="9767c-545">Usare [Abilitare la registrazione diagnostica per le app Web nel servizio app di Azure][app-service-logging].</span><span class="sxs-lookup"><span data-stu-id="9767c-545">Use [App Service diagnostic logging][app-service-logging].</span></span> <span data-ttu-id="9767c-546">Usare un servizio come [Azure Log Analytics][azure-log-analytics], [Application Insights][app-insights] o [New Relic][new-relic] per interpretare i log di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="9767c-546">Use a service such as [Azure Log Analytics][azure-log-analytics], [Application Insights][app-insights], or [New Relic][new-relic] to help understand the diagnostic logs.</span></span>

### <a name="one-of-the-operations-in-a-workflow-or-distributed-transaction-fails"></a><span data-ttu-id="9767c-547">Una delle operazioni in una transazione distribuita o un flusso di lavoro non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-547">One of the operations in a workflow or distributed transaction fails.</span></span>

<span data-ttu-id="9767c-548">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-548">**Detection**.</span></span> <span data-ttu-id="9767c-549">Dopo *N* tentativi, il problema persiste.</span><span class="sxs-lookup"><span data-stu-id="9767c-549">After *N* retry attempts, it still fails.</span></span>

<span data-ttu-id="9767c-550">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-550">**Recovery:**</span></span>

- <span data-ttu-id="9767c-551">Come piano di mitigazione, implementare il modello [Supervisore agente di pianificazione] [ scheduler-agent-supervisor] per gestire l'intero flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="9767c-551">As a mitigation plan, implement the [Scheduler Agent Supervisor][scheduler-agent-supervisor] pattern to manage the entire workflow.</span></span>
- <span data-ttu-id="9767c-552">Non riprovare ai timeout.</span><span class="sxs-lookup"><span data-stu-id="9767c-552">Don't retry on timeouts.</span></span> <span data-ttu-id="9767c-553">La percentuale di successo per questo errore è bassa.</span><span class="sxs-lookup"><span data-stu-id="9767c-553">There is a low success rate for this error.</span></span>
- <span data-ttu-id="9767c-554">Mettere il lavoro in coda per riprovare più tardi.</span><span class="sxs-lookup"><span data-stu-id="9767c-554">Queue work, in order to retry later.</span></span>

<span data-ttu-id="9767c-555">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-555">**Diagnostics**.</span></span> <span data-ttu-id="9767c-556">Accedere a tutte le operazioni (riuscite e non riuscite), incluse le azioni di compensazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-556">Log all operations (successful and failed), including compensating actions.</span></span> <span data-ttu-id="9767c-557">Usare gli ID di correlazione, in modo che sia possibile tenere traccia di tutte le operazioni all'interno della stessa transazione.</span><span class="sxs-lookup"><span data-stu-id="9767c-557">Use correlation IDs, so that you can track all operations within the same transaction.</span></span>

### <a name="a-call-to-a-remote-service-fails"></a><span data-ttu-id="9767c-558">Una chiamata a un servizio remoto non riesce.</span><span class="sxs-lookup"><span data-stu-id="9767c-558">A call to a remote service fails.</span></span>

<span data-ttu-id="9767c-559">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="9767c-559">**Detection**.</span></span> <span data-ttu-id="9767c-560">Codice di errore HTTP.</span><span class="sxs-lookup"><span data-stu-id="9767c-560">HTTP error code.</span></span>

<span data-ttu-id="9767c-561">**Ripristino:**</span><span class="sxs-lookup"><span data-stu-id="9767c-561">**Recovery:**</span></span>

1. <span data-ttu-id="9767c-562">Riprovare in caso di errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="9767c-562">Retry on transient failures.</span></span>
2. <span data-ttu-id="9767c-563">Se la chiamata non riesce dopo *N* tentativi, eseguire un'azione di fallback</span><span class="sxs-lookup"><span data-stu-id="9767c-563">If the call fails after *N* attempts, take a fallback action.</span></span> <span data-ttu-id="9767c-564">(specifica dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="9767c-564">(Application specific.)</span></span>
3. <span data-ttu-id="9767c-565">Implementare il [modello di Interruttore] [ circuit-breaker] per evitare che si verifichino errori a catena.</span><span class="sxs-lookup"><span data-stu-id="9767c-565">Implement the [Circuit Breaker pattern][circuit-breaker] to avoid cascading failures.</span></span>

<span data-ttu-id="9767c-566">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="9767c-566">**Diagnostics**.</span></span> <span data-ttu-id="9767c-567">Accedere a tutti gli errori di chiamata remota.</span><span class="sxs-lookup"><span data-stu-id="9767c-567">Log all remote call failures.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9767c-568">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="9767c-568">Next steps</span></span>

<span data-ttu-id="9767c-569">Per altre informazioni sul processo di FMA, vedere [Resilienza in base alla progettazione per i servizi cloud] [ resilience-by-design-pdf] (download PDF).</span><span class="sxs-lookup"><span data-stu-id="9767c-569">For more information about the FMA process, see [Resilience by design for cloud services][resilience-by-design-pdf] (PDF download).</span></span>

<!-- markdownlint-enable MD026 -->

<!-- links -->

[api-management]: /azure/api-management/
[api-management-throttling]: /azure/api-management/api-management-sample-flexible-throttling/
[app-insights]: /azure/application-insights/app-insights-overview/
[app-insights-web-apps]: /azure/application-insights/app-insights-azure-web-apps/
[app-service-configure]: /azure/app-service-web/web-sites-configure/
[app-service-logging]: /azure/app-service-web/web-sites-enable-diagnostic-log/
[app-service-slots]: /azure/app-service-web/web-sites-staged-publishing/
[auto-rest-client-retry]: https://github.com/Azure/autorest/tree/master/docs
[azure-activity-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-activity-logs/
[azure-alerts]: /azure/monitoring-and-diagnostics/insights-alerts-portal/
[azure-log-analytics]: /azure/log-analytics/log-analytics-overview/
[BrokeredMessage.TimeToLive]: https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.timetolive.aspx
[cassandra-error-handling]: https://www.datastax.com/dev/blog/cassandra-error-handling-done-right
[circuit-breaker]: https://msdn.microsoft.com/library/dn589784.aspx
[cosmosdb-multi-region]: /azure/cosmos-db/tutorial-global-distribution-sql-api
[elasticsearch-azure]: ../elasticsearch/index.md
[elasticsearch-client]: https://www.elastic.co/guide/en/elasticsearch/client/index.html
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[onstop-events]: https://azure.microsoft.com/blog/the-right-way-to-handle-azure-onstop-events/
[lb-monitor]: /azure/load-balancer/load-balancer-monitor-log/
[lb-probe]: /azure/load-balancer/load-balancer-custom-probe-overview/#learn-about-the-types-of-probes
[new-relic]: https://newrelic.com/
[priority-queue-pattern]: https://msdn.microsoft.com/library/dn589794.aspx
[queue-based-load-leveling]: https://msdn.microsoft.com/library/dn589783.aspx
[QuotaExceededException]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.quotaexceededexception.aspx
[ra-web-apps-basic]: ../reference-architectures/app-service-web-app/basic-web-app.md
[redis-monitor]: /azure/redis-cache/cache-how-to-monitor/
[redis-retry]: ../best-practices/retry-service-specific.md#azure-redis-cache
[resilience-by-design-pdf]: https://download.microsoft.com/download/D/8/C/D8C599A4-4E8A-49BF-80EE-FE35F49B914D/Resilience_by_Design_for_Cloud_Services_White_Paper.pdf
[RoleEntryPoint.OnStop]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx
[RoleEnvironment.Stopping]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx
[rm-locks]: /azure/azure-resource-manager/resource-group-lock-resources/
[sb-dead-letter-queue]: /azure/service-bus-messaging/service-bus-dead-letter-queues/
[sb-georeplication-sample]: https://github.com/Azure-Samples/azure-servicebus-messaging-samples/tree/master/GeoReplication
[sb-messagingexception-class]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingexception.aspx
[sb-messaging-exceptions]: /azure/service-bus-messaging/service-bus-messaging-exceptions/
[sb-outages]: /azure/service-bus-messaging/service-bus-outages-disasters/#protecting-queues-and-topics-against-datacenter-outages-or-disasters
[sb-partition]: /azure/service-bus-messaging/service-bus-partitioning/
[sb-poison-message]: /azure/app-service-web/websites-dotnet-webjobs-sdk-storage-queues-how-to/#poison
[sb-retry]: ../best-practices/retry-service-specific.md#service-bus
[search-sdk]: https://msdn.microsoft.com/library/dn951165.aspx
[scheduler-agent-supervisor]: https://msdn.microsoft.com/library/dn589780.aspx
[search-analytics]: /azure/search/search-traffic-analytics/
[sql-db-audit]: /azure/sql-database/sql-database-auditing-get-started/
[sql-db-errors]: /azure/sql-database/sql-database-develop-error-messages/#resource-governance-errors
[sql-db-failover]: /azure/sql-database/sql-database-geo-replication-failover-portal/
[sql-db-limits]: /azure/sql-database/sql-database-resource-limits/
[sql-db-replication]: /azure/sql-database/sql-database-geo-replication-overview/
[storage-metrics]: https://msdn.microsoft.com/library/dn782843.aspx
[storage-replication]: /azure/storage/storage-redundancy/
[Storage.RetryPolicies]: https://msdn.microsoft.com/library/microsoft.windowsazure.storage.retrypolicies.aspx
[sys.event_log]: https://msdn.microsoft.com/library/dn270018.aspx
[throttling-pattern]: https://msdn.microsoft.com/library/dn589798.aspx
[web-jobs]: /azure/app-service-web/web-sites-create-web-jobs/
[web-jobs-shutdown]: /azure/app-service-web/websites-dotnet-webjobs-sdk-storage-queues-how-to/#graceful
