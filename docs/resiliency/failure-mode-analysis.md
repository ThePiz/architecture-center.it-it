---
title: "Analisi della modalità di errore"
description: "Linee guida per l'esecuzione dell'analisi della modalità di errore per soluzioni cloud basate su Azure."
author: MikeWasson
ms.date: 03/24/2017
ms.custom: resiliency
pnp.series.title: Design for Resiliency
ms.openlocfilehash: aca2088cb007728c5717a968969000c0a19bcd07
ms.sourcegitcommit: a7aae13569e165d4e768ce0aaaac154ba612934f
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/30/2018
---
# <a name="failure-mode-analysis"></a><span data-ttu-id="d8ccf-103">Analisi della modalità di errore</span><span class="sxs-lookup"><span data-stu-id="d8ccf-103">Failure mode analysis</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="d8ccf-104">L'analisi della modalità di errore (FMA) è un processo che consente di ottenere la resilienza in un sistema, identificando possibili punti di errore in esso presenti.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-104">Failure mode analysis (FMA) is a process for building resiliency into a system, by identifying possible failure points in the system.</span></span> <span data-ttu-id="d8ccf-105">La FMA deve essere eseguita durante le fasi di progettazione e architettura, in modo che sia possibile integrare il ripristino dagli errori nel sistema dall'inizio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-105">The FMA should be part of the architecture and design phases, so that you can build failure recovery into the system from the beginning.</span></span>

<span data-ttu-id="d8ccf-106">Ecco il processo generale per eseguire una FMA:</span><span class="sxs-lookup"><span data-stu-id="d8ccf-106">Here is the general process to conduct an FMA:</span></span>

1. <span data-ttu-id="d8ccf-107">Identificare tutti i componenti nel sistema.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-107">Identify all of the components in the system.</span></span> <span data-ttu-id="d8ccf-108">Includere le dipendenze esterne, ad esempio i provider di identità, i servizi di terze parti e così via.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-108">Include external dependencies, such as as identity providers, third-party services, and so on.</span></span>   
2. <span data-ttu-id="d8ccf-109">Per ogni componente, identificare potenziali errori che potrebbero verificarsi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-109">For each component, identify potential failures that could occur.</span></span> <span data-ttu-id="d8ccf-110">Un singolo componente può avere più di una modalità di errore.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-110">A single component may have more than one failure mode.</span></span> <span data-ttu-id="d8ccf-111">Ad esempio gli errori di lettura e gli errori di scrittura devono essere valutati separatamente, in quanto l'impatto e le misure di attenuazione sono diversi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-111">For example, you should consider read failures and write failures separately, because the impact and possible mitigations will be different.</span></span>
3. <span data-ttu-id="d8ccf-112">Classificare ogni modalità di errore in base al relativo rischio complessivo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-112">Rate each failure mode according to its overall risk.</span></span> <span data-ttu-id="d8ccf-113">Tenere presente questi fattori:</span><span class="sxs-lookup"><span data-stu-id="d8ccf-113">Consider these factors:</span></span>  

   * <span data-ttu-id="d8ccf-114">Che cos'è la probabilità di errore.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-114">What is the likelihood of the failure.</span></span> <span data-ttu-id="d8ccf-115">È abbastanza comune?</span><span class="sxs-lookup"><span data-stu-id="d8ccf-115">Is it relatively common?</span></span> <span data-ttu-id="d8ccf-116">Estremamente rara?</span><span class="sxs-lookup"><span data-stu-id="d8ccf-116">Extrememly rare?</span></span> <span data-ttu-id="d8ccf-117">Non è necessario ragionare su numeri esatti, in quanto lo scopo è stabilire una classificazione della priorità.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-117">You don't need exact numbers; the purpose is to help rank the priority.</span></span>
   * <span data-ttu-id="d8ccf-118">Qual è l'impatto sull'applicazione in termini di disponibilità, perdita dei dati, costo monetario e interruzione dell'operatività?</span><span class="sxs-lookup"><span data-stu-id="d8ccf-118">What is the impact on the application, in terms of availability, data loss, monetary cost, and business disruption?</span></span>
4. <span data-ttu-id="d8ccf-119">Per ogni modalità di errore, determinare il modo in cui l'applicazione risponde ed esegue il ripristino.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-119">For each failure mode, determine how the application will respond and recover.</span></span> <span data-ttu-id="d8ccf-120">Prendere in considerazione eventuali compromessi relativi ai costi e alla complessità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-120">Consider tradeoffs in cost and application complexity.</span></span>   

<span data-ttu-id="d8ccf-121">Come punto di partenza per il processo di analisi della modalità di errore, questo articolo include un catalogo di potenziali modalità di errore e delle relative attenuazioni.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-121">As a starting point for your FMA process, this article contains a catalog of potential failure modes and their mitigations.</span></span> <span data-ttu-id="d8ccf-122">Il catalogo è organizzato in base alla tecnologia o al servizio di Azure, oltre a una categoria generale per la progettazione a livello di applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-122">The catalog is organized by technology or Azure service, plus a general category for application-level design.</span></span> <span data-ttu-id="d8ccf-123">Il catalogo non è esaustivo, ma tiene conto di molti dei servizi di base di Azure.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-123">The catalog is not exhaustive, but covers many of the core Azure services.</span></span>

## <a name="app-service"></a><span data-ttu-id="d8ccf-124">Servizio app</span><span class="sxs-lookup"><span data-stu-id="d8ccf-124">App Service</span></span>
### <a name="app-service-app-shuts-down"></a><span data-ttu-id="d8ccf-125">L'app Servizio app di Azure si arresta.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-125">App Service app shuts down.</span></span>
<span data-ttu-id="d8ccf-126">**Rilevamento**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-126">**Detection**.</span></span> <span data-ttu-id="d8ccf-127">Possibili cause:</span><span class="sxs-lookup"><span data-stu-id="d8ccf-127">Possible causes:</span></span>

* <span data-ttu-id="d8ccf-128">Arresto previsto</span><span class="sxs-lookup"><span data-stu-id="d8ccf-128">Expected shutdown</span></span>

  * <span data-ttu-id="d8ccf-129">Un operatore arresta l'applicazione, ad esempio tramite il portale di Azure.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-129">An operator shuts down the application; for example, using the Azure portal.</span></span>
  * <span data-ttu-id="d8ccf-130">L'app è stata scaricata perché era inattiva</span><span class="sxs-lookup"><span data-stu-id="d8ccf-130">The app was unloaded because it was idle.</span></span> <span data-ttu-id="d8ccf-131">(solo se l'impostazione `Always On` è disabilitata).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-131">(Only if the `Always On` setting is disabled.)</span></span>
* <span data-ttu-id="d8ccf-132">Arresto imprevisto</span><span class="sxs-lookup"><span data-stu-id="d8ccf-132">Unexpected shutdown</span></span>

  * <span data-ttu-id="d8ccf-133">L'app si arresta in modo anomalo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-133">The app crashes.</span></span>
  * <span data-ttu-id="d8ccf-134">Un'istanza VM del Servizio app di Azure non è più disponibile.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-134">An App Service VM instance becomes unavailable.</span></span>

<span data-ttu-id="d8ccf-135">La registrazione Application_End è l'unico modo per individuare gli arresti di dominio dell'app (arresto anomalo del processo software).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-135">Application_End logging will catch the app domain shutdown (soft process crash) and is the only way to catch the application domain shutdowns.</span></span>

<span data-ttu-id="d8ccf-136">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-136">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-137">Se l'arresto era previsto, usare l'evento di arresto dell'applicazione per spegnere normalmente il sistema.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-137">If the shutdown was expected, use the application's shutdown event to shut down gracefully.</span></span> <span data-ttu-id="d8ccf-138">Ad esempio, in ASP.NET usare il metodo `Application_End`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-138">For example, in ASP.NET, use the `Application_End` method.</span></span>
* <span data-ttu-id="d8ccf-139">Se l'applicazione è stata scaricata durante l'inattività, viene riavviata automaticamente alla richiesta successiva.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-139">If the application was unloaded while idle, it is automatically restarted on the next request.</span></span> <span data-ttu-id="d8ccf-140">Tuttavia, si incorrerà nei costi dell'"avvio a freddo".</span><span class="sxs-lookup"><span data-stu-id="d8ccf-140">However, you will incur the "cold start" cost.</span></span>
* <span data-ttu-id="d8ccf-141">Per evitare che l'applicazione venga scaricata durante l'inattività, abilitare l'impostazione `Always On` nell'app Web.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-141">To prevent the application from being unloaded while idle, enable the `Always On` setting in the web app.</span></span> <span data-ttu-id="d8ccf-142">Vedere [Configurazione delle app Web in Servizio app di Azure][app-service-configure].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-142">See [Configure web apps in Azure App Service][app-service-configure].</span></span>
* <span data-ttu-id="d8ccf-143">Per impedire che un operatore arresti l'app, impostare un blocco di risorsa con livello `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-143">To prevent an operator from shutting down the app, set a resource lock with `ReadOnly` level.</span></span> <span data-ttu-id="d8ccf-144">Vedere [Bloccare le risorse per impedire modifiche impreviste][rm-locks].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-144">See [Lock resources with Azure Resource Manager][rm-locks].</span></span>
* <span data-ttu-id="d8ccf-145">In caso di arresto anomalo dell'app o se un'istanza VM del Servizio app di Azure non è più disponibile, il Servizio app riavvia automaticamente l'app.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-145">If the app crashes or an App Service VM becomes unavailable, App Service automatically restarts the app.</span></span>

<span data-ttu-id="d8ccf-146">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-146">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-147">Log dell'applicazione e del server Web.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-147">Application logs and web server logs.</span></span> <span data-ttu-id="d8ccf-148">Vedere [Abilitare la registrazione diagnostica per le app Web nel servizio app di Azure][app-service-logging].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-148">See [Enable diagnostics logging for web apps in Azure App Service][app-service-logging].</span></span>

### <a name="a-particular-user-repeatedly-makes-bad-requests-or-overloads-the-system"></a><span data-ttu-id="d8ccf-149">Un utente specifico esegue ripetutamente richieste non valide o sovraccarica il sistema.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-149">A particular user repeatedly makes bad requests or overloads the system.</span></span>
<span data-ttu-id="d8ccf-150">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-150">**Detection**.</span></span> <span data-ttu-id="d8ccf-151">Autenticare gli utenti e includere l'ID utente nei registri dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-151">Authenticate users and include user ID in application logs.</span></span>

<span data-ttu-id="d8ccf-152">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-152">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-153">Usare la [Documentazione di Gestione API] [ api-management] per limitare le richieste da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-153">Use [Azure API Management][api-management] to throttle requests from the user.</span></span> <span data-ttu-id="d8ccf-154">Vedere [Limitazione avanzata delle richieste con Gestione API di Azure][api-management-throttling]</span><span class="sxs-lookup"><span data-stu-id="d8ccf-154">See [Advanced request throttling with Azure API Management][api-management-throttling]</span></span>
* <span data-ttu-id="d8ccf-155">Bloccare l'utente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-155">Block the user.</span></span>

<span data-ttu-id="d8ccf-156">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-156">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-157">Registrare tutte le richieste di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-157">Log all authentication requests.</span></span>

### <a name="a-bad-update-was-deployed"></a><span data-ttu-id="d8ccf-158">È stato distribuito un aggiornamento non valido.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-158">A bad update was deployed.</span></span>
<span data-ttu-id="d8ccf-159">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-159">**Detection**.</span></span> <span data-ttu-id="d8ccf-160">Monitorare l'integrità dell'applicazione tramite il portale di Azure (vedere [Monitoraggio delle prestazioni dell'applicazione Web di Azure][app-insights-web-apps]) o implementare il [modello di monitoraggio degli endpoint per l'integrità] [health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-160">Monitor the application health through the Azure Portal (see [Monitor Azure web app performance][app-insights-web-apps]) or implement the [health endpoint monitoring pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="d8ccf-161">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-161">**Recovery**.</span></span> <span data-ttu-id="d8ccf-162">Usare più [slot di distribuzione] [ app-service-slots] ed eseguire il rollback all'ultima distribuzione valida.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-162">Use multiple [deployment slots][app-service-slots] and roll back to the last-known-good deployment.</span></span> <span data-ttu-id="d8ccf-163">Per altre informazioni, vedere [Applicazione Web di base][ra-web-apps-basic].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-163">For more information, see [Basic web application][ra-web-apps-basic].</span></span>

## <a name="azure-active-directory"></a><span data-ttu-id="d8ccf-164">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="d8ccf-164">Azure Active Directory</span></span>
### <a name="openid-connect-oidc-authentication-fails"></a><span data-ttu-id="d8ccf-165">L'autenticazione di OpenID Connect (OIDC) non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-165">OpenID Connect (OIDC) authentication fails.</span></span>
<span data-ttu-id="d8ccf-166">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-166">**Detection**.</span></span> <span data-ttu-id="d8ccf-167">Le modalità di errore possibili includono:</span><span class="sxs-lookup"><span data-stu-id="d8ccf-167">Possible failure modes include:</span></span>

1. <span data-ttu-id="d8ccf-168">Azure Active Directory non è disponibile o non è raggiungibile a causa di un problema di rete.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-168">Azure AD is not available, or cannot be reached due to a network problem.</span></span> <span data-ttu-id="d8ccf-169">Il reindirizzamento all'endpoint di autenticazione non riesce e il middleware OIDC genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-169">Redirection to the authentication endpoint fails, and the OIDC middleware throws an exception.</span></span>
2. <span data-ttu-id="d8ccf-170">Il tenant di Azure Active Directory non esiste.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-170">Azure AD tenant does not exist.</span></span> <span data-ttu-id="d8ccf-171">Il reindirizzamento all'endpoint di autenticazione restituisce un codice di errore HTTP e il middleware OIDC genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-171">Redirection to the authentication endpoint returns an HTTP error code, and the OIDC middleware throws an exception.</span></span>
3. <span data-ttu-id="d8ccf-172">L'utente non riesce a eseguire l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-172">User cannot authenticate.</span></span> <span data-ttu-id="d8ccf-173">Non è necessaria alcuna strategia di rilevamento; Azure AD gestisce gli errori di accesso.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-173">No detection strategy is necessary; Azure AD handles login failures.</span></span>

<span data-ttu-id="d8ccf-174">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-174">**Recovery**</span></span>

1. <span data-ttu-id="d8ccf-175">Individuare le eccezioni non gestite dal middleware.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-175">Catch unhandled exceptions from the middleware.</span></span>
2. <span data-ttu-id="d8ccf-176">Gestire gli eventi `AuthenticationFailed`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-176">Handle `AuthenticationFailed` events.</span></span>
3. <span data-ttu-id="d8ccf-177">Reindirizzare l'utente a una pagina di errore.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-177">Redirect the user to an error page.</span></span>
4. <span data-ttu-id="d8ccf-178">Tentativi utente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-178">User retries.</span></span>

## <a name="azure-search"></a><span data-ttu-id="d8ccf-179">Ricerca di Azure</span><span class="sxs-lookup"><span data-stu-id="d8ccf-179">Azure Search</span></span>
### <a name="writing-data-to-azure-search-fails"></a><span data-ttu-id="d8ccf-180">La scrittura dei dati in Ricerca di Azure non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-180">Writing data to Azure Search fails.</span></span>
<span data-ttu-id="d8ccf-181">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-181">**Detection**.</span></span> <span data-ttu-id="d8ccf-182">Individuare gli errori `Microsoft.Rest.Azure.CloudException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-182">Catch `Microsoft.Rest.Azure.CloudException` errors.</span></span>

<span data-ttu-id="d8ccf-183">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-183">**Recovery**</span></span>

<span data-ttu-id="d8ccf-184">L'[SDK Search .NET] [ search-sdk] esegue automaticamente nuovi tentativi dopo gli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-184">The [Search .NET SDK][search-sdk] automatically retries after transient failures.</span></span> <span data-ttu-id="d8ccf-185">Tutte le eccezioni generate dall'SDK client devono essere considerate come errori non temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-185">Any exceptions thrown by the client SDK should be treated as non-transient errors.</span></span>

<span data-ttu-id="d8ccf-186">Il criterio di ripetizione dei tentativi predefinito usa il backoff esponenziale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-186">The default retry policy uses exponential back-off.</span></span> <span data-ttu-id="d8ccf-187">Per usare un criterio di ripetizione dei tentativi diverso, chiamare `SetRetryPolicy` sulla classe `SearchIndexClient` o `SearchServiceClient`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-187">To use a different retry policy, call `SetRetryPolicy` on the `SearchIndexClient` or `SearchServiceClient` class.</span></span> <span data-ttu-id="d8ccf-188">Per altre informazioni, vedere [Tentativi automatici][auto-rest-client-retry].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-188">For more information, see [Automatic Retries][auto-rest-client-retry].</span></span>

<span data-ttu-id="d8ccf-189">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-189">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-190">Usare [Analisi del traffico di ricerca][search-analytics].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-190">Use [Search Traffic Analytics][search-analytics].</span></span>

### <a name="reading-data-from-azure-search-fails"></a><span data-ttu-id="d8ccf-191">La lettura dei dati da Ricerca di Azure non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-191">Reading data from Azure Search fails.</span></span>
<span data-ttu-id="d8ccf-192">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-192">**Detection**.</span></span> <span data-ttu-id="d8ccf-193">Individuare gli errori `Microsoft.Rest.Azure.CloudException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-193">Catch `Microsoft.Rest.Azure.CloudException` errors.</span></span>

<span data-ttu-id="d8ccf-194">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-194">**Recovery**</span></span>

<span data-ttu-id="d8ccf-195">L'[SDK Search .NET][search-sdk] esegue automaticamente nuovi tentativi dopo gli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-195">The [Search .NET SDK][search-sdk]  automatically retries after transient failures.</span></span> <span data-ttu-id="d8ccf-196">Tutte le eccezioni generate dall'SDK client devono essere considerate come errori non temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-196">Any exceptions thrown by the client SDK should be treated as non-transient errors.</span></span>

<span data-ttu-id="d8ccf-197">Il criterio di ripetizione dei tentativi predefinito usa il backoff esponenziale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-197">The default retry policy uses exponential back-off.</span></span> <span data-ttu-id="d8ccf-198">Per usare un criterio di ripetizione dei tentativi diverso, chiamare `SetRetryPolicy` sulla classe `SearchIndexClient` o `SearchServiceClient`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-198">To use a different retry policy, call `SetRetryPolicy` on the `SearchIndexClient` or `SearchServiceClient` class.</span></span> <span data-ttu-id="d8ccf-199">Per altre informazioni, vedere [Tentativi automatici][auto-rest-client-retry].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-199">For more information, see [Automatic Retries][auto-rest-client-retry].</span></span>

<span data-ttu-id="d8ccf-200">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-200">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-201">Usare [Analisi del traffico di ricerca][search-analytics].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-201">Use [Search Traffic Analytics][search-analytics].</span></span>

## <a name="cassandra"></a><span data-ttu-id="d8ccf-202">Cassandra</span><span class="sxs-lookup"><span data-stu-id="d8ccf-202">Cassandra</span></span>
### <a name="reading-or-writing-to-a-node-fails"></a><span data-ttu-id="d8ccf-203">La lettura o la scrittura in un nodo non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-203">Reading or writing to a node fails.</span></span>
<span data-ttu-id="d8ccf-204">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-204">**Detection**.</span></span> <span data-ttu-id="d8ccf-205">Individuare l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-205">Catch the exception.</span></span> <span data-ttu-id="d8ccf-206">Per i client .NET, in genere è `System.Web.HttpException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-206">For .NET clients, this will typically be `System.Web.HttpException`.</span></span> <span data-ttu-id="d8ccf-207">Altri client potrebbero avere altri tipi di eccezione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-207">Other client may have other exception types.</span></span>  <span data-ttu-id="d8ccf-208">Per altre informazioni, vedere la pagina relativa alla [gestione degli errori Cassandra eseguita correttamente](http://www.datastax.com/dev/blog/cassandra-error-handling-done-right).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-208">For more information, see [Cassandra error handling done right](http://www.datastax.com/dev/blog/cassandra-error-handling-done-right).</span></span>

<span data-ttu-id="d8ccf-209">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-209">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-210">Ogni [client Cassandra](https://wiki.apache.org/cassandra/ClientOptions) presenta capacità e criteri specifici di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-210">Each [Cassandra client](https://wiki.apache.org/cassandra/ClientOptions) has its own retry policies and capabilities.</span></span> <span data-ttu-id="d8ccf-211">Per altre informazioni, vedere la pagina relativa alla [gestione degli errori Cassandra eseguita correttamente][cassandra-error-handling].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-211">For more information, see [Cassandra error handling done right][cassandra-error-handling].</span></span>
* <span data-ttu-id="d8ccf-212">Usare una distribuzione con riconoscimento del rack e i nodi di dati distribuiti nei domini di errore.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-212">Use a rack-aware deployment, with data nodes distributed across the fault domains.</span></span>
* <span data-ttu-id="d8ccf-213">Distribuire in più aree con coerenza del quorum locale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-213">Deploy to multiple regions with local quorum consistency.</span></span> <span data-ttu-id="d8ccf-214">Se si verifica un errore non temporaneo, eseguire il failover in un'altra area.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-214">If a non-transient failure occurs, fail over to another region.</span></span>

<span data-ttu-id="d8ccf-215">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-215">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-216">Log applicazioni</span><span class="sxs-lookup"><span data-stu-id="d8ccf-216">Application logs</span></span>

## <a name="cloud-service"></a><span data-ttu-id="d8ccf-217">Servizio cloud</span><span class="sxs-lookup"><span data-stu-id="d8ccf-217">Cloud Service</span></span>
### <a name="web-or-worker-roles-are-unexpectedlybeing-shut-down"></a><span data-ttu-id="d8ccf-218">I ruoli di lavoro o Web vengono arrestati in modo imprevisto.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-218">Web or worker roles are unexpectedly being shut down.</span></span>
<span data-ttu-id="d8ccf-219">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-219">**Detection**.</span></span> <span data-ttu-id="d8ccf-220">Viene generato l'evento [RoleEnvironment.Stopping][RoleEnvironment.Stopping].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-220">The [RoleEnvironment.Stopping][RoleEnvironment.Stopping] event is fired.</span></span>

<span data-ttu-id="d8ccf-221">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-221">**Recovery**.</span></span> <span data-ttu-id="d8ccf-222">Eseguire l'override del metodo [RoleEntryPoint.OnStop][RoleEntryPoint.OnStop] per eseguire normalmente la pulizia.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-222">Override the [RoleEntryPoint.OnStop][RoleEntryPoint.OnStop] method to gracefully clean up.</span></span> <span data-ttu-id="d8ccf-223">Per altre informazioni, vedere [Come gestire correttamente gli eventi OnStop d Azure][onstop-events] (blog).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-223">For more information, see [The Right Way to Handle Azure OnStop Events][onstop-events] (blog).</span></span>

## <a name="cosmos-db"></a><span data-ttu-id="d8ccf-224">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="d8ccf-224">Cosmos DB</span></span> 
### <a name="reading-data-fails"></a><span data-ttu-id="d8ccf-225">La lettura dei dati non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-225">Reading data fails.</span></span>
<span data-ttu-id="d8ccf-226">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-226">**Detection**.</span></span> <span data-ttu-id="d8ccf-227">Individuare `System.Net.Http.HttpRequestException` o `Microsoft.Azure.Documents.DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-227">Catch `System.Net.Http.HttpRequestException` or `Microsoft.Azure.Documents.DocumentClientException`.</span></span>

<span data-ttu-id="d8ccf-228">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-228">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-229">L'SDK esegue automaticamente nuovi tentativi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-229">The SDK automatically retries failed attempts.</span></span> <span data-ttu-id="d8ccf-230">Per impostare il numero di tentativi e il tempo di attesa massimo, configurare `ConnectionPolicy.RetryOptions`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-230">To set the number of retries and the maximum wait time, configure `ConnectionPolicy.RetryOptions`.</span></span> <span data-ttu-id="d8ccf-231">Le eccezioni generate dal client escludono il criterio di ripetizione oppure non sono errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-231">Exceptions that the client raises are either beyond the retry policy or are not transient errors.</span></span>
* <span data-ttu-id="d8ccf-232">Se Cosmos DB limita il client, viene restituito un errore HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-232">If Cosmos DB throttles the client, it returns an HTTP 429 error.</span></span> <span data-ttu-id="d8ccf-233">Verificare il codice di stato in `DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-233">Check the status code in the `DocumentClientException`.</span></span> <span data-ttu-id="d8ccf-234">Se l'errore 429 si verifica in modo coerente, è consigliabile aumentare il valore di throughput della raccolta.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-234">If you are getting error 429 consistently, consider increasing the throughput value of the collection.</span></span>
    * <span data-ttu-id="d8ccf-235">Se si usa l'API di MongoDB, il servizio restituisce il codice di errore 16500 in caso di limitazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-235">If you are using the MongoDB API, the service returns error code 16500 when throttling.</span></span>
* <span data-ttu-id="d8ccf-236">Replicare il database Cosmos DB tra due o più aree.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-236">Replicate the Cosmos DB database across two or more regions.</span></span> <span data-ttu-id="d8ccf-237">Tutte le repliche sono leggibili.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-237">All replicas are readable.</span></span> <span data-ttu-id="d8ccf-238">Specificare il parametro `PreferredLocations` mediante gli SDK client.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-238">Using the client SDKs, specify the `PreferredLocations` parameter.</span></span> <span data-ttu-id="d8ccf-239">Si tratta di un elenco ordinato di aree di Azure.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-239">This is an ordered list of Azure regions.</span></span> <span data-ttu-id="d8ccf-240">Tutte le letture verranno inviate alla prima area disponibile nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-240">All reads will be sent to the first available region in the list.</span></span> <span data-ttu-id="d8ccf-241">Se la richiesta non riesce, il client proverà con altre aree nell'elenco seguendo l'ordine.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-241">If the request fails, the client will try the other regions in the list, in order.</span></span> <span data-ttu-id="d8ccf-242">Per altre informazioni, vedere [Procedura di configurazione della distribuzione globale in Azure Cosmos DB mediante l'API SQL][cosmosdb-multi-region].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-242">For more information, see [How to setup Azure Cosmos DB global distribution using the SQL API][cosmosdb-multi-region].</span></span>

<span data-ttu-id="d8ccf-243">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-243">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-244">Registrare tutti gli errori sul lato client.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-244">Log all errors on the client side.</span></span>

### <a name="writing-data-fails"></a><span data-ttu-id="d8ccf-245">La scrittura dei dati non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-245">Writing data fails.</span></span>
<span data-ttu-id="d8ccf-246">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-246">**Detection**.</span></span> <span data-ttu-id="d8ccf-247">Individuare `System.Net.Http.HttpRequestException` o `Microsoft.Azure.Documents.DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-247">Catch `System.Net.Http.HttpRequestException` or `Microsoft.Azure.Documents.DocumentClientException`.</span></span>

<span data-ttu-id="d8ccf-248">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-248">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-249">L'SDK esegue automaticamente nuovi tentativi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-249">The SDK automatically retries failed attempts.</span></span> <span data-ttu-id="d8ccf-250">Per impostare il numero di tentativi e il tempo di attesa massimo, configurare `ConnectionPolicy.RetryOptions`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-250">To set the number of retries and the maximum wait time, configure `ConnectionPolicy.RetryOptions`.</span></span> <span data-ttu-id="d8ccf-251">Le eccezioni generate dal client escludono il criterio di ripetizione oppure non sono errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-251">Exceptions that the client raises are either beyond the retry policy or are not transient errors.</span></span>
* <span data-ttu-id="d8ccf-252">Se Cosmos DB limita il client, viene restituito un errore HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-252">If Cosmos DB throttles the client, it returns an HTTP 429 error.</span></span> <span data-ttu-id="d8ccf-253">Verificare il codice di stato in `DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-253">Check the status code in the `DocumentClientException`.</span></span> <span data-ttu-id="d8ccf-254">Se l'errore 429 si verifica in modo coerente, è consigliabile aumentare il valore di throughput della raccolta.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-254">If you are getting error 429 consistently, consider increasing the throughput value of the collection.</span></span>
* <span data-ttu-id="d8ccf-255">Replicare il database Cosmos DB tra due o più aree.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-255">Replicate the Cosmos DB database across two or more regions.</span></span> <span data-ttu-id="d8ccf-256">Se l'area primaria non riesce, verrà alzata di livello per la scrittura un'area diversa.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-256">If the primary region fails, another region will be promoted to write.</span></span> <span data-ttu-id="d8ccf-257">È inoltre possibile attivare manualmente un failover.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-257">You can also trigger a failover manually.</span></span> <span data-ttu-id="d8ccf-258">L'SDK esegue l'individuazione e il routing automatici, pertanto dopo un failover il codice di applicazione continua a funzionare.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-258">The SDK does automatic discovery and routing, so application code continues to work after a failover.</span></span> <span data-ttu-id="d8ccf-259">Durante il periodo di failover (in genere minuti), le operazioni di scrittura avranno una latenza maggiore, in quanto l'SDK deve individuare la nuova area di scrittura.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-259">During the failover period (typically minutes), write operations will have higher latency, as the SDK finds the new write region.</span></span>
  <span data-ttu-id="d8ccf-260">Per altre informazioni, vedere [Procedura di configurazione della distribuzione globale in Azure Cosmos DB mediante l'API SQL][cosmosdb-multi-region].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-260">For more information, see [How to setup Azure Cosmos DB global distribution using the SQL API][cosmosdb-multi-region].</span></span>
* <span data-ttu-id="d8ccf-261">Come fallback, rendere persistente il documento in una coda di backup ed elaborare la coda in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-261">As a fallback, persist the document to a backup queue, and process the queue later.</span></span>

<span data-ttu-id="d8ccf-262">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-262">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-263">Registrare tutti gli errori sul lato client.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-263">Log all errors on the client side.</span></span>

## <a name="elasticsearch"></a><span data-ttu-id="d8ccf-264">Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="d8ccf-264">Elasticsearch</span></span>
### <a name="reading-data-from-elasticsearch-fails"></a><span data-ttu-id="d8ccf-265">La lettura dei dati da Elasticsearch non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-265">Reading data from Elasticsearch fails.</span></span>
<span data-ttu-id="d8ccf-266">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-266">**Detection**.</span></span> <span data-ttu-id="d8ccf-267">Individuare l'eccezione appropriata per il [client Elasticsearch] [ elasticsearch-client] specifico in uso.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-267">Catch the appropriate exception for the particular [Elasticsearch client][elasticsearch-client] being used.</span></span>

<span data-ttu-id="d8ccf-268">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-268">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-269">Usare un meccanismo di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-269">Use a retry mechanism.</span></span> <span data-ttu-id="d8ccf-270">Ogni client presenta criteri specifici di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-270">Each client has its own retry policies.</span></span>
* <span data-ttu-id="d8ccf-271">Distribuire più nodi Elasticsearch e usare la replica per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-271">Deploy multiple Elasticsearch nodes and use replication for high availability.</span></span>

<span data-ttu-id="d8ccf-272">Per altre informazioni, vedere [Esecuzione di Elasticsearch su Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-272">For more information, see [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

<span data-ttu-id="d8ccf-273">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-273">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-274">È possibile usare gli strumenti di monitoraggio per Elasticsearch o registrare tutti gli errori sul lato client con il payload.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-274">You can use monitoring tools for Elasticsearch, or log all errors on the client side with the payload.</span></span> <span data-ttu-id="d8ccf-275">Vedere la sezione "Monitoraggio" in [Esecuzione di Elasticsearch su Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-275">See the 'Monitoring' section in [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

### <a name="writing-data-to-elasticsearch-fails"></a><span data-ttu-id="d8ccf-276">La scrittura dei dati in Elasticsearch non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-276">Writing data to Elasticsearch fails.</span></span>
<span data-ttu-id="d8ccf-277">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-277">**Detection**.</span></span> <span data-ttu-id="d8ccf-278">Individuare l'eccezione appropriata per il [client Elasticsearch] [ elasticsearch-client] specifico in uso.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-278">Catch the appropriate exception for the particular [Elasticsearch client][elasticsearch-client] being used.</span></span>  

<span data-ttu-id="d8ccf-279">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-279">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-280">Usare un meccanismo di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-280">Use a retry mechanism.</span></span> <span data-ttu-id="d8ccf-281">Ogni client presenta criteri specifici di ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-281">Each client has its own retry policies.</span></span>
* <span data-ttu-id="d8ccf-282">Se l'applicazione è in grado di tollerare un livello di coerenza ridotto, è consigliabile scrivere con l'impostazione `write_consistency` per `quorum`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-282">If the application can tolerate a reduced consistency level, consider writing with `write_consistency` setting of `quorum`.</span></span>

<span data-ttu-id="d8ccf-283">Per altre informazioni, vedere [Esecuzione di Elasticsearch su Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-283">For more information, see [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

<span data-ttu-id="d8ccf-284">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-284">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-285">È possibile usare gli strumenti di monitoraggio per Elasticsearch o registrare tutti gli errori sul lato client con il payload.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-285">You can use monitoring tools for Elasticsearch, or log all errors on the client side with the payload.</span></span> <span data-ttu-id="d8ccf-286">Vedere la sezione "Monitoraggio" in [Esecuzione di Elasticsearch su Azure][elasticsearch-azure].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-286">See the 'Monitoring' section in [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

## <a name="queue-storage"></a><span data-ttu-id="d8ccf-287">Archiviazione code</span><span class="sxs-lookup"><span data-stu-id="d8ccf-287">Queue storage</span></span>
### <a name="writing-a-message-to-azure-queue-storage-fails-consistently"></a><span data-ttu-id="d8ccf-288">La scrittura di un messaggio in Archiviazione code di Azure non riesce sistematicamente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-288">Writing a message to Azure Queue storage fails consistently.</span></span>
<span data-ttu-id="d8ccf-289">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-289">**Detection**.</span></span> <span data-ttu-id="d8ccf-290">Dopo *N* tentativi l'operazione di scrittura continua a non riuscire.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-290">After *N* retry attempts, the write operation still fails.</span></span>

<span data-ttu-id="d8ccf-291">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-291">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-292">Archiviare i dati in una cache locale e inoltrare le operazioni di scrittura per l'archiviazione in un secondo momento, quando il servizio diventa disponibile.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-292">Store the data in a local cache, and forward the writes to storage later, when the service becomes available.</span></span>
* <span data-ttu-id="d8ccf-293">Creare una coda secondaria e scrivere in tale coda se quella primaria non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-293">Create a secondary queue, and write to that queue if the primary queue is unavailable.</span></span>

<span data-ttu-id="d8ccf-294">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-294">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-295">Usare le [metriche di archiviazione][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-295">Use [storage metrics][storage-metrics].</span></span>

### <a name="the-application-cannot-process-a-particular-message-from-the-queue"></a><span data-ttu-id="d8ccf-296">L'applicazione non è in grado di elaborare un determinato messaggio dalla coda.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-296">The application cannot process a particular message from the queue.</span></span>
<span data-ttu-id="d8ccf-297">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-297">**Detection**.</span></span> <span data-ttu-id="d8ccf-298">(specifico dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-298">Application specific.</span></span> <span data-ttu-id="d8ccf-299">Ad esempio il messaggio contiene dati non validi o la logica di business non riesce per qualche motivo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-299">For example, the message contains invalid data, or the business logic fails for some reason.</span></span>

<span data-ttu-id="d8ccf-300">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-300">**Recovery**</span></span>

<span data-ttu-id="d8ccf-301">Spostare il messaggio in una coda separata.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-301">Move the message to a separate queue.</span></span> <span data-ttu-id="d8ccf-302">Eseguire un processo separato per esaminare i messaggi in quella coda.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-302">Run a separate process to examine the messages in that queue.</span></span>

<span data-ttu-id="d8ccf-303">Usare le code di messaggistica del Bus di servizio di Microsoft Azure, che fornisce una funzionalità [coda di messaggi non recapitabili] [ sb-dead-letter-queue] a questo scopo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-303">Consider using Azure Service Bus Messaging queues, which provides a [dead-letter queue][sb-dead-letter-queue] functionality for this purpose.</span></span>

> [!NOTE]
> <span data-ttu-id="d8ccf-304">Se si usano le code di archiviazione con Processi Web, WebJobs SDK fornisce la funzionalità incorporata di gestione di messaggi non elaborabili.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-304">If you are using Storage queues with WebJobs, the WebJobs SDK provides built-in poison message handling.</span></span> <span data-ttu-id="d8ccf-305">Vedere [Come usare il servizio di archiviazione di accodamento di Azure con WebJobs SDK][sb-poison-message].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-305">See [How to use Azure queue storage with the WebJobs SDK][sb-poison-message].</span></span>

<span data-ttu-id="d8ccf-306">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-306">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-307">Usare la registrazione delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-307">Use application logging.</span></span>

## <a name="redis-cache"></a><span data-ttu-id="d8ccf-308">Cache Redis</span><span class="sxs-lookup"><span data-stu-id="d8ccf-308">Redis Cache</span></span>
### <a name="reading-from-the-cache-fails"></a><span data-ttu-id="d8ccf-309">La lettura dalla cache non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-309">Reading from the cache fails.</span></span>
<span data-ttu-id="d8ccf-310">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-310">**Detection**.</span></span> <span data-ttu-id="d8ccf-311">Individuare `StackExchange.Redis.RedisConnectionException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-311">Catch `StackExchange.Redis.RedisConnectionException`.</span></span>

<span data-ttu-id="d8ccf-312">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-312">**Recovery**</span></span>

1. <span data-ttu-id="d8ccf-313">Riprovare in caso di errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-313">Retry on transient failures.</span></span> <span data-ttu-id="d8ccf-314">Cache Redis di Azure supporta la ripetizione integrata dei tentativi. Vedere [Linee guida per la ripetizione di tentativi di Cache Redis di Azure][redis-retry].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-314">Azure Redis cache supports built-in retry through See [Redis Cache retry guidelines][redis-retry].</span></span>
2. <span data-ttu-id="d8ccf-315">Considerare gli errori non temporanei come un mancato riscontro nella cache e usare l'origine dati originale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-315">Treat non-transient failures as a cache miss, and fall back to the original data source.</span></span>

<span data-ttu-id="d8ccf-316">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-316">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-317">Usare [Come monitorare Cache Redis di Azure][redis-monitor].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-317">Use [Redis Cache diagnostics][redis-monitor].</span></span>

### <a name="writing-to-the-cache-fails"></a><span data-ttu-id="d8ccf-318">La scrittura nella cache non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-318">Writing to the cache fails.</span></span>
<span data-ttu-id="d8ccf-319">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-319">**Detection**.</span></span> <span data-ttu-id="d8ccf-320">Individuare `StackExchange.Redis.RedisConnectionException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-320">Catch `StackExchange.Redis.RedisConnectionException`.</span></span>

<span data-ttu-id="d8ccf-321">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-321">**Recovery**</span></span>

1. <span data-ttu-id="d8ccf-322">Riprovare in caso di errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-322">Retry on transient failures.</span></span> <span data-ttu-id="d8ccf-323">Cache Redis di Azure supporta la ripetizione integrata dei tentativi. Vedere [Linee guida per la ripetizione di tentativi di Cache Redis di Azure][redis-retry].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-323">Azure Redis cache supports built-in retry through See [Redis Cache retry guidelines][redis-retry].</span></span>
2. <span data-ttu-id="d8ccf-324">Se l'errore è non temporaneo, ignorarlo e consentire alle altre transazioni di scrivere nella cache in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-324">If the error is non-transient, ignore it and let other transactions write to the cache later.</span></span>

<span data-ttu-id="d8ccf-325">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-325">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-326">Usare [Come monitorare Cache Redis di Azure][redis-monitor].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-326">Use [Redis Cache diagnostics][redis-monitor].</span></span>

## <a name="sql-database"></a><span data-ttu-id="d8ccf-327">Database SQL</span><span class="sxs-lookup"><span data-stu-id="d8ccf-327">SQL Database</span></span>
### <a name="cannot-connect-to-the-database-in-the-primary-region"></a><span data-ttu-id="d8ccf-328">Non è possibile connettersi al database nell'area primaria.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-328">Cannot connect to the database in the primary region.</span></span>
<span data-ttu-id="d8ccf-329">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-329">**Detection**.</span></span> <span data-ttu-id="d8ccf-330">La connessione non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-330">Connection fails.</span></span>

<span data-ttu-id="d8ccf-331">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-331">**Recovery**</span></span>

<span data-ttu-id="d8ccf-332">Prerequisito: Il database deve essere configurato per la replica geografica attiva.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-332">Prerequisite: The database must be configured for active geo-replication.</span></span> <span data-ttu-id="d8ccf-333">Vedere [Panoramica: gruppi di failover e replica geografica attiva][sql-db-replication].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-333">See [SQL Database Active Geo-Replication][sql-db-replication].</span></span>

* <span data-ttu-id="d8ccf-334">Per le query, leggere da una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-334">For queries, read from a secondary replica.</span></span>
* <span data-ttu-id="d8ccf-335">Per inserimenti e aggiornamenti, eseguire manualmente il failover in una replica secondaria.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-335">For inserts and updates, manually fail over to a secondary replica.</span></span> <span data-ttu-id="d8ccf-336">Vedere [Configurare la replica geografica attiva per il database SQL di Azure nel portale di Azure e avviare il failover][sql-db-failover].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-336">See [Initiate a planned or unplanned failover for Azure SQL Database][sql-db-failover].</span></span>

<span data-ttu-id="d8ccf-337">La replica usa una stringa di connessione diversa, pertanto sarà necessario aggiornare la stringa di connessione nella propria applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-337">The replica uses a different connection string, so you will need to update the connection string in your application.</span></span>

### <a name="client-runs-out-of-connections-in-the-connection-pool"></a><span data-ttu-id="d8ccf-338">Il client esaurisce le connessioni nel pool di connessioni.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-338">Client runs out of connections in the connection pool.</span></span>
<span data-ttu-id="d8ccf-339">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-339">**Detection**.</span></span> <span data-ttu-id="d8ccf-340">Individuare gli errori `System.InvalidOperationException`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-340">Catch `System.InvalidOperationException` errors.</span></span>

<span data-ttu-id="d8ccf-341">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-341">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-342">Ripetere l'operazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-342">Retry the operation.</span></span>
* <span data-ttu-id="d8ccf-343">Come piano di mitigazione, isolare il pool di connessioni per ciascun caso d'uso, in modo che un solo caso d'uso non possa dominare tutte le connessioni.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-343">As a mitigation plan, isolate the connection pools for each use case, so that one use case can't dominate all the connections.</span></span>
* <span data-ttu-id="d8ccf-344">Aumentare il pool di connessioni massimo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-344">Increase the maximum connection pools.</span></span>

<span data-ttu-id="d8ccf-345">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-345">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-346">Log applicazioni.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-346">Application logs.</span></span>

### <a name="database-connection-limit-is-reached"></a><span data-ttu-id="d8ccf-347">È stato raggiunto il limite di connessioni di database.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-347">Database connection limit is reached.</span></span>
<span data-ttu-id="d8ccf-348">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-348">**Detection**.</span></span> <span data-ttu-id="d8ccf-349">Il database SQL di Azure limita il numero di accessi, sessioni e ruoli di lavoro simultanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-349">Azure SQL Database limits the number of concurrent workers, logins, and sessions.</span></span> <span data-ttu-id="d8ccf-350">I limiti dipendono dal livello di servizio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-350">The limits depend on the service tier.</span></span> <span data-ttu-id="d8ccf-351">Per altre informazioni, vedere [Limiti delle risorse del database SQL di Azure][sql-db-limits].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-351">For more information, see [Azure SQL Database resource limits][sql-db-limits].</span></span>

<span data-ttu-id="d8ccf-352">Per rilevare questi errori, individuare `System.Data.SqlClient.SqlException` e controllare il valore di `SqlException.Number` per il codice di errore SQL.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-352">To detect these errors, catch `System.Data.SqlClient.SqlException` and check the value of `SqlException.Number` for the SQL error code.</span></span> <span data-ttu-id="d8ccf-353">Per un elenco di codici di errore rilevanti, vedere [Codici di errore SQL per le applicazioni client del database SQL: errore di connessione e altri problemi del database][sql-db-errors].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-353">For a list of relevant error codes, see [SQL error codes for SQL Database client applications: Database connection error and other issues][sql-db-errors].</span></span>

<span data-ttu-id="d8ccf-354">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-354">**Recovery**.</span></span> <span data-ttu-id="d8ccf-355">Questi errori sono considerati temporanei, pertanto il problema si può risolvere con altri tentativi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-355">These errors are considered transient, so retrying may resolve the issue.</span></span> <span data-ttu-id="d8ccf-356">Se si riscontrano questi errori in modo sistematico, valutare se non sia opportuno un ridimensionamento del database.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-356">If you consistently hit these errors, consider scaling the database.</span></span>

<span data-ttu-id="d8ccf-357">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-357">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-358">- La query [sys.event_log][sys.event_log] restituisce connessioni di database riuscite, non riuscite e deadlock.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-358">- The [sys.event_log][sys.event_log] query returns successful database connections, connection failures, and deadlocks.</span></span>

* <span data-ttu-id="d8ccf-359">Creare una [regola di avviso][azure-alerts] per le connessioni non riuscite.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-359">Create an [alert rule][azure-alerts] for failed connections.</span></span>
* <span data-ttu-id="d8ccf-360">Abilitare il [controllo del database SQL di Microsoft Azure][sql-db-audit] e verificare la presenza di accessi non riusciti.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-360">Enable [SQL Database auditing][sql-db-audit] and check for failed logins.</span></span>

## <a name="service-bus-messaging"></a><span data-ttu-id="d8ccf-361">Messaggistica del bus di servizio</span><span class="sxs-lookup"><span data-stu-id="d8ccf-361">Service Bus Messaging</span></span>
### <a name="reading-a-message-from-a-service-bus-queue-fails"></a><span data-ttu-id="d8ccf-362">La lettura di un messaggio da una coda del bus di servizio non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-362">Reading a message from a Service Bus queue fails.</span></span>
<span data-ttu-id="d8ccf-363">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-363">**Detection**.</span></span> <span data-ttu-id="d8ccf-364">Individuare le eccezioni dal client SDK.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-364">Catch exceptions from the client SDK.</span></span> <span data-ttu-id="d8ccf-365">La classe base per le eccezioni del bus di servizio è [MessagingException][sb-messagingexception-class].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-365">The base class for Service Bus exceptions is [MessagingException][sb-messagingexception-class].</span></span> <span data-ttu-id="d8ccf-366">Se l'errore è temporaneo, a proprietà `IsTransient` è true.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-366">If the error is transient, the `IsTransient` property is true.</span></span>

<span data-ttu-id="d8ccf-367">Per altre informazioni, vedere [Eccezioni di messaggistica del bus di servizio][sb-messaging-exceptions].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-367">For more information, see [Service Bus messaging exceptions][sb-messaging-exceptions].</span></span>

<span data-ttu-id="d8ccf-368">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-368">**Recovery**</span></span>

1. <span data-ttu-id="d8ccf-369">Riprovare in caso di errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-369">Retry on transient failures.</span></span> <span data-ttu-id="d8ccf-370">Vedere [Bus di servizio - Linee guida per la ripetizione di tentativi][sb-retry].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-370">See [Service Bus retry guidelines][sb-retry].</span></span>
2. <span data-ttu-id="d8ccf-371">I messaggi che non si riesce a recapitare a nessun ricevitore vengono inseriti nella *coda di messaggi non recapitabili*.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-371">Messages that cannot be delivered to any receiver are placed in a *dead-letter queue*.</span></span> <span data-ttu-id="d8ccf-372">Usare questa cosa per vedere i messaggi che non sono stati ricevuti.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-372">Use this queue to see which messages could not be received.</span></span> <span data-ttu-id="d8ccf-373">Non è prevista alcuna pulizia automatica della coda di messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-373">There is no automatic cleanup of the dead-letter queue.</span></span> <span data-ttu-id="d8ccf-374">I messaggi rimangono nella coda fino a quando non vengono recuperati in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-374">Messages remain there until you explicitly retrieve them.</span></span> <span data-ttu-id="d8ccf-375">Vedere [Panoramica delle code dei messaggi non recapitabili del bus di servizio][sb-dead-letter-queue].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-375">See [Overview of Service Bus dead-letter queues][sb-dead-letter-queue].</span></span>

### <a name="writing-a-message-to-a-service-bus-queue-fails"></a><span data-ttu-id="d8ccf-376">La scrittura di un messaggio in una coda del bus di servizio non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-376">Writing a message to a Service Bus queue fails.</span></span>
<span data-ttu-id="d8ccf-377">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-377">**Detection**.</span></span> <span data-ttu-id="d8ccf-378">Individuare le eccezioni dal client SDK.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-378">Catch exceptions from the client SDK.</span></span> <span data-ttu-id="d8ccf-379">La classe base per le eccezioni del bus di servizio è [MessagingException][sb-messagingexception-class].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-379">The base class for Service Bus exceptions is [MessagingException][sb-messagingexception-class].</span></span> <span data-ttu-id="d8ccf-380">Se l'errore è temporaneo, a proprietà `IsTransient` è true.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-380">If the error is transient, the `IsTransient` property is true.</span></span>

<span data-ttu-id="d8ccf-381">Per altre informazioni, vedere [Eccezioni di messaggistica del bus di servizio][sb-messaging-exceptions].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-381">For more information, see [Service Bus messaging exceptions][sb-messaging-exceptions].</span></span>

<span data-ttu-id="d8ccf-382">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-382">**Recovery**</span></span>

1. <span data-ttu-id="d8ccf-383">Il client del bus di servizio esegue automaticamente nuovi tentativi dopo gli errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-383">The Service Bus client automatically retries after transient errors.</span></span> <span data-ttu-id="d8ccf-384">Per impostazione predefinita, usa il backoff esponenziale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-384">By default, it uses exponential back-off.</span></span> <span data-ttu-id="d8ccf-385">Superato il numero massimo di tentativi o trascorso il periodo di timeout massimo, il client genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-385">After the maximum retry count or maximum timeout period, the client throws an exception.</span></span> <span data-ttu-id="d8ccf-386">Per altre informazioni, vedere [Bus di servizio - Linee guida per la ripetizione di tentativi][sb-retry].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-386">For more information, see [Service Bus retry guidelines][sb-retry].</span></span>
2. <span data-ttu-id="d8ccf-387">Se viene superata la quota della coda, il client genera [QuotaExceededException][QuotaExceededException].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-387">If the queue quota is exceeded, the client throws [QuotaExceededException][QuotaExceededException].</span></span> <span data-ttu-id="d8ccf-388">Per informazioni dettagliate, vedere il messaggio di eccezione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-388">The exception message gives more details.</span></span> <span data-ttu-id="d8ccf-389">Eliminare alcuni messaggi dalla coda prima di fare un nuovo tentativo e provare a usare il modello Interruttore per evitare che vengano fatti tentativi continuativi superando la quota.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-389">Drain some messages from the queue before retrying, and consider using the Circuit Breaker pattern to avoid continued retries while the quota is exceeded.</span></span> <span data-ttu-id="d8ccf-390">Assicurasi inoltre che la proprietà [BrokeredMessage.TimeToLive] non sia impostata su un valore troppo elevato.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-390">Also, make sure the [BrokeredMessage.TimeToLive] property is not set too high.</span></span>
3. <span data-ttu-id="d8ccf-391">All'interno di un'area è possibile migliorare la resilienza tramite [code o argomenti partizionati][sb-partition].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-391">Within a region, resiliency can be improved by using [partitioned queues or topics][sb-partition].</span></span> <span data-ttu-id="d8ccf-392">Una coda o un argomento non partizionato viene assegnato a un archivio di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-392">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="d8ccf-393">Se l'archivio di messaggistica in questione non è disponibile, tutte le operazioni eseguite sulla coda o sull'argomento avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-393">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="d8ccf-394">Una coda o un argomento partizionati sono suddivisi in più archivi di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-394">A partitioned queue or topic is partitioned across multiple messaging stores.</span></span>
4. <span data-ttu-id="d8ccf-395">Per aumentare la resilienza, creare due spazi dei nomi del bus di servizio in aree diverse e replicare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-395">For additional resiliency, create two Service Bus namespaces in different regions, and replicate the messages.</span></span> <span data-ttu-id="d8ccf-396">È possibile usare sia la replica attiva sia quella passiva.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-396">You can use either active replication or passive replication.</span></span>

   * <span data-ttu-id="d8ccf-397">Replica attiva: il client invia tutti i messaggi a entrambe le code.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-397">Active replication: The client sends every message to both queues.</span></span> <span data-ttu-id="d8ccf-398">Il ricevitore è in ascolto su entrambe le code.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-398">The receiver listens on both queues.</span></span> <span data-ttu-id="d8ccf-399">Contrassegnare i messaggi con un identificatore univoco, in modo che il client possa eliminare i messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-399">Tag messages with a unique identifier, so the client can discard duplicate messages.</span></span>
   * <span data-ttu-id="d8ccf-400">Replica passiva: il client invia tutti i messaggi a una sola coda.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-400">Passive replication: The client sends the message to one queue.</span></span> <span data-ttu-id="d8ccf-401">Se si verifica un errore, il client esegue il fallback alla coda di altri.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-401">If there is an error, the client falls back to the other queue.</span></span> <span data-ttu-id="d8ccf-402">Il ricevitore è in ascolto su entrambe le code.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-402">The receiver listens on both queues.</span></span> <span data-ttu-id="d8ccf-403">Questo approccio riduce il numero di messaggi duplicati inviati.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-403">This approach reduces the number of duplicate messages that are sent.</span></span> <span data-ttu-id="d8ccf-404">Tuttavia, il ricevitore deve comunque gestire i messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-404">However, the receiver must still handle duplicate messages.</span></span>

     <span data-ttu-id="d8ccf-405">Per altre informazioni, vedere l'[esempio di replica geografica][sb-georeplication-sample] e [Procedure consigliate per isolare le applicazioni del bus di servizio da interruzioni ed emergenze del servizio](/azure/service-bus-messaging/service-bus-outages-disasters/).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-405">For more information, see [GeoReplication sample][sb-georeplication-sample] and [Best practices for insulating applications against Service Bus outages and disasters](/azure/service-bus-messaging/service-bus-outages-disasters/).</span></span>

### <a name="duplicate-message"></a><span data-ttu-id="d8ccf-406">Messaggio duplicato.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-406">Duplicate message.</span></span>
<span data-ttu-id="d8ccf-407">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-407">**Detection**.</span></span> <span data-ttu-id="d8ccf-408">Esaminare le proprietà `MessageId` e `DeliveryCount` del messaggio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-408">Examine the `MessageId` and `DeliveryCount` properties of the message.</span></span>

<span data-ttu-id="d8ccf-409">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-409">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-410">Se possibile, concepire le operazioni di elaborazione dei messaggi in modo che siano idempotenti.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-410">If possible, design your message processing operations to be idempotent.</span></span> <span data-ttu-id="d8ccf-411">In caso contrario, archiviare gli ID dei messaggio che sono già stati elaborati e verificare l'ID prima di elaborare un messaggio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-411">Otherwise, store message IDs of messages that are already processed, and check the ID before processing a message.</span></span>
* <span data-ttu-id="d8ccf-412">Abilitare il rilevamento dei duplicati creando la coda con `RequiresDuplicateDetection` impostato su true.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-412">Enable duplicate detection, by creating the queue with `RequiresDuplicateDetection` set to true.</span></span> <span data-ttu-id="d8ccf-413">Con questa impostazione, il bus di servizio elimina automaticamente qualsiasi messaggio inviato con lo stesso `MessageId` di un messaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-413">With this setting, Service Bus automatically deletes any message that is sent with the same `MessageId` as a previous message.</span></span>  <span data-ttu-id="d8ccf-414">Tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="d8ccf-414">Note the following:</span></span>

  * <span data-ttu-id="d8ccf-415">Questa impostazione impedisce di inserire nella coda messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-415">This setting prevents duplicate messages from being put into the queue.</span></span> <span data-ttu-id="d8ccf-416">Non impedisce tuttavia a un ricevitore di elaborare più volte lo stesso messaggio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-416">It doesn't prevent a receiver from processing the same message more than once.</span></span>
  * <span data-ttu-id="d8ccf-417">Il rilevamento di duplicati prevede una finestra temporale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-417">Duplicate detection has a time window.</span></span> <span data-ttu-id="d8ccf-418">Se un duplicato viene inviato al di là di questa finestra, non verrà rilevato.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-418">If a duplicate is sent beyond this window, it won't be detected.</span></span>

<span data-ttu-id="d8ccf-419">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-419">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-420">Registrare messaggi duplicati.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-420">Log duplicated messages.</span></span>

### <a name="the-application-cannot-process-a-particular-message-from-the-queue"></a><span data-ttu-id="d8ccf-421">L'applicazione non è in grado di elaborare un determinato messaggio dalla coda.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-421">The application cannot process a particular message from the queue.</span></span>
<span data-ttu-id="d8ccf-422">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-422">**Detection**.</span></span> <span data-ttu-id="d8ccf-423">(specifico dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-423">Application specific.</span></span> <span data-ttu-id="d8ccf-424">Ad esempio il messaggio contiene dati non validi o la logica di business non riesce per qualche motivo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-424">For example, the message contains invalid data, or the business logic fails for some reason.</span></span>

<span data-ttu-id="d8ccf-425">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-425">**Recovery**</span></span>

<span data-ttu-id="d8ccf-426">Esistono due modalità di errore da considerare.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-426">There are two failure modes to consider.</span></span>

* <span data-ttu-id="d8ccf-427">Il ricevitore rileva l'errore.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-427">The receiver detects the failure.</span></span> <span data-ttu-id="d8ccf-428">In questo caso spostare il messaggio nella coda di messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-428">In this case, move the message to the dead-letter queue.</span></span> <span data-ttu-id="d8ccf-429">Successivamente eseguire un processo separato per esaminare i messaggi in quella coda.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-429">Later, run a separate process to examine the messages in the dead-letter queue.</span></span>
* <span data-ttu-id="d8ccf-430">Si verifica un errore del ricevitore durante l'elaborazione del messaggio &mdash;, ad esempio, a causa di un'eccezione non gestita.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-430">The receiver fails in the middle of processing the message &mdash; for example, due to an unhandled exception.</span></span> <span data-ttu-id="d8ccf-431">Per gestire questo caso, usare la modalità `PeekLock`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-431">To handle this case, use `PeekLock` mode.</span></span> <span data-ttu-id="d8ccf-432">In questa modalità, se il blocco scade, il messaggio diventa disponibile per altri ricevitori.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-432">In this mode, if the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="d8ccf-433">Se il messaggio supera il numero massimo di recapiti o la durata, il messaggio viene spostato automaticamente nella coda di messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-433">If the message exceeds the maximum delivery count or the time-to-live, the message is automatically moved to the dead-letter queue.</span></span>

<span data-ttu-id="d8ccf-434">Per altre informazioni, vedere [Panoramica delle code dei messaggi non recapitabili del bus di servizio][sb-dead-letter-queue].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-434">For more information, see [Overview of Service Bus dead-letter queues][sb-dead-letter-queue].</span></span>

<span data-ttu-id="d8ccf-435">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-435">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-436">Ogni volta che l'applicazione sposta un messaggio alla coda di messaggi non recapitabili, scrivere un evento nel registro applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-436">Whenever the application moves a message to the dead-letter queue, write an event to the application logs.</span></span>

## <a name="service-fabric"></a><span data-ttu-id="d8ccf-437">Service Fabric</span><span class="sxs-lookup"><span data-stu-id="d8ccf-437">Service Fabric</span></span>
### <a name="a-request-to-a-service-fails"></a><span data-ttu-id="d8ccf-438">Una richiesta a un servizio non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-438">A request to a service fails.</span></span>
<span data-ttu-id="d8ccf-439">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-439">**Detection**.</span></span> <span data-ttu-id="d8ccf-440">Il servizio restituisce un errore.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-440">The service returns an error.</span></span>

<span data-ttu-id="d8ccf-441">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-441">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-442">Individuare di nuovo un proxy (`ServiceProxy` o `ActorProxy`) e chiamare nuovamente il metodo di servizio/attore.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-442">Locate a proxy again (`ServiceProxy` or `ActorProxy`) and call the service/actor method again.</span></span>
* <span data-ttu-id="d8ccf-443">**Servizio con stato**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-443">**Stateful service**.</span></span> <span data-ttu-id="d8ccf-444">Eseguire il wrapping delle operazioni sulle raccolte affidabili in una transazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-444">Wrap operations on reliable collections in a transaction.</span></span> <span data-ttu-id="d8ccf-445">Se si verifica un errore, verrà eseguito il rollback della transazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-445">If there is an error, the transaction will be rolled back.</span></span> <span data-ttu-id="d8ccf-446">Se viene eseguito il pull da un coda di una richiesta, questa verrà elaborata nuovamente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-446">The request, if pulled from a queue, will be processed again.</span></span>
* <span data-ttu-id="d8ccf-447">**Servizio senza stato**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-447">**Stateless service**.</span></span> <span data-ttu-id="d8ccf-448">Se il servizio mantiene i dati in un archivio esterno, è necessario che tutte le operazioni siano idempotenti.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-448">If the service persists data to an external store, all operations need to be idempotent.</span></span>

<span data-ttu-id="d8ccf-449">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-449">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-450">Registro applicazioni</span><span class="sxs-lookup"><span data-stu-id="d8ccf-450">Application log</span></span>

### <a name="service-fabric-node-is-shut-down"></a><span data-ttu-id="d8ccf-451">Il nodo di Service Fabric è stato arrestato.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-451">Service Fabric node is shut down.</span></span>
<span data-ttu-id="d8ccf-452">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-452">**Detection**.</span></span> <span data-ttu-id="d8ccf-453">Un token di annullamento viene passato al metodo `RunAsync` del servizio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-453">A cancellation token is passed to the service's `RunAsync` method.</span></span> <span data-ttu-id="d8ccf-454">Service Fabric annulla l'attività prima dell'arresto del nodo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-454">Service Fabric cancels the task before shutting down the node.</span></span>

<span data-ttu-id="d8ccf-455">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-455">**Recovery**.</span></span> <span data-ttu-id="d8ccf-456">Usare il token di annullamento per rilevare l'arresto.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-456">Use the cancellation token to detect shutdown.</span></span> <span data-ttu-id="d8ccf-457">Quando Service Fabric richiede l'annullamento, completare tutte le operazioni e chiudere  `RunAsync` più rapidamente possibile.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-457">When Service Fabric requests cancellation, finish any work and exit `RunAsync` as quickly as possible.</span></span>

<span data-ttu-id="d8ccf-458">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-458">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-459">Log applicazioni</span><span class="sxs-lookup"><span data-stu-id="d8ccf-459">Application logs</span></span>

## <a name="storage"></a><span data-ttu-id="d8ccf-460">Archiviazione</span><span class="sxs-lookup"><span data-stu-id="d8ccf-460">Storage</span></span>
### <a name="writing-data-to-azure-storage-fails"></a><span data-ttu-id="d8ccf-461">La scrittura dei dati in Archiviazione di Azure non riesce</span><span class="sxs-lookup"><span data-stu-id="d8ccf-461">Writing data to Azure Storage fails</span></span>
<span data-ttu-id="d8ccf-462">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-462">**Detection**.</span></span> <span data-ttu-id="d8ccf-463">Il client riceve errori durante la scrittura.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-463">The client receives errors when writing.</span></span>

<span data-ttu-id="d8ccf-464">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-464">**Recovery**</span></span>

1. <span data-ttu-id="d8ccf-465">Ritentare l'operazione per il ripristino da errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-465">Retry the operation, to recover from transient failures.</span></span> <span data-ttu-id="d8ccf-466">Il [criterio di ripetizione dei tentativi][Storage.RetryPolicies] nel client SDK viene gestito automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-466">The [retry policy][Storage.RetryPolicies] in the client SDK handles this automatically.</span></span>
2. <span data-ttu-id="d8ccf-467">Implementare il modello Interruttore per evitare di oltrepassare le limitazioni di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-467">Implement the Circuit Breaker pattern to avoid overwhelming storage.</span></span>
3. <span data-ttu-id="d8ccf-468">Se N tentativi non sono riusciti, eseguire un normale fallback.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-468">If N retry attempts fail, perform a graceful fallback.</span></span> <span data-ttu-id="d8ccf-469">Ad esempio: </span><span class="sxs-lookup"><span data-stu-id="d8ccf-469">For example:</span></span>

   * <span data-ttu-id="d8ccf-470">Archiviare i dati in una cache locale e inoltrare le operazioni di scrittura per l'archiviazione in un secondo momento, quando il servizio diventa disponibile.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-470">Store the data in a local cache, and forward the writes to storage later, when the service becomes available.</span></span>
   * <span data-ttu-id="d8ccf-471">Se l'azione di scrittura viene eseguita in un ambito transazionale, è possibile compensare la transazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-471">If the write action was in a transactional scope, compensate the transaction.</span></span>

<span data-ttu-id="d8ccf-472">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-472">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-473">Usare le [metriche di archiviazione][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-473">Use [storage metrics][storage-metrics].</span></span>

### <a name="reading-data-from-azure-storage-fails"></a><span data-ttu-id="d8ccf-474">La lettura dei dati da Archiviazione di Azure non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-474">Reading data from Azure Storage fails.</span></span>
<span data-ttu-id="d8ccf-475">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-475">**Detection**.</span></span> <span data-ttu-id="d8ccf-476">Il client riceve errori durante la lettura.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-476">The client receives errors when reading.</span></span>

<span data-ttu-id="d8ccf-477">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-477">**Recovery**</span></span>

1. <span data-ttu-id="d8ccf-478">Ritentare l'operazione per il ripristino da errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-478">Retry the operation, to recover from transient failures.</span></span> <span data-ttu-id="d8ccf-479">Il [criterio di ripetizione dei tentativi][Storage.RetryPolicies] nel client SDK viene gestito automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-479">The [retry policy][Storage.RetryPolicies] in the client SDK handles this automatically.</span></span>
2. <span data-ttu-id="d8ccf-480">Per l'archiviazione RA-GRS, se la lettura dall'endpoint primario non riesce, provare a leggere dall'endpoint secondario.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-480">For RA-GRS storage, if reading from the primary endpoint fails, try reading from the secondary endpoint.</span></span> <span data-ttu-id="d8ccf-481">Il client SDK può gestire questa operazione automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-481">The client SDK can handle this automatically.</span></span> <span data-ttu-id="d8ccf-482">Vedere [Replica di Archiviazione di Azure][storage-replication].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-482">See [Azure Storage replication][storage-replication].</span></span>
3. <span data-ttu-id="d8ccf-483">Se *N* tentativi hanno esito negativo, eseguire un'azione di fallback per ridurre le prestazioni in modo graduale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-483">If *N* retry attempts fail, take a fallback action to degrade gracefully.</span></span> <span data-ttu-id="d8ccf-484">Ad esempio, se non è possibile recuperare un'immagine del prodotto non può essere recuperata dall'archivio, mostrare un'immagine segnaposto generica.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-484">For example, if a product image can't be retrieved from storage, show a generic placeholder image.</span></span>

<span data-ttu-id="d8ccf-485">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-485">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-486">Usare le [metriche di archiviazione][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-486">Use [storage metrics][storage-metrics].</span></span>

## <a name="virtual-machine"></a><span data-ttu-id="d8ccf-487">Macchina virtuale</span><span class="sxs-lookup"><span data-stu-id="d8ccf-487">Virtual Machine</span></span>
### <a name="connection-to-a-backend-vm-fails"></a><span data-ttu-id="d8ccf-488">La connessione a una macchina virtuale di back-end non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-488">Connection to a backend VM fails.</span></span>
<span data-ttu-id="d8ccf-489">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-489">**Detection**.</span></span> <span data-ttu-id="d8ccf-490">Errori delle connessioni di rete.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-490">Network connection errors.</span></span>

<span data-ttu-id="d8ccf-491">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-491">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-492">Distribuire almeno du macchine virtuali di back-end in un set di disponibilità dietro un bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-492">Deploy at least two backend VMs in an availability set, behind a load balancer.</span></span>
* <span data-ttu-id="d8ccf-493">Quando l'errore di connessione è temporaneo, talvolta i protocollo TCP riesce a ritentare l'invio del messaggio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-493">If the connection error is transient, sometimes TCP will successfully retry sending the message.</span></span>
* <span data-ttu-id="d8ccf-494">Implementare un criterio di ripetizione dei tentativi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-494">Implement a retry policy in the application.</span></span>
* <span data-ttu-id="d8ccf-495">Per gli errori persistenti o non temporanei, implementare il modello [Interruttore][circuit-breaker].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-495">For persistent or non-transient errors, implement the [Circuit Breaker][circuit-breaker] pattern.</span></span>
* <span data-ttu-id="d8ccf-496">Se la macchina virtuale chiamante supera il limite di rete in uscita, la coda in uscita si riempirà.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-496">If the calling VM exceeds its network egress limit, the outbound queue will fill up.</span></span> <span data-ttu-id="d8ccf-497">Se la coda in uscita è completa in modo coerente, prendere in considerazione la scalabilità orizzontale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-497">If the outbound queue is consistently full, consider scaling out.</span></span>

<span data-ttu-id="d8ccf-498">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-498">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-499">Registrare gli eventi in base ai limiti del servizio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-499">Log events at service boundaries.</span></span>

### <a name="vm-instance-becomes-unavailable-or-unhealthy"></a><span data-ttu-id="d8ccf-500">Un'istanza VM non è più disponibile o non è più integra.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-500">VM instance becomes unavailable or unhealthy.</span></span>
<span data-ttu-id="d8ccf-501">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-501">**Detection**.</span></span> <span data-ttu-id="d8ccf-502">Configurare il [probe di integrità][lb-probe] di Load Balancer che segnala se l'istanza di macchina virtuale è integra.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-502">Configure a Load Balancer [health probe][lb-probe] that signals whether the VM instance is healthy.</span></span> <span data-ttu-id="d8ccf-503">Il probe deve verificare se le funzioni critiche rispondono correttamente.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-503">The probe should check whether critical functions are responding correctly.</span></span>

<span data-ttu-id="d8ccf-504">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-504">**Recovery**.</span></span> <span data-ttu-id="d8ccf-505">Per ogni livello di applicazione, inserire più istanze di macchina virtuale nello stesso set di disponibilità e posizionare un bilanciamento del carico di fronte alle macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-505">For each application tier, put multiple VM instances into the same availability set, and place a load balancer in front of the VMs.</span></span> <span data-ttu-id="d8ccf-506">Se il probe di integrità non riesce, Load Balancer interrompe l'invio di nuove connessioni all'istanza non integra.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-506">If the health probe fails, the Load Balancer stops sending new connections to the unhealthy instance.</span></span>

<span data-ttu-id="d8ccf-507">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-507">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-508">- Usare l'[analisi dei log][lb-monitor] di Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-508">- Use Load Balancer [log analytics][lb-monitor].</span></span>

* <span data-ttu-id="d8ccf-509">Configurare il sistema di monitoraggio per monitorare tutti gli endpoint di monitoraggio dello stato.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-509">Configure your monitoring system to monitor all of the health monitoring endpoints.</span></span>

### <a name="operator-accidentally-shuts-down-a-vm"></a><span data-ttu-id="d8ccf-510">L'operatore arrestato accidentalmente una macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-510">Operator accidentally shuts down a VM.</span></span>
<span data-ttu-id="d8ccf-511">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-511">**Detection**.</span></span> <span data-ttu-id="d8ccf-512">N/D</span><span class="sxs-lookup"><span data-stu-id="d8ccf-512">N/A</span></span>

<span data-ttu-id="d8ccf-513">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-513">**Recovery**.</span></span> <span data-ttu-id="d8ccf-514">Impostare un blocco di risorsa con livello `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-514">Set a resource lock with `ReadOnly` level.</span></span> <span data-ttu-id="d8ccf-515">Vedere [Bloccare le risorse per impedire modifiche impreviste][rm-locks].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-515">See [Lock resources with Azure Resource Manager][rm-locks].</span></span>

<span data-ttu-id="d8ccf-516">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-516">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-517">Usare i [Log attività di Azure][azure-activity-logs].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-517">Use [Azure Activity Logs][azure-activity-logs].</span></span>

## <a name="webjobs"></a><span data-ttu-id="d8ccf-518">WebJobs</span><span class="sxs-lookup"><span data-stu-id="d8ccf-518">WebJobs</span></span>
### <a name="continuous-job-stops-running-when-the-scm-host-is-idle"></a><span data-ttu-id="d8ccf-519">L'esecuzione del processo continuo viene interrotta quando l'host SCM è inattivo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-519">Continuous job stops running when the SCM host is idle.</span></span>
<span data-ttu-id="d8ccf-520">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-520">**Detection**.</span></span> <span data-ttu-id="d8ccf-521">Passare un token di annullamento alla funzione WebJob.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-521">Pass a cancellation token to the WebJob function.</span></span> <span data-ttu-id="d8ccf-522">Per altre informazioni, vedere l'articolo sull' [arresto normale dei processi][web-jobs-shutdown].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-522">For more information, see [Graceful shutdown][web-jobs-shutdown].</span></span>

<span data-ttu-id="d8ccf-523">**Ripristino**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-523">**Recovery**.</span></span> <span data-ttu-id="d8ccf-524">Abilitare l'impostazione `Always On` nell'app Web.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-524">Enable the `Always On` setting in the web app.</span></span> <span data-ttu-id="d8ccf-525">Per altre informazioni, vedere [Eseguire attività in background con Processi Web in Servizio app di Azure][web-jobs].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-525">For more information, see [Run Background tasks with WebJobs][web-jobs].</span></span>

## <a name="application-design"></a><span data-ttu-id="d8ccf-526">Progettazione di applicazioni</span><span class="sxs-lookup"><span data-stu-id="d8ccf-526">Application design</span></span>
### <a name="application-cant-handle-a-spike-in-incoming-requests"></a><span data-ttu-id="d8ccf-527">L'applicazione non riesce a gestire un picco nelle richieste in arrivo.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-527">Application can't handle a spike in incoming requests.</span></span>
<span data-ttu-id="d8ccf-528">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-528">**Detection**.</span></span> <span data-ttu-id="d8ccf-529">Dipende dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-529">Depends on the application.</span></span> <span data-ttu-id="d8ccf-530">Sintomi tipici:</span><span class="sxs-lookup"><span data-stu-id="d8ccf-530">Typical symptoms:</span></span>

* <span data-ttu-id="d8ccf-531">Il sito Web inizia a restituire codici di errore HTTP 5xx.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-531">The website starts returning HTTP 5xx error codes.</span></span>
* <span data-ttu-id="d8ccf-532">I servizi dipendenti, ad esempio di database o archiviazione, iniziano a limitare le richieste.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-532">Dependent services, such as database or storage, start to throttle requests.</span></span> <span data-ttu-id="d8ccf-533">Cercare gli errori HTTP, ad esempio HTTP 429 (troppe richieste), a seconda del servizio.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-533">Look for HTTP errors such as HTTP 429 (Too Many Requests), depending on the service.</span></span>
* <span data-ttu-id="d8ccf-534">La lunghezza della coda aumenta.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-534">HTTP queue length grows.</span></span>

<span data-ttu-id="d8ccf-535">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-535">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-536">Scalare in orizzontale per gestire il carico maggiore.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-536">Scale out to handle increased load.</span></span>
* <span data-ttu-id="d8ccf-537">Ridurre gli errori per evitare che errori a cascata interferiscano con l'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-537">Mitigate failures to avoid having cascading failures disrupt the entire application.</span></span> <span data-ttu-id="d8ccf-538">Le strategie di mitigazione includono:</span><span class="sxs-lookup"><span data-stu-id="d8ccf-538">Mitigation strategies include:</span></span>

  * <span data-ttu-id="d8ccf-539">Implementare il [Modello Limitazione][throttling-pattern] per evitare di sovraccaricare i sistemi back-end.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-539">Implement the [Throttling Pattern][throttling-pattern] to avoid overwhelming backend systems.</span></span>
  * <span data-ttu-id="d8ccf-540">Usare lo [schema di livellamento del carico basato sulle code][queue-based-load-leveling] per memorizzare nel buffer le richieste ed elaborarle a un ritmo adeguato.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-540">Use [queue-based load leveling][queue-based-load-leveling] to buffer requests and process them at an appropriate pace.</span></span>
  * <span data-ttu-id="d8ccf-541">Assegnare la priorità per alcuni client.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-541">Prioritize certain clients.</span></span> <span data-ttu-id="d8ccf-542">Ad esempio, se l'applicazione prevede livelli gratuiti e a pagamento, limitare i clienti del livello gratuito, ma non quelli a pagamento.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-542">For example, if the application has free and paid tiers, throttle customers on the free tier, but not paid customers.</span></span> <span data-ttu-id="d8ccf-543">Vedere [Modello di coda con priorità][priority-queue-pattern].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-543">See [Priority queue pattern][priority-queue-pattern].</span></span>

<span data-ttu-id="d8ccf-544">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-544">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-545">Usare [Abilitare la registrazione diagnostica per le app Web nel servizio app di Azure][app-service-logging].</span><span class="sxs-lookup"><span data-stu-id="d8ccf-545">Use [App Service diagnostic logging][app-service-logging].</span></span> <span data-ttu-id="d8ccf-546">Usare un servizio come [Azure Log Analytics][azure-log-analytics], [Application Insights][app-insights] o [New Relic][new-relic] per interpretare i log di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-546">Use a service such as [Azure Log Analytics][azure-log-analytics], [Application Insights][app-insights], or [New Relic][new-relic] to help understand the diagnostic logs.</span></span>

### <a name="one-of-the-operations-in-a-workflow-or-distributed-transaction-fails"></a><span data-ttu-id="d8ccf-547">Una delle operazioni in una transazione distribuita o un flusso di lavoro non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-547">One of the operations in a workflow or distributed transaction fails.</span></span>
<span data-ttu-id="d8ccf-548">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-548">**Detection**.</span></span> <span data-ttu-id="d8ccf-549">Dopo *N* tentativi, il problema persiste.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-549">After *N* retry attempts, it still fails.</span></span>

<span data-ttu-id="d8ccf-550">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-550">**Recovery**</span></span>

* <span data-ttu-id="d8ccf-551">Come piano di mitigazione, implementare il modello [Supervisore agente di pianificazione] [ scheduler-agent-supervisor] per gestire l'intero flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-551">As a mitigation plan, implement the [Scheduler Agent Supervisor][scheduler-agent-supervisor] pattern to manage the entire workflow.</span></span>
* <span data-ttu-id="d8ccf-552">Non riprovare ai timeout.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-552">Don't retry on timeouts.</span></span> <span data-ttu-id="d8ccf-553">La percentuale di successo per questo errore è bassa.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-553">There is a low success rate for this error.</span></span>
* <span data-ttu-id="d8ccf-554">Mettere il lavoro in coda per riprovare più tardi.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-554">Queue work, in order to retry later.</span></span>

<span data-ttu-id="d8ccf-555">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-555">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-556">Accedere a tutte le operazioni (riuscite e non riuscite), incluse le azioni di compensazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-556">Log all operations (successful and failed), including compensating actions.</span></span> <span data-ttu-id="d8ccf-557">Usare gli ID di correlazione, in modo che sia possibile tenere traccia di tutte le operazioni all'interno della stessa transazione.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-557">Use correlation IDs, so that you can track all operations within the same transaction.</span></span>

### <a name="a-call-to-a-remote-service-fails"></a><span data-ttu-id="d8ccf-558">Una chiamata a un servizio remoto non riesce.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-558">A call to a remote service fails.</span></span>
<span data-ttu-id="d8ccf-559">**Rilevamento**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-559">**Detection**.</span></span> <span data-ttu-id="d8ccf-560">Codice di errore HTTP.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-560">HTTP error code.</span></span>

<span data-ttu-id="d8ccf-561">**Ripristino**</span><span class="sxs-lookup"><span data-stu-id="d8ccf-561">**Recovery**</span></span>

1. <span data-ttu-id="d8ccf-562">Riprovare in caso di errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-562">Retry on transient failures.</span></span>
2. <span data-ttu-id="d8ccf-563">Se la chiamata non riesce dopo *N* tentativi, eseguire un'azione di fallback</span><span class="sxs-lookup"><span data-stu-id="d8ccf-563">If the call fails after *N* attempts, take a fallback action.</span></span> <span data-ttu-id="d8ccf-564">(specifica dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-564">(Application specific.)</span></span>
3. <span data-ttu-id="d8ccf-565">Implementare il [modello di Interruttore] [ circuit-breaker] per evitare che si verifichino errori a catena.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-565">Implement the [Circuit Breaker pattern][circuit-breaker] to avoid cascading failures.</span></span>

<span data-ttu-id="d8ccf-566">**Diagnostica**.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-566">**Diagnostics**.</span></span> <span data-ttu-id="d8ccf-567">Accedere a tutti gli errori di chiamata remota.</span><span class="sxs-lookup"><span data-stu-id="d8ccf-567">Log all remote call failures.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d8ccf-568">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="d8ccf-568">Next steps</span></span>
<span data-ttu-id="d8ccf-569">Per altre informazioni sul processo di FMA, vedere [Resilienza in base alla progettazione per i servizi cloud] [ resilience-by-design-pdf] (download PDF).</span><span class="sxs-lookup"><span data-stu-id="d8ccf-569">For more information about the FMA process, see [Resilience by design for cloud services][resilience-by-design-pdf] (PDF download).</span></span>

<!-- links -->

[api-management]: https://azure.microsoft.com/documentation/services/api-management/
[api-management-throttling]: /azure/api-management/api-management-sample-flexible-throttling/
[app-insights]: /azure/application-insights/app-insights-overview/
[app-insights-web-apps]: /azure/application-insights/app-insights-azure-web-apps/
[app-service-configure]: /azure/app-service-web/web-sites-configure/
[app-service-logging]: /azure/app-service-web/web-sites-enable-diagnostic-log/
[app-service-slots]: /azure/app-service-web/web-sites-staged-publishing/
[auto-rest-client-retry]: https://github.com/Azure/autorest/tree/master/docs
[azure-activity-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-activity-logs/
[azure-alerts]: /azure/monitoring-and-diagnostics/insights-alerts-portal/
[azure-log-analytics]: /azure/log-analytics/log-analytics-overview/
[BrokeredMessage.TimeToLive]: https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.timetolive.aspx
[cassandra-error-handling]: http://www.datastax.com/dev/blog/cassandra-error-handling-done-right
[circuit-breaker]: https://msdn.microsoft.com/library/dn589784.aspx
[cosmosdb-multi-region]: /azure/cosmos-db/tutorial-global-distribution-sql-api
[elasticsearch-azure]: ../elasticsearch/index.md
[elasticsearch-client]: https://www.elastic.co/guide/en/elasticsearch/client/index.html
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[onstop-events]: https://azure.microsoft.com/blog/the-right-way-to-handle-azure-onstop-events/
[lb-monitor]: /azure/load-balancer/load-balancer-monitor-log/
[lb-probe]: /azure/load-balancer/load-balancer-custom-probe-overview/#learn-about-the-types-of-probes
[new-relic]: https://newrelic.com/
[priority-queue-pattern]: https://msdn.microsoft.com/library/dn589794.aspx
[queue-based-load-leveling]: https://msdn.microsoft.com/library/dn589783.aspx
[QuotaExceededException]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.quotaexceededexception.aspx
[ra-web-apps-basic]: ../reference-architectures/app-service-web-app/basic-web-app.md
[redis-monitor]: /azure/redis-cache/cache-how-to-monitor/
[redis-retry]: ../best-practices/retry-service-specific.md#azure-redis-cache-retry-guidelines
[resilience-by-design-pdf]: http://download.microsoft.com/download/D/8/C/D8C599A4-4E8A-49BF-80EE-FE35F49B914D/Resilience_by_Design_for_Cloud_Services_White_Paper.pdf
[RoleEntryPoint.OnStop]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx
[RoleEnvironment.Stopping]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx
[rm-locks]: /azure/azure-resource-manager/resource-group-lock-resources/
[sb-dead-letter-queue]: /azure/service-bus-messaging/service-bus-dead-letter-queues/
[sb-georeplication-sample]: https://github.com/Azure-Samples/azure-servicebus-messaging-samples/tree/master/GeoReplication
[sb-messagingexception-class]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingexception.aspx
[sb-messaging-exceptions]: /azure/service-bus-messaging/service-bus-messaging-exceptions/
[sb-outages]: /azure/service-bus-messaging/service-bus-outages-disasters/#protecting-queues-and-topics-against-datacenter-outages-or-disasters
[sb-partition]: /azure/service-bus-messaging/service-bus-partitioning/
[sb-poison-message]: /azure/app-service-web/websites-dotnet-webjobs-sdk-storage-queues-how-to/#poison
[sb-retry]: ../best-practices/retry-service-specific.md#service-bus-retry-guidelines
[search-sdk]: https://msdn.microsoft.com/library/dn951165.aspx
[scheduler-agent-supervisor]: https://msdn.microsoft.com/library/dn589780.aspx
[search-analytics]: /azure/search/search-traffic-analytics/
[sql-db-audit]: /azure/sql-database/sql-database-auditing-get-started/
[sql-db-errors]: /azure/sql-database/sql-database-develop-error-messages/#resource-governance-errors
[sql-db-failover]: /azure/sql-database/sql-database-geo-replication-failover-portal/
[sql-db-limits]: /azure/sql-database/sql-database-resource-limits/
[sql-db-replication]: /azure/sql-database/sql-database-geo-replication-overview/
[storage-metrics]: https://msdn.microsoft.com/library/dn782843.aspx
[storage-replication]: /azure/storage/storage-redundancy/
[Storage.RetryPolicies]: https://msdn.microsoft.com/library/microsoft.windowsazure.storage.retrypolicies.aspx
[sys.event_log]: https://msdn.microsoft.com/library/dn270018.aspx
[throttling-pattern]: https://msdn.microsoft.com/library/dn589798.aspx
[web-jobs]: /azure/app-service-web/web-sites-create-web-jobs/
[web-jobs-shutdown]: /azure/app-service-web/websites-dotnet-webjobs-sdk-storage-queues-how-to/#graceful
