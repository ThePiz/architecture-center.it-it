---
title: Progettazione di applicazioni resilienti per Azure
description: Come creare applicazioni resilienti in Azure per disponibilità elevata e ripristino di emergenza.
author: MikeWasson
ms.date: 05/26/2017
ms.custom: resiliency
ms.openlocfilehash: f5dfca30b3587e198c1c0f99ad4903ed7b0e33d4
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 09/28/2018
ms.locfileid: "47429289"
---
# <a name="designing-resilient-applications-for-azure"></a><span data-ttu-id="39abe-103">Progettazione di applicazioni resilienti per Azure</span><span class="sxs-lookup"><span data-stu-id="39abe-103">Designing resilient applications for Azure</span></span>

<span data-ttu-id="39abe-104">In un sistema distribuito si presentano errori.</span><span class="sxs-lookup"><span data-stu-id="39abe-104">In a distributed system, failures will happen.</span></span> <span data-ttu-id="39abe-105">E gli hardware possono danneggiarsi.</span><span class="sxs-lookup"><span data-stu-id="39abe-105">Hardware can fail.</span></span> <span data-ttu-id="39abe-106">La rete, poi, può avere errori temporanei.</span><span class="sxs-lookup"><span data-stu-id="39abe-106">The network can have transient failures.</span></span> <span data-ttu-id="39abe-107">Raramente un intero servizio o area può subire delle interruzioni, tuttavia è necessario pianificare anche questo tipo di problemi.</span><span class="sxs-lookup"><span data-stu-id="39abe-107">Rarely, an entire service or region may experience a disruption, but even those must be planned for.</span></span> 

<span data-ttu-id="39abe-108">La creazione di un'applicazione affidabile nel cloud è diversa rispetto alla creazione di un'applicazione affidabile in un contesto aziendale.</span><span class="sxs-lookup"><span data-stu-id="39abe-108">Building a reliable application in the cloud is different than building a reliable application in an enterprise setting.</span></span> <span data-ttu-id="39abe-109">Mentre in passato si potrebbe aver acquistato un hardware di fascia alta per aumentare le prestazioni, in un ambiente cloud è necessario scalare orizzontalmente anziché verticalmente.</span><span class="sxs-lookup"><span data-stu-id="39abe-109">While historically you may have purchased higher-end hardware to scale up, in a cloud environment you must scale out instead of scaling up.</span></span> <span data-ttu-id="39abe-110">I costi degli ambienti cloud sono mantenuti bassi dall'uso di hardware appositi.</span><span class="sxs-lookup"><span data-stu-id="39abe-110">Costs for cloud environments are kept low through the use of commodity hardware.</span></span> <span data-ttu-id="39abe-111">Anziché focalizzarsi sulla prevenzione degli errori e sull'ottimizzazione del "tempo medio tra errori", in questo nuovo ambiente l'attenzione si sposta sul "tempo medio per il ripristino".</span><span class="sxs-lookup"><span data-stu-id="39abe-111">Instead of focusing on preventing failures and optimizing "mean time between failures," in this new environment the focus shifts to "mean time to restore."</span></span> <span data-ttu-id="39abe-112">L'obiettivo è ridurre l'effetto di un errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-112">The goal is to minimize the effect of a failure.</span></span>

<span data-ttu-id="39abe-113">Questo articolo fornisce una panoramica sulla creazione di applicazioni resilienti in Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="39abe-113">This article provides an overview of how to build resilient applications in Microsoft Azure.</span></span> <span data-ttu-id="39abe-114">e inizia con una definizione del termine *resilienza* e dei concetti correlati.</span><span class="sxs-lookup"><span data-stu-id="39abe-114">It starts with a definition of the term *resiliency* and related concepts.</span></span> <span data-ttu-id="39abe-115">Quindi, viene descritto un processo per ottenere la resilienza, adottando un approccio strutturato in base alla durata di un'applicazione, dalla progettazione e implementazione alla distribuzione, fino alle operazioni.</span><span class="sxs-lookup"><span data-stu-id="39abe-115">Then it describes a process for achieving resiliency, using a structured approach over the lifetime of an application, from design and implementation to deployment and operations.</span></span>

## <a name="what-is-resiliency"></a><span data-ttu-id="39abe-116">Cos'è la resilienza?</span><span class="sxs-lookup"><span data-stu-id="39abe-116">What is resiliency?</span></span>
<span data-ttu-id="39abe-117">La **resilienza** è la capacità di un sistema di correggere gli errori e continuare a funzionare.</span><span class="sxs-lookup"><span data-stu-id="39abe-117">**Resiliency** is the ability of a system to recover from failures and continue to function.</span></span> <span data-ttu-id="39abe-118">Non significa *evitare*, ma *rispondere* agli errori in modo da evitare tempi di inattività o perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="39abe-118">It's not about *avoiding* failures, but *responding* to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="39abe-119">L'obiettivo della resilienza consiste nel ripristinare uno stato completamente funzionale dell'applicazione dopo un errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-119">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span>

<span data-ttu-id="39abe-120">Due aspetti importanti della resilienza sono la disponibilità elevata e il ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="39abe-120">Two important aspects of resiliency are high availability and disaster recovery.</span></span>

* <span data-ttu-id="39abe-121">La **disponibilità elevata** è la capacità dell'applicazione di continuare a essere eseguita in uno stato integro, senza tempi di inattività significativi.</span><span class="sxs-lookup"><span data-stu-id="39abe-121">**High availability** (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="39abe-122">Per "stato integro" si intende che l'applicazione è reattiva e gli utenti possono connettersi all'applicazione e interagire con essa.</span><span class="sxs-lookup"><span data-stu-id="39abe-122">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span>  
* <span data-ttu-id="39abe-123">Il **ripristino di emergenza** è la capacità di correggere eventi imprevisti rari ma gravi, ad esempio errori non temporanei su larga scala, come un'interruzione del servizio che interessa un'intera area.</span><span class="sxs-lookup"><span data-stu-id="39abe-123">**Disaster recovery** (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="39abe-124">Il ripristino di emergenza include il backup dei dati e l'archiviazione e può includere l'intervento manuale, ad esempio il ripristino di un database dal backup.</span><span class="sxs-lookup"><span data-stu-id="39abe-124">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="39abe-125">Un modo per pensare alla disponibilità elevata e al ripristino di emergenza è che il secondo ha inizio quando l'impatto di un errore supera la capacità che la prima ha di gestirlo.</span><span class="sxs-lookup"><span data-stu-id="39abe-125">One way to think about HA versus DR is that DR starts when the impact of a fault exceeds the ability of the HA design to handle it.</span></span>  

<span data-ttu-id="39abe-126">Quando si progetta per la resilienza, è necessario comprendere i requisiti di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="39abe-126">When you design resiliency, you must understand your availability requirements.</span></span> <span data-ttu-id="39abe-127">Quanto tempo di inattività è accettabile?</span><span class="sxs-lookup"><span data-stu-id="39abe-127">How much downtime is acceptable?</span></span> <span data-ttu-id="39abe-128">La risposta è in parte in funzione dei costi.</span><span class="sxs-lookup"><span data-stu-id="39abe-128">This is partly a function of cost.</span></span> <span data-ttu-id="39abe-129">Quanto costa un potenziale tempo di inattività all'azienda?</span><span class="sxs-lookup"><span data-stu-id="39abe-129">How much will potential downtime cost your business?</span></span> <span data-ttu-id="39abe-130">Quanto si dovrebbe investire per rendere l'applicazione a disponibilità elevata?</span><span class="sxs-lookup"><span data-stu-id="39abe-130">How much should you invest in making the application highly available?</span></span> <span data-ttu-id="39abe-131">È necessario anche definire cosa significa che l'applicazione debba essere disponibile.</span><span class="sxs-lookup"><span data-stu-id="39abe-131">You also have to define what it means for the application to be available.</span></span> <span data-ttu-id="39abe-132">Ad esempio, se un cliente può inviare un ordine, ma il sistema non è in grado di elaborarlo nel normale intervallo di tempo, si può dire che l'applicazione non sia disponibile?</span><span class="sxs-lookup"><span data-stu-id="39abe-132">For example, is the application "down" if a customer can submit an order but the system cannot process it within the normal timeframe?</span></span> <span data-ttu-id="39abe-133">È necessario anche considerare le probabilità che un tipo particolare di interruzione si verifichi e se sia conveniente una strategia di mitigazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-133">Also consider the probability of a particular type of outage occurring, and whether a mitigation strategy is cost-effective.</span></span>

<span data-ttu-id="39abe-134">Un altro termine comune è la **continuità aziendale**, cioè la capacità di eseguire funzioni di business essenziali durante e dopo il verificarsi di condizioni avverse, come una calamità naturale o l'inattività di un servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-134">Another common term is **business continuity** (BC), which is the ability to perform essential business functions during and after adverse conditions, such as a natural disaster or a downed service.</span></span> <span data-ttu-id="39abe-135">La continuità aziendale copre tutte le operazioni di un'azienda, tra cui le strutture fisiche, le persone, le comunicazioni, i trasporti e i servizi IT.</span><span class="sxs-lookup"><span data-stu-id="39abe-135">BC covers the entire operation of the business, including physical facilities, people, communications, transportation, and IT.</span></span> <span data-ttu-id="39abe-136">Questo articolo si focalizza sulle applicazioni cloud, ma la pianificazione della resilienza deve essere eseguita nel contesto dei requisiti complessivi della continuità aziendale.</span><span class="sxs-lookup"><span data-stu-id="39abe-136">This article focuses on cloud applications, but resilience planning must be done in the context of overall BC requirements.</span></span> 

<span data-ttu-id="39abe-137">Il **backup dei dati** costituisce una parte essenziale del ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="39abe-137">**Data backup** is a critical part of DR.</span></span> <span data-ttu-id="39abe-138">In caso di errore nei componenti senza stato di un'applicazione, è comunque possibile ridistribuirli.</span><span class="sxs-lookup"><span data-stu-id="39abe-138">If the stateless components of an application fail, you can always redeploy them.</span></span> <span data-ttu-id="39abe-139">Ma se si verificano perdite di dati, non è possibile riportare il sistema a uno stato stabile.</span><span class="sxs-lookup"><span data-stu-id="39abe-139">But if data is lost, the system can't return to a stable state.</span></span> <span data-ttu-id="39abe-140">In caso di un'emergenza a livello di area, è necessario eseguire il backup dei dati, possibilmente in un'area diversa.</span><span class="sxs-lookup"><span data-stu-id="39abe-140">Data must be backed up, ideally in a different region in case of a region-wide disaster.</span></span> 

<span data-ttu-id="39abe-141">Il backup è un'operazione diversa rispetto alla **replica dei dati**.</span><span class="sxs-lookup"><span data-stu-id="39abe-141">Backup is distinct from **data replication**.</span></span> <span data-ttu-id="39abe-142">La replica dei dati implica la copia dei dati quasi in tempo reale, in modo che il sistema possa effettuare rapidamente il failover a una replica.</span><span class="sxs-lookup"><span data-stu-id="39abe-142">Data replication involves copying data in near-real-time, so that the system can fail over quickly to a replica.</span></span> <span data-ttu-id="39abe-143">Molti sistemi di database supportano la replica, ad esempio SQL Server supporta i gruppi di disponibilità Always On di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="39abe-143">Many databases systems support replication; for example, SQL Server supports SQL Server Always On Availability Groups.</span></span> <span data-ttu-id="39abe-144">La funzionalità di replica dei dati può ridurre il tempo necessario per il ripristino da un'interruzione, garantendo la disponibilità costante di una replica dei dati,</span><span class="sxs-lookup"><span data-stu-id="39abe-144">Data replication can reduce how long it takes to recover from an outage, by ensuring that a replica of the data is always standing by.</span></span> <span data-ttu-id="39abe-145">ma non offre alcuna protezione in caso di errore umano.</span><span class="sxs-lookup"><span data-stu-id="39abe-145">However, data replication won't protect against human error.</span></span> <span data-ttu-id="39abe-146">Se i dati risultano danneggiati a causa di un errore umano, vengono comunque copiati nelle repliche.</span><span class="sxs-lookup"><span data-stu-id="39abe-146">If data gets corrupted because of human error, the corrupted data just gets copied to the replicas.</span></span> <span data-ttu-id="39abe-147">È quindi necessario includere comunque il backup a lungo termine nella strategia di ripristino di emergenza.</span><span class="sxs-lookup"><span data-stu-id="39abe-147">Therefore, you still need to include long-term backup in your DR strategy.</span></span> 

## <a name="process-to-achieve-resiliency"></a><span data-ttu-id="39abe-148">Processo per ottenere la resilienza</span><span class="sxs-lookup"><span data-stu-id="39abe-148">Process to achieve resiliency</span></span>
<span data-ttu-id="39abe-149">La resilienza non è un componente aggiuntivo,</span><span class="sxs-lookup"><span data-stu-id="39abe-149">Resiliency is not an add-on.</span></span> <span data-ttu-id="39abe-150">ma deve essere progettata nel sistema e messa in pratica operativa.</span><span class="sxs-lookup"><span data-stu-id="39abe-150">It must be designed into the system and put into operational practice.</span></span> <span data-ttu-id="39abe-151">Di seguito è riportato un modello generale da seguire:</span><span class="sxs-lookup"><span data-stu-id="39abe-151">Here is a general model to follow:</span></span>

1. <span data-ttu-id="39abe-152">**Definire** i requisiti di disponibilità in base alle esigenze aziendali.</span><span class="sxs-lookup"><span data-stu-id="39abe-152">**Define** your availability requirements, based on business needs.</span></span>
2. <span data-ttu-id="39abe-153">**Progettare** l'applicazione ai fini della resilienza:</span><span class="sxs-lookup"><span data-stu-id="39abe-153">**Design** the application for resiliency.</span></span> <span data-ttu-id="39abe-154">iniziare con un'architettura che segue procedure comprovate e quindi identificare i possibili punti di errore presenti.</span><span class="sxs-lookup"><span data-stu-id="39abe-154">Start with an architecture that follows proven practices, and then identify the possible failure points in that architecture.</span></span>
3. <span data-ttu-id="39abe-155">**Implementare** strategie per rilevare e correggere gli errori.</span><span class="sxs-lookup"><span data-stu-id="39abe-155">**Implement** strategies to detect and recover from failures.</span></span> 
4. <span data-ttu-id="39abe-156">**Testare** l'implementazione attraverso la simulazione di errori e l'attivazione di failover forzati.</span><span class="sxs-lookup"><span data-stu-id="39abe-156">**Test** the implementation by simulating faults and triggering forced failovers.</span></span> 
5. <span data-ttu-id="39abe-157">**Distribuire** l'applicazione nell'ambiente di produzione servendosi di un processo ripetibile e affidabile.</span><span class="sxs-lookup"><span data-stu-id="39abe-157">**Deploy** the application into production using a reliable, repeatable process.</span></span> 
6. <span data-ttu-id="39abe-158">**Monitorare** l'applicazione per rilevare gli errori:</span><span class="sxs-lookup"><span data-stu-id="39abe-158">**Monitor** the application to detect failures.</span></span> <span data-ttu-id="39abe-159">monitorando il sistema, è possibile misurare l'integrità dell'applicazione e rispondere agli eventi imprevisti, se necessario.</span><span class="sxs-lookup"><span data-stu-id="39abe-159">By monitoring the system, you can gauge the health of the application and respond to incidents if necessary.</span></span> 
7. <span data-ttu-id="39abe-160">**Rispondere** se si verificano errori che richiedono interventi manuali.</span><span class="sxs-lookup"><span data-stu-id="39abe-160">**Respond** if there are failure that require manual interventions.</span></span>

<span data-ttu-id="39abe-161">Nella parte restante di questo articolo verrà approfondito più nel dettaglio ognuno di questi passaggi.</span><span class="sxs-lookup"><span data-stu-id="39abe-161">In the remainder of this article, we discuss each of these steps in more detail.</span></span>

## <a name="define-your-availability-requirements"></a><span data-ttu-id="39abe-162">Definire i requisiti di disponibilità</span><span class="sxs-lookup"><span data-stu-id="39abe-162">Define your availability requirements</span></span>
<span data-ttu-id="39abe-163">La pianificazione della resilienza inizia con i requisiti aziendali.</span><span class="sxs-lookup"><span data-stu-id="39abe-163">Resiliency planning starts with business requirements.</span></span> <span data-ttu-id="39abe-164">Di seguito sono illustrati alcuni approcci per considerare la resilienza in questi termini.</span><span class="sxs-lookup"><span data-stu-id="39abe-164">Here are some approaches for thinking about resiliency in those terms.</span></span>

### <a name="decompose-by-workload"></a><span data-ttu-id="39abe-165">Scomporre in base al carico di lavoro</span><span class="sxs-lookup"><span data-stu-id="39abe-165">Decompose by workload</span></span>
<span data-ttu-id="39abe-166">Molte soluzioni cloud sono composte da carichi di lavoro di più applicazioni.</span><span class="sxs-lookup"><span data-stu-id="39abe-166">Many cloud solutions consist of multiple application workloads.</span></span> <span data-ttu-id="39abe-167">Il termine "carico di lavoro" in questo contesto indica una capacità discreta, o attività di elaborazione, che può essere logicamente separata da altre attività, in termini di requisiti di logica di business e di archiviazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="39abe-167">The term "workload" in this context means a discrete capability or computing task, which can be logically separated from other tasks, in terms of business logic and data storage requirements.</span></span> <span data-ttu-id="39abe-168">Per esempio, un'applicazione di e-commerce potrebbe includere i carichi di lavoro seguenti:</span><span class="sxs-lookup"><span data-stu-id="39abe-168">For example, an e-commerce app might include the following workloads:</span></span>

* <span data-ttu-id="39abe-169">Esplorare e cercare un catalogo di prodotti.</span><span class="sxs-lookup"><span data-stu-id="39abe-169">Browse and search a product catalog.</span></span>
* <span data-ttu-id="39abe-170">Creare e tenere traccia degli ordini.</span><span class="sxs-lookup"><span data-stu-id="39abe-170">Create and track orders.</span></span>
* <span data-ttu-id="39abe-171">Visualizzare le raccomandazioni.</span><span class="sxs-lookup"><span data-stu-id="39abe-171">View recommendations.</span></span>

<span data-ttu-id="39abe-172">Questi carichi di lavoro potrebbero avere requisiti diversi di disponibilità, scalabilità, coerenza dei dati, ripristino di emergenza e così via.</span><span class="sxs-lookup"><span data-stu-id="39abe-172">These workloads might have different requirements for availability, scalability, data consistency, disaster recovery, and so forth.</span></span> <span data-ttu-id="39abe-173">Ancora una volta, si tratta di decisioni aziendali.</span><span class="sxs-lookup"><span data-stu-id="39abe-173">Again, these are business decisions.</span></span>

<span data-ttu-id="39abe-174">È necessario considerare anche i modelli di utilizzo:</span><span class="sxs-lookup"><span data-stu-id="39abe-174">Also consider usage patterns.</span></span> <span data-ttu-id="39abe-175">esistono determinati periodi critici in cui il sistema deve essere disponibile?</span><span class="sxs-lookup"><span data-stu-id="39abe-175">Are there certain critical periods when the system must be available?</span></span> <span data-ttu-id="39abe-176">Ad esempio, un servizio di dichiarazione dei redditi non può interrompersi proprio prima della scadenza, o ancora, un servizio di streaming video deve rimanere in piedi durante un grande evento sportivo e così via.</span><span class="sxs-lookup"><span data-stu-id="39abe-176">For example, a tax-filing service can't go down right before the filing deadline, a video streaming service must stay up during a big sports event, and so on.</span></span> <span data-ttu-id="39abe-177">Durante i periodi critici, potrebbero esserci distribuzioni ridondanti in più aree, perciò l'applicazione potrebbe effettuare il failover se si presentano errori in un'area.</span><span class="sxs-lookup"><span data-stu-id="39abe-177">During the critical periods, you might have redundant deployments across several regions, so the application could fail over if one region failed.</span></span> <span data-ttu-id="39abe-178">Tuttavia, una distribuzione in più aree è più costosa, perciò, nei periodi meno critici, si potrebbe eseguire l'applicazione in una sola area.</span><span class="sxs-lookup"><span data-stu-id="39abe-178">However, a multi-region deployment is more expensive, so during less critical times, you might run the application in a single region.</span></span>

### <a name="rto-and-rpo"></a><span data-ttu-id="39abe-179">RTO e RPO</span><span class="sxs-lookup"><span data-stu-id="39abe-179">RTO and RPO</span></span>
<span data-ttu-id="39abe-180">Due metriche importanti da considerare sono l'obiettivo del tempo di ripristino e l'obiettivo del punto di ripristino.</span><span class="sxs-lookup"><span data-stu-id="39abe-180">Two important metrics to consider are the recovery time objective and recovery point objective.</span></span>

* <span data-ttu-id="39abe-181">L'**obiettivo del tempo di ripristino** (RTO) è il tempo massimo accettabile che un'applicazione non sia disponibile dopo un evento imprevisto.</span><span class="sxs-lookup"><span data-stu-id="39abe-181">**Recovery time objective** (RTO) is the maximum acceptable time that an application can be unavailable after an incident.</span></span> <span data-ttu-id="39abe-182">Se l'obiettivo RTO è di 90 minuti, è necessario essere in grado di ripristinare l'applicazione a uno stato di esecuzione entro 90 minuti dall'inizio di un'emergenza.</span><span class="sxs-lookup"><span data-stu-id="39abe-182">If your RTO is 90 minutes, you must be able to restore the application to a running state within 90 minutes from the start of a disaster.</span></span> <span data-ttu-id="39abe-183">Se si ha un obiettivo RTO basso, si potrebbe tenere una seconda distribuzione continuamente eseguita in standby, per prevenire un'interruzione di area.</span><span class="sxs-lookup"><span data-stu-id="39abe-183">If you have a very low RTO, you might keep a second deployment continually running on standby, to protect against a regional outage.</span></span>

* <span data-ttu-id="39abe-184">**Obiettivo del punto di ripristino** (RPO) è la durata massima di perdita dei dati accettabile durante un'emergenza.</span><span class="sxs-lookup"><span data-stu-id="39abe-184">**Recovery point objective** (RPO) is the maximum duration of data loss that is acceptable during a disaster.</span></span> <span data-ttu-id="39abe-185">Per esempio, se si archiviano i dati in un singolo database, senza replica in altri database, e si eseguono backup orari, si potrebbero perdere fino a un'ora di dati.</span><span class="sxs-lookup"><span data-stu-id="39abe-185">For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data.</span></span> 

<span data-ttu-id="39abe-186">Gli obiettivi RTO e RPO sono requisiti aziendali.</span><span class="sxs-lookup"><span data-stu-id="39abe-186">RTO and RPO are business requirements.</span></span> <span data-ttu-id="39abe-187">Condurre una valutazione dei rischi consente di definire gli obiettivi RTO e RPO dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-187">Conducting a risk assessment can help you define the application's RTO and RPO.</span></span> <span data-ttu-id="39abe-188">Un'altra metrica comune è il **tempo medio per il ripristino** (MTTR), ovvero il tempo medio impiegato per ripristinare l'applicazione dopo un errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-188">Another common metric is **mean time to recover** (MTTR), which is the average time that it takes to restore the application after a failure.</span></span> <span data-ttu-id="39abe-189">Il tempo medio per il ripristino è un fatto empirico relativo a un sistema.</span><span class="sxs-lookup"><span data-stu-id="39abe-189">MTTR is an empirical fact about a system.</span></span> <span data-ttu-id="39abe-190">Se questo tempo supera l'obiettivo RTO, di conseguenza un errore di sistema causerà un'interruzione delle attività inaccettabile, poiché non sarà possibile ripristinare il sistema entro l'obiettivo RTO definito.</span><span class="sxs-lookup"><span data-stu-id="39abe-190">If MTTR exceeds the RTO, then a failure in the system will cause an unacceptable business disruption, because it won't be possible to restore the system within the defined RTO.</span></span> 

### <a name="slas"></a><span data-ttu-id="39abe-191">Contratti di servizio</span><span class="sxs-lookup"><span data-stu-id="39abe-191">SLAs</span></span>
<span data-ttu-id="39abe-192">In Azure i [Contratti di servizio][sla] descrivono gli impegni di Microsoft in merito a tempi di attività e connettività.</span><span class="sxs-lookup"><span data-stu-id="39abe-192">In Azure, the [Service Level Agreement][sla] (SLA) describes Microsoft’s commitments for uptime and connectivity.</span></span> <span data-ttu-id="39abe-193">Se il contratto per un determinato servizio è del 99,9%, significa che è necessario prevedere che il servizio sia disponibile per il 99,9% del tempo.</span><span class="sxs-lookup"><span data-stu-id="39abe-193">If the SLA for a particular service is 99.9%, it means you should expect the service to be available 99.9% of the time.</span></span>

> [!NOTE]
> <span data-ttu-id="39abe-194">Il contratto di servizio di Azure include non solo indicazioni per ottenere un credito per il servizio qualora il contratto di servizio non venga soddisfatto, ma anche definizioni specifiche di "disponibilità" per ogni servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-194">The Azure SLA also includes provisions for obtaining a service credit if the SLA is not met, along with specific definitions of "availability" for each service.</span></span> <span data-ttu-id="39abe-195">Questo aspetto del contratto di servizio funge da criterio di imposizione.</span><span class="sxs-lookup"><span data-stu-id="39abe-195">That aspect of the SLA acts as an enforcement policy.</span></span> 
> 
> 

<span data-ttu-id="39abe-196">È necessario definire i propri contratti di servizio di destinazione per ogni carico di lavoro nella propria soluzione.</span><span class="sxs-lookup"><span data-stu-id="39abe-196">You should define your own target SLAs for each workload in your solution.</span></span> <span data-ttu-id="39abe-197">Un contratto di servizio consente di valutare se l'architettura soddisfi i requisiti aziendali.</span><span class="sxs-lookup"><span data-stu-id="39abe-197">An SLA makes it possible to evaluate whether the architecture meets the business requirements.</span></span> <span data-ttu-id="39abe-198">Ad esempio, se un carico di lavoro richiede il 99,99% del tempo di attività, ma dipende da un servizio con un contratto del 99,9%, tale servizio non può essere un punto singolo di errore nel sistema.</span><span class="sxs-lookup"><span data-stu-id="39abe-198">For example, if a workload requires 99.99% uptime, but depends on a service with a 99.9% SLA, that service cannot be a single-point of failure in the system.</span></span> <span data-ttu-id="39abe-199">Un rimedio è avere un percorso di fallback nel caso in cui il servizio si interrompa, o intraprenda altre misure per il correggere un errore nel servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-199">One remedy is to have a fallback path in case the service fails, or take other measures to recover from a failure in that service.</span></span> 

<span data-ttu-id="39abe-200">La tabella seguente illustra il potenziale tempo totale di inattività per vari livelli di contratto di servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-200">The following table shows the potential cumulative downtime for various SLA levels.</span></span> 

| <span data-ttu-id="39abe-201">Contratto di servizio</span><span class="sxs-lookup"><span data-stu-id="39abe-201">SLA</span></span> | <span data-ttu-id="39abe-202">Tempo di inattività settimanale</span><span class="sxs-lookup"><span data-stu-id="39abe-202">Downtime per week</span></span> | <span data-ttu-id="39abe-203">Tempo di inattività mensile</span><span class="sxs-lookup"><span data-stu-id="39abe-203">Downtime per month</span></span> | <span data-ttu-id="39abe-204">Tempo di inattività annuale</span><span class="sxs-lookup"><span data-stu-id="39abe-204">Downtime per year</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="39abe-205">99%</span><span class="sxs-lookup"><span data-stu-id="39abe-205">99%</span></span> |<span data-ttu-id="39abe-206">1,68 ore</span><span class="sxs-lookup"><span data-stu-id="39abe-206">1.68 hours</span></span> |<span data-ttu-id="39abe-207">7,2 ore</span><span class="sxs-lookup"><span data-stu-id="39abe-207">7.2 hours</span></span> |<span data-ttu-id="39abe-208">3,65 giorni</span><span class="sxs-lookup"><span data-stu-id="39abe-208">3.65 days</span></span> |
| <span data-ttu-id="39abe-209">99,9%</span><span class="sxs-lookup"><span data-stu-id="39abe-209">99.9%</span></span> |<span data-ttu-id="39abe-210">10,1 minuti</span><span class="sxs-lookup"><span data-stu-id="39abe-210">10.1 minutes</span></span> |<span data-ttu-id="39abe-211">43,2 minuti</span><span class="sxs-lookup"><span data-stu-id="39abe-211">43.2 minutes</span></span> |<span data-ttu-id="39abe-212">8,76 ore</span><span class="sxs-lookup"><span data-stu-id="39abe-212">8.76 hours</span></span> |
| <span data-ttu-id="39abe-213">99,95%</span><span class="sxs-lookup"><span data-stu-id="39abe-213">99.95%</span></span> |<span data-ttu-id="39abe-214">5 minuti</span><span class="sxs-lookup"><span data-stu-id="39abe-214">5 minutes</span></span> |<span data-ttu-id="39abe-215">21,6 minuti</span><span class="sxs-lookup"><span data-stu-id="39abe-215">21.6 minutes</span></span> |<span data-ttu-id="39abe-216">4,38 ore</span><span class="sxs-lookup"><span data-stu-id="39abe-216">4.38 hours</span></span> |
| <span data-ttu-id="39abe-217">99,99%</span><span class="sxs-lookup"><span data-stu-id="39abe-217">99.99%</span></span> |<span data-ttu-id="39abe-218">1,01 minuti</span><span class="sxs-lookup"><span data-stu-id="39abe-218">1.01 minutes</span></span> |<span data-ttu-id="39abe-219">4,32 minuti</span><span class="sxs-lookup"><span data-stu-id="39abe-219">4.32 minutes</span></span> |<span data-ttu-id="39abe-220">52,56 minuti</span><span class="sxs-lookup"><span data-stu-id="39abe-220">52.56 minutes</span></span> |
| <span data-ttu-id="39abe-221">99,999%</span><span class="sxs-lookup"><span data-stu-id="39abe-221">99.999%</span></span> |<span data-ttu-id="39abe-222">6 secondi</span><span class="sxs-lookup"><span data-stu-id="39abe-222">6 seconds</span></span> |<span data-ttu-id="39abe-223">25,9 secondi</span><span class="sxs-lookup"><span data-stu-id="39abe-223">25.9 seconds</span></span> |<span data-ttu-id="39abe-224">5,26 minuti</span><span class="sxs-lookup"><span data-stu-id="39abe-224">5.26 minutes</span></span> |

<span data-ttu-id="39abe-225">Naturalmente, a parità di condizioni, una maggiore disponibilità è migliore.</span><span class="sxs-lookup"><span data-stu-id="39abe-225">Of course, higher availability is better, everything else being equal.</span></span> <span data-ttu-id="39abe-226">Tuttavia, quando si cercano di ottenere più 9, i costi e la complessità per raggiungere quel livello di disponibilità aumentano.</span><span class="sxs-lookup"><span data-stu-id="39abe-226">But as you strive for more 9s, the cost and complexity to achieve that level of availability grows.</span></span> <span data-ttu-id="39abe-227">Un tempo di attività pari al 99,99% si traduce in circa 5 minuti di inattività totale al mese.</span><span class="sxs-lookup"><span data-stu-id="39abe-227">An uptime of 99.99% translates to about 5 minutes of total downtime per month.</span></span> <span data-ttu-id="39abe-228">Vale la pena sostenere questa maggiore complessità e questi costi aggiuntivi per raggiungere cinque 9?</span><span class="sxs-lookup"><span data-stu-id="39abe-228">Is it worth the additional complexity and cost to reach five 9s?</span></span> <span data-ttu-id="39abe-229">La risposta dipende dai requisiti aziendali.</span><span class="sxs-lookup"><span data-stu-id="39abe-229">The answer depends on the business requirements.</span></span> 

<span data-ttu-id="39abe-230">Di seguito sono riportate alcune altre considerazioni che emergono quando si definisce un contratto di servizio:</span><span class="sxs-lookup"><span data-stu-id="39abe-230">Here are some other considerations when defining an SLA:</span></span>

* <span data-ttu-id="39abe-231">Per ottenere quattro 9 (99,99%), non ci si può probabilmente basare su un intervento manuale per correggere gli errori.</span><span class="sxs-lookup"><span data-stu-id="39abe-231">To achieve four 9's (99.99%), you probably can't rely on manual intervention to recover from failures.</span></span> <span data-ttu-id="39abe-232">L'applicazione, infatti, deve essere in grado di eseguire automaticamente la diagnosi e la riparazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-232">The application must be self-diagnosing and self-healing.</span></span> 
* <span data-ttu-id="39abe-233">Dopo il quarto 9, è difficile rilevare le interruzioni in modo sufficientemente rapido per soddisfare il contratto di servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-233">Beyond four 9's, it is challenging to detect outages quickly enough to meet the SLA.</span></span>
* <span data-ttu-id="39abe-234">Si pensi all'intervallo di tempo rispetto al quale viene misurato il contratto di servizio:</span><span class="sxs-lookup"><span data-stu-id="39abe-234">Think about the time window that your SLA is measured against.</span></span> <span data-ttu-id="39abe-235">minore è la finestra, più ristretto sarà il livello di tolleranza.</span><span class="sxs-lookup"><span data-stu-id="39abe-235">The smaller the window, the tighter the tolerances.</span></span> <span data-ttu-id="39abe-236">Probabilmente non ha senso definire il contratto di servizio in termini di tempo di attività oraria o giornaliera.</span><span class="sxs-lookup"><span data-stu-id="39abe-236">It probably doesn't make sense to define your SLA in terms of hourly or daily uptime.</span></span> 

### <a name="composite-slas"></a><span data-ttu-id="39abe-237">Contratti di servizio compositi</span><span class="sxs-lookup"><span data-stu-id="39abe-237">Composite SLAs</span></span>
<span data-ttu-id="39abe-238">Si consideri un'app Web del servizio app che scrive nel database SQL di Azure.</span><span class="sxs-lookup"><span data-stu-id="39abe-238">Consider an App Service web app that writes to Azure SQL Database.</span></span> <span data-ttu-id="39abe-239">Al momento della redazione del presente documento, tali servizi Azure dispongono dei contratti di servizio seguenti:</span><span class="sxs-lookup"><span data-stu-id="39abe-239">At the time of this writing, these Azure services have the following SLAs:</span></span>

* <span data-ttu-id="39abe-240">App Web del servizio app = 99,95%</span><span class="sxs-lookup"><span data-stu-id="39abe-240">App Service Web Apps = 99.95%</span></span>
* <span data-ttu-id="39abe-241">Database SQL = 99,99%</span><span class="sxs-lookup"><span data-stu-id="39abe-241">SQL Database = 99.99%</span></span>

![Contratto di servizio composito](./images/sla1.png)

<span data-ttu-id="39abe-243">A quanto corrisponde il tempo di inattività massimo che ci si aspetta da questa applicazione?</span><span class="sxs-lookup"><span data-stu-id="39abe-243">What is the maximum downtime you would expect for this application?</span></span> <span data-ttu-id="39abe-244">Se il servizio presenta errori, di conseguenza l'intera applicazione presenterà errori.</span><span class="sxs-lookup"><span data-stu-id="39abe-244">If either service fails, the whole application fails.</span></span> <span data-ttu-id="39abe-245">In generale, la probabilità di interruzione di ogni servizio è indipendente, pertanto il contratto di servizio composito per l'applicazione è pari a 99,95% &times; 99,99% = 99,94%.</span><span class="sxs-lookup"><span data-stu-id="39abe-245">In general, the probability of each service failing is independent, so the composite SLA for this application is 99.95% &times; 99.99% = 99.94%.</span></span> <span data-ttu-id="39abe-246">Questa percentuale è inferiore ai singoli contratti di servizio e questo non è sorprendente, poiché un'applicazione che si basa su più servizi ha anche più punti di errore potenziali.</span><span class="sxs-lookup"><span data-stu-id="39abe-246">That's lower than the individual SLAs, which isn't surprising, because an application that relies on multiple services has more potential failure points.</span></span> 

<span data-ttu-id="39abe-247">D'altra parte, è possibile migliorare il contratto di servizio composito creando percorsi di fallback indipendenti.</span><span class="sxs-lookup"><span data-stu-id="39abe-247">On the other hand, you can improve the composite SLA by creating independent fallback paths.</span></span> <span data-ttu-id="39abe-248">Ad esempio, se il database SQL non è disponibile, inserire le transazioni in una coda, in modo tale che vengano elaborate successivamente.</span><span class="sxs-lookup"><span data-stu-id="39abe-248">For example, if SQL Database is unavailable, put transactions into a queue, to be processed later.</span></span>

![Contratto di servizio composito](./images/sla2.png)

<span data-ttu-id="39abe-250">Con questa struttura, l'applicazione è ancora disponibile anche se non si può connettere al database.</span><span class="sxs-lookup"><span data-stu-id="39abe-250">With this design, the application is still available even if it can't connect to the database.</span></span> <span data-ttu-id="39abe-251">Tuttavia, se la coda e il database si interrompono allo stesso tempo, l'applicazione si interromperà.</span><span class="sxs-lookup"><span data-stu-id="39abe-251">However, it fails if the database and the queue both fail at the same time.</span></span> <span data-ttu-id="39abe-252">La percentuale di tempo prevista per un errore simultaneo è pari a 0,0001 &times; 0,001 e perciò il contratto di servizio composito per questo percorso combinato equivale a:</span><span class="sxs-lookup"><span data-stu-id="39abe-252">The expected percentage of time for a simultaneous failure is 0.0001 &times; 0.001, so the composite SLA for this combined path is:</span></span>  

* <span data-ttu-id="39abe-253">Database O coda = 1,0 &minus; (0,0001 &times; 0,001) = 99,99999%</span><span class="sxs-lookup"><span data-stu-id="39abe-253">Database OR queue = 1.0 &minus; (0.0001 &times; 0.001) = 99.99999%</span></span>

<span data-ttu-id="39abe-254">Il contratto di servizio composito totale è:</span><span class="sxs-lookup"><span data-stu-id="39abe-254">The total composite SLA is:</span></span>

* <span data-ttu-id="39abe-255">App Web E (database O coda) = 99,95% &times; 99,99999% = ~99,95%</span><span class="sxs-lookup"><span data-stu-id="39abe-255">Web app AND (database OR queue) = 99.95% &times; 99.99999% = ~99.95%</span></span>

<span data-ttu-id="39abe-256">Ci sono, però, compromessi a questo approccio.</span><span class="sxs-lookup"><span data-stu-id="39abe-256">But there are tradeoffs to this approach.</span></span> <span data-ttu-id="39abe-257">La logica dell'applicazione è più complessa, si sta pagando per la coda e ci possono essere problemi di coerenza dei dati da considerare.</span><span class="sxs-lookup"><span data-stu-id="39abe-257">The application logic is more complex, you are paying for the queue, and there may be data consistency issues to consider.</span></span>

<span data-ttu-id="39abe-258">**Contratto di servizio per distribuzioni in più aree**.</span><span class="sxs-lookup"><span data-stu-id="39abe-258">**SLA for multi-region deployments**.</span></span> <span data-ttu-id="39abe-259">Un'altra tecnica a disponibilità elevata consiste nel distribuire l'applicazione in più aree e usare Gestione traffico di Azure per effettuare il failover, se l'applicazione si interrompe in un'unica area.</span><span class="sxs-lookup"><span data-stu-id="39abe-259">Another HA technique is to deploy the application in more than one region, and use Azure Traffic Manager to fail over if the application fails in one region.</span></span> <span data-ttu-id="39abe-260">Per una distribuzione in due aree, il contratto di servizio è calcolato come segue.</span><span class="sxs-lookup"><span data-stu-id="39abe-260">For a two-region deployment, the composite SLA is calculated as follows.</span></span> 

<span data-ttu-id="39abe-261">Si consideri *N* come il contratto di servizio composito per l'applicazione distribuita in un'area.</span><span class="sxs-lookup"><span data-stu-id="39abe-261">Let *N* be the composite SLA for the application deployed in one region.</span></span> <span data-ttu-id="39abe-262">La probabilità prevista che l'applicazione si interrompa allo stesso tempo in entrambe le aree equivale a (1 &minus; N) &times; (1 &minus; N).</span><span class="sxs-lookup"><span data-stu-id="39abe-262">The expected chance that the application will fail in both regions at the same time is (1 &minus; N) &times; (1 &minus; N).</span></span> <span data-ttu-id="39abe-263">Di conseguenza:</span><span class="sxs-lookup"><span data-stu-id="39abe-263">Therefore,</span></span>

* <span data-ttu-id="39abe-264">Contratto di servizio combinato per entrambe le aree = 1 &minus; (1 &minus; N)(1 &minus; N) = N + (1 &minus; N)N</span><span class="sxs-lookup"><span data-stu-id="39abe-264">Combined SLA for both regions = 1 &minus; (1 &minus; N)(1 &minus; N) = N + (1 &minus; N)N</span></span>

<span data-ttu-id="39abe-265">Infine, è necessario tenere in considerazione il [Contratto di Servizio per Gestione traffico][tm-sla].</span><span class="sxs-lookup"><span data-stu-id="39abe-265">Finally, you must factor in the [SLA for Traffic Manager][tm-sla].</span></span> <span data-ttu-id="39abe-266">Al momento della redazione del presente documento, il contratto di servizio per Gestione traffico è pari a 99,99%.</span><span class="sxs-lookup"><span data-stu-id="39abe-266">At the time of this writing, the SLA for Traffic Manager SLA is 99.99%.</span></span>

* <span data-ttu-id="39abe-267">Contratto di servizio composito = 99,99% &times; (contratto di servizio combinato per entrambe le aree)</span><span class="sxs-lookup"><span data-stu-id="39abe-267">Composite SLA = 99.99% &times; (combined SLA for both regions)</span></span>

<span data-ttu-id="39abe-268">In aggiunta, l'esecuzione del failover non è istantanea e può causare periodi di inattività durante un failover.</span><span class="sxs-lookup"><span data-stu-id="39abe-268">Also, failing over is not instantaneous and can result in some downtime during a failover.</span></span> <span data-ttu-id="39abe-269">Vedere [Monitoraggio degli endpoint di Gestione traffico][tm-failover].</span><span class="sxs-lookup"><span data-stu-id="39abe-269">See [Traffic Manager endpoint monitoring and failover][tm-failover].</span></span>

<span data-ttu-id="39abe-270">Il numero calcolato dei contratti di servizio è una baseline utile, ma non fornisce tutte le informazioni riguardanti la disponibilità.</span><span class="sxs-lookup"><span data-stu-id="39abe-270">The calculated SLA number is a useful baseline, but it doesn't tell the whole story about availability.</span></span> <span data-ttu-id="39abe-271">Spesso un'applicazione può ridurre le prestazioni in modo non drastico e graduale nel caso di errore di un percorso non critico.</span><span class="sxs-lookup"><span data-stu-id="39abe-271">Often, an application can degrade gracefully when a non-critical path fails.</span></span> <span data-ttu-id="39abe-272">Si consideri un'applicazione in cui viene visualizzato un catalogo di libri.</span><span class="sxs-lookup"><span data-stu-id="39abe-272">Consider an application that shows a catalog of books.</span></span> <span data-ttu-id="39abe-273">Nel caso in cui l'applicazione non possa recuperare l'immagine di anteprima di una copertina, si potrebbe visualizzare un'immagine segnaposto.</span><span class="sxs-lookup"><span data-stu-id="39abe-273">If the application can't retrieve the thumbnail image for the cover, it might show a placeholder image.</span></span> <span data-ttu-id="39abe-274">In tal caso, l'errore nell'ottenimento dell'immagine non riduce i tempi di attività dell'applicazione, sebbene condizioni l'esperienza utente.</span><span class="sxs-lookup"><span data-stu-id="39abe-274">In that case, failing to get the image does not reduce the application's uptime, although it affects the user experience.</span></span>  

## <a name="design-for-resiliency"></a><span data-ttu-id="39abe-275">Progettare per la resilienza</span><span class="sxs-lookup"><span data-stu-id="39abe-275">Design for resiliency</span></span>

<span data-ttu-id="39abe-276">Durante la fase di progettazione, è consigliabile eseguire un'analisi della modalità di errore (FMA).</span><span class="sxs-lookup"><span data-stu-id="39abe-276">During the design phase, you should perform a failure mode analysis (FMA).</span></span> <span data-ttu-id="39abe-277">L'obiettivo di quest'analisi è di identificare i possibili punti di errore e definire il modo in cui l'applicazione risponde a tali errori.</span><span class="sxs-lookup"><span data-stu-id="39abe-277">The goal of an FMA is to identify possible points of failure, and define how the application will respond to those failures.</span></span>

* <span data-ttu-id="39abe-278">Come rileverà l'applicazione questo tipo di errore?</span><span class="sxs-lookup"><span data-stu-id="39abe-278">How will the application detect this type of failure?</span></span>
* <span data-ttu-id="39abe-279">Come risponderà l'applicazione a questo tipo di errore?</span><span class="sxs-lookup"><span data-stu-id="39abe-279">How will the application respond to this type of failure?</span></span>
* <span data-ttu-id="39abe-280">Come si potrà registrare e monitorare questo tipo di errore?</span><span class="sxs-lookup"><span data-stu-id="39abe-280">How will you log and monitor this type of failure?</span></span> 

<span data-ttu-id="39abe-281">Per altre informazioni sul processo dell'analisi FMA, con indicazioni specifiche per Azure, vedere [Azure resiliency guidance: Failure mode analysis][fma] (Guida alla resilienza di Azure: analisi della modalità di errore).</span><span class="sxs-lookup"><span data-stu-id="39abe-281">For more information about the FMA process, with specific recommendations for Azure, see [Azure resiliency guidance: Failure mode analysis][fma].</span></span>

### <a name="example-of-identifying-failure-modes-and-detection-strategy"></a><span data-ttu-id="39abe-282">Esempio di identificazione di modalità di errore e di strategia di rilevamento</span><span class="sxs-lookup"><span data-stu-id="39abe-282">Example of identifying failure modes and detection strategy</span></span>
<span data-ttu-id="39abe-283">**Punto di errore:** Chiamata a un servizio Web / API esterno</span><span class="sxs-lookup"><span data-stu-id="39abe-283">**Failure point:** Call to an external web service / API.</span></span>

| <span data-ttu-id="39abe-284">Modalità di errore</span><span class="sxs-lookup"><span data-stu-id="39abe-284">Failure mode</span></span> | <span data-ttu-id="39abe-285">Strategia di rilevamento</span><span class="sxs-lookup"><span data-stu-id="39abe-285">Detection strategy</span></span> |
| --- | --- |
| <span data-ttu-id="39abe-286">Il servizio non è disponibile</span><span class="sxs-lookup"><span data-stu-id="39abe-286">Service is unavailable</span></span> |<span data-ttu-id="39abe-287">HTTP 5xx</span><span class="sxs-lookup"><span data-stu-id="39abe-287">HTTP 5xx</span></span> |
| <span data-ttu-id="39abe-288">Limitazione</span><span class="sxs-lookup"><span data-stu-id="39abe-288">Throttling</span></span> |<span data-ttu-id="39abe-289">HTTP 429 (Troppe richieste)</span><span class="sxs-lookup"><span data-stu-id="39abe-289">HTTP 429 (Too Many Requests)</span></span> |
| <span data-ttu-id="39abe-290">Authentication</span><span class="sxs-lookup"><span data-stu-id="39abe-290">Authentication</span></span> |<span data-ttu-id="39abe-291">HTTP 401 (Non autorizzato)</span><span class="sxs-lookup"><span data-stu-id="39abe-291">HTTP 401 (Unauthorized)</span></span> |
| <span data-ttu-id="39abe-292">Risposta lenta</span><span class="sxs-lookup"><span data-stu-id="39abe-292">Slow response</span></span> |<span data-ttu-id="39abe-293">Timeout della richiesta</span><span class="sxs-lookup"><span data-stu-id="39abe-293">Request times out</span></span> |


### <a name="redundancy-and-designing-for-failure"></a><span data-ttu-id="39abe-294">Ridondanza e progettazione per gli errori</span><span class="sxs-lookup"><span data-stu-id="39abe-294">Redundancy and designing for failure</span></span>

<span data-ttu-id="39abe-295">L'ambito di impatto degli errori può variare.</span><span class="sxs-lookup"><span data-stu-id="39abe-295">Failures can vary in the scope of their impact.</span></span> <span data-ttu-id="39abe-296">Alcuni errori hardware, come nel caso di un disco danneggiato, possono influire su un singolo computer host.</span><span class="sxs-lookup"><span data-stu-id="39abe-296">Some hardware failures, such as a failed disk, may affect a single host machine.</span></span> <span data-ttu-id="39abe-297">Un commutatore di rete non funzionante può invece influire su un intero rack di server.</span><span class="sxs-lookup"><span data-stu-id="39abe-297">A failed network switch could affect a whole server rack.</span></span> <span data-ttu-id="39abe-298">Gli errori che causano l'interruzione di un intero data center, ad esempio l'interruzione dell'alimentazione in un data center, sono invece meno comuni.</span><span class="sxs-lookup"><span data-stu-id="39abe-298">Less common are failures that disrupt a whole data center, such as loss of power in a data center.</span></span> <span data-ttu-id="39abe-299">Sono infine rari i casi in cui un'intera area risulta non disponibile.</span><span class="sxs-lookup"><span data-stu-id="39abe-299">Rarely, an entire region could become unavailable.</span></span>

<span data-ttu-id="39abe-300">Uno dei principali modi per rendere resiliente un'applicazione consiste nell'applicare la ridondanza.</span><span class="sxs-lookup"><span data-stu-id="39abe-300">One of the main ways to make an application resilient is through redundancy.</span></span> <span data-ttu-id="39abe-301">Ma la ridondanza va pianificata quando si progetta l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-301">But you need to plan for this redundancy when you design the application.</span></span> <span data-ttu-id="39abe-302">Il livello di ridondanza necessario dipende inoltre dai requisiti aziendali: non tutte le applicazioni richiedono la ridondanza tra aree per proteggersi da un'interruzione dell'alimentazione a livello di area.</span><span class="sxs-lookup"><span data-stu-id="39abe-302">Also, the level of redundancy that you need depends on your business requirements &mdash; not every application needs redundancy across regions to guard against a regional outage.</span></span> <span data-ttu-id="39abe-303">In generale, è opportuno trovare il giusto compromesso tra incremento della ridondanza e dell'affidabilità e aumento dei costi e della complessità.</span><span class="sxs-lookup"><span data-stu-id="39abe-303">In general, there is a tradeoff between greater redundancy and reliability versus higher cost and complexity.</span></span>  

<span data-ttu-id="39abe-304">In Azure sono disponibili numerose funzionalità per rendere ridondante un'applicazione a ogni livello di errore, a partire da una singola macchina virtuale fino a un'intera area.</span><span class="sxs-lookup"><span data-stu-id="39abe-304">Azure has a number of features to make an application redundant at every level of failure, from an individual VM to an entire region.</span></span> 

![](./images/redundancy.svg)

<span data-ttu-id="39abe-305">**Singola macchina virtuale**.</span><span class="sxs-lookup"><span data-stu-id="39abe-305">**Single VM**.</span></span> <span data-ttu-id="39abe-306">Azure offre un contratto di servizio relativo al tempo di attività per le singole macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="39abe-306">Azure provides an uptime SLA for single VMs.</span></span> <span data-ttu-id="39abe-307">Anche se è possibile ottenere un contratto di servizio di livello superiore eseguendo due o più macchine virtuali, è possibile che una singola macchina virtuale sia già abbastanza affidabile per alcuni carichi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="39abe-307">Although you can get a higher SLA by running two or more VMs, a single VM may be reliable enough for some workloads.</span></span> <span data-ttu-id="39abe-308">Per i carichi di lavoro di produzione è consigliabile usare due o più macchine virtuali per garantire la ridondanza.</span><span class="sxs-lookup"><span data-stu-id="39abe-308">For production workloads, we recommend using two or more VMs for redundancy.</span></span> 

<span data-ttu-id="39abe-309">**Set di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="39abe-309">**Availability sets**.</span></span> <span data-ttu-id="39abe-310">Per proteggersi da errori hardware localizzati, ad esempio un disco o un commutatore di rete non funzionante, distribuire due o più macchine virtuali in un set di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="39abe-310">To protect against localized hardware failures, such as a disk or network switch failing, deploy two or more VMs in an availability set.</span></span> <span data-ttu-id="39abe-311">Un set di disponibilità è costituito da due o più *domini di errore* che condividono una fonte di alimentazione e uno switch di rete comuni.</span><span class="sxs-lookup"><span data-stu-id="39abe-311">An availability set consists of two or more *fault domains* that share a common power source and network switch.</span></span> <span data-ttu-id="39abe-312">Le macchine virtuali in un set di disponibilità vengono distribuite tra i domini di errore, in modo che, se un dominio di errore è interessato da un errore hardware, il traffico di rete possa comunque essere indirizzato alle macchine virtuali negli altri domini di errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-312">VMs in an availability set are distributed across the fault domains, so if a hardware failure affects one fault domain, network traffic can still be routed the VMs in the other fault domains.</span></span> <span data-ttu-id="39abe-313">Per altre informazioni sui set di disponibilità, vedere [Gestire la disponibilità delle macchine virtuali Windows in Azure](/azure/virtual-machines/windows/manage-availability).</span><span class="sxs-lookup"><span data-stu-id="39abe-313">For more information about Availability Sets, see [Manage the availability of Windows virtual machines in Azure](/azure/virtual-machines/windows/manage-availability).</span></span>

<span data-ttu-id="39abe-314">**Zone di disponibilità**.</span><span class="sxs-lookup"><span data-stu-id="39abe-314">**Availability zones**.</span></span>  <span data-ttu-id="39abe-315">Una zona di disponibilità è una zona fisicamente separata in un'area di Azure.</span><span class="sxs-lookup"><span data-stu-id="39abe-315">An Availability Zone is a physically separate zone within an Azure region.</span></span> <span data-ttu-id="39abe-316">Ogni zona di disponibilità può contare su risorse di alimentazione, rete e raffreddamento a sé.</span><span class="sxs-lookup"><span data-stu-id="39abe-316">Each Availability Zone has a distinct power source, network, and cooling.</span></span> <span data-ttu-id="39abe-317">La distribuzione di macchine virtuali tra zone di disponibilità consente di proteggere un'applicazione in caso di errori a livello di data center.</span><span class="sxs-lookup"><span data-stu-id="39abe-317">Deploying VMs across availability zones helps to protect an application against datacenter-wide failures.</span></span> 

<span data-ttu-id="39abe-318">**Aree associate**.</span><span class="sxs-lookup"><span data-stu-id="39abe-318">**Paired regions**.</span></span> <span data-ttu-id="39abe-319">Per proteggere un'applicazione da un'interruzione dell'alimentazione a livello di area, è possibile distribuire l'applicazione in più aree, tramite Gestione traffico di Microsoft Azure in modo da distribuire il traffico Internet in aree diverse.</span><span class="sxs-lookup"><span data-stu-id="39abe-319">To protect an application against a regional outage, you can deploy the application across multiple regions, using Azure Traffic Manager to distribute internet traffic to the different regions.</span></span> <span data-ttu-id="39abe-320">Ogni area di Azure è associata a un'altra area</span><span class="sxs-lookup"><span data-stu-id="39abe-320">Each Azure region is paired with another region.</span></span> <span data-ttu-id="39abe-321">e la combinazione di queste aree costituisce una [coppia di aree](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="39abe-321">Together, these form a [regional pair](/azure/best-practices-availability-paired-regions).</span></span> <span data-ttu-id="39abe-322">Ad eccezione del Brasile meridionale, le coppie di aree hanno la stessa collocazione geografica in modo da soddisfare i requisiti di residenza dei dati ai fini della giurisdizione per le imposizioni fiscali e normative.</span><span class="sxs-lookup"><span data-stu-id="39abe-322">With the exception of Brazil South, regional pairs are located within the same geography in order to meet data residency requirements for tax and law enforcement jurisdiction purposes.</span></span>

<span data-ttu-id="39abe-323">Quando si progetta un'applicazione con più aree, tenere presente che la latenza di rete tra più aree è superiore rispetto a quella all'interno di una singola area.</span><span class="sxs-lookup"><span data-stu-id="39abe-323">When you design a multi-region application, take into account that network latency across regions is higher than within a region.</span></span> <span data-ttu-id="39abe-324">Se, ad esempio, se si sta eseguendo la replica di un database per abilitare il failover, usare la replica di dati sincrona all'interno di un'area e la replica dei dati asincrona tra aree diverse.</span><span class="sxs-lookup"><span data-stu-id="39abe-324">For example, if you are replicating a database to enable failover, use synchronous data replication within a region, but asynchronous data replication across regions.</span></span>

| &nbsp; | <span data-ttu-id="39abe-325">Set di disponibilità</span><span class="sxs-lookup"><span data-stu-id="39abe-325">Availability Set</span></span> | <span data-ttu-id="39abe-326">Zona di disponibilità</span><span class="sxs-lookup"><span data-stu-id="39abe-326">Availability Zone</span></span> | <span data-ttu-id="39abe-327">Area associata</span><span class="sxs-lookup"><span data-stu-id="39abe-327">Paired region</span></span> |
|--------|------------------|-------------------|---------------|
| <span data-ttu-id="39abe-328">Ambito dell'errore</span><span class="sxs-lookup"><span data-stu-id="39abe-328">Scope of failure</span></span> | <span data-ttu-id="39abe-329">Rack</span><span class="sxs-lookup"><span data-stu-id="39abe-329">Rack</span></span> | <span data-ttu-id="39abe-330">Data center</span><span class="sxs-lookup"><span data-stu-id="39abe-330">Datacenter</span></span> | <span data-ttu-id="39abe-331">Region</span><span class="sxs-lookup"><span data-stu-id="39abe-331">Region</span></span> |
| <span data-ttu-id="39abe-332">Routing delle richieste</span><span class="sxs-lookup"><span data-stu-id="39abe-332">Request routing</span></span> | <span data-ttu-id="39abe-333">Load Balancer</span><span class="sxs-lookup"><span data-stu-id="39abe-333">Load Balancer</span></span> | <span data-ttu-id="39abe-334">Bilanciamento del carico tra zone</span><span class="sxs-lookup"><span data-stu-id="39abe-334">Cross-zone Load Balancer</span></span> | <span data-ttu-id="39abe-335">Gestione traffico</span><span class="sxs-lookup"><span data-stu-id="39abe-335">Traffic Manager</span></span> |
| <span data-ttu-id="39abe-336">Latenza di rete</span><span class="sxs-lookup"><span data-stu-id="39abe-336">Network latency</span></span> | <span data-ttu-id="39abe-337">Molto bassa</span><span class="sxs-lookup"><span data-stu-id="39abe-337">Very low</span></span> | <span data-ttu-id="39abe-338">Basso</span><span class="sxs-lookup"><span data-stu-id="39abe-338">Low</span></span> | <span data-ttu-id="39abe-339">Medio-alta</span><span class="sxs-lookup"><span data-stu-id="39abe-339">Mid to high</span></span> |
| <span data-ttu-id="39abe-340">Rete virtuale</span><span class="sxs-lookup"><span data-stu-id="39abe-340">Virtual network</span></span>  | <span data-ttu-id="39abe-341">VNet</span><span class="sxs-lookup"><span data-stu-id="39abe-341">VNet</span></span> | <span data-ttu-id="39abe-342">VNet</span><span class="sxs-lookup"><span data-stu-id="39abe-342">VNet</span></span> | <span data-ttu-id="39abe-343">Peering reti virtuali tra aree</span><span class="sxs-lookup"><span data-stu-id="39abe-343">Cross-region VNet peering</span></span> |

## <a name="implement-resiliency-strategies"></a><span data-ttu-id="39abe-344">Implementare strategie di resilienza</span><span class="sxs-lookup"><span data-stu-id="39abe-344">Implement resiliency strategies</span></span>
<span data-ttu-id="39abe-345">Questa sezione fornisce un sondaggio su alcune strategie di resilienza comuni.</span><span class="sxs-lookup"><span data-stu-id="39abe-345">This section provides a survey of some common resiliency strategies.</span></span> <span data-ttu-id="39abe-346">La maggior parte di queste sono limitate a una tecnologia particolare.</span><span class="sxs-lookup"><span data-stu-id="39abe-346">Most of these are not limited to a particular technology.</span></span> <span data-ttu-id="39abe-347">Le descrizioni in questa sezione fanno un riepilogo dell'idea generale alla base di ogni tecnica, con collegamenti ad altri documenti.</span><span class="sxs-lookup"><span data-stu-id="39abe-347">The descriptions in this section summarize the general idea behind each technique, with links to further reading.</span></span>

<span data-ttu-id="39abe-348">**Riprovare in caso di errori temporanei**.</span><span class="sxs-lookup"><span data-stu-id="39abe-348">**Retry transient failures**.</span></span> <span data-ttu-id="39abe-349">Gli errori temporanei possono dipendere da una perdita temporanea della connettività di rete, da una connessione a un database eliminato o da un timeout quando un servizio è occupato.</span><span class="sxs-lookup"><span data-stu-id="39abe-349">Transient failures can be caused by momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="39abe-350">Spesso, un errore temporaneo può essere risolto semplicemente eseguendo nuovamente la richiesta.</span><span class="sxs-lookup"><span data-stu-id="39abe-350">Often, a transient failure can be resolved simply by retrying the request.</span></span> <span data-ttu-id="39abe-351">Per molti servizi di Azure, il client SDK implementa automaticamente nuovi tentativi, in modo trasparente al chiamante. Vedere [Retry service specific guidance][retry-service-specific guidance] (Linee guida specifiche del servizio di ripetizione dei tentativi).</span><span class="sxs-lookup"><span data-stu-id="39abe-351">For many Azure services, the client SDK implements automatic retries, in a way that is transparent to the caller; see [Retry service specific guidance][retry-service-specific guidance].</span></span>

<span data-ttu-id="39abe-352">Ogni nuovo tentativo si aggiunge alla latenza totale e,</span><span class="sxs-lookup"><span data-stu-id="39abe-352">Each retry attempt adds to the total latency.</span></span> <span data-ttu-id="39abe-353">in aggiunta, un numero eccessivo di richieste non riuscite può causare un collo di bottiglia, poiché le richieste in sospeso si accumulano nella coda.</span><span class="sxs-lookup"><span data-stu-id="39abe-353">Also, too many failed requests can cause a bottleneck, as pending requests accumulate in the queue.</span></span> <span data-ttu-id="39abe-354">Queste richieste bloccate potrebbero tenere in sospeso risorse di sistema critiche, come la memoria, i thread, le connessioni di database e così via, che possono causare errori a catena.</span><span class="sxs-lookup"><span data-stu-id="39abe-354">These blocked requests might hold critical system resources such as memory, threads, database connections, and so on, which can cause cascading failures.</span></span> <span data-ttu-id="39abe-355">Per evitare questa problematica, aumentare il ritardo tra ogni nuovo tentativo e l'altro e limitare il numero totale di richieste non riuscite.</span><span class="sxs-lookup"><span data-stu-id="39abe-355">To avoid this, increase the delay between each retry attempt, and limit the total number of failed requests.</span></span> 

![](./images/retry.png)

<span data-ttu-id="39abe-356">**Bilanciare il carico tra più istanze**.</span><span class="sxs-lookup"><span data-stu-id="39abe-356">**Load balance across instances**.</span></span> <span data-ttu-id="39abe-357">Ai fini della scalabilità, un'applicazione cloud deve essere in grado di scalare orizzontalmente aggiungendo altre istanze.</span><span class="sxs-lookup"><span data-stu-id="39abe-357">For scalability, a cloud application should be able to scale out by adding more instances.</span></span> <span data-ttu-id="39abe-358">Questo approccio migliora anche la resilienza, poiché le istanze danneggiate possono essere rimosse dalla rotazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-358">This approach also improves resiliency, because unhealthy instances can be removed from rotation.</span></span> <span data-ttu-id="39abe-359">Ad esempio: </span><span class="sxs-lookup"><span data-stu-id="39abe-359">For example:</span></span>

* <span data-ttu-id="39abe-360">Inserire due o più macchine virtuali dietro al bilanciamento del carico:</span><span class="sxs-lookup"><span data-stu-id="39abe-360">Put two or more VMs behind a load balancer.</span></span> <span data-ttu-id="39abe-361">quest'ultimo distribuisce il traffico a tutte le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="39abe-361">The load balancer distributes traffic to all the VMs.</span></span> <span data-ttu-id="39abe-362">Vedere [Run load-balanced VMs for scalability and availability][ra-multi-vm] (Eseguire macchine virtuali con carico bilanciato per la scalabilità e la disponibilità).</span><span class="sxs-lookup"><span data-stu-id="39abe-362">See [Run load-balanced VMs for scalability and availability][ra-multi-vm].</span></span>
* <span data-ttu-id="39abe-363">Scalare orizzontalmente un'applicazione del servizio app di Azure a più istanze:</span><span class="sxs-lookup"><span data-stu-id="39abe-363">Scale out an Azure App Service app to multiple instances.</span></span> <span data-ttu-id="39abe-364">il servizio app bilancia automaticamente il carico tra le istanze.</span><span class="sxs-lookup"><span data-stu-id="39abe-364">App Service automatically balances load across instances.</span></span> <span data-ttu-id="39abe-365">Vedere [Basic web application][ra-basic-web] (Applicazione Web di base).</span><span class="sxs-lookup"><span data-stu-id="39abe-365">See [Basic web application][ra-basic-web].</span></span>
* <span data-ttu-id="39abe-366">Usare [Gestione traffico][tm] per distribuire il traffico in un set di endpoint.</span><span class="sxs-lookup"><span data-stu-id="39abe-366">Use [Azure Traffic Manager][tm] to distribute traffic across a set of endpoints.</span></span>

<span data-ttu-id="39abe-367">**Replicare i dati**.</span><span class="sxs-lookup"><span data-stu-id="39abe-367">**Replicate data**.</span></span> <span data-ttu-id="39abe-368">La replica dei dati è una strategia generale per la gestione degli errori non temporanei in un archivio dati.</span><span class="sxs-lookup"><span data-stu-id="39abe-368">Replicating data is a general strategy for handling non-transient failures in a data store.</span></span> <span data-ttu-id="39abe-369">Molte tecnologie di archiviazione forniscono funzioni di replica predefinite, tra cui Database SQL di Azure, Cosmos DB e Apache Cassandra.</span><span class="sxs-lookup"><span data-stu-id="39abe-369">Many storage technologies provide built-in replication, including Azure SQL Database, Cosmos DB, and Apache Cassandra.</span></span> <span data-ttu-id="39abe-370">È importante considerare i percorsi sia di lettura che di scrittura:</span><span class="sxs-lookup"><span data-stu-id="39abe-370">It's important to consider both the read and write paths.</span></span> <span data-ttu-id="39abe-371">in base alla tecnologia di archiviazione, potrebbero essere fornite più repliche scrivibili, o una singola replica scrivibile e più repliche di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="39abe-371">Depending on the storage technology, you might have multiple writable replicas, or a single writable replica and multiple read-only replicas.</span></span> 

<span data-ttu-id="39abe-372">Per ottimizzare la disponibilità, è possibile posizionare le repliche in più aree.</span><span class="sxs-lookup"><span data-stu-id="39abe-372">To maximize availability, replicas can be placed in multiple regions.</span></span> <span data-ttu-id="39abe-373">Tuttavia, ciò aumenta la latenza quando si replicano i dati.</span><span class="sxs-lookup"><span data-stu-id="39abe-373">However, this increases the latency when replicating the data.</span></span> <span data-ttu-id="39abe-374">In genere, la replica tra aree viene eseguita in modo asincrono e ciò implica un modello di coerenza finale e la potenziale perdita di dati se una replica ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="39abe-374">Typically, replicating across regions is done asynchronously, which implies an eventual consistency model and potential data loss if a replica fails.</span></span> 

<span data-ttu-id="39abe-375">**Ridurre le prestazioni in modo graduale**.</span><span class="sxs-lookup"><span data-stu-id="39abe-375">**Degrade gracefully**.</span></span> <span data-ttu-id="39abe-376">Se un servizio ha esito negativo e non è presente un percorso di failover, l'applicazione potrebbe essere in grado di ridurre le prestazioni gradualmente pur fornendo un'esperienza utente accettabile.</span><span class="sxs-lookup"><span data-stu-id="39abe-376">If a service fails and there is no failover path, the application may be able to degrade gracefully while still providing an acceptable user experience.</span></span> <span data-ttu-id="39abe-377">Ad esempio: </span><span class="sxs-lookup"><span data-stu-id="39abe-377">For example:</span></span>

* <span data-ttu-id="39abe-378">Inserire un elemento di lavoro in una coda, in modo da gestirlo in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="39abe-378">Put a work item on a queue, to be handled later.</span></span> 
* <span data-ttu-id="39abe-379">Restituire un valore stimato.</span><span class="sxs-lookup"><span data-stu-id="39abe-379">Return an estimated value.</span></span>
* <span data-ttu-id="39abe-380">Usare i dati memorizzati nella cache locale.</span><span class="sxs-lookup"><span data-stu-id="39abe-380">Use locally cached data.</span></span> 
* <span data-ttu-id="39abe-381">Far visualizzare all'utente un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-381">Show the user an error message.</span></span> <span data-ttu-id="39abe-382">(Questa opzione è migliore dell'applicazione che smette di risponde alle richieste).</span><span class="sxs-lookup"><span data-stu-id="39abe-382">(This option is better than having the application stop responding to requests.)</span></span>

<span data-ttu-id="39abe-383">**Limitare gli utenti con volumi elevati**.</span><span class="sxs-lookup"><span data-stu-id="39abe-383">**Throttle high-volume users**.</span></span> <span data-ttu-id="39abe-384">A volte un numero ridotto di utenti crea un carico eccessivo</span><span class="sxs-lookup"><span data-stu-id="39abe-384">Sometimes a small number of users create excessive load.</span></span> <span data-ttu-id="39abe-385">e ciò può avere un impatto anche sugli altri utenti, riducendo la disponibilità complessiva dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-385">That can have an impact on other users, reducing the overall availability of your application.</span></span>

<span data-ttu-id="39abe-386">Quando un singolo client esegue un numero eccessivo di richieste, l'applicazione può limitare il client per un determinato periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="39abe-386">When a single client makes an excessive number of requests, the application might throttle the client for a certain period of time.</span></span> <span data-ttu-id="39abe-387">Durante il periodo di limitazione, infatti, l'applicazione rifiuta alcune o tutte le richieste provenienti da quel client (a seconda della precisa strategia di limitazione delle richieste applicata).</span><span class="sxs-lookup"><span data-stu-id="39abe-387">During the throttling period, the application refuses some or all of the requests from that client (depending on the exact throttling strategy).</span></span> <span data-ttu-id="39abe-388">La soglia per la limitazione potrebbe dipendere dal livello di servizio del cliente.</span><span class="sxs-lookup"><span data-stu-id="39abe-388">The threshold for throttling might depend on the customer's service tier.</span></span> 

<span data-ttu-id="39abe-389">La limitazione delle richieste non implica necessariamente che il client debba eseguire azioni malintenzionate, me solo che il client superi la propria quota del servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-389">Throttling does not imply the client was necessarily acting maliciously, only that it exceeded its service quota.</span></span> <span data-ttu-id="39abe-390">In alcuni casi, un consumer potrebbe superare di molto la quota o, altrimenti, potrebbe comportarsi in modo errato.</span><span class="sxs-lookup"><span data-stu-id="39abe-390">In some cases, a consumer might consistently exceed their quota or otherwise behave badly.</span></span> <span data-ttu-id="39abe-391">In tal caso, si potrebbe andare avanti e bloccare l'utente.</span><span class="sxs-lookup"><span data-stu-id="39abe-391">In that case, you might go further and block the user.</span></span> <span data-ttu-id="39abe-392">In genere questo avviene bloccando una chiave API o un intervallo di indirizzi IP.</span><span class="sxs-lookup"><span data-stu-id="39abe-392">Typically, this is done by blocking an API key or an IP address range.</span></span> <span data-ttu-id="39abe-393">Per altre informazioni, vedere l'articolo [Throttling Pattern][throttling-pattern] (Modello di limitazione).</span><span class="sxs-lookup"><span data-stu-id="39abe-393">For more information, see [Throttling Pattern][throttling-pattern].</span></span>

<span data-ttu-id="39abe-394">**Usare un interruttore**.</span><span class="sxs-lookup"><span data-stu-id="39abe-394">**Use a circuit breaker**.</span></span> <span data-ttu-id="39abe-395">Il [modello a interruttore][circuit-breaker-pattern] può impedire a un'applicazione di tentare ripetutamente un'operazione che probabilmente continuerà a restituire un errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-395">The [Circuit Breaker][circuit-breaker-pattern] pattern can prevent an application from repeatedly trying an operation that is likely to fail.</span></span> <span data-ttu-id="39abe-396">L'interruttore esegue il wrapping delle chiamate a un servizio e tiene traccia del numero di errori recenti.</span><span class="sxs-lookup"><span data-stu-id="39abe-396">The circuit breaker wraps calls to a service and tracks the number of recent failures.</span></span> <span data-ttu-id="39abe-397">Se il conteggio degli errori supera una soglia, l'interruttore inizia a restituire un codice di errore senza chiamare il servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-397">If the failure count exceeds a threshold, the circuit breaker starts returning an error code without calling the service.</span></span> <span data-ttu-id="39abe-398">In questo modo il servizio ha il tempo di ripristinarsi.</span><span class="sxs-lookup"><span data-stu-id="39abe-398">This gives the service time to recover.</span></span> 

<span data-ttu-id="39abe-399">**Usare il livellamento del carico per contenere i picchi di traffico**.</span><span class="sxs-lookup"><span data-stu-id="39abe-399">**Use load leveling to smooth out spikes in traffic**.</span></span> <span data-ttu-id="39abe-400">Nelle applicazioni possono verificarsi picchi improvvisi di traffico, che possono sovraccaricare i servizi nel back-end.</span><span class="sxs-lookup"><span data-stu-id="39abe-400">Applications may experience sudden spikes in traffic, which can overwhelm services on the backend.</span></span> <span data-ttu-id="39abe-401">Se un servizio back-end non può rispondere alle richieste in modo sufficientemente rapido, ciò potrebbe comportare che le richieste si mettano in coda (backup) o che il servizio limiti l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-401">If a backend service cannot respond to requests quickly enough, it may cause requests to queue (back up), or cause the service to throttle the application.</span></span> <span data-ttu-id="39abe-402">Per evitare questo problema, è possibile usare una coda come un buffer.</span><span class="sxs-lookup"><span data-stu-id="39abe-402">To avoid this, you can use a queue as a buffer.</span></span> <span data-ttu-id="39abe-403">Quando è presente un nuovo elemento di lavoro, anziché chiamare subito il servizio back-end, l'applicazione mette in coda un elemento di lavoro per eseguirlo in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="39abe-403">When there is a new work item, instead of calling the backend service immediately, the application queues a work item to run asynchronously.</span></span> <span data-ttu-id="39abe-404">La coda si comporta come un buffer che contiene i picchi di carico.</span><span class="sxs-lookup"><span data-stu-id="39abe-404">The queue acts as a buffer that smooths out peaks in the load.</span></span> <span data-ttu-id="39abe-405">Per altre informazioni, vedere [Queue-Based Load Leveling Pattern][load-leveling-pattern] (Modello di livellamento del carico basato sulle code).</span><span class="sxs-lookup"><span data-stu-id="39abe-405">For more information, see [Queue-Based Load Leveling Pattern][load-leveling-pattern].</span></span>

<span data-ttu-id="39abe-406">**Isolare le risorse critiche**.</span><span class="sxs-lookup"><span data-stu-id="39abe-406">**Isolate critical resources**.</span></span> <span data-ttu-id="39abe-407">In alcuni casi gli errori in un sottosistema si possono propagare a catena, causando errori in altre parti dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-407">Failures in one subsystem can sometimes cascade, causing failures in other parts of the application.</span></span> <span data-ttu-id="39abe-408">Questa situazione può verificarsi se un errore porta alcune risorse, come i thread o i socket, a non essere liberate in modo tempestivo, causandone l'esaurimento.</span><span class="sxs-lookup"><span data-stu-id="39abe-408">This can happen if a failure causes some resources, such as threads or sockets, not to get freed in a timely manner, leading to resource exhaustion.</span></span> 

<span data-ttu-id="39abe-409">Per evitare questo problema, è possibile partizionare un sistema in gruppi isolati, in modo che un errore in una partizione non causi l'arresto dell'intero sistema.</span><span class="sxs-lookup"><span data-stu-id="39abe-409">To avoid this, you can partition a system into isolated groups, so that a failure in one partition does not bring down the entire system.</span></span> <span data-ttu-id="39abe-410">Questo modello talvolta viene denominato Bulkhead pattern (modello a scomparti).</span><span class="sxs-lookup"><span data-stu-id="39abe-410">This technique is sometimes called the Bulkhead pattern.</span></span>

<span data-ttu-id="39abe-411">Esempi:</span><span class="sxs-lookup"><span data-stu-id="39abe-411">Examples:</span></span>

* <span data-ttu-id="39abe-412">Partizionare un database (per esempio, in base al tenant) e assegnare a ogni partizione un pool separato di istanze del server Web.</span><span class="sxs-lookup"><span data-stu-id="39abe-412">Partition a database (for example, by tenant) and assign a separate pool of web server instances for each partition.</span></span>  
* <span data-ttu-id="39abe-413">Usare pool di thread distinti per isolare le chiamate a servizi diversi:</span><span class="sxs-lookup"><span data-stu-id="39abe-413">Use separate thread pools to isolate calls to different services.</span></span> <span data-ttu-id="39abe-414">questo consente di evitare errori a catena in caso di errore di uno dei servizi.</span><span class="sxs-lookup"><span data-stu-id="39abe-414">This helps to prevent cascading failures if one of the services fails.</span></span> <span data-ttu-id="39abe-415">Per un esempio, vedere [Hystrix library][hystrix] di Netflix.</span><span class="sxs-lookup"><span data-stu-id="39abe-415">For an example, see the Netflix [Hystrix library][hystrix].</span></span>
* <span data-ttu-id="39abe-416">Usare i [containers][containers] (visualizzazione a livello di sistema operativo) per limitare le risorse disponibili a un sottosistema specifico.</span><span class="sxs-lookup"><span data-stu-id="39abe-416">Use [containers][containers] to limit the resources available to a particular subsystem.</span></span> 

![](./images/bulkhead.png)

<span data-ttu-id="39abe-417">**Applicare le transazioni di compensazione**.</span><span class="sxs-lookup"><span data-stu-id="39abe-417">**Apply compensating transactions**.</span></span> <span data-ttu-id="39abe-418">Una [transazione di compensazione][compensating-transaction-pattern] è una transazione che annulla gli effetti di un'altra transazione completata.</span><span class="sxs-lookup"><span data-stu-id="39abe-418">A [compensating transaction][compensating-transaction-pattern] is a transaction that undoes the effects of another completed transaction.</span></span> <span data-ttu-id="39abe-419">In un sistema distribuito può essere molto difficile ottenere una consistenza transazionale di alto livello.</span><span class="sxs-lookup"><span data-stu-id="39abe-419">In a distributed system, it can be very difficult to achieve strong transactional consistency.</span></span> <span data-ttu-id="39abe-420">Le transazioni di compensazione sono un modo per ottenere la consistenza attraverso una serie di transazioni singole di dimensioni inferiori, che possono essere annullate a ogni passaggio.</span><span class="sxs-lookup"><span data-stu-id="39abe-420">Compensating transactions are a way to achieve consistency by using a series of smaller, individual transactions that can be undone at each step.</span></span>

<span data-ttu-id="39abe-421">Per organizzare un viaggio, ad esempio, un cliente potrebbe prenotare un'automobile, una camera di albergo e un volo.</span><span class="sxs-lookup"><span data-stu-id="39abe-421">For example, to book a trip, a customer might reserve a car, a hotel room, and a flight.</span></span> <span data-ttu-id="39abe-422">Se uno di questi passaggi fallisce, l'intera operazione ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="39abe-422">If any of these steps fails, the entire operation fails.</span></span> <span data-ttu-id="39abe-423">Anziché tentare di usare una singola transazione distribuita per l'intera operazione, è possibile definire una transazione di compensazione per ogni passaggio.</span><span class="sxs-lookup"><span data-stu-id="39abe-423">Instead of trying to use a single distributed transaction for the entire operation, you can define a compensating transaction for each step.</span></span> <span data-ttu-id="39abe-424">Per esempio, per annullare la prenotazione di un'auto, si cancella tale prenotazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-424">For example, to undo a car reservation, you cancel the reservation.</span></span> <span data-ttu-id="39abe-425">Per completare l'intera operazione, un coordinatore esegue ogni passaggio:</span><span class="sxs-lookup"><span data-stu-id="39abe-425">In order to complete the whole operation, a coordinator executes each step.</span></span> <span data-ttu-id="39abe-426">se un passaggio ha esito negativo, si applicano le transazioni di compensazione per annullare qualunque passaggio che sia stato completato.</span><span class="sxs-lookup"><span data-stu-id="39abe-426">If any step fails, the coordinator applies compensating transactions to undo any steps that were completed.</span></span> 

## <a name="test-for-resiliency"></a><span data-ttu-id="39abe-427">Eseguire test per la resilienza</span><span class="sxs-lookup"><span data-stu-id="39abe-427">Test for resiliency</span></span>
<span data-ttu-id="39abe-428">In genere non è possibile testare resilienza nello stesso modo in cui si esegue il test della funzionalità di un'applicazione (eseguendo gli unit test e così via).</span><span class="sxs-lookup"><span data-stu-id="39abe-428">Generally, you can't test resiliency in the same way that you test application functionality (by running unit tests and so on).</span></span> <span data-ttu-id="39abe-429">Infatti, è necessario testare il modo in cui il carico di lavoro end-to-end viene eseguito in condizioni di errore che si verificano solo in modo intermittente.</span><span class="sxs-lookup"><span data-stu-id="39abe-429">Instead, you must test how the end-to-end workload performs under failure conditions which only occur intermittently.</span></span>

<span data-ttu-id="39abe-430">Il test è un processo iterativo:</span><span class="sxs-lookup"><span data-stu-id="39abe-430">Testing is an iterative process.</span></span> <span data-ttu-id="39abe-431">testare l'applicazione, misurare il risultato, analizzare e indirizzare gli eventuali errori che si verificano e ripetere il processo.</span><span class="sxs-lookup"><span data-stu-id="39abe-431">Test the application, measure the outcome, analyze and address any failures that result, and repeat the process.</span></span>

<span data-ttu-id="39abe-432">**Test dell'inserimento degli errori**.</span><span class="sxs-lookup"><span data-stu-id="39abe-432">**Fault injection testing**.</span></span> <span data-ttu-id="39abe-433">Testare la resilienza del sistema durante gli errori, o attivando errori reali, oppure stimolandoli.</span><span class="sxs-lookup"><span data-stu-id="39abe-433">Test the resiliency of the system during failures, either by triggering actual failures or by simulating them.</span></span> <span data-ttu-id="39abe-434">Di seguito sono riportati alcuni scenari di errore comuni da testare:</span><span class="sxs-lookup"><span data-stu-id="39abe-434">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="39abe-435">Arrestare le istanze di macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="39abe-435">Shut down VM instances.</span></span>
* <span data-ttu-id="39abe-436">Arrestare in modo anomalo i processi.</span><span class="sxs-lookup"><span data-stu-id="39abe-436">Crash processes.</span></span>
* <span data-ttu-id="39abe-437">Far scadere i certificati.</span><span class="sxs-lookup"><span data-stu-id="39abe-437">Expire certificates.</span></span>
* <span data-ttu-id="39abe-438">Cambiare le chiavi di accesso.</span><span class="sxs-lookup"><span data-stu-id="39abe-438">Change access keys.</span></span>
* <span data-ttu-id="39abe-439">Arrestare il servizio DNS nei controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="39abe-439">Shut down the DNS service on domain controllers.</span></span>
* <span data-ttu-id="39abe-440">Limitare le risorse di sistema disponibili, come la RAM o il numero di thread.</span><span class="sxs-lookup"><span data-stu-id="39abe-440">Limit available system resources, such as RAM or number of threads.</span></span>
* <span data-ttu-id="39abe-441">Smontare i dischi.</span><span class="sxs-lookup"><span data-stu-id="39abe-441">Unmount disks.</span></span>
* <span data-ttu-id="39abe-442">Ridistribuire una VM.</span><span class="sxs-lookup"><span data-stu-id="39abe-442">Redeploy a VM.</span></span>

<span data-ttu-id="39abe-443">Misurare i tempi di ripristino e verificare che i requisiti aziendali siano soddisfatti.</span><span class="sxs-lookup"><span data-stu-id="39abe-443">Measure the recovery times and verify that your business requirements are met.</span></span> <span data-ttu-id="39abe-444">Testare le combinazioni di modalità di errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-444">Test combinations of failure modes as well.</span></span> <span data-ttu-id="39abe-445">Assicurarsi che gli errori non si propaghino a cascata e che vengano gestiti in modo isolato.</span><span class="sxs-lookup"><span data-stu-id="39abe-445">Make sure that failures don't cascade, and are handled in an isolated way.</span></span>

<span data-ttu-id="39abe-446">Questa è un'altra ragione per cui è importante analizzare i punti di errore possibili durante la fase di progettazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-446">This is another reason why it's important to analyze possible failure points during the design phase.</span></span> <span data-ttu-id="39abe-447">I risultati dell'analisi devono essere di input per il piano di test.</span><span class="sxs-lookup"><span data-stu-id="39abe-447">The results of that analysis should be inputs into your test plan.</span></span>

<span data-ttu-id="39abe-448">**Test di carico**.</span><span class="sxs-lookup"><span data-stu-id="39abe-448">**Load testing**.</span></span> <span data-ttu-id="39abe-449">Il test di carico è fondamentale per l'identificazione di errori che si verificano solo in condizioni di carico come, ad esempio, il database back-end sovraccarico o la limitazione delle richieste di servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-449">Load testing is crucial for identifying failures that only happen under load, such as the backend database being overwhelmed or service throttling.</span></span> <span data-ttu-id="39abe-450">Eseguire il test per il carico di picco, usando dati di produzione oppure dati sintetici che siano più simili possibile ai dati di produzione.</span><span class="sxs-lookup"><span data-stu-id="39abe-450">Test for peak load, using production data or synthetic data that is as close to production data as possible.</span></span> <span data-ttu-id="39abe-451">L'obiettivo consiste nel verificare il comportamento dell'applicazione in condizioni reali.</span><span class="sxs-lookup"><span data-stu-id="39abe-451">The goal is to see how the application behaves under real-world conditions.</span></span>   

## <a name="deploy-using-reliable-processes"></a><span data-ttu-id="39abe-452">Distribuire con processi affidabili</span><span class="sxs-lookup"><span data-stu-id="39abe-452">Deploy using reliable processes</span></span>
<span data-ttu-id="39abe-453">Una volta che un'applicazione viene distribuita nell'ambiente di produzione, gli aggiornamenti sono una possibile fonte di errori.</span><span class="sxs-lookup"><span data-stu-id="39abe-453">Once an application is deployed to production, updates are a possible source of errors.</span></span> <span data-ttu-id="39abe-454">Nel peggiore dei casi, un aggiornamento non valido può causare tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="39abe-454">In the worst case, a bad update can cause downtime.</span></span> <span data-ttu-id="39abe-455">Per evitare questo problema, il processo di distribuzione deve essere prevedibile e ripetibile.</span><span class="sxs-lookup"><span data-stu-id="39abe-455">To avoid this, the deployment process must be predictable and repeatable.</span></span> <span data-ttu-id="39abe-456">La distribuzione include il provisioning delle risorse di Azure, la distribuzione del codice dell'applicazione e l'applicazione delle impostazioni di configurazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-456">Deployment includes provisioning Azure resources, deploying application code, and applying configuration settings.</span></span> <span data-ttu-id="39abe-457">Un aggiornamento può interessare tutte e tre le fasi oppure un subset.</span><span class="sxs-lookup"><span data-stu-id="39abe-457">An update may involve all three, or a subset.</span></span> 

<span data-ttu-id="39abe-458">Il punto essenziale è che le distribuzioni manuali sono inclini all'errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-458">The crucial point is that manual deployments are prone to error.</span></span> <span data-ttu-id="39abe-459">Perciò, è consigliabile disporre di un processo automatico e idempotente che si possa eseguire su richiesta ed eseguire nuovamente in caso di problemi.</span><span class="sxs-lookup"><span data-stu-id="39abe-459">Therefore, it's recommended to have an automated, idempotent process that you can run on demand, and re-run if something fails.</span></span> 

* <span data-ttu-id="39abe-460">Usare i modelli di Azure Resource Manager per automatizzare il provisioning delle risorse di Azure.</span><span class="sxs-lookup"><span data-stu-id="39abe-460">Use Azure Resource Manager templates to automate provisioning of Azure resources.</span></span>
* <span data-ttu-id="39abe-461">Usare [Panoramica della piattaforma DSC di Automazione di Azure][dsc] per configurare le VM.</span><span class="sxs-lookup"><span data-stu-id="39abe-461">Use [Azure Automation Desired State Configuration][dsc] (DSC) to configure VMs.</span></span>
* <span data-ttu-id="39abe-462">Usare un processo di distribuzione automatizzata per il codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-462">Use an automated deployment process for application code.</span></span>

<span data-ttu-id="39abe-463">Due concetti collegati alla distribuzione resiliente sono l'*infrastruttura come codice* e l'*infrastruttura immutabile*.</span><span class="sxs-lookup"><span data-stu-id="39abe-463">Two concepts related to resilient deployment are *infrastructure as code* and *immutable infrastructure*.</span></span>

* <span data-ttu-id="39abe-464">L'**infrastruttura come codice** consiste nell'usare il codice per eseguire il provisioning e configurare l'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="39abe-464">**Infrastructure as code** is the practice of using code to provision and configure infrastructure.</span></span> <span data-ttu-id="39abe-465">L'infrastruttura come codice può usare un approccio dichiarativo o un approccio imperativo (o una combinazione di entrambi).</span><span class="sxs-lookup"><span data-stu-id="39abe-465">Infrastructure as code may use a declarative approach or an imperative approach (or a combination of both).</span></span> <span data-ttu-id="39abe-466">I modelli di Resource Manager sono un esempio di approccio dichiarativo,</span><span class="sxs-lookup"><span data-stu-id="39abe-466">Resource Manager templates are an example of a declarative approach.</span></span> <span data-ttu-id="39abe-467">mentre gli script di PowerShell, invece, sono un esempio di approccio imperativo.</span><span class="sxs-lookup"><span data-stu-id="39abe-467">PowerShell scripts are an example of an imperative approach.</span></span>
* <span data-ttu-id="39abe-468">L'**infrastruttura immutabile** è il principio secondo cui non si dovrebbe modificare l'infrastruttura dopo la distribuzione nell'ambiente di produzione,</span><span class="sxs-lookup"><span data-stu-id="39abe-468">**Immutable infrastructure** is the principle that you shouldn’t modify infrastructure after it’s deployed to production.</span></span> <span data-ttu-id="39abe-469">altrimenti ci si può trovare in uno stato in cui sono state applicate modifiche ad hoc, ed è quindi difficile sapere esattamente cosa sia cambiato e ragionare sul sistema.</span><span class="sxs-lookup"><span data-stu-id="39abe-469">Otherwise, you can get into a state where ad hoc changes have been applied, so it's hard to know exactly what changed, and hard to reason about the system.</span></span> 

<span data-ttu-id="39abe-470">Un'altra domanda è come si possa implementare un aggiornamento dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-470">Another question is how to roll out an application update.</span></span> <span data-ttu-id="39abe-471">Sono consigliate tecniche come la distribuzione di tipo blu-verde o le versioni canary, che eseguono il push degli aggiornamenti in modalità altamente controllate per ridurre al minimo gli impatti possibili da una distribuzione non valida.</span><span class="sxs-lookup"><span data-stu-id="39abe-471">We recommend techniques such as blue-green deployment or canary releases, which push updates in highly controlled way to minimize possible impacts from a bad deployment.</span></span>

* <span data-ttu-id="39abe-472">La [distribuzione di tipo blu-verde][blue-green] è una tecnica in cui un aggiornamento viene distribuito in un ambiente di produzione separato dall'applicazione live.</span><span class="sxs-lookup"><span data-stu-id="39abe-472">[Blue-green deployment][blue-green] is a technique where an update is deployed into a production environment separate from the live application.</span></span> <span data-ttu-id="39abe-473">Dopo la convalida della distribuzione, commutare il routing del traffico alla versione aggiornata.</span><span class="sxs-lookup"><span data-stu-id="39abe-473">After you validate the deployment, switch the traffic routing to the updated version.</span></span> <span data-ttu-id="39abe-474">Ad esempio, l'App Web del servizio app di Azure consente quest'operazione attraverso gli slot di staging.</span><span class="sxs-lookup"><span data-stu-id="39abe-474">For example, Azure App Service Web Apps enables this with staging slots.</span></span>
* <span data-ttu-id="39abe-475">Le [versioni canary][canary-release] sono simili alle distribuzioni di tipo blu-verde.</span><span class="sxs-lookup"><span data-stu-id="39abe-475">[Canary releases][canary-release] are similar to blue-green deployments.</span></span> <span data-ttu-id="39abe-476">Anziché commutare tutto il traffico alla versione aggiornata, si distribuisce l'aggiornamento a una piccola percentuale di utenti, instradando una parte del traffico alla nuova distribuzione.</span><span class="sxs-lookup"><span data-stu-id="39abe-476">Instead of switching all traffic to the updated version, you roll out the update to a small percentage of users, by routing a portion of the traffic to the new deployment.</span></span> <span data-ttu-id="39abe-477">Se si verificano problemi, interrompere e ripristinare la distribuzione precedente,</span><span class="sxs-lookup"><span data-stu-id="39abe-477">If there is a problem, back off and revert to the old deployment.</span></span> <span data-ttu-id="39abe-478">altrimenti instradare sempre più traffico alla nuova versione, fino a quando non si raggiunge il 100% del traffico.</span><span class="sxs-lookup"><span data-stu-id="39abe-478">Otherwise, route more of the traffic to the new version, until it gets 100% of the traffic.</span></span>

<span data-ttu-id="39abe-479">Qualunque approccio si adotti, nel caso in cui la nuova versione non funzioni, assicurarsi che sia possibile eseguire il rollback all'ultima distribuzione valida conosciuta.</span><span class="sxs-lookup"><span data-stu-id="39abe-479">Whatever approach you take, make sure that you can roll back to the last-known-good deployment, in case the new version is not functioning.</span></span> <span data-ttu-id="39abe-480">In aggiunta, se si verificano errori, i registri applicazioni indicano quale versione ha causato l'errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-480">Also, if errors occur, the application logs must indicate which version caused the error.</span></span> 

## <a name="monitor-to-detect-failures"></a><span data-ttu-id="39abe-481">Monitorare per rilevare gli errori</span><span class="sxs-lookup"><span data-stu-id="39abe-481">Monitor to detect failures</span></span>
<span data-ttu-id="39abe-482">Il monitoraggio e la diagnostica sono fondamentali per la resilienza,</span><span class="sxs-lookup"><span data-stu-id="39abe-482">Monitoring and diagnostics are crucial for resiliency.</span></span> <span data-ttu-id="39abe-483">infatti, se qualcosa non riesce, è necessario sapere che è sorto un problema ed è indispensabile avere informazioni approfondite sulla causa dell'errore.</span><span class="sxs-lookup"><span data-stu-id="39abe-483">If something fails, you need to know that it failed, and you need insights into the cause of the failure.</span></span> 

<span data-ttu-id="39abe-484">Il monitoraggio di un sistema distribuito su vasta scala costituisce una sfida significativa.</span><span class="sxs-lookup"><span data-stu-id="39abe-484">Monitoring a large-scale distributed system poses a significant challenge.</span></span> <span data-ttu-id="39abe-485">Si pensi a un'applicazione che esegue alcune dozzine di macchine virtuali &mdash; non è pratico accedere a ogni macchina virtuale, una alla volta, ed esaminare il file di log, tentando di risolvere un problema.</span><span class="sxs-lookup"><span data-stu-id="39abe-485">Think about an application that runs on a few dozen VMs &mdash; it's not practical to log into each VM, one at a time, and look through log files, trying to troubleshoot a problem.</span></span> <span data-ttu-id="39abe-486">In aggiunta, il numero di istanze di VM probabilmente non è statico.</span><span class="sxs-lookup"><span data-stu-id="39abe-486">Moreover, the number of VM instances is probably not static.</span></span> <span data-ttu-id="39abe-487">Le VM, infatti, vengono aggiunte e rimosse con l'aumentare e il ridursi dell'applicazione e, in alcuni casi, un'istanza può avere esito negativo e può essere necessario che venga sottoposta a un nuovo provisioning.</span><span class="sxs-lookup"><span data-stu-id="39abe-487">VMs get added and removed as the application scales in and out, and occasionally an instance may fail and need to be reprovisioned.</span></span> <span data-ttu-id="39abe-488">Si consideri anche che un'applicazione cloud tipica potrebbe usare più archivi di dati (archiviazione di Azure, database SQL, Cosmos DB, cache redis) e un'azione utente singola può estendersi a più sottosistemi.</span><span class="sxs-lookup"><span data-stu-id="39abe-488">In addition, a typical cloud application might use multiple data stores (Azure storage, SQL Database, Cosmos DB, Redis cache), and a single user action may span multiple subsystems.</span></span> 

<span data-ttu-id="39abe-489">Si può pensare al processo di monitoraggio e diagnostica come a una pipeline con varie fasi distinte:</span><span class="sxs-lookup"><span data-stu-id="39abe-489">You can think of the monitoring and diagnostics process as a pipeline with several distinct stages:</span></span>

![Contratto di servizio composito](./images/monitoring.png)

* <span data-ttu-id="39abe-491">**Strumentazione**.</span><span class="sxs-lookup"><span data-stu-id="39abe-491">**Instrumentation**.</span></span> <span data-ttu-id="39abe-492">I dati non elaborati per il monitoraggio e la diagnostica provengano da un'ampia gamma di origini, tra cui: i registri applicazioni, i log del server Web, i contatori delle prestazioni del sistema operativo, i registri database e la diagnostica incorporata nella piattaforma Azure.</span><span class="sxs-lookup"><span data-stu-id="39abe-492">The raw data for monitoring and diagnostics comes from a variety of sources, including application logs, web server logs, OS performance counters, database logs, and diagnostics built into the Azure platform.</span></span> <span data-ttu-id="39abe-493">La maggior parte dei servizi di Azure dispongono di funzionalità di diagnostica che è possibile usare per determinare la causa dei problemi.</span><span class="sxs-lookup"><span data-stu-id="39abe-493">Most Azure services have a diagnostics feature that you can use to determine the cause of problems.</span></span>
* <span data-ttu-id="39abe-494">**Raccolta e archiviazione**.</span><span class="sxs-lookup"><span data-stu-id="39abe-494">**Collection and storage**.</span></span> <span data-ttu-id="39abe-495">I dati di strumentazione non elaborati possono essere contenuti in diverse posizioni e con formati diversi (ad esempio, log di traccia delle applicazioni, log di IIS, contatori delle prestazioni).</span><span class="sxs-lookup"><span data-stu-id="39abe-495">Raw instrumentation data can be held in various locations and with various formats (e.g., application trace logs, IIS logs, performance counters).</span></span> <span data-ttu-id="39abe-496">Queste origini diverse sono raccolte, consolidate e inserite in un archivio affidabile.</span><span class="sxs-lookup"><span data-stu-id="39abe-496">These disparate sources are collected, consolidated, and put into reliable storage.</span></span>
* <span data-ttu-id="39abe-497">**Analisi e diagnosi**.</span><span class="sxs-lookup"><span data-stu-id="39abe-497">**Analysis and diagnosis**.</span></span> <span data-ttu-id="39abe-498">Dopo che vengono consolidati, i dati possono essere analizzati per risolvere i problemi e fornire una visione complessiva dell'integrità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-498">After the data is consolidated, it can be analyzed to troubleshoot issues and provide an overall view of application health.</span></span>
* <span data-ttu-id="39abe-499">**Visualizzazione e avvisi**.</span><span class="sxs-lookup"><span data-stu-id="39abe-499">**Visualization and alerts**.</span></span> <span data-ttu-id="39abe-500">In questa fase i dati di telemetria vengono presentati in modo tale che un operatore possa notare rapidamente i problemi o le tendenze.</span><span class="sxs-lookup"><span data-stu-id="39abe-500">In this stage, telemetry data is presented in such a way that an operator can quickly notice problems or trends.</span></span> <span data-ttu-id="39abe-501">Un esempio è rappresentato dai dashboard o dagli avvisi di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="39abe-501">Example include dashboards or email alerts.</span></span>  

<span data-ttu-id="39abe-502">Il monitoraggio è diverso dal rilevamento degli errori:</span><span class="sxs-lookup"><span data-stu-id="39abe-502">Monitoring is not the same as failure detection.</span></span> <span data-ttu-id="39abe-503">l'applicazione, per esempio, potrebbe rilevare un errore temporaneo e riprovare, non restituendo tempi di inattività.</span><span class="sxs-lookup"><span data-stu-id="39abe-503">For example, your application might detect a transient error and retry, resulting in no downtime.</span></span> <span data-ttu-id="39abe-504">Allo stesso tempo, però, dovrebbe anche registrare l'operazione del nuovo tentativo, in modo che si possa monitorare la frequenza degli errori e avere un quadro generale dello stato di integrità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-504">But it should also log the retry operation, so that you can monitor the error rate, in order to get an overall picture of application health.</span></span> 

<span data-ttu-id="39abe-505">Per questo motivo i registri applicazioni sono una fonte importante di dati di diagnostica.</span><span class="sxs-lookup"><span data-stu-id="39abe-505">Application logs are an important source of diagnostics data.</span></span> <span data-ttu-id="39abe-506">Fra le procedure consigliate per la registrazione delle applicazioni vi sono:</span><span class="sxs-lookup"><span data-stu-id="39abe-506">Best practices for application logging include:</span></span>

* <span data-ttu-id="39abe-507">Eseguire la registrazione in ambiente di produzione,</span><span class="sxs-lookup"><span data-stu-id="39abe-507">Log in production.</span></span> <span data-ttu-id="39abe-508">altrimenti si potrebbero perdere informazioni là dove sono più necessarie.</span><span class="sxs-lookup"><span data-stu-id="39abe-508">Otherwise, you lose insight where you need it most.</span></span>
* <span data-ttu-id="39abe-509">Registrare gli eventi in base ai limiti del servizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-509">Log events at service boundaries.</span></span> <span data-ttu-id="39abe-510">Includere un ID di correlazione che passi attraverso i limiti di servizio:</span><span class="sxs-lookup"><span data-stu-id="39abe-510">Include a correlation ID that flows across service boundaries.</span></span> <span data-ttu-id="39abe-511">se una transazione passa attraverso più servizi e uno di questi ha esito negativo, l'ID di correlazione consente di individuare il motivo per cui la transazione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="39abe-511">If a transaction flows through multiple services and one of them fails, the correlation ID will help you pinpoint why the transaction failed.</span></span>
* <span data-ttu-id="39abe-512">Usare la registrazione semantica, conosciuta anche come registrazione strutturata:</span><span class="sxs-lookup"><span data-stu-id="39abe-512">Use semantic logging, also known as structured logging.</span></span> <span data-ttu-id="39abe-513">i log non strutturati rendono difficile automatizzare il consumo e l'analisi dei dati di log, che sono necessari a livello di scalabilità cloud.</span><span class="sxs-lookup"><span data-stu-id="39abe-513">Unstructured logs make it hard to automate the consumption and analysis of the log data, which is needed at cloud scale.</span></span>
* <span data-ttu-id="39abe-514">Usare la registrazione asincrona:</span><span class="sxs-lookup"><span data-stu-id="39abe-514">Use asynchronous logging.</span></span> <span data-ttu-id="39abe-515">in caso contrario, il sistema di registrazione può provocare un errore nell'applicazione, generando il backup delle richieste che si bloccano durante l'attesa di scrivere un evento di registrazione.</span><span class="sxs-lookup"><span data-stu-id="39abe-515">Otherwise, the logging system itself can cause the application to fail by causing requests to back up, as they block while waiting to write a logging event.</span></span>
* <span data-ttu-id="39abe-516">La registrazione delle applicazioni è diversa dal controllo:</span><span class="sxs-lookup"><span data-stu-id="39abe-516">Application logging is not the same as auditing.</span></span> <span data-ttu-id="39abe-517">quest'ultimo, infatti, può avvenire per motivi normativi o di conformità.</span><span class="sxs-lookup"><span data-stu-id="39abe-517">Auditing may be done for compliance or regulatory reasons.</span></span> <span data-ttu-id="39abe-518">Di conseguenza, i record di controllo devono essere completati e non possono essere eliminati durante l'elaborazione delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="39abe-518">As such, audit records must be complete, and it's not acceptable to drop any while processing transactions.</span></span> <span data-ttu-id="39abe-519">Se un'applicazione richiede un controllo, questo deve essere mantenuto separato dalla registrazione diagnostica.</span><span class="sxs-lookup"><span data-stu-id="39abe-519">If an application requires auditing, this should be kept separate from diagnostics logging.</span></span> 

<span data-ttu-id="39abe-520">Per maggiori informazioni sul monitoraggio e la diagnostica, vedere [Monitoring and diagnostics guidance][monitoring-guidance] (Monitoraggio e diagnostica).</span><span class="sxs-lookup"><span data-stu-id="39abe-520">For more information about monitoring and diagnostics, see [Monitoring and diagnostics guidance][monitoring-guidance].</span></span>

## <a name="respond-to-failures"></a><span data-ttu-id="39abe-521">Rispondere agli errori</span><span class="sxs-lookup"><span data-stu-id="39abe-521">Respond to failures</span></span>
<span data-ttu-id="39abe-522">Nelle sezioni precedenti sono state trattate le strategie di ripristino automatico, che sono fondamentali per la disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="39abe-522">Previous sections have focused on automated recovery strategies, which are critical for high availability.</span></span> <span data-ttu-id="39abe-523">Tuttavia, a volte, è necessario intervenire manualmente.</span><span class="sxs-lookup"><span data-stu-id="39abe-523">However, sometimes manual intervention is needed.</span></span>

* <span data-ttu-id="39abe-524">**Avvisi**.</span><span class="sxs-lookup"><span data-stu-id="39abe-524">**Alerts**.</span></span> <span data-ttu-id="39abe-525">Monitorare l'applicazione per quei segnali di avviso che potrebbero richiedere un intervento proattivo.</span><span class="sxs-lookup"><span data-stu-id="39abe-525">Monitor your application for warning signs that may require proactive intervention.</span></span> <span data-ttu-id="39abe-526">Se viene visualizzato, ad esempio, che il database SQL o Cosmos DB limitano in modo consistente l'applicazione, potrebbe essere necessario aumentare la capacità del database o ottimizzare le query.</span><span class="sxs-lookup"><span data-stu-id="39abe-526">For example, if you see that SQL Database or Cosmos DB consistently throttles your application, you might need to increase your database capacity or optimize your queries.</span></span> <span data-ttu-id="39abe-527">In questo esempio, anche se l'applicazione può gestire gli errori di limitazione delle richieste in modo trasparente, i dati di telemetria dovrebbero comunque generare un avviso in modo che si possa procedere nel controllo.</span><span class="sxs-lookup"><span data-stu-id="39abe-527">In this example, even though the application might handle the throttling errors transparently, your telemetry should still raise an alert so that you can follow up.</span></span>  
* <span data-ttu-id="39abe-528">**Failover manuale**.</span><span class="sxs-lookup"><span data-stu-id="39abe-528">**Manual failover**.</span></span> <span data-ttu-id="39abe-529">Alcuni sistemi non possono effettuare il failover automaticamente e richiedono un failover manuale.</span><span class="sxs-lookup"><span data-stu-id="39abe-529">Some systems cannot fail over automatically and require a manual failover.</span></span> 
* <span data-ttu-id="39abe-530">**Test della conformità operativa**.</span><span class="sxs-lookup"><span data-stu-id="39abe-530">**Operational readiness testing**.</span></span> <span data-ttu-id="39abe-531">Se l'applicazione effettua il failover in un'area secondaria, è consigliabile eseguire un test della conformità operativa prima di eseguire il failback nell'area primaria.</span><span class="sxs-lookup"><span data-stu-id="39abe-531">If your application fails over to a secondary region, you should perform an operational readiness test before you fail back to the primary region.</span></span> <span data-ttu-id="39abe-532">Il test dovrebbe verificare che l'area primaria sia integra e pronta a ricevere nuovamente traffico.</span><span class="sxs-lookup"><span data-stu-id="39abe-532">The test should verify that the primary region is healthy and ready to receive traffic again.</span></span>
* <span data-ttu-id="39abe-533">**Controllo della coerenza dei dati**.</span><span class="sxs-lookup"><span data-stu-id="39abe-533">**Data consistency check**.</span></span> <span data-ttu-id="39abe-534">Nel caso di un errore in un archivio dati, è possibile che ci siano incoerenze dei dati quando l'archivio diventa nuovamente disponibile, soprattutto se i dati sono stati replicati.</span><span class="sxs-lookup"><span data-stu-id="39abe-534">If a failure happens in a data store, there may be data inconsistencies when the store becomes available again, especially if the data was replicated.</span></span> 
* <span data-ttu-id="39abe-535">**Ripristino da backup**.</span><span class="sxs-lookup"><span data-stu-id="39abe-535">**Restoring from backup**.</span></span> <span data-ttu-id="39abe-536">Per esempio, il database SQL, nel caso in cui si verifichi un'interruzione di area, può essere ripristinato a livello geografico dal backup più recente.</span><span class="sxs-lookup"><span data-stu-id="39abe-536">For example, if SQL Database experiences a regional outage, you can geo-restore the database from the latest backup.</span></span>

<span data-ttu-id="39abe-537">È consigliabile eseguire le operazioni seguenti: documentare e testare il piano di ripristino di emergenza,</span><span class="sxs-lookup"><span data-stu-id="39abe-537">Document and test your disaster recovery plan.</span></span> <span data-ttu-id="39abe-538">valutare l'impatto aziendale degli errori delle applicazioni,</span><span class="sxs-lookup"><span data-stu-id="39abe-538">Evaluate the business impact of application failures.</span></span> <span data-ttu-id="39abe-539">automatizzare il processo il più possibile e documentare eventuali passaggi manuali, come ad esempio il failover manuale o il ripristino dei dati dai backup,</span><span class="sxs-lookup"><span data-stu-id="39abe-539">Automate the process as much as possible, and document any manual steps, such as manual failover or data restoration from backups.</span></span> <span data-ttu-id="39abe-540">testare regolarmente, infine, il processo di ripristino di emergenza per convalidare e migliorare il piano.</span><span class="sxs-lookup"><span data-stu-id="39abe-540">Regularly test your disaster recovery process to validate and improve the plan.</span></span> 

## <a name="summary"></a><span data-ttu-id="39abe-541">Summary</span><span class="sxs-lookup"><span data-stu-id="39abe-541">Summary</span></span>
<span data-ttu-id="39abe-542">Questo articolo si è focalizzato sulla resilienza da una prospettiva olistica, enfatizzando alcune delle problematiche del cloud.</span><span class="sxs-lookup"><span data-stu-id="39abe-542">This article discussed resiliency from a holistic perspective, emphasizing some of the unique challenges of the cloud.</span></span> <span data-ttu-id="39abe-543">Fra queste sono inclusi la natura distribuita del cloud computing, l'uso di hardware appositi e la presenza di errori di rete temporanei.</span><span class="sxs-lookup"><span data-stu-id="39abe-543">These include the distributed nature of cloud computing, the use of commodity hardware, and the presence of transient network faults.</span></span>

<span data-ttu-id="39abe-544">Di seguito sono riportati alcuni punti chiave illustrati nell'articolo:</span><span class="sxs-lookup"><span data-stu-id="39abe-544">Here are the major points to take away from this article:</span></span>

* <span data-ttu-id="39abe-545">La resilienza comporta una maggiore disponibilità e un minore tempo medio per il ripristino dagli errori.</span><span class="sxs-lookup"><span data-stu-id="39abe-545">Resiliency leads to higher availability, and lower mean time to recover from failures.</span></span> 
* <span data-ttu-id="39abe-546">La resilienza nel cloud richiede un set di tecniche diverso dalle soluzioni locali tradizionali.</span><span class="sxs-lookup"><span data-stu-id="39abe-546">Achieving resiliency in the cloud requires a different set of techniques from traditional on-premises solutions.</span></span> 
* <span data-ttu-id="39abe-547">La resilienza non avviene per errore:</span><span class="sxs-lookup"><span data-stu-id="39abe-547">Resiliency does not happen by accident.</span></span> <span data-ttu-id="39abe-548">deve essere progettata e integrata dall'inizio.</span><span class="sxs-lookup"><span data-stu-id="39abe-548">It must be designed and built in from the start.</span></span>
* <span data-ttu-id="39abe-549">La resilienza coinvolge ogni aspetto del ciclo di vita di un'applicazione: dalla pianificazione e la codifica alle operazioni.</span><span class="sxs-lookup"><span data-stu-id="39abe-549">Resiliency touches every part of the application lifecycle, from planning and coding to operations.</span></span>
* <span data-ttu-id="39abe-550">Testa e monitora!</span><span class="sxs-lookup"><span data-stu-id="39abe-550">Test and monitor!</span></span>


<!-- links -->

[blue-green]: https://martinfowler.com/bliki/BlueGreenDeployment.html
[canary-release]: https://martinfowler.com/bliki/CanaryRelease.html
[circuit-breaker-pattern]: https://msdn.microsoft.com/library/dn589784.aspx
[compensating-transaction-pattern]: https://msdn.microsoft.com/library/dn589804.aspx
[containers]: https://en.wikipedia.org/wiki/Operating-system-level_virtualization
[dsc]: /azure/automation/automation-dsc-overview
[contingency-planning-guide]: https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-34r1.pdf
[fma]: failure-mode-analysis.md
[hystrix]: https://medium.com/netflix-techblog/introducing-hystrix-for-resilience-engineering-13531c1ab362
[jmeter]: https://jmeter.apache.org/
[load-leveling-pattern]: ../patterns/queue-based-load-leveling.md
[monitoring-guidance]: ../best-practices/monitoring.md
[ra-basic-web]: ../reference-architectures/app-service-web-app/basic-web-app.md
[ra-multi-vm]: ../reference-architectures/virtual-machines-windows/multi-vm.md
[checklist]: ../checklist/resiliency.md
[retry-pattern]: ../patterns/retry.md
[retry-service-specific guidance]: ../best-practices/retry-service-specific.md
[sla]: https://azure.microsoft.com/support/legal/sla/
[throttling-pattern]: ../patterns/throttling.md
[tm]: https://azure.microsoft.com/services/traffic-manager/
[tm-failover]: /azure/traffic-manager/traffic-manager-monitoring
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
